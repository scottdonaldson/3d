!function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){var r=e[a][1][t];return i(r?r:t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){var n=t("three.js"),i=function(t){var e,r,o,a=document.getElementById(t),s=a.clientWidth,h=a.clientHeight,c=45,u=s/h,l=.1,f=1e5;return o=new n.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),o.shadowMap.enabled=!0,r=new n.PerspectiveCamera(c,u,l,f),e=new n.Scene,e.add(r),o.setSize(s,h),t?document.getElementById(t).appendChild(o.domElement):document.body.appendChild(o.domElement),this.container={el:a,width:function(){return a.clientWidth},height:function(){return a.clientHeight}},this.scene=e,this.camera=i.normalize(r),this.renderer=o,this.objects=[],this};i.shadows=function(t){return t.castShadow=!0,t.receiveShadow=!0,t},i.normalize=function(t){return["x","y","z"].forEach(function(e){t[e]=function(t){return t?(this.position[e]=t,this):this.position[e]}}),t},i.Shape=function(){var t=new n.Shape;return t},i.Box=function(t,e,r){var i=new n.BoxGeometry(t,e,r);return i.height=e,i},i.Cylinder=function(t,e,r,i){var o=new n.CylinderGeometry(t,e,r,i);return o},i.Material=function(t,e){var r={basic:"MeshBasicMaterial",lambert:"MeshLambertMaterial",depth:"MeshDepthMaterial",phong:"MeshPhongMaterial"},i="lambert";return t in r?("object"!=typeof e||e.color?"string"==typeof e&&(e={color:e}):e.color="#fff",i=t):e="string"==typeof t?{color:t}:{color:"#fff"},new n[r[i]](e)},i.prototype.mesh=function(t,e){e||(e=i.Material());var r,n,o,a,s=new i.Mesh(t,e,this);return n=t.vertices.map(function(t){return t.y}),o=Math.max.apply(null,n),a=Math.min.apply(null,n),r=o-a,s.translateY(r/2),s},i.prototype.light=function(t,e,r,o){var a=new n.DirectionalLight(t||"#fff",e||1);return r!==!1&&(a.castShadow=!0,a.shadowMapWidth=a.shadowMapHeight=2048,a.shadowCameraLeft=-1e3,a.shadowCameraRight=1e3,a.shadowCameraBottom=-1e3,a.shadowCameraTop=1e3,o&&(a.shadowCameraVisible=!0)),this.scene.add(a),i.normalize(a)},i.Mesh=function(t,e,r){var o=new n.Mesh(t,e);return o=i.shadows(o),r.scene.add(o),i.normalize(o)},e.exports=i},{"three.js":14}],2:[function(t,e,r){function n(t,e,r,n){var i=document.createElement(t);return e&&(i.innerHTML=e),r&&r.split(" ").forEach(function(t){i.classList.add(t)}),n&&n.appendChild(i),i}function i(t,e,r){var i=n("img","","",t);i.src=e.google.profileImageURL;var h=(n("small",e.google.displayName,"block",t),new a(o.dataRef+"/users/"+e.uid)),c=n("ul",'<li class="underline">Zones:</li>',"zones tight no-list",t),u=n("button","New","new-zone-button",t);u.addEventListener("click",function(){s({title:"Name your zone!",text:"Make it a good name...",type:"input",animation:"slide-from-top"},function(t){h.push({name:t,created_at:(new Date).getTime()})})}),c.addEventListener("click",function(t){var n=t.target;n.hasAttribute("data-id")&&([].slice.apply(c.children).forEach(function(t){t.classList.remove("active")}),n.classList.add("active"),r.update(e.uid,n.getAttribute("data-id")))}),h.on("child_added",function(t){var e=document.createElement("li");e.setAttribute("data-id",t.key()),e.innerHTML=t.val().name,t.key()===r.zone()&&e.classList.add("active"),c.appendChild(e)})}var o=t("./config.js"),a=t("firebase"),s=t("sweetalert");e.exports=i},{"./config.js":5,firebase:11,sweetalert:12}],3:[function(t,e,r){e.exports=function(t){function e(e){var r=e.success,i=e.error;t.authWithOAuthPopup("google",function(t,e){return t?i(t):(n={id:e.auth.uid,name:e.google.displayName,photo:e.google.profileImageURL},r(e))})}function r(t){return t&&n[t]?n[t]:(t&&!n[t]&&console.warn("Could not find "+t+" on the user. Returning the entire user object instead."),n)}var n=!1;return{login:e,getUser:r}}},{}],4:[function(t,e,r){var n=t("three.js");n.OrbitControls=t("three-orbit-controls")(n),e.exports=function(t){var e=t.camera;e.position.x=-700,e.position.y=350,e.position.z=1100;var r=new n.OrbitControls(e,t.container.el);return r.mouseButtons={ORBIT:n.MOUSE.RIGHT,PAN:n.MOUSE.LEFT},r.maxPolarAngle=Math.PI/2,r.maxDistance=8e3,r.damping=.5,e}},{"three-orbit-controls":13,"three.js":14}],5:[function(t,e,r){var n={dataRef:"https://3-d.firebaseio.com"};e.exports=n},{}],6:[function(t,e,r){function n(){y=new f("container"),b=t("./camera.js")(y),w=t("./scene.js")(y,"google:104314934710208349695","test"),M=y.renderer,M.setClearColor("#f2e8e8");var e=new l.BoxGeometry(50,50,50);rollOverMaterial=new l.MeshBasicMaterial({color:5592575,opacity:.5,transparent:!0}),S=new l.Mesh(e,rollOverMaterial),S.visible=!1,S.position.set(25,25,25),y.scene.add(S);var r=y.mesh(f.Box(1e5,1,1e5),f.Material("lambert","#888")).y(-2);_=y.mesh(f.Box(100,1,100)),y.objects.push(_);var n=document.getElementById("time-range");x=t("./lighting.js")(y,r,n),window.addEventListener("resize",o,!1),y.container.el.addEventListener("mousemove",s,!1),y.container.el.addEventListener("mousedown",h,!1),y.container.el.addEventListener("mouseup",c,!1)}function i(){if(T){T.setFromCamera(C,b),A=[],T.intersectObjects(y.scene.children).forEach(function(t){A.push(t)});var t,e=1/0;A.forEach(function(r){r.distance<e&&(e=r.distance,t=r)})}M.render(y.scene,b),window.requestAnimationFrame(i)}function o(){b.aspect=y.container.width()/y.container.height(),b.updateProjectionMatrix(),M.setSize(y.container.width(),y.container.height())}function a(){E=!0,S.visible=!1}function s(t){if(C.x=t.offsetX/y.container.width()*2-1,C.y=2*-(t.offsetY/y.container.height())+1,m.getUser()){T.setFromCamera(C,b);var e,r=T.intersectObjects(y.objects);r.length>0?(e=r[0],S.visible=!E,S.position.copy(e.point).add(e.face.normal),S.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)):S.visible=!1}}function h(t){E&&(S.visible=!1),C.set(t.offsetX/y.container.width()*2-1,2*-(t.offsetY/y.container.height())+1),L={x:C.x,y:C.y}}function c(t){if(C.x===L.x&&C.y===L.y){T.setFromCamera(C,b);var e,r=T.intersectObjects(y.objects);r.length>0&&(e=r[0],E?w.removeVoxel(e.object):w.makeVoxel(e))}}var u=t("./config.js"),l=t("three.js"),f=t("./T.js"),p=t("firebase"),d=new p(u.dataRef),m=t("./auth.js")(d),g=document.getElementById("admin"),v=document.getElementById("login");v.addEventListener("click",function(){function e(e){v.parentNode.removeChild(v),t("./admin.js")(g,e,w)}function r(){}m.login({success:e,error:r})});var y,b,x,w,M,S,_,E=!1;n(),i();var T=new l.Raycaster,C=new l.Vector2,A=[];document.addEventListener("keydown",function(t){var e={16:a,32:x.incrementTime};t.keyCode in e&&e[t.keyCode](t)}),document.addEventListener("keyup",function(t){16===t.keyCode&&(E=!1)});var L},{"./T.js":1,"./admin.js":2,"./auth.js":3,"./camera.js":4,"./config.js":5,"./lighting.js":7,"./scene.js":8,firebase:11,"three.js":14}],7:[function(t,e,r){var n=t("three.js"),i=t("tween.js");e.exports=function(e,r,o){function a(t){function e(e,r){return r-2*(r-e)*Math.abs(t-.5)}0>t&&(t=0),t>1&&(t=1);var r,i,o;r=e(.8,.95),i=e(.5,.95),o=e(.25,.95),u.color=new n.Color(r,i,o),u.position.z=6800*(.5-t),r=e(0,.333),i=e(0,.5),o=e(.25,1),g.topColor.value=new n.Color(r,i,o),r=e(.6,.95),i=e(.6,.95),o=e(.6,.95),g.bottomColor.value=new n.Color(r,i,o),b.material.uniforms=g}function s(){x+=.005,a(x)}function h(t,e){var r=new i.Tween({time:x}),n=function(){i.update(),window.requestAnimationFrame(n)};n(),r.to({time:t},1e3*e||1e3).easing(i.Easing.Quadratic.InOut).onUpdate(function(){x=this.time,a(x)}).onComplete(function(){n=function(){}}),r.start()}var c=e.scene,u=e.light(),l=e.light("#fff",1,!1),f=r;u.position.set(-500,2500,3400),l.position.set(2e3,2500,-500),u.target=l.target=f;var p=new n.HemisphereLight("#57f","#000",.15);p.position.set(400,500,-200),c.add(p);var d=t("./shaders/vertexShader.js"),m=t("./shaders/fragmentShader.js"),g={topColor:{type:"c",value:new n.Color(30719)},bottomColor:{type:"c",value:new n.Color("#ccc")},offset:{type:"f",value:400},exponent:{type:"f",value:.6}};g.topColor.value.copy(p.color),c.fog=new n.Fog("#000",1e3,2e4),c.fog.color.copy(g.bottomColor.value);var v=new n.SphereGeometry(2e4,32,15),y=new n.ShaderMaterial({uniforms:g,vertexShader:d,fragmentShader:m,side:n.BackSide}),b=new n.Mesh(v,y);c.add(b);var x=0;a(0),o.addEventListener("change",function(){a(+this.value)}),o.addEventListener("input",function(){a(+this.value)});var w={setTime:a,incrementTime:s,animateTime:h};return window.lighting=w,w}},{"./shaders/fragmentShader.js":9,"./shaders/vertexShader.js":10,"three.js":14,"tween.js":15}],8:[function(t,e,r){function n(t){var e=+t.split(",")[0],r=+t.split(",")[1],n=+t.split(",")[2],i=new h.Vector3(e,r,n);return i}function i(t){return t[Math.floor(Math.random()*t.length)]}function o(t,e,r){function o(t,e){if(t&&e){g.user=t,g.zone=e;var r=new s(a.dataRef+"/users/"+g.user+"/"+g.zone);m=r.child("voxels"),d(),m.on("child_added",function(t){f(t.key(),t.val())})}}function u(e){var r=t.mesh(c.Box(50,50,50),c.Material(e||"#ccc"));return r}function l(t){var e="56789abcdef",r=i(e),n="#"+r+r+r,o=new h.Vector3;o.copy(t.point).add(t.face.normal),o.divideScalar(50).floor().multiplyScalar(50).addScalar(25);var a=[o.x,o.y,o.z].join(",");m.child(a).set("#"+r+r+r),f(a,n)}function f(e,r){var i=u(r),o=n(e);i._id=e,i.position.set(o.x,o.y,o.z),t.scene.add(i),t.objects.push(i)}function p(e){var r=e._id,n=t.objects.slice(0,t.objects.indexOf(e)),i=t.objects.slice(t.objects.indexOf(e)+1);r&&(m.child(r).set(null),t.scene.remove(e),t.objects=n.concat(i))}function d(){for(var e=1;e<t.objects.length;e++)t.scene.remove(t.objects[e]);t.objects=t.objects.slice(0,1)}var m,g={user:e,zone:r};return o(e,r),{update:o,makeVoxel:l,removeVoxel:p,zone:function(){return r}}}var a=t("./config.js"),s=t("firebase"),h=t("three.js"),c=t("./T.js");e.exports=o},{"./T.js":1,"./config.js":5,firebase:11,"three.js":14}],9:[function(t,e,r){e.exports=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );","}"].join("\n")},{}],10:[function(t,e,r){e.exports=["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n")},{}],11:[function(require,module,exports){!function(){function n(t){return void 0!==t}function ba(){}function ca(t){t.ub=function(){return t.uf?t.uf:t.uf=new t}}function da(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var r=Object.prototype.toString.call(t);if("[object Window]"==r)return"object";if("[object Array]"==r||"number"==typeof t.length&&"undefined"!=typeof t.splice&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==r||"undefined"!=typeof t.call&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&"undefined"==typeof t.call)return"object";return e}function ea(t){return"array"==da(t)}function fa(t){var e=da(t);return"array"==e||"object"==e&&"number"==typeof t.length}function p(t){return"string"==typeof t}function ga(t){return"number"==typeof t}function ha(t){return"function"==da(t)}function ia(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function ja(t,e,r){return t.call.apply(t.bind,arguments)}function ka(t,e,r){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),t.apply(e,r)}}return function(){return t.apply(e,arguments)}}function q(t,e,r){return q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ja:ka,q.apply(null,arguments)}function ma(t,e){function r(){}r.prototype=e.prototype,t.bh=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.Yg=function(t,r,n){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[r].apply(t,i)}}function r(t,e){for(var r in t)e.call(void 0,t[r],r,t)}function na(t,e){var r,n={};for(r in t)n[r]=e.call(void 0,t[r],r,t);return n}function oa(t,e){for(var r in t)if(!e.call(void 0,t[r],r,t))return!1;return!0}function pa(t){var e,r=0;for(e in t)r++;return r}function qa(t){for(var e in t)return e}function ra(t){var e,r=[],n=0;for(e in t)r[n++]=t[e];return r}function sa(t){var e,r=[],n=0;for(e in t)r[n++]=e;return r}function ta(t,e){for(var r in t)if(t[r]==e)return!0;return!1}function ua(t,e,r){for(var n in t)if(e.call(r,t[n],n,t))return n}function va(t,e){var r=ua(t,e,void 0);return r&&t[r]}function wa(t){for(var e in t)return!1;return!0}function xa(t){var e,r={};for(e in t)r[e]=t[e];return r}function za(t,e){for(var r,n,i=1;i<arguments.length;i++){n=arguments[i];for(r in n)t[r]=n[r];for(var o=0;o<ya.length;o++)r=ya[o],Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}}function Aa(a){if(a=String(a),/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a)}function Ba(){this.Sd=void 0}function Ca(t,e,r){switch(typeof e){case"string":Da(e,r);break;case"number":r.push(isFinite(e)&&!isNaN(e)?e:"null");break;case"boolean":r.push(e);break;case"undefined":r.push("null");break;case"object":if(null==e){r.push("null");break}if(ea(e)){var n=e.length;r.push("[");for(var i="",o=0;n>o;o++)r.push(i),i=e[o],Ca(t,t.Sd?t.Sd.call(e,String(o),i):i,r),i=",";r.push("]");break}r.push("{"),n="";for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(i=e[o],"function"!=typeof i&&(r.push(n),Da(o,r),r.push(":"),Ca(t,t.Sd?t.Sd.call(e,o,i):i,r),n=","));r.push("}");break;case"function":break;default:throw Error("Unknown type: "+typeof e)}}function Da(t,e){e.push('"',t.replace(Fa,function(t){if(t in Ea)return Ea[t];var e=t.charCodeAt(0),r="\\u";return 16>e?r+="000":256>e?r+="00":4096>e&&(r+="0"),Ea[t]=r+e.toString(16)}),'"')}function Ga(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^la()).toString(36)}function Ka(){this.Va=-1}function La(){this.Va=-1,this.Va=64,this.N=[],this.me=[],this.Wf=[],this.Ld=[],this.Ld[0]=128;for(var t=1;t<this.Va;++t)this.Ld[t]=0;this.de=this.ac=0,this.reset()}function Ma(t,e,r){r||(r=0);var n=t.Wf;if(p(e))for(var i=0;16>i;i++)n[i]=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),r+=4;else for(i=0;16>i;i++)n[i]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r+=4;for(i=16;80>i;i++){var o=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=4294967295&(o<<1|o>>>31)}e=t.N[0],r=t.N[1];for(var a,s=t.N[2],h=t.N[3],c=t.N[4],i=0;80>i;i++)40>i?20>i?(o=h^r&(s^h),a=1518500249):(o=r^s^h,a=1859775393):60>i?(o=r&s|h&(r|s),a=2400959708):(o=r^s^h,a=3395469782),o=(e<<5|e>>>27)+o+c+a+n[i]&4294967295,c=h,h=s,s=4294967295&(r<<30|r>>>2),r=e,e=o;t.N[0]=t.N[0]+e&4294967295,t.N[1]=t.N[1]+r&4294967295,t.N[2]=t.N[2]+s&4294967295,t.N[3]=t.N[3]+h&4294967295,t.N[4]=t.N[4]+c&4294967295}function Ta(t,e){var r=Ua(t,e,void 0);return 0>r?null:p(t)?t.charAt(r):t[r]}function Ua(t,e,r){for(var n=t.length,i=p(t)?t.split(""):t,o=0;n>o;o++)if(o in i&&e.call(r,i[o],o,t))return o;return-1}function Va(t,e){var r=Na(t,e);r>=0&&u.splice.call(t,r,1)}function Wa(t,e,r){return 2>=arguments.length?u.slice.call(t,e):u.slice.call(t,e,r)}function Xa(t,e){t.sort(e||Ya)}function Ya(t,e){return t>e?1:e>t?-1:0}function fb(t,e){if(!fa(t))throw Error("encodeByteArray takes an array as a parameter");gb();for(var r=e?db:cb,n=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,h=i+2<t.length,c=h?t[i+2]:0,u=o>>2,o=(3&o)<<4|s>>4,s=(15&s)<<2|c>>6,c=63&c;h||(c=64,a||(s=64)),n.push(r[u],r[o],r[s],r[c])}return n.join("")}function gb(){if(!cb){cb={},db={},eb={};for(var t=0;65>t;t++)cb[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),db[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t),eb[db[t]]=t,t>=62&&(eb["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)]=t)}}function v(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function w(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function ib(t,e){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function jb(t){var e={};return ib(t,function(t,r){e[t]=r}),e}function kb(t){var e=[];return ib(t,function(t,r){ea(r)?Oa(r,function(r){e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}),e.length?"&"+e.join("&"):""}function lb(t){var e={};return t=t.replace(/^\?/,"").split("&"),Oa(t,function(t){t&&(t=t.split("="),e[t[0]]=t[1])}),e}function x(t,e,r,n){var i;if(e>n?i="at least "+e:n>r&&(i=0===r?"none":"no more than "+r),i)throw Error(t+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+i+".")}function y(t,e,r){var n="";switch(e){case 1:n=r?"first":"First";break;case 2:n=r?"second":"Second";break;case 3:n=r?"third":"Third";break;case 4:n=r?"fourth":"Fourth";break;default:throw Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t=t+" failed: "+(n+" argument ")}function A(t,e,r,i){if((!i||n(r))&&!ha(r))throw Error(y(t,e,i)+"must be a valid function.")}function mb(t,e,r){if(n(r)&&(!ia(r)||null===r))throw Error(y(t,e,!0)+"must be a valid context object.")}function nb(t){return"undefined"!=typeof JSON&&n(JSON.parse)?JSON.parse(t):Aa(t)}function B(t){if("undefined"!=typeof JSON&&n(JSON.stringify))t=JSON.stringify(t);else{var e=[];Ca(new Ba,t,e),t=e.join("")}return t}function ob(){this.Wd=C}function pb(){}function rb(t,e,r){this.Tf=t,this.Ka=e,this.Kd=r}function vb(){this.tb=[]}function wb(t,e){for(var r=null,n=0;n<e.length;n++){var i=e[n],o=i.Zb();null===r||o.ca(r.Zb())||(t.tb.push(r),r=null),null===r&&(r=new xb(o)),r.add(i)}r&&t.tb.push(r)}function yb(t,e,r){wb(t,r),zb(t,function(t){return t.ca(e)})}function Ab(t,e,r){wb(t,r),zb(t,function(t){return t.contains(e)||e.contains(t)})}function zb(t,e){for(var r=!0,n=0;n<t.tb.length;n++){var i=t.tb[n];if(i)if(i=i.Zb(),e(i)){for(var i=t.tb[n],o=0;o<i.vd.length;o++){var a=i.vd[o];if(null!==a){i.vd[o]=null;var s=a.Vb();Bb&&Cb("event: "+a.toString()),Db(s)}}t.tb[n]=null}else r=!1}r&&(t.tb=[])}function xb(t){this.ra=t,this.vd=[]}function D(t,e,r,n){this.type=t,this.Ja=e,this.Wa=r,this.Ke=n,this.Qd=void 0}function Eb(t){return new D(Fb,t)}function Gb(t,e,r,n){this.ue=e,this.Zd=r,this.Qd=n,this.ud=t}function Hb(t,e,r){this.ue=t,this.error=e,this.path=r}function tb(t,e,r){this.A=t,this.ea=e,this.Ub=r}function Ib(t){return t.ea}function Jb(t){return t.Ub}function Kb(t,e){return e.e()?t.ea&&!t.Ub:sb(t,E(e))}function sb(t,e){return t.ea&&!t.Ub||t.A.Da(e)}function Lb(t){this.gg=t,this.Dd=null}function Mb(t,e){this.Of={},this.fd=new Lb(t),this.ba=e;var r=1e4+2e4*Math.random();setTimeout(q(this.If,this),Math.floor(r))}function Nb(){this.Ec={}}function Ob(t,e,r){n(r)||(r=1),v(t.Ec,e)||(t.Ec[e]=0),t.Ec[e]+=r}function Rb(t){return t=t.toString(),Pb[t]||(Pb[t]=new Nb),Pb[t]}function Sb(t,e){var r=t.toString();return Qb[r]||(Qb[r]=e()),Qb[r]}function F(t,e){this.name=t,this.S=e}function Tb(t,e){return new F(t,e)}function Ub(t,e){return Vb(t.name,e.name)}function Wb(t,e){return Vb(t,e)}function Xb(t,e,r){this.type=Yb,this.source=t,this.path=e,this.Ga=r}function Zb(t,e){this.type=$b,this.source=t,this.path=e}function ac(t,e){this.La=t,this.wa=e?e:bc}function cc(t,e){for(var r,n=t.wa,i=null;!n.e();){if(r=t.La(e,n.key),0===r){if(n.left.e())return i?i.key:null;for(n=n.left;!n.right.e();)n=n.right;return n.key}0>r?n=n.left:r>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}function dc(t,e,r,n,i){for(this.Ud=i||null,this.Fe=n,this.Pa=[],i=1;!t.e();)if(i=e?r(t.key,e):1,n&&(i*=-1),0>i)t=this.Fe?t.left:t.right;else{if(0===i){this.Pa.push(t);break}this.Pa.push(t),t=this.Fe?t.right:t.left}}function J(t){if(0===t.Pa.length)return null;var e,r=t.Pa.pop();if(e=t.Ud?t.Ud(r.key,r.value):{key:r.key,value:r.value},t.Fe)for(r=r.left;!r.e();)t.Pa.push(r),r=r.right;else for(r=r.right;!r.e();)t.Pa.push(r),r=r.left;return e}function ec(t){if(0===t.Pa.length)return null;var e;return e=t.Pa,e=e[e.length-1],t.Ud?t.Ud(e.key,e.value):{key:e.key,value:e.value}}function fc(t,e,r,n,i){this.key=t,this.value=e,this.color=null!=r?r:!0,this.left=null!=n?n:bc,this.right=null!=i?i:bc}function gc(t){return t.left.e()?t:gc(t.left)}function ic(t){return t.left.e()?bc:(t.left.fa()||t.left.left.fa()||(t=jc(t)),t=t.Y(null,null,null,ic(t.left),null),hc(t))}function hc(t){return t.right.fa()&&!t.left.fa()&&(t=mc(t)),t.left.fa()&&t.left.left.fa()&&(t=kc(t)),t.left.fa()&&t.right.fa()&&(t=lc(t)),t}function jc(t){return t=lc(t),t.right.left.fa()&&(t=t.Y(null,null,null,null,kc(t.right)),t=mc(t),t=lc(t)),t}function mc(t){return t.right.Y(null,null,t.color,t.Y(null,null,!0,null,t.right.left),null)}function kc(t){return t.left.Y(null,null,t.color,null,t.Y(null,null,!0,t.left.right,null))}function lc(t){return t.Y(null,null,!t.color,t.left.Y(null,null,!t.left.color,null,null),t.right.Y(null,null,!t.right.color,null,null))}function nc(){}function oc(t,e){return t&&"object"==typeof t?(K(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}function pc(t,e){var r=new qc;return rc(t,new L(""),function(t,n){r.nc(t,sc(n,e))}),r}function sc(t,e){var r,n=t.C().I(),n=oc(n,e);if(t.K()){var i=oc(t.Ca(),e);return i!==t.Ca()||n!==t.C().I()?new tc(i,M(n)):t}return r=t,n!==t.C().I()&&(r=r.ga(new tc(n))),t.P(N,function(t,n){var i=sc(n,e);i!==n&&(r=r.U(t,i))}),r}function uc(){this.wc={}}function vc(t){this.Fc=t,this.Pd="firebase:"}function wc(t){try{if("undefined"!=typeof window&&"undefined"!=typeof window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vc(e)}}catch(r){}return new uc}function zc(t,e,r,n,i){this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.kb=e,this.hc=r,this.Wg=n,this.Od=i||"",this.Ya=xc.get("host:"+t)||this.host}function Ac(t,e){e!==t.Ya&&(t.Ya=e,"s-"===t.Ya.substr(0,2)&&xc.set("host:"+t.host,t.Ya))}function Bc(t,e,n){if(K("string"==typeof e,"typeof type must == string"),K("object"==typeof n,"typeof params must == object"),e===Cc)e=(t.kb?"wss://":"ws://")+t.Ya+"/.ws?";else{if(e!==Dc)throw Error("Unknown connection type: "+e);e=(t.kb?"https://":"http://")+t.Ya+"/.lp?"}t.host!==t.Ya&&(n.ns=t.hc);var i=[];return r(n,function(t,e){i.push(e+"="+t)}),e+i.join("&")}function K(t,e){if(!t)throw Fc(e)}function Fc(t){return Error("Firebase ("+hb+") INTERNAL ASSERT FAILED: "+t)}function Gc(t){try{var e;if("undefined"!=typeof atob)e=atob(t);else{gb();for(var r=eb,n=[],i=0;i<t.length;){var o=r[t.charAt(i++)],a=i<t.length?r[t.charAt(i)]:0;++i;var s=i<t.length?r[t.charAt(i)]:64;++i;var h=i<t.length?r[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==h)throw Error();n.push(o<<2|a>>4),64!=s&&(n.push(a<<4&240|s>>2),64!=h&&n.push(s<<6&192|h))}if(8192>n.length)e=String.fromCharCode.apply(null,n);else{for(t="",r=0;r<n.length;r+=8192)t+=String.fromCharCode.apply(null,Wa(n,r,r+8192));e=t}}return e}catch(c){Cb("base64Decode failed: ",c)}return null}function Hc(t){var e=Ic(t);t=new La,t.update(e);var e=[],r=8*t.de;56>t.ac?t.update(t.Ld,56-t.ac):t.update(t.Ld,t.Va-(t.ac-56));for(var n=t.Va-1;n>=56;n--)t.me[n]=255&r,r/=256;for(Ma(t,t.me),n=r=0;5>n;n++)for(var i=24;i>=0;i-=8)e[r]=t.N[n]>>i&255,++r;return fb(e)}function Jc(t){for(var e="",r=0;r<arguments.length;r++)e=fa(arguments[r])?e+Jc.apply(null,arguments[r]):"object"==typeof arguments[r]?e+B(arguments[r]):e+arguments[r],e+=" ";return e}function Cb(t){if(!0===Kc&&(Kc=!1,null===Bb&&!0===yc.get("logging_enabled")&&Lc(!0)),Bb){var e=Jc.apply(null,arguments);Bb(e)}}function Mc(t){return function(){Cb(t,arguments)}}function Nc(t){if("undefined"!=typeof console){var e="FIREBASE INTERNAL ERROR: "+Jc.apply(null,arguments);"undefined"!=typeof console.error?console.error(e):console.log(e)}}function Oc(t){var e=Jc.apply(null,arguments);throw Error("FIREBASE FATAL ERROR: "+e)}function O(t){if("undefined"!=typeof console){var e="FIREBASE WARNING: "+Jc.apply(null,arguments);"undefined"!=typeof console.warn?console.warn(e):console.log(e)}}function Pc(t){var e="",r="",n="",i="",o=!0,a="https",s=443;if(p(t)){var h=t.indexOf("//");for(h>=0&&(a=t.substring(0,h-1),t=t.substring(h+2)),h=t.indexOf("/"),-1===h&&(h=t.length),e=t.substring(0,h),i="",t=t.substring(h).split("/"),h=0;h<t.length;h++)if(0<t[h].length){var c=t[h];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch(u){}i+="/"+c}t=e.split("."),3===t.length?(r=t[1],n=t[0].toLowerCase()):2===t.length&&(r=t[0]),h=e.indexOf(":"),h>=0&&(o="https"===a||"wss"===a,s=e.substring(h+1),isFinite(s)&&(s=String(s)),s=p(s)?/^\s*-?0x/i.test(s)?parseInt(s,16):parseInt(s,10):NaN)}return{host:e,port:s,domain:r,Tg:n,kb:o,scheme:a,$c:i}}function Qc(t){return ga(t)&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function Rc(t){if("complete"===document.readyState)t();else{var e=!1,r=function(){document.body?e||(e=!0,t()):setTimeout(r,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&r()}),window.attachEvent("onload",r))}}function Vb(t,e){if(t===e)return 0;if("[MIN_NAME]"===t||"[MAX_NAME]"===e)return-1;if("[MIN_NAME]"===e||"[MAX_NAME]"===t)return 1;var r=Sc(t),n=Sc(e);return null!==r?null!==n?0==r-n?t.length-e.length:r-n:-1:null!==n?1:e>t?-1:1}function Tc(t,e){if(e&&t in e)return e[t];throw Error("Missing required key ("+t+") in object: "+B(e))}function Uc(t){if("object"!=typeof t||null===t)return B(t);var e,r=[];for(e in t)r.push(e);r.sort(),e="{";for(var n=0;n<r.length;n++)0!==n&&(e+=","),e+=B(r[n]),e+=":",e+=Uc(t[r[n]]);return e+"}"}function Vc(t,e){if(t.length<=e)return[t];for(var r=[],n=0;n<t.length;n+=e)n+e>t?r.push(t.substring(n,t.length)):r.push(t.substring(n,n+e));return r}function Wc(t,e){if(ea(t))for(var n=0;n<t.length;++n)e(n,t[n]);else r(t,e)}function Xc(t){K(!Qc(t),"Invalid JSON number");var e,r,n,i;for(0===t?(n=r=0,e=-(1/0)===1/t?1:0):(e=0>t,t=Math.abs(t),t>=Math.pow(2,-1022)?(n=Math.min(Math.floor(Math.log(t)/Math.LN2),1023),r=n+1023,n=Math.round(t*Math.pow(2,52-n)-Math.pow(2,52))):(r=0,n=Math.round(t/Math.pow(2,-1074)))),i=[],t=52;t;--t)i.push(n%2?1:0),n=Math.floor(n/2);for(t=11;t;--t)i.push(r%2?1:0),r=Math.floor(r/2);for(i.push(e?1:0),i.reverse(),e=i.join(""),r="",t=0;64>t;t+=8)n=parseInt(e.substr(t,8),2).toString(16),1===n.length&&(n="0"+n),r+=n;return r.toLowerCase()}function Sc(t){return Yc.test(t)&&(t=Number(t),t>=-2147483648&&2147483647>=t)?t:null}function Db(t){try{t()}catch(e){setTimeout(function(){throw O("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}}function P(t,e){if(ha(t)){var r=Array.prototype.slice.call(arguments,1).slice();Db(function(){t.apply(null,r)})}}function Ic(t){for(var e=[],r=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);i>=55296&&56319>=i&&(i-=55296,n++,K(n<t.length,"Surrogate pair missing trail surrogate."),i=65536+(i<<10)+(t.charCodeAt(n)-56320)),128>i?e[r++]=i:(2048>i?e[r++]=i>>6|192:(65536>i?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return e}function Zc(t){for(var e=0,r=0;r<t.length;r++){var n=t.charCodeAt(r);128>n?e++:2048>n?e+=2:n>=55296&&56319>=n?(e+=4,r++):e+=3}return e}function $c(t){var e={},r={},n={},i="";try{var o=t.split("."),e=nb(Gc(o[0])||""),r=nb(Gc(o[1])||""),i=o[2],n=r.d||{};delete r.d}catch(a){}return{Zg:e,Bc:r,data:n,Qg:i}}function ad(t){return t=$c(t).Bc,"object"==typeof t&&t.hasOwnProperty("iat")?w(t,"iat"):null}function bd(t){t=$c(t);var e=t.Bc;return!!t.Qg&&!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}function cd(t){this.W=t,this.g=t.n.g}function dd(t,e,r,n){var i=[],o=[];return Oa(e,function(e){"child_changed"===e.type&&t.g.Ad(e.Ke,e.Ja)&&o.push(new D("child_moved",e.Ja,e.Wa))}),ed(t,i,"child_removed",e,n,r),ed(t,i,"child_added",e,n,r),ed(t,i,"child_moved",o,n,r),ed(t,i,"child_changed",e,n,r),ed(t,i,Fb,e,n,r),i}function ed(t,e,r,n,i,o){n=Pa(n,function(t){return t.type===r}),Xa(n,q(t.hg,t)),Oa(n,function(r){var n=fd(t,r,o);Oa(i,function(i){i.Kf(r.type)&&e.push(i.createEvent(n,t.W))})})}function fd(t,e,r){return"value"!==e.type&&"child_removed"!==e.type&&(e.Qd=r.rf(e.Wa,e.Ja,t.g)),e}function gd(){this.bb={}}function hd(t,e){var r=e.type,n=e.Wa;K("child_added"==r||"child_changed"==r||"child_removed"==r,"Only child changes supported for tracking"),K(".priority"!==n,"Only non-priority child changes can be tracked.");var i=w(t.bb,n);if(i){var o=i.type;if("child_added"==r&&"child_removed"==o)t.bb[n]=new D("child_changed",e.Ja,n,i.Ja);else if("child_removed"==r&&"child_added"==o)delete t.bb[n];else if("child_removed"==r&&"child_changed"==o)t.bb[n]=new D("child_removed",i.Ke,n);else if("child_changed"==r&&"child_added"==o)t.bb[n]=new D("child_added",e.Ja,n);else{if("child_changed"!=r||"child_changed"!=o)throw Fc("Illegal combination of changes: "+e+" occurred after "+i);t.bb[n]=new D("child_changed",e.Ja,n,i.Ke)}}else t.bb[n]=e}function id(t,e,r){this.Rb=t,this.pb=e,this.rb=r||null}function jd(t,e,r){this.ha=t,this.pb=e,this.rb=r}function kd(t){this.g=t}function ld(t){this.Be=new kd(t.g),this.g=t.g;var e;t.ma?(e=md(t),e=t.g.Pc(nd(t),e)):e=t.g.Tc(),this.ed=e,t.pa?(e=od(t),t=t.g.Pc(pd(t),e)):t=t.g.Qc(),this.Gc=t}function qd(t){this.sa=new ld(t),this.g=t.g,K(t.ja,"Only valid if limit has been set"),this.ka=t.ka,this.Jb=!rd(t)}function sd(t,e,r,n,i,o){var a;if(t.Jb){var s=td(t.g);a=function(t,e){return s(e,t)}}else a=td(t.g);K(e.Db()==t.ka,"");var h=new F(r,n),c=t.Jb?ud(e,t.g):vd(e,t.g),u=t.sa.matches(h);if(e.Da(r)){for(var l=e.R(r),c=i.ye(t.g,c,t.Jb);null!=c&&(c.name==r||e.Da(c.name));)c=i.ye(t.g,c,t.Jb);return i=null==c?1:a(c,h),u&&!n.e()&&i>=0?(null!=o&&hd(o,new D("child_changed",n,r,l)),e.U(r,n)):(null!=o&&hd(o,new D("child_removed",l,r)),e=e.U(r,C),null!=c&&t.sa.matches(c)?(null!=o&&hd(o,new D("child_added",c.S,c.name)),e.U(c.name,c.S)):e)}return n.e()?e:u&&0<=a(c,h)?(null!=o&&(hd(o,new D("child_removed",c.S,c.name)),hd(o,new D("child_added",n,r))),e.U(r,n).U(c.name,C)):e}function wd(t,e){this.je=t,this.fg=e}function xd(t){this.V=t}function Hd(t,e,r,n,i,o){var a=e.O;if(null!=n.tc(r))return e;var s;if(r.e())K(Ib(e.w()),"If change path is empty, we must have complete server data"),Jb(e.w())?(i=ub(e),n=n.yc(i instanceof R?i:C)):n=n.za(ub(e)),o=t.V.xa(e.O.j(),n,o);else{var h=E(r);if(".priority"==h)K(1==Kd(r),"Can't have a priority with additional path components"),o=a.j(),s=e.w().j(),n=n.ld(r,o,s),o=null!=n?t.V.ga(o,n):a.j();else{var c=H(r);sb(a,h)?(s=e.w().j(),n=n.ld(r,a.j(),s),n=null!=n?a.j().R(h).G(c,n):a.j().R(h)):n=n.xc(h,e.w()),o=null!=n?t.V.G(a.j(),h,n,c,i,o):a.j()}}return Fd(e,o,a.ea||r.e(),t.V.Na())}function Ad(t,e,r,n,i,o,a,s){var h=e.w();if(a=a?t.V:t.V.Wb(),r.e())n=a.xa(h.j(),n,null);else if(a.Na()&&!h.Ub)n=h.j().G(r,n),n=a.xa(h.j(),n,null);else{var c=E(r);if(!Kb(h,r)&&1<Kd(r))return e;var u=H(r);n=h.j().R(c).G(u,n),n=".priority"==c?a.ga(h.j(),n):a.G(h.j(),c,n,u,qb,null)}return h=h.ea||r.e(),e=new Id(e.O,new tb(n,h,a.Na())),Hd(t,e,r,i,new rb(i,e,o),s)}function yd(t,e,r,n,i,o,a){var s=e.O;if(i=new rb(i,e,o),r.e())a=t.V.xa(e.O.j(),n,a),t=Fd(e,a,!0,t.V.Na());else if(o=E(r),".priority"===o)a=t.V.ga(e.O.j(),n),t=Fd(e,a,s.ea,s.Ub);else{r=H(r);var h=s.j().R(o);if(!r.e()){var c=i.qf(o);n=null!=c?".priority"===Ld(r)&&c.Q(r.parent()).e()?c:c.G(r,n):C;
}h.ca(n)?t=e:(a=t.V.G(s.j(),o,n,r,i,a),t=Fd(e,a,s.ea,t.V.Na()))}return t}function Cd(t,e,r,n,i,o,a){var s=e;return Md(n,function(n,h){var c=r.u(n);sb(e.O,E(c))&&(s=yd(t,s,c,h,i,o,a))}),Md(n,function(n,h){var c=r.u(n);sb(e.O,E(c))||(s=yd(t,s,c,h,i,o,a))}),s}function Nd(t,e){return Md(e,function(e,r){t=t.G(e,r)}),t}function Dd(t,e,r,n,i,o,a,s){if(e.w().j().e()&&!Ib(e.w()))return e;var h=e;r=r.e()?n:Od(Pd,r,n);var c=e.w().j();return r.children.ia(function(r,n){if(c.Da(r)){var u=e.w().j().R(r),u=Nd(u,n);h=Ad(t,h,new L(r),u,i,o,a,s)}}),r.children.ia(function(r,n){var u=!sb(e.w(),r)&&null==n.value;c.Da(r)||u||(u=e.w().j().R(r),u=Nd(u,n),h=Ad(t,h,new L(r),u,i,o,a,s))}),h}function Gd(t,e,r,n,i,o,a){if(null!=i.tc(r))return e;var s=Jb(e.w()),h=e.w();if(null!=n.value){if(r.e()&&h.ea||Kb(h,r))return Ad(t,e,r,h.j().Q(r),i,o,s,a);if(r.e()){var c=Pd;return h.j().P(Qd,function(t,e){c=c.set(new L(t),e)}),Dd(t,e,r,c,i,o,s,a)}return e}return c=Pd,Md(n,function(t){var e=r.u(t);Kb(h,e)&&(c=c.set(t,h.j().Q(e)))}),Dd(t,e,r,c,i,o,s,a)}function Rd(){}function td(t){return q(t.compare,t)}function Ud(t){K(!t.e()&&".priority"!==E(t),"Can't create PathIndex with empty path or .priority key"),this.cc=t}function Wd(){}function Xd(){}function Yd(){}function ae(){this.Tb=this.pa=this.Lb=this.ma=this.ja=!1,this.ka=0,this.Nb="",this.ec=null,this.xb="",this.bc=null,this.vb="",this.g=N}function rd(t){return""===t.Nb?t.ma:"l"===t.Nb}function nd(t){return K(t.ma,"Only valid if start has been set"),t.ec}function md(t){return K(t.ma,"Only valid if start has been set"),t.Lb?t.xb:"[MIN_NAME]"}function pd(t){return K(t.pa,"Only valid if end has been set"),t.bc}function od(t){return K(t.pa,"Only valid if end has been set"),t.Tb?t.vb:"[MAX_NAME]"}function ce(t){var e=new ae;return e.ja=t.ja,e.ka=t.ka,e.ma=t.ma,e.ec=t.ec,e.Lb=t.Lb,e.xb=t.xb,e.pa=t.pa,e.bc=t.bc,e.Tb=t.Tb,e.vb=t.vb,e.g=t.g,e}function de(t,e){var r=ce(t);return r.g=e,r}function ee(t){var e={};if(t.ma&&(e.sp=t.ec,t.Lb&&(e.sn=t.xb)),t.pa&&(e.ep=t.bc,t.Tb&&(e.en=t.vb)),t.ja){e.l=t.ka;var r=t.Nb;""===r&&(r=rd(t)?"l":"r"),e.vf=r}return t.g!==N&&(e.i=t.g.toString()),e}function S(t){return!(t.ma||t.pa||t.ja)}function fe(t){return S(t)&&t.g==N}function ge(t){var e={};if(fe(t))return e;var r;return t.g===N?r="$priority":t.g===$d?r="$value":t.g===Qd?r="$key":(K(t.g instanceof Ud,"Unrecognized index type!"),r=t.g.toString()),e.orderBy=B(r),t.ma&&(e.startAt=B(t.ec),t.Lb&&(e.startAt+=","+B(t.xb))),t.pa&&(e.endAt=B(t.bc),t.Tb&&(e.endAt+=","+B(t.vb))),t.ja&&(rd(t)?e.limitToFirst=t.ka:e.limitToLast=t.ka),e}function he(t,e){this.Bd=t,this.dc=e}function ie(t,e,r){var n=na(t.Bd,function(n,i){var o=w(t.dc,i);if(K(o,"Missing index implementation for "+i),n===Sd){if(o.Ic(e.S)){for(var a=[],s=r.Xb(Tb),h=J(s);h;)h.name!=e.name&&a.push(h),h=J(s);return a.push(e),je(a,td(o))}return Sd}return o=r.get(e.name),a=n,o&&(a=a.remove(new F(e.name,o))),a.Oa(e,e.S)});return new he(n,t.dc)}function ke(t,e,r){var n=na(t.Bd,function(t){if(t===Sd)return t;var n=r.get(e.name);return n?t.remove(new F(e.name,n)):t});return new he(n,t.dc)}function tc(t,e){this.B=t,K(n(this.B)&&null!==this.B,"LeafNode shouldn't be created with null/undefined value."),this.aa=e||C,me(this.aa),this.Cb=null}function R(t,e,r){this.m=t,(this.aa=e)&&me(this.aa),t.e()&&K(!this.aa||this.aa.e(),"An empty node cannot have a priority"),this.wb=r,this.Cb=null}function ud(t,e){var r;return r=(r=qe(t,e))?(r=r.Sc())&&r.name:t.m.Sc(),r?new F(r,t.m.get(r)):null}function vd(t,e){var r;return r=(r=qe(t,e))?(r=r.fc())&&r.name:t.m.fc(),r?new F(r,t.m.get(r)):null}function qe(t,e){return e===Qd?null:t.wb.get(e.toString())}function M(t,e){if(null===t)return C;var n=null;if("object"==typeof t&&".priority"in t?n=t[".priority"]:"undefined"!=typeof e&&(n=e),K(null===n||"string"==typeof n||"number"==typeof n||"object"==typeof n&&".sv"in n,"Invalid priority type found: "+typeof n),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new tc(t,M(n));if(t instanceof Array){var i=C,o=t;return r(o,function(t,e){if(v(o,e)&&"."!==e.substring(0,1)){var r=M(t);(r.K()||!r.e())&&(i=i.U(e,r))}}),i.ga(M(n))}var a=[],s=!1,h=t;if(ib(h,function(t){if("string"!=typeof t||"."!==t.substring(0,1)){var e=M(h[t]);e.e()||(s=s||!e.C().e(),a.push(new F(t,e)))}}),0==a.length)return C;var c=je(a,Ub,function(t){return t.name},Wb);if(s){var u=je(a,td(N));return new R(c,M(n),new he({".priority":u},{".priority":N}))}return new R(c,M(n),le)}function se(t){this.count=parseInt(Math.log(t+1)/re,10),this.jf=this.count-1,this.eg=t+1&parseInt(Array(this.count+1).join("1"),2)}function te(t){var e=!(t.eg&1<<t.jf);return t.jf--,e}function je(t,e,r,n){function i(e,n){var o=n-e;if(0==o)return null;if(1==o){var a=t[e],s=r?r(a):a;return new fc(s,a.S,!1,null,null)}var a=parseInt(o/2,10)+e,o=i(e,a),h=i(a+1,n),a=t[a],s=r?r(a):a;return new fc(s,a.S,!1,o,h)}t.sort(e);var o=function(e){function n(e,n){var h=s-e,c=s;s-=e;var c=i(h+1,c),h=t[h],u=r?r(h):h,c=new fc(u,h.S,n,null,c);o?o.left=c:a=c,o=c}for(var o=null,a=null,s=t.length,h=0;h<e.count;++h){var c=te(e),u=Math.pow(2,e.count-(h+1));c?n(u,!1):(n(u,!1),n(u,!0))}return a}(new se(t.length));return null!==o?new ac(n||e,o):new ac(n||e)}function oe(t){return"number"==typeof t?"number:"+Xc(t):"string:"+t}function me(t){if(t.K()){var e=t.I();K("string"==typeof e||"number"==typeof e||"object"==typeof e&&v(e,".sv"),"Priority must be a string or number.")}else K(t===Vd||t.e(),"priority of unexpected type.");K(t===Vd||t.C().e(),"Priority nodes can't have a priority of their own.")}function ue(){R.call(this,new ac(Wb),C,le)}function Id(t,e){this.O=t,this.Yd=e}function Fd(t,e,r,n){return new Id(new tb(e,r,n),t.Yd)}function Jd(t){return t.O.ea?t.O.j():null}function ub(t){return t.Yd.ea?t.Yd.j():null}function ve(t,e){this.W=t;var r=t.n,n=new kd(r.g),r=S(r)?new kd(r.g):r.ja?new qd(r):new ld(r);this.Hf=new xd(r);var i=e.w(),o=e.O,a=n.xa(C,i.j(),null),s=r.xa(C,o.j(),null);this.Ka=new Id(new tb(s,o.ea,r.Na()),new tb(a,i.ea,n.Na())),this.Xa=[],this.lg=new cd(t)}function we(t){return t.W}function ye(t,e){var r=t.Ka.O,n=[];return r.j().K()||r.j().P(N,function(t,e){n.push(new D("child_added",e,t))}),r.ea&&n.push(Eb(r.j())),xe(t,n,r.j(),e)}function xe(t,e,r,n){return dd(t.lg,e,r,n?[n]:t.Xa)}function ze(t,e,r){this.type=Bd,this.source=t,this.path=e,this.children=r}function Ae(t,e){this.f=Mc("p:rest:"),this.F=t,this.Gb=e,this.Aa=null,this.$={}}function Be(t,e){return n(e)?"tag$"+e:(K(fe(t.n),"should have a tag if it's not a default query."),t.path.toString())}function Ce(t,e,r,n){r=r||{},r.format="export",t.Aa&&(r.auth=t.Aa);var i=(t.F.kb?"https://":"http://")+t.F.host+e+"?"+kb(r);t.f("Sending REST request for "+i);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(n&&4===o.readyState){t.f("REST Response for "+i+" received. status:",o.status,"response:",o.responseText);var e=null;if(200<=o.status&&300>o.status){try{e=nb(o.responseText)}catch(r){O("Failed to parse JSON response for "+i+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&O("Got unsuccessful REST response for "+i+" Status: "+o.status),n(o.status);n=null}},o.open("GET",i,!0),o.send()}function De(t){K(ea(t)&&0<t.length,"Requires a non-empty array"),this.Xf=t,this.Oc={}}function Ee(t,e){K(Ta(t.Xf,function(t){return t===e}),"Unknown event: "+e)}function Ge(){if(De.call(this,["online"]),this.kc=!0,"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener){var t=this;window.addEventListener("online",function(){t.kc||(t.kc=!0,t.fe("online",!0))},!1),window.addEventListener("offline",function(){t.kc&&(t.kc=!1,t.fe("online",!1))},!1)}}function He(){De.call(this,["visible"]);var t,e;if("undefined"!=typeof document&&"undefined"!=typeof document.addEventListener&&("undefined"!=typeof document.hidden?(e="visibilitychange",t="hidden"):"undefined"!=typeof document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):"undefined"!=typeof document.msHidden?(e="msvisibilitychange",t="msHidden"):"undefined"!=typeof document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.Ob=!0,e){var r=this;document.addEventListener(e,function(){var e=!document[t];e!==r.Ob&&(r.Ob=e,r.fe("visible",e))},!1)}}function L(t,e){if(1==arguments.length){this.o=t.split("/");for(var r=0,n=0;n<this.o.length;n++)0<this.o[n].length&&(this.o[r]=this.o[n],r++);this.o.length=r,this.Z=0}else this.o=t,this.Z=e}function T(t,e){var r=E(t);if(null===r)return e;if(r===E(e))return T(H(t),H(e));throw Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Ie(t,e){for(var r=t.slice(),n=e.slice(),i=0;i<r.length&&i<n.length;i++){var o=Vb(r[i],n[i]);if(0!==o)return o}return r.length===n.length?0:r.length<n.length?-1:1}function E(t){return t.Z>=t.o.length?null:t.o[t.Z]}function Kd(t){return t.o.length-t.Z}function H(t){var e=t.Z;return e<t.o.length&&e++,new L(t.o,e)}function Ld(t){return t.Z<t.o.length?t.o[t.o.length-1]:null}function Je(t,e){this.Qa=t.slice(),this.Ha=Math.max(1,this.Qa.length),this.lf=e;for(var r=0;r<this.Qa.length;r++)this.Ha+=Zc(this.Qa[r]);Ke(this)}function Ke(t){if(768<t.Ha)throw Error(t.lf+"has a key path longer than 768 bytes ("+t.Ha+").");if(32<t.Qa.length)throw Error(t.lf+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Le(t))}function Le(t){return 0==t.Qa.length?"":"in property '"+t.Qa.join(".")+"'"}function Me(t,e){this.value=t,this.children=e||Ne}function Oe(t){var e=Pd;return r(t,function(t,r){e=e.set(new L(r),t)}),e}function Pe(t,e,r){if(null!=t.value&&r(t.value))return{path:G,value:t.value};if(e.e())return null;var n=E(e);return t=t.children.get(n),null!==t?(e=Pe(t,H(e),r),null!=e?{path:new L(n).u(e.path),value:e.value}:null):null}function Qe(t,e){return Pe(t,e,function(){return!0})}function Od(t,e,r){if(e.e())return r;var n=E(e);return e=Od(t.children.get(n)||Pd,H(e),r),n=e.e()?t.children.remove(n):t.children.Oa(n,e),new Me(t.value,n)}function Re(t,e){return Se(t,G,e)}function Se(t,e,r){var n={};return t.children.ia(function(t,i){n[t]=Se(i,e.u(t),r)}),r(e,t.value,n)}function Te(t,e,r){return Ue(t,e,G,r)}function Ue(t,e,r,n){var i=t.value?n(r,t.value):!1;return i?i:e.e()?null:(i=E(e),(t=t.children.get(i))?Ue(t,H(e),r.u(i),n):null)}function Ve(t,e,r){var n=G;if(!e.e()){var i=!0;t.value&&(i=r(n,t.value)),!0===i&&(i=E(e),(t=t.children.get(i))&&We(t,H(e),n.u(i),r))}}function We(t,e,r,n){if(e.e())return t;t.value&&n(r,t.value);var i=E(e);return(t=t.children.get(i))?We(t,H(e),r.u(i),n):Pd}function Md(t,e){Xe(t,G,e)}function Xe(t,e,r){t.children.ia(function(t,n){Xe(n,e.u(t),r)}),t.value&&r(e,t.value)}function Ye(t,e){t.children.ia(function(t,r){r.value&&e(t,r.value)})}function Ze(t,e,r){this.type=Ed,this.source=$e,this.path=t,this.Qb=e,this.Vd=r}function af(t,e,r,n){this.we=t,this.pf=e,this.Hb=r,this.af=n,K(!n||e,"Tagged queries must be from server.")}function cf(t){this.X=t}function ef(t,e,r){if(e.e())return new cf(new Me(r));var n=Qe(t.X,e);if(null!=n){var i=n.path,n=n.value;return e=T(i,e),n=n.G(e,r),new cf(t.X.set(i,n))}return t=Od(t.X,e,new Me(r)),new cf(t)}function ff(t,e,r){var n=t;return ib(r,function(t,r){n=ef(n,e.u(t),r)}),n}function gf(t,e){var r=Qe(t.X,e);return null!=r?t.X.get(r.path).Q(T(r.path,e)):null}function hf(t){var e=[],r=t.X.value;return null!=r?r.K()||r.P(N,function(t,r){e.push(new F(t,r))}):t.X.children.ia(function(t,r){null!=r.value&&e.push(new F(t,r.value))}),e}function jf(t,e){if(e.e())return t;var r=gf(t,e);return new cf(null!=r?new Me(r):t.X.subtree(e))}function kf(t,e,r){if(null!=e.value)return r.G(t,e.value);var n=null;return e.children.ia(function(e,i){".priority"===e?(K(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):r=kf(t.u(e),i,r)}),r.Q(t).e()||null===n||(r=r.G(t.u(".priority"),n)),r}function lf(){this.T=df,this.na=[],this.Mc=-1}function mf(t,e){for(var r=0;r<t.na.length;r++){var n=t.na[r];if(n.kd===e)return n}return null}function nf(t,e){return t.Ga?t.path.contains(e):!!ua(t.children,function(r,n){return t.path.u(n).contains(e)})}function pf(t){return t.visible}function of(t,e,r){for(var n=df,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path;if(o.Ga)r.contains(a)?(a=T(r,a),n=ef(n,a,o.Ga)):a.contains(r)&&(a=T(a,r),n=ef(n,G,o.Ga.Q(a)));else{if(!o.children)throw Fc("WriteRecord should have .snap or .children");r.contains(a)?(a=T(r,a),n=ff(n,a,o.children)):a.contains(r)&&(a=T(a,r),a.e()?n=ff(n,G,o.children):(o=w(o.children,E(a)))&&(o=o.Q(H(a)),n=ef(n,G,o)))}}}return n}function qf(t,e){this.Mb=t,this.X=e}function rf(){this.ya={}}function tf(t){return Pa(ra(t.ya),function(t){return!S(t.W.n)})}function uf(t,e){if(S(e.n))return sf(t);var r=e.va();return w(t.ya,r)}function sf(t){return va(t.ya,function(t){return S(t.W.n)})||null}function vf(t){this.ta=Pd,this.ib=new lf,this.$e={},this.mc={},this.Nc=t}function wf(t,e,r,i,o){var a=t.ib,s=o;return K(i>a.Mc,"Stacking an older write on top of newer ones"),n(s)||(s=!0),a.na.push({path:e,Ga:r,kd:i,visible:s}),s&&(a.T=ef(a.T,e,r)),a.Mc=i,o?xf(t,new Xb($e,e,r)):[]}function yf(t,e,r,n){var i=t.ib;return K(n>i.Mc,"Stacking an older merge on top of newer ones"),i.na.push({path:e,children:r,kd:n,visible:!0}),i.T=ff(i.T,e,r),i.Mc=n,r=Oe(r),xf(t,new ze($e,e,r))}function zf(t,e,r){r=r||!1;var n=mf(t.ib,e);if(t.ib.Rd(e)){var i=Pd;return null!=n.Ga?i=i.set(G,!0):ib(n.children,function(t,e){i=i.set(new L(t),e)}),xf(t,new Ze(n.path,i,r))}return[]}function Af(t,e,r){return r=Oe(r),xf(t,new ze(bf,e,r))}function Bf(t,e,r,n){if(n=Cf(t,n),null!=n){var i=Df(n);return n=i.path,i=i.Hb,e=T(n,e),r=new Xb(new af(!1,!0,i,!0),e,r),Ef(t,n,r)}return[]}function Ff(t,e,r,n){if(n=Cf(t,n)){var i=Df(n);return n=i.path,i=i.Hb,e=T(n,e),r=Oe(r),r=new ze(new af(!1,!0,i,!0),e,r),Ef(t,n,r)}return[]}function Jf(t){return Re(t,function(t,e,n){if(e&&null!=sf(e))return[sf(e)];var i=[];return e&&(i=tf(e)),r(n,function(t){i=i.concat(t)}),i})}function Nf(t,e){for(var r=0;r<e.length;++r){var n=e[r];if(!S(n.n)){var n=Gf(n),i=t.mc[n];delete t.mc[n],delete t.$e["_"+i]}}}function Lf(t){return S(t.n)&&!fe(t.n)?t.Ib():t}function If(t,e,n){var i=e.path,o=Mf(t,e);if(n=Kf(t,n),e=t.Nc.Xe(Lf(e),o,n.xd,n.H),i=t.ta.subtree(i),o)K(null==sf(i.value),"If we're adding a query, it shouldn't be shadowed");else for(o=Re(i,function(t,e,n){if(!t.e()&&e&&null!=sf(e))return[we(sf(e))];var i=[];return e&&(i=i.concat(Qa(tf(e),function(t){return t.W}))),r(n,function(t){i=i.concat(t)}),i}),i=0;i<o.length;++i)n=o[i],t.Nc.ae(Lf(n),Mf(t,n));return e}function Kf(t,e){var r=e.W,n=Mf(t,r);return{xd:function(){return(e.w()||C).hash()},H:function(e){if("ok"===e){if(n){var i=r.path;if(e=Cf(t,n)){var o=Df(e);e=o.path,o=o.Hb,i=T(e,i),i=new Zb(new af(!1,!0,o,!0),i),e=Ef(t,e,i)}else e=[]}else e=xf(t,new Zb(bf,r.path));return e}return i="Unknown Error","too_big"===e?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?i="Client doesn't have permission to access the desired data.":"unavailable"==e&&(i="The service is unavailable"),i=Error(e+": "+i),i.code=e.toUpperCase(),t.jb(r,null,i)}}}function Gf(t){return t.path.toString()+"$"+t.va()}function Df(t){var e=t.indexOf("$");return K(-1!==e&&e<t.length-1,"Bad queryKey."),{Hb:t.substr(e+1),path:new L(t.substr(0,e))}}function Cf(t,e){var r=t.$e,n="_"+e;return n in r?r[n]:void 0}function Mf(t,e){var r=Gf(e);return w(t.mc,r)}function Ef(t,e,r){var n=t.ta.get(e);return K(n,"Missing sync point for query tag that we're tracking"),n.ab(r,new qf(e,t.ib),null)}function xf(t,e){return Of(t,e,t.ta,null,new qf(G,t.ib))}function Of(t,e,r,n,i){if(e.path.e())return Pf(t,e,r,n,i);var o=r.get(G);null==n&&null!=o&&(n=o.fb(G));var a=[],s=E(e.path),h=e.Xc(s);if((r=r.children.get(s))&&h)var c=n?n.R(s):null,s=i.u(s),a=a.concat(Of(t,h,r,c,s));return o&&(a=a.concat(o.ab(e,i,n))),a}function Pf(t,e,r,n,i){var o=r.get(G);null==n&&null!=o&&(n=o.fb(G));var a=[];return r.children.ia(function(r,o){var s=n?n.R(r):null,h=i.u(r),c=e.Xc(r);c&&(a=a.concat(Pf(t,c,o,s,h)))}),o&&(a=a.concat(o.ab(e,i,n))),a}function Qf(){this.children={},this.nd=0,this.value=null}function Rf(t,e,r){this.Gd=t?t:"",this.Zc=e?e:null,this.A=r?r:new Qf}function Sf(t,e){for(var r,n=e instanceof L?e:new L(e),i=t;null!==(r=E(n));)i=new Rf(r,i,w(i.A.children,r)||new Qf),n=H(n);return i}function Tf(t,e){K("undefined"!=typeof e,"Cannot set value to undefined"),t.A.value=e,Uf(t)}function Vf(t,e,r,n){r&&!n&&e(t),t.P(function(t){Vf(t,e,!0,n)}),r&&n&&e(t)}function Wf(t,e){for(var r=t.parent();null!==r&&!e(r);)r=r.parent()}function Uf(t){if(null!==t.Zc){var e=t.Zc,r=t.Gd,n=t.e(),i=v(e.A.children,r);n&&i?(delete e.A.children[r],e.A.nd--,Uf(e)):n||i||(e.A.children[r]=t.A,e.A.nd++,Uf(e))}}function $f(t){return p(t)&&0!==t.length&&!Xf.test(t)}function ag(t){return null===t||p(t)||ga(t)&&!Qc(t)||ia(t)&&v(t,".sv")}function bg(t,e,r,i){i&&!n(e)||cg(y(t,1,i),e,r)}function cg(t,e,r){if(r instanceof L&&(r=new Je(r,t)),!n(e))throw Error(t+"contains undefined "+Le(r));if(ha(e))throw Error(t+"contains a function "+Le(r)+" with contents: "+e.toString());if(Qc(e))throw Error(t+"contains "+e.toString()+" "+Le(r));if(p(e)&&e.length>10485760/3&&10485760<Zc(e))throw Error(t+"contains a string greater than 10485760 utf8 bytes "+Le(r)+" ('"+e.substring(0,50)+"...')");if(ia(e)){var i=!1,o=!1;if(ib(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!$f(e)))throw Error(t+" contains an invalid key ("+e+") "+Le(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),cg(t,n,r),r.pop()}),i&&o)throw Error(t+' contains ".value" child '+Le(r)+" in addition to actual children.")}}function dg(t,e){var r,n;for(r=0;r<e.length;r++){n=e[r];for(var i=n.slice(),o=0;o<i.length;o++)if((".priority"!==i[o]||o!==i.length-1)&&!$f(i[o]))throw Error(t+"contains an invalid key ("+i[o]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}for(e.sort(Ie),i=null,r=0;r<e.length;r++){if(n=e[r],null!==i&&i.contains(n))throw Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+n.toString());i=n}}function eg(t,e,r){var n=y(t,1,!1);if(!ia(e)||ea(e))throw Error(n+" must be an object containing the children to replace.");var i=[];ib(e,function(t,e){var o=new L(t);if(cg(n,e,r.u(o)),".priority"===Ld(o)&&!ag(e))throw Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(o)}),dg(n,i)}function fg(t,e,r){if(Qc(r))throw Error(y(t,e,!1)+"is "+r.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ag(r))throw Error(y(t,e,!1)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}function gg(t,e,r){if(!r||n(e))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw Error(y(t,1,r)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function hg(t,e){if(n(e)&&!$f(e))throw Error(y(t,2,!0)+'was an invalid key: "'+e+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function ig(t,e){if(!p(e)||0===e.length||Yf.test(e))throw Error(y(t,1,!1)+'was an invalid path: "'+e+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function jg(t,e){if(".info"===E(e))throw Error(t+" failed: Can't modify data under /.info/")}function kg(t,e){if(!p(e))throw Error(y(t,1,!1)+"must be a valid credential (a string).")}function lg(t,e,r){if(!p(r))throw Error(y(t,e,!1)+"must be a valid string.")}function mg(t,e){if(lg(t,1,e),!Zf.test(e))throw Error(y(t,1,!1)+"'"+e+"' is not a valid authentication provider.")}function ng(t,e,r,i){if((!i||n(r))&&(!ia(r)||null===r))throw Error(y(t,e,i)+"must be a valid object.")}function og(t,e,r){if(!ia(e)||!v(e,r))throw Error(y(t,1,!1)+'must contain the key "'+r+'"');if(!p(w(e,r)))throw Error(y(t,1,!1)+'must contain the key "'+r+'" with type "string"')}function pg(){this.set={}}function qg(t,e){r(t.set,function(t,r){e(r,t)})}function qc(){this.m=this.B=null}function rg(t,e){if(e.e())return t.B=null,t.m=null,!0;if(null!==t.B){if(t.B.K())return!1;var r=t.B;return t.B=null,r.P(N,function(e,r){t.nc(new L(e),r)}),rg(t,e)}return null!==t.m?(r=E(e),e=H(e),t.m.contains(r)&&rg(t.m.get(r),e)&&t.m.remove(r),t.m.e()?(t.m=null,!0):!1):!0}function rc(t,e,r){null!==t.B?r(e,t.B):t.P(function(t,n){var i=new L(e.toString()+"/"+t);rc(n,i,r)})}function tg(t,e,r){this.od=t||{},this.ee=e||{},this.$a=r||{},this.od.remember||(this.od.remember="default")}function vg(t){var e={},r={};return ib(t||{},function(t,n){0<=Na(ug,t)?e[t]=n:r[t]=n}),new tg(e,{},r)}function wg(t,e){this.Qe=["session",t.Od,t.hc].join(":"),this.be=e}function xg(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function yg(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xg())}function zg(){return"undefined"!=typeof location&&/^file:\//.test(location.href)}function Ag(t){var e=xg();if(""===e)return!1;if("Microsoft Internet Explorer"===navigator.appName){if((e=e.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/))&&1<e.length)return parseFloat(e[1])>=t}else if(-1<e.indexOf("Trident")&&(e=e.match(/rv:([0-9]{2,2}[\.0-9]{0,})/))&&1<e.length)return parseFloat(e[1])>=t;return!1}function Bg(){var t,e=window.opener.frames;for(t=e.length-1;t>=0;t--)try{if(e[t].location.protocol===window.location.protocol&&e[t].location.host===window.location.host&&"__winchan_relay_frame"===e[t].name)return e[t]}catch(r){}return null}function Cg(t,e,r){t.attachEvent?t.attachEvent("on"+e,r):t.addEventListener&&t.addEventListener(e,r,!1)}function Dg(t,e,r){t.detachEvent?t.detachEvent("on"+e,r):t.removeEventListener&&t.removeEventListener(e,r,!1)}function Eg(t){/^https?:\/\//.test(t)||(t=window.location.href);var e=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(t);return e?e[1]:t}function Fg(t){var e="";try{t=t.replace("#","");var r=lb(t);r&&v(r,"__firebase_request_key")&&(e=w(r,"__firebase_request_key"))}catch(n){}return e}function Gg(){var t=Pc(sg);return t.scheme+"://"+t.host+"/v2"}function Hg(t){return Gg()+"/"+t+"/auth/channel"}function Ig(t){var e=this;if(this.Ac=t,this.ce="*",Ag(8)?this.Rc=this.zd=Bg():(this.Rc=window.opener,this.zd=window),!e.Rc)throw"Unable to find relay frame";Cg(this.zd,"message",q(this.jc,this)),Cg(this.zd,"message",q(this.Bf,this));try{Jg(this,{a:"ready"})}catch(r){Cg(this.Rc,"load",function(){Jg(e,{a:"ready"})})}Cg(window,"unload",q(this.Bg,this))}function Jg(t,e){e=B(e),Ag(8)?t.Rc.doPost(e,t.ce):t.Rc.postMessage(e,t.ce)}function Kg(t){this.pc=Ga()+Ga()+Ga(),this.Ef=t}function Mg(t){var e=Error(w(Lg,t),t);return e.code=t,e}function Ng(t){var e;(e=!t.window_features)||(e=xg(),e=-1!==e.indexOf("Fennec/")||-1!==e.indexOf("Firefox/")&&-1!==e.indexOf("Android")),e&&(t.window_features=void 0),t.window_name||(t.window_name="_blank"),this.options=t}function Og(t){t.method||(t.method="GET"),t.headers||(t.headers={}),t.headers.content_type||(t.headers.content_type="application/json"),t.headers.content_type=t.headers.content_type.toLowerCase(),this.options=t}function Pg(t){this.pc=Ga()+Ga()+Ga(),this.Ef=t}function Qg(t){t.callback_parameter||(t.callback_parameter="callback"),this.options=t,window.__firebase_auth_jsonp=window.__firebase_auth_jsonp||{}}function Rg(t,e,r){setTimeout(function(){try{var n=document.createElement("script");n.type="text/javascript",n.id=t,n.async=!0,n.src=e,n.onerror=function(){var e=document.getElementById(t);null!==e&&e.parentNode.removeChild(e),r&&r(Mg("NETWORK_ERROR"))};var i=document.getElementsByTagName("head");(i&&0!=i.length?i[0]:document.documentElement).appendChild(n)}catch(o){r&&r(Mg("NETWORK_ERROR"))}},0)}function Sg(t,e,r,n){De.call(this,["auth_status"]),this.F=t,this.df=e,this.Vg=r,this.Le=n,this.sc=new wg(t,[xc,yc]),this.mb=null,this.Se=!1,Tg(this)}function Tg(t){yc.get("redirect_request_id")&&Ug(t);var e=t.sc.get();e&&e.token?(Vg(t,e),t.df(e.token,function(r,n){Wg(t,r,n,!1,e.token,e)},function(e,r){Xg(t,"resumeSession()",e,r)})):Vg(t,null)}function Yg(t,e,r,n,i,o){"firebaseio-demo.com"===t.F.domain&&O("Firebase authentication is not supported on demo Firebases (*.firebaseio-demo.com). To secure your Firebase, create a production Firebase at https://www.firebase.com."),t.df(e,function(o,a){Wg(t,o,a,!0,e,r,n||{},i)},function(e,r){Xg(t,"auth()",e,r,o)})}function Zg(t,e){t.sc.clear(),Vg(t,null),t.Vg(function(t,r){if("ok"===t)P(e,null);else{var n=(t||"error").toUpperCase(),i=n;r&&(i+=": "+r),i=Error(i),i.code=n,P(e,i)}})}function Wg(t,e,r,n,i,o,a,s){"ok"===e?(n&&(e=r.auth,o.auth=e,o.expires=r.expires,o.token=bd(i)?i:"",r=null,e&&v(e,"uid")?r=w(e,"uid"):v(o,"uid")&&(r=w(o,"uid")),o.uid=r,r="custom",e&&v(e,"provider")?r=w(e,"provider"):v(o,"provider")&&(r=w(o,"provider")),o.provider=r,t.sc.clear(),bd(i)&&(a=a||{},r=xc,"sessionOnly"===a.remember&&(r=yc),"none"!==a.remember&&t.sc.set(o,r)),Vg(t,o)),P(s,null,o)):(t.sc.clear(),Vg(t,null),o=t=(e||"error").toUpperCase(),r&&(o+=": "+r),o=Error(o),o.code=t,P(s,o))}function Xg(t,e,r,n,i){O(e+" was canceled: "+n),t.sc.clear(),Vg(t,null),t=Error(n),t.code=r.toUpperCase(),P(i,t)}function $g(t,e,r,n,i){ah(t),r=new tg(n||{},{},r||{}),bh(t,[Og,Qg],"/auth/"+e,r,i)}function ch(t,e,r,n){ah(t);var i=[Ng,Pg];r=vg(r),"anonymous"===e||"password"===e?setTimeout(function(){P(n,Mg("TRANSPORT_UNAVAILABLE"))},0):(r.ee.window_features="menubar=yes,modal=yes,alwaysRaised=yeslocation=yes,resizable=yes,scrollbars=yes,status=yes,height=625,width=625,top="+("object"==typeof screen?.5*(screen.height-625):0)+",left="+("object"==typeof screen?.5*(screen.width-625):0),r.ee.relay_url=Hg(t.F.hc),r.ee.requestWithCredential=q(t.qc,t),bh(t,i,"/auth/"+e,r,n))}function Ug(t){var e=yc.get("redirect_request_id");if(e){var r=yc.get("redirect_client_options");yc.remove("redirect_request_id"),yc.remove("redirect_client_options");var n=[Og,Qg],e={requestId:e,requestKey:Fg(document.location.hash)},r=new tg(r,{},e);t.Se=!0;try{document.location.hash=document.location.hash.replace(/&__firebase_request_key=([a-zA-z0-9]*)/,"")}catch(i){}bh(t,n,"/auth/session",r,function(){this.Se=!1}.bind(t))}}function bh(t,e,r,n,i){dh(t,e,r,n,function(e,r){!e&&r&&r.token&&r.uid?Yg(t,r.token,r,n.od,function(t,e){t?P(i,t):P(i,null,e)}):P(i,e||Mg("UNKNOWN_ERROR"))})}function dh(t,e,r,n,i){e=Pa(e,function(t){return"function"==typeof t.isAvailable&&t.isAvailable()}),0===e.length?setTimeout(function(){P(i,Mg("TRANSPORT_UNAVAILABLE"))},0):(e=new(e.shift())(n.ee),n=jb(n.$a),n.v="js-"+hb,n.transport=e.Cc(),n.suppress_status_codes=!0,t=Gg()+"/"+t.F.hc+r,e.open(t,n,function(t,e){if(t)P(i,t);else if(e&&e.error){var r=Error(e.error.message);r.code=e.error.code,r.details=e.error.details,P(i,r)}else P(i,null,e)}))}function Vg(t,e){var r=null!==t.mb||null!==e;t.mb=e,r&&t.fe("auth_status",e),t.Le(null!==e)}function ah(t){var e=t.F;if("firebaseio.com"!==e.domain&&"firebaseio-demo.com"!==e.domain&&"auth.firebase.com"===sg)throw Error("This custom Firebase server ('"+t.F.domain+"') does not support delegated login.")}function eh(t){this.jc=t,this.Nd=[],this.Sb=0,this.qe=-1,this.Fb=null}function fh(t,e,r){t.qe=e,t.Fb=r,t.qe<t.Sb&&(t.Fb(),t.Fb=null)}function gh(t,e,r){for(t.Nd[e]=r;t.Nd[t.Sb];){var n=t.Nd[t.Sb];delete t.Nd[t.Sb];for(var i=0;i<n.length;++i)if(n[i]){var o=t;Db(function(){o.jc(n[i])})}if(t.Sb===t.qe){t.Fb&&(clearTimeout(t.Fb),t.Fb(),t.Fb=null);break}t.Sb++}}function hh(t,e,r,n){this.re=t,this.f=Mc(t),this.nb=this.ob=0,this.Ua=Rb(e),this.Qf=r,this.Hc=!1,this.Bb=n,this.jd=function(t){return Bc(e,Dc,t)}}function lh(t,e){var r=B(e).length;t.nb+=r,Ob(t.Ua,"bytes_received",r)}function kh(t,e,r,n){if(this.jd=n,this.hb=r,this.Pe=new pg,this.ad=[],this.te=Math.floor(1e8*Math.random()),this.Xd=!0,this.he=Ec(),window["pLPCommand"+this.he]=t,window["pRTLPCB"+this.he]=e,t=document.createElement("iframe"),t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Cb("No IE domain setting required")}catch(i){t.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}t.contentDocument?t.eb=t.contentDocument:t.contentWindow?t.eb=t.contentWindow.document:t.document&&(t.eb=t.document),this.Ea=t,t="",this.Ea.src&&"javascript:"===this.Ea.src.substr(0,11)&&(t='<script>document.domain="'+document.domain+'";</script>'),t="<html><body>"+t+"</body></html>";try{this.Ea.eb.open(),this.Ea.eb.write(t),this.Ea.eb.close()}catch(o){Cb("frame writing exception"),o.stack&&Cb(o.stack),Cb(o)}}function nh(t){if(t.le&&t.Xd&&t.Pe.count()<(0<t.ad.length?2:1)){t.te++;var e={};e.id=t.ug,e.pw=t.vg,e.ser=t.te;for(var e=t.jd(e),r="",n=0;0<t.ad.length&&1870>=t.ad[0].kf.length+30+r.length;){var i=t.ad.shift(),r=r+"&seg"+n+"="+i.Mg+"&ts"+n+"="+i.Ug+"&d"+n+"="+i.kf;n++}return oh(t,e+r,t.te),!0}return!1}function oh(t,e,r){function n(){t.Pe.remove(r),nh(t)}t.Pe.add(r,1);var i=setTimeout(n,Math.floor(25e3));mh(t,e,function(){clearTimeout(i),n()})}function mh(t,e,r){setTimeout(function(){try{if(t.Xd){var n=t.Ea.eb.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){var t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),r())},n.onerror=function(){Cb("Long-poll script failed to load: "+e),t.Xd=!1,t.close()},t.Ea.eb.body.appendChild(n)}}catch(i){}},Math.floor(1))}function qh(t,e,r,n){this.re=t,this.f=Mc(this.re),this.frames=this.Kc=null,this.nb=this.ob=this.bf=0,this.Ua=Rb(e),t={v:"5"},"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f"),r&&(t.s=r),n&&(t.ls=n),this.ef=Bc(e,Cc,t)}function th(t,e){if(t.frames.push(e),t.frames.length==t.bf){var r=t.frames.join("");t.frames=null,r=nb(r),t.zg(r)}}function sh(t){clearInterval(t.Kc),t.Kc=setInterval(function(){t.ua&&t.ua.send("0"),sh(t)},Math.floor(45e3))}function uh(t){vh(this,t)}function vh(t,e){var r=qh&&qh.isAvailable(),n=r&&!(xc.wf||!0===xc.get("previous_websocket_failure"));if(e.Wg&&(r||O("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)t.gd=[qh];else{var i=t.gd=[];Wc(wh,function(t,e){e&&e.isAvailable()&&i.push(e)})}}function xh(t){if(0<t.gd.length)return t.gd[0];throw Error("No transports available")}function yh(t,e,r,n,i,o,a){this.id=t,this.f=Mc("c:"+this.id+":"),this.jc=r,this.Wc=n,this.la=i,this.Ne=o,this.F=e,this.Md=[],this.ff=0,this.Pf=new uh(e),this.Ta=0,this.Bb=a,this.f("Connection created"),zh(this)}function zh(t){var e=xh(t.Pf);t.J=new e("c:"+t.id+":"+t.ff++,t.F,void 0,t.Bb),t.Re=e.responsesRequiredToBeHealthy||0;var r=Ah(t,t.J),n=Bh(t,t.J);t.hd=t.J,t.cd=t.J,t.D=null,t.Ab=!1,setTimeout(function(){t.J&&t.J.open(r,n)},Math.floor(0)),e=e.healthyTimeout||0,e>0&&(t.yd=setTimeout(function(){t.yd=null,t.Ab||(t.J&&102400<t.J.nb?(t.f("Connection exceeded healthy timeout but has received "+t.J.nb+" bytes.  Marking connection healthy."),t.Ab=!0,t.J.Ed()):t.J&&10240<t.J.ob?t.f("Connection exceeded healthy timeout but has sent "+t.J.ob+" bytes.  Leaving connection alive."):(t.f("Closing unhealthy connection after timeout."),t.close()))},Math.floor(e)))}function Bh(t,e){return function(r){e===t.J?(t.J=null,r||0!==t.Ta?1===t.Ta&&t.f("Realtime connection lost."):(t.f("Realtime connection failed."),"s-"===t.F.Ya.substr(0,2)&&(xc.remove("host:"+t.F.host),t.F.Ya=t.F.host)),t.close()):e===t.D?(t.f("Secondary connection lost."),r=t.D,t.D=null,t.hd!==r&&t.cd!==r||t.close()):t.f("closing an old connection")}}function Ah(t,e){return function(r){if(2!=t.Ta)if(e===t.cd){var n=Tc("t",r);if(r=Tc("d",r),"c"==n){if(n=Tc("t",r),"d"in r)if(r=r.d,"h"===n){var n=r.ts,i=r.v,o=r.h;t.Nf=r.s,Ac(t.F,o),0==t.Ta&&(t.J.start(),
Ch(t,t.J,n),"5"!==i&&O("Protocol version mismatch detected"),r=t.Pf,(r=1<r.gd.length?r.gd[1]:null)&&Dh(t,r))}else if("n"===n){for(t.f("recvd end transmission on primary"),t.cd=t.D,r=0;r<t.Md.length;++r)t.Id(t.Md[r]);t.Md=[],Eh(t)}else"s"===n?(t.f("Connection shutdown command received. Shutting down..."),t.Ne&&(t.Ne(r),t.Ne=null),t.la=null,t.close()):"r"===n?(t.f("Reset packet received.  New host: "+r),Ac(t.F,r),1===t.Ta?t.close():(Fh(t),zh(t))):"e"===n?Nc("Server Error: "+r):"o"===n?(t.f("got pong on primary."),Gh(t),Hh(t)):Nc("Unknown control packet command: "+n)}else"d"==n&&t.Id(r)}else if(e===t.D)if(n=Tc("t",r),r=Tc("d",r),"c"==n)"t"in r&&(r=r.t,"a"===r?Ih(t):"r"===r?(t.f("Got a reset on secondary, closing it"),t.D.close(),t.hd!==t.D&&t.cd!==t.D||t.close()):"o"===r&&(t.f("got pong on secondary."),t.Mf--,Ih(t)));else{if("d"!=n)throw Error("Unknown protocol layer: "+n);t.Md.push(r)}else t.f("message on old connection")}}function Eh(t){t.hd===t.D&&t.cd===t.D&&(t.f("cleaning up and promoting a connection: "+t.D.re),t.J=t.D,t.D=null)}function Ih(t){0>=t.Mf?(t.f("Secondary connection is healthy."),t.Ab=!0,t.D.Ed(),t.D.start(),t.f("sending client ack on secondary"),t.D.send({t:"c",d:{t:"a",d:{}}}),t.f("Ending transmission on primary"),t.J.send({t:"c",d:{t:"n",d:{}}}),t.hd=t.D,Eh(t)):(t.f("sending ping on secondary."),t.D.send({t:"c",d:{t:"p",d:{}}}))}function Gh(t){t.Ab||(t.Re--,0>=t.Re&&(t.f("Primary connection is healthy."),t.Ab=!0,t.J.Ed()))}function Dh(t,e){t.D=new e("c:"+t.id+":"+t.ff++,t.F,t.Nf),t.Mf=e.responsesRequiredToBeHealthy||0,t.D.open(Ah(t,t.D),Bh(t,t.D)),setTimeout(function(){t.D&&(t.f("Timed out trying to upgrade."),t.D.close())},Math.floor(6e4))}function Ch(t,e,r){t.f("Realtime connection established."),t.J=e,t.Ta=1,t.Wc&&(t.Wc(r,t.Nf),t.Wc=null),0===t.Re?(t.f("Primary connection is healthy."),t.Ab=!0):setTimeout(function(){Hh(t)},Math.floor(5e3))}function Hh(t){t.Ab||1!==t.Ta||(t.f("sending ping on primary."),Jh(t,{t:"c",d:{t:"p",d:{}}}))}function Jh(t,e){if(1!==t.Ta)throw"Connection is not connected";t.hd.send(e)}function Fh(t){t.f("Shutting down all connections"),t.J&&(t.J.close(),t.J=null),t.D&&(t.D.close(),t.D=null),t.yd&&(clearTimeout(t.yd),t.yd=null)}function Kh(t,e,r,n){this.id=Lh++,this.f=Mc("p:"+this.id+":"),this.xf=this.Ee=!1,this.$={},this.qa=[],this.Yc=0,this.Vc=[],this.oa=!1,this.Za=1e3,this.Fd=3e5,this.Gb=e,this.Uc=r,this.Oe=n,this.F=t,this.sb=this.Aa=this.Ia=this.Bb=this.We=null,this.Ob=!1,this.Td={},this.Lg=0,this.nf=!0,this.Lc=this.Ge=null,Mh(this,0),He.ub().Eb("visible",this.Cg,this),-1===t.host.indexOf("fblocal")&&Ge.ub().Eb("online",this.Ag,this)}function Oh(t,e){var r=e.Ig,n=r.path.toString(),i=r.va();t.f("Listen on "+n+" for "+i);var o={p:n};e.tag&&(o.q=ee(r.n),o.t=e.tag),o.h=e.xd(),t.Fa("q",o,function(o){var a=o.d,s=o.s;if(a&&"object"==typeof a&&v(a,"w")){var h=w(a,"w");ea(h)&&0<=Na(h,"no_index")&&O("Using an unspecified index. Consider adding "+('".indexOn": "'+r.n.g.toString()+'"')+" at "+r.path.toString()+" to your security rules for better performance")}(t.$[n]&&t.$[n][i])===e&&(t.f("listen response",o),"ok"!==s&&Ph(t,n,i),e.H&&e.H(s,a))})}function Qh(t){var e=t.Aa;t.oa&&e&&t.Fa("auth",{cred:e.ig},function(r){var n=r.s;r=r.d||"error","ok"!==n&&t.Aa===e&&delete t.Aa,e.of?"ok"!==n&&e.md&&e.md(n,r):(e.of=!0,e.zc&&e.zc(n,r))})}function Rh(t,e,r,n,i){r={p:r,d:n},t.f("onDisconnect "+e,r),t.Fa(e,r,function(t){i&&setTimeout(function(){i(t.s,t.d)},Math.floor(0))})}function Sh(t,e,r,i,o,a){i={p:r,d:i},n(a)&&(i.h=a),t.qa.push({action:e,Jf:i,H:o}),t.Yc++,e=t.qa.length-1,t.oa?Th(t,e):t.f("Buffering put: "+r)}function Th(t,e){var r=t.qa[e].action,n=t.qa[e].Jf,i=t.qa[e].H;t.qa[e].Jg=t.oa,t.Fa(r,n,function(n){t.f(r+" response",n),delete t.qa[e],t.Yc--,0===t.Yc&&(t.qa=[]),i&&i(n.s,n.d)})}function Mh(t,e){K(!t.Ia,"Scheduling a connect when we're already connected/ing?"),t.sb&&clearTimeout(t.sb),t.sb=setTimeout(function(){t.sb=null,Wh(t)},Math.floor(e))}function Wh(t){if(Xh(t)){t.f("Making a connection attempt"),t.Ge=(new Date).getTime(),t.Lc=null;var e=q(t.Id,t),r=q(t.Wc,t),n=q(t.Df,t),i=t.id+":"+Nh++;t.Ia=new yh(i,t.F,e,r,n,function(e){O(e+" ("+t.F.toString()+")"),t.xf=!0},t.Bb)}}function Uh(t,e,r){r=r?Qa(r,function(t){return Uc(t)}).join("$"):"default",(t=Ph(t,e,r))&&t.H&&t.H("permission_denied")}function Ph(t,e,r){e=new L(e).toString();var i;return n(t.$[e])?(i=t.$[e][r],delete t.$[e][r],0===pa(t.$[e])&&delete t.$[e]):i=void 0,i}function Vh(t){Qh(t),r(t.$,function(e){r(e,function(e){Oh(t,e)})});for(var e=0;e<t.qa.length;e++)t.qa[e]&&Th(t,e);for(;t.Vc.length;)e=t.Vc.shift(),Rh(t,e.action,e.$c,e.data,e.H)}function Xh(t){var e;return e=Ge.ub().kc,!t.xf&&!t.Ee&&e}function Q(t,e,r){this.A=t,this.W=e,this.g=r}function Yh(t,e){this.F=t,this.Ua=Rb(t),this.fd=null,this.da=new vb,this.Hd=1,this.Ra=null,e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)?(this.ba=new Ae(this.F,q(this.Gb,this)),setTimeout(q(this.Uc,this,!0),0)):this.ba=this.Ra=new Kh(this.F,q(this.Gb,this),q(this.Uc,this),q(this.Oe,this)),this.Sg=Sb(t,q(function(){return new Mb(this.Ua,this.ba)},this)),this.uc=new Rf,this.Ce=new ob;var r=this;this.Cd=new vf({Xe:function(t,e,n,i){return e=[],n=r.Ce.j(t.path),n.e()||(e=xf(r.Cd,new Xb(bf,t.path,n)),setTimeout(function(){i("ok")},0)),e},ae:ba}),Zh(this,"connected",!1),this.la=new qc,this.M=new Sg(t,q(this.ba.M,this.ba),q(this.ba.ge,this.ba),q(this.Le,this)),this.sd=0,this.De=null,this.L=new vf({Xe:function(t,e,n,i){return r.ba.yf(t,n,e,function(e,n){var o=i(e,n);Ab(r.da,t.path,o)}),[]},ae:function(t,e){r.ba.Rf(t,e)}})}function $h(t){return t=t.Ce.j(new L(".info/serverTimeOffset")).I()||0,(new Date).getTime()+t}function ai(t){return t=t={timestamp:$h(t)},t.timestamp=t.timestamp||(new Date).getTime(),t}function Zh(t,e,r){e=new L("/.info/"+e),r=M(r);var n=t.Ce;n.Wd=n.Wd.G(e,r),r=xf(t.Cd,new Xb(bf,e,r)),Ab(t.da,e,r)}function ci(t){t.f("onDisconnectEvents");var e=ai(t),r=[];rc(pc(t.la,e),G,function(e,n){r=r.concat(xf(t.L,new Xb(bf,e,n)));var i=ei(t,e);bi(t,i)}),t.la=new qc,Ab(t.da,G,r)}function fi(t,e,r,n){var i=M(r);t.ba.Me(e.toString(),i.I(!0),function(r,o){"ok"===r&&t.la.nc(e,i),di(n,r,o)})}function gi(t,e,r,n,i){var o=M(r,n);t.ba.Me(e.toString(),o.I(!0),function(r,n){"ok"===r&&t.la.nc(e,o),di(i,r,n)})}function hi(t,e,r,n){var i,o=!0;for(i in r)o=!1;o?(Cb("onDisconnect().update() called with empty data.  Don't do anything."),di(n,"ok")):t.ba.Cf(e.toString(),r,function(i,o){if("ok"===i)for(var a in r){var s=M(r[a]);t.la.nc(e.u(a),s)}di(n,i,o)})}function ii(t,e,r){r=".info"===E(e.path)?t.Cd.Pb(e,r):t.L.Pb(e,r),yb(t.da,e.path,r)}function di(t,e,r){t&&Db(function(){if("ok"==e)t(null);else{var n=(e||"error").toUpperCase(),i=n;r&&(i+=": "+r),i=Error(i),i.code=n,t(i)}})}function ji(t,e,r,i,o){function a(){}t.f("transaction on "+e);var s=new U(t,e);if(s.Eb("value",a),r={path:e,update:r,H:i,status:null,Ff:Ec(),cf:o,Lf:0,ie:function(){s.ic("value",a)},ke:null,Ba:null,pd:null,qd:null,rd:null},i=t.L.za(e,void 0)||C,r.pd=i,i=r.update(i.I()),n(i)){cg("transaction failed: Data returned ",i,r.path),r.status=1,o=Sf(t.uc,e);var h=o.Ca()||[];h.push(r),Tf(o,h),"object"==typeof i&&null!==i&&v(i,".priority")?(h=w(i,".priority"),K(ag(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(t.L.za(e)||C).C().I(),o=ai(t),i=M(i,h),o=sc(i,o),r.qd=i,r.rd=o,r.Ba=t.Hd++,r=wf(t.L,e,o,r.Ba,r.cf),Ab(t.da,e,r),ki(t)}else r.ie(),r.qd=null,r.rd=null,r.H&&(t=new Q(r.pd,new U(t,r.path),N),r.H(null,!1,t))}function ki(t,e){var r=e||t.uc;if(e||li(t,r),null!==r.Ca()){var n=mi(t,r);K(0<n.length,"Sending zero length transaction queue"),Sa(n,function(t){return 1===t.status})&&ni(t,r.path(),n)}else r.wd()&&r.P(function(e){ki(t,e)})}function ni(t,e,r){for(var n=Qa(r,function(t){return t.Ba}),i=t.L.za(e,n)||C,n=i,i=i.hash(),o=0;o<r.length;o++){var a=r[o];K(1===a.status,"tryToSendTransactionQueue_: items in queue should all be run."),a.status=2,a.Lf++;var s=T(e,a.path),n=n.G(s,a.qd)}n=n.I(!0),t.ba.put(e.toString(),n,function(n){t.f("transaction put response",{path:e.toString(),status:n});var i=[];if("ok"===n){for(n=[],o=0;o<r.length;o++){if(r[o].status=3,i=i.concat(zf(t.L,r[o].Ba)),r[o].H){var a=r[o].rd,s=new U(t,r[o].path);n.push(q(r[o].H,null,null,!0,new Q(a,s,N)))}r[o].ie()}for(li(t,Sf(t.uc,e)),ki(t),Ab(t.da,e,i),o=0;o<n.length;o++)Db(n[o])}else{if("datastale"===n)for(o=0;o<r.length;o++)r[o].status=4===r[o].status?5:1;else for(O("transaction at "+e.toString()+" failed: "+n),o=0;o<r.length;o++)r[o].status=5,r[o].ke=n;bi(t,e)}},i)}function bi(t,e){var r=oi(t,e),n=r.path(),r=mi(t,r);return pi(t,r,n),n}function pi(t,e,r){if(0!==e.length){for(var i=[],o=[],a=Qa(e,function(t){return t.Ba}),s=0;s<e.length;s++){var h,c=e[s],u=T(r,c.path),l=!1;if(K(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),5===c.status)l=!0,h=c.ke,o=o.concat(zf(t.L,c.Ba,!0));else if(1===c.status)if(25<=c.Lf)l=!0,h="maxretry",o=o.concat(zf(t.L,c.Ba,!0));else{var f=t.L.za(c.path,a)||C;c.pd=f;var p=e[s].update(f.I());n(p)?(cg("transaction failed: Data returned ",p,c.path),u=M(p),"object"==typeof p&&null!=p&&v(p,".priority")||(u=u.ga(f.C())),f=c.Ba,p=ai(t),p=sc(u,p),c.qd=u,c.rd=p,c.Ba=t.Hd++,Va(a,f),o=o.concat(wf(t.L,c.path,p,c.Ba,c.cf)),o=o.concat(zf(t.L,f,!0))):(l=!0,h="nodata",o=o.concat(zf(t.L,c.Ba,!0)))}Ab(t.da,r,o),o=[],l&&(e[s].status=3,setTimeout(e[s].ie,Math.floor(0)),e[s].H&&("nodata"===h?(c=new U(t,e[s].path),i.push(q(e[s].H,null,null,!1,new Q(e[s].pd,c,N)))):i.push(q(e[s].H,null,Error(h),!1,null))))}for(li(t,t.uc),s=0;s<i.length;s++)Db(i[s]);ki(t)}}function oi(t,e){for(var r,n=t.uc;null!==(r=E(e))&&null===n.Ca();)n=Sf(n,r),e=H(e);return n}function mi(t,e){var r=[];return qi(t,e,r),r.sort(function(t,e){return t.Ff-e.Ff}),r}function qi(t,e,r){var n=e.Ca();if(null!==n)for(var i=0;i<n.length;i++)r.push(n[i]);e.P(function(e){qi(t,e,r)})}function li(t,e){var r=e.Ca();if(r){for(var n=0,i=0;i<r.length;i++)3!==r[i].status&&(r[n]=r[i],n++);r.length=n,Tf(e,0<r.length?r:null)}e.P(function(e){li(t,e)})}function ei(t,e){var r=oi(t,e).path(),n=Sf(t.uc,e);return Wf(n,function(e){ri(t,e)}),ri(t,n),Vf(n,function(e){ri(t,e)}),r}function ri(t,e){var r=e.Ca();if(null!==r){for(var n=[],i=[],o=-1,a=0;a<r.length;a++)4!==r[a].status&&(2===r[a].status?(K(o===a-1,"All SENT items should be at beginning of queue."),o=a,r[a].status=4,r[a].ke="set"):(K(1===r[a].status,"Unexpected transaction status in abort"),r[a].ie(),i=i.concat(zf(t.L,r[a].Ba,!0)),r[a].H&&n.push(q(r[a].H,null,Error("set"),!1,null))));for(-1===o?Tf(e,null):r.length=o+1,Ab(t.da,e.path(),i),a=0;a<n.length;a++)Db(n[a])}}function W(){this.oc={},this.Sf=!1}function X(t,e){this.bd=t,this.ra=e}function Y(t,e,r,n){this.k=t,this.path=e,this.n=r,this.lc=n}function si(t){var e=null,r=null;if(t.ma&&(e=nd(t)),t.pa&&(r=pd(t)),t.g===Qd){if(t.ma){if("[MIN_NAME]"!=md(t))throw Error("Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().");if("string"!=typeof e)throw Error("Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.")}if(t.pa){if("[MAX_NAME]"!=od(t))throw Error("Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().");if("string"!=typeof r)throw Error("Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.")}}else if(t.g===N){if(null!=e&&!ag(e)||null!=r&&!ag(r))throw Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(K(t.g instanceof Ud||t.g===$d,"unknown index type."),null!=e&&"object"==typeof e||null!=r&&"object"==typeof r)throw Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")}function ti(t){if(t.ma&&t.pa&&t.ja&&(!t.ja||""===t.Nb))throw Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")}function ui(t,e){if(!0===t.lc)throw Error(e+": You can't combine multiple orderBy calls.")}function vi(t,e,r){var n={cancel:null,Ma:null};if(e&&r)n.cancel=e,A(t,3,n.cancel,!0),n.Ma=r,mb(t,4,n.Ma);else if(e)if("object"==typeof e&&null!==e)n.Ma=e;else{if("function"!=typeof e)throw Error(y(t,3,!0)+" must either be a cancel callback or a context object.");n.cancel=e}return n}function U(t,e){var r,n,i;if(t instanceof Yh)r=t,n=e;else{x("new Firebase",1,2,arguments.length),n=Pc(arguments[0]),r=n.Tg,"firebase"===n.domain&&Oc(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!=r||Oc("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.kb||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&O("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),r=new zc(n.host,n.kb,r,"ws"===n.scheme||"wss"===n.scheme),n=new L(n.$c),i=n.toString();var o;if(!(o=!p(r.host)||0===r.host.length||!$f(r.hc))&&(o=0!==i.length)&&(i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),o=!(p(i)&&0!==i.length&&!Yf.test(i))),o)throw Error(y("new Firebase",1,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".');if(e)if(e instanceof W)i=e;else{if(!p(e))throw Error("Expected a valid Firebase.Context for second argument to new Firebase()");i=W.ub(),r.Od=e}else i=W.ub();o=r.toString();var a=w(i.oc,o);a||(a=new Yh(r,i.Sf),i.oc[o]=a),r=a}Y.call(this,r,n,be,!1)}function Lc(t,e){K(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?("undefined"!=typeof console&&("function"==typeof console.log?Bb=q(console.log,console):"object"==typeof console.log&&(Bb=function(t){console.log(t)})),e&&yc.set("logging_enabled",!0)):t?Bb=t:(Bb=null,yc.remove("logging_enabled"))}var g,aa=this,la=Date.now||function(){return+new Date},ya="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Ea={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},Fa=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,Ha;t:{var Ia=aa.navigator;if(Ia){var Ja=Ia.userAgent;if(Ja){Ha=Ja;break t}}Ha=""}ma(La,Ka),La.prototype.reset=function(){this.N[0]=1732584193,this.N[1]=4023233417,this.N[2]=2562383102,this.N[3]=271733878,this.N[4]=3285377520,this.de=this.ac=0},La.prototype.update=function(t,e){if(null!=t){n(e)||(e=t.length);for(var r=e-this.Va,i=0,o=this.me,a=this.ac;e>i;){if(0==a)for(;r>=i;)Ma(this,t,i),i+=this.Va;if(p(t)){for(;e>i;)if(o[a]=t.charCodeAt(i),++a,++i,a==this.Va){Ma(this,o),a=0;break}}else for(;e>i;)if(o[a]=t[i],++a,++i,a==this.Va){Ma(this,o),a=0;break}}this.ac=a,this.de+=e}};var u=Array.prototype,Na=u.indexOf?function(t,e,r){return u.indexOf.call(t,e,r)}:function(t,e,r){if(r=null==r?0:0>r?Math.max(0,t.length+r):r,p(t))return p(e)&&1==e.length?t.indexOf(e,r):-1;for(;r<t.length;r++)if(r in t&&t[r]===e)return r;return-1},Oa=u.forEach?function(t,e,r){u.forEach.call(t,e,r)}:function(t,e,r){for(var n=t.length,i=p(t)?t.split(""):t,o=0;n>o;o++)o in i&&e.call(r,i[o],o,t)},Pa=u.filter?function(t,e,r){return u.filter.call(t,e,r)}:function(t,e,r){for(var n=t.length,i=[],o=0,a=p(t)?t.split(""):t,s=0;n>s;s++)if(s in a){var h=a[s];e.call(r,h,s,t)&&(i[o++]=h)}return i},Qa=u.map?function(t,e,r){return u.map.call(t,e,r)}:function(t,e,r){for(var n=t.length,i=Array(n),o=p(t)?t.split(""):t,a=0;n>a;a++)a in o&&(i[a]=e.call(r,o[a],a,t));return i},Ra=u.reduce?function(t,e,r,n){for(var i=[],o=1,a=arguments.length;a>o;o++)i.push(arguments[o]);return n&&(i[0]=q(e,n)),u.reduce.apply(t,i)}:function(t,e,r,n){var i=r;return Oa(t,function(r,o){i=e.call(n,i,r,o,t)}),i},Sa=u.every?function(t,e,r){return u.every.call(t,e,r)}:function(t,e,r){for(var n=t.length,i=p(t)?t.split(""):t,o=0;n>o;o++)if(o in i&&!e.call(r,i[o],o,t))return!1;return!0},Za=-1!=Ha.indexOf("Opera")||-1!=Ha.indexOf("OPR"),$a=-1!=Ha.indexOf("Trident")||-1!=Ha.indexOf("MSIE"),ab=-1!=Ha.indexOf("Gecko")&&-1==Ha.toLowerCase().indexOf("webkit")&&!(-1!=Ha.indexOf("Trident")||-1!=Ha.indexOf("MSIE")),bb=-1!=Ha.toLowerCase().indexOf("webkit");!function(){var t,e="";return Za&&aa.opera?(e=aa.opera.version,ha(e)?e():e):(ab?t=/rv\:([^\);]+)(\)|;)/:$a?t=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:bb&&(t=/WebKit\/(\S+)/),t&&(e=(e=t.exec(Ha))?e[1]:""),$a&&(t=(t=aa.document)?t.documentMode:void 0,t>parseFloat(e))?String(t):e)}();var cb=null,db=null,eb=null,hb=hb||"2.3.1";ob.prototype.j=function(t){return this.Wd.Q(t)},ob.prototype.toString=function(){return this.Wd.toString()},pb.prototype.qf=function(){return null},pb.prototype.ye=function(){return null};var qb=new pb;rb.prototype.qf=function(t){var e=this.Ka.O;return sb(e,t)?e.j().R(t):(e=null!=this.Kd?new tb(this.Kd,!0,!1):this.Ka.w(),this.Tf.xc(t,e))},rb.prototype.ye=function(t,e,r){var n=null!=this.Kd?this.Kd:ub(this.Ka);return t=this.Tf.ne(n,e,1,r,t),0===t.length?null:t[0]},xb.prototype.add=function(t){this.vd.push(t)},xb.prototype.Zb=function(){return this.ra};var Fb="value";Gb.prototype.Zb=function(){var t=this.Zd.Ib();return"value"===this.ud?t.path:t.parent().path},Gb.prototype.ze=function(){return this.ud},Gb.prototype.Vb=function(){return this.ue.Vb(this)},Gb.prototype.toString=function(){return this.Zb().toString()+":"+this.ud+":"+B(this.Zd.mf())},Hb.prototype.Zb=function(){return this.path},Hb.prototype.ze=function(){return"cancel"},Hb.prototype.Vb=function(){return this.ue.Vb(this)},Hb.prototype.toString=function(){return this.path.toString()+":cancel"},tb.prototype.j=function(){return this.A},Lb.prototype.get=function(){var t=this.gg.get(),e=xa(t);if(this.Dd)for(var r in this.Dd)e[r]-=this.Dd[r];return this.Dd=t,e},Mb.prototype.If=function(){var t,e=this.fd.get(),r={},n=!1;for(t in e)0<e[t]&&v(this.Of,t)&&(r[t]=e[t],n=!0);n&&this.ba.Ue(r),setTimeout(q(this.If,this),Math.floor(6e5*Math.random()))},Nb.prototype.get=function(){return xa(this.Ec)};var Pb={},Qb={};Xb.prototype.Xc=function(t){return this.path.e()?new Xb(this.source,G,this.Ga.R(t)):new Xb(this.source,H(this.path),this.Ga)},Xb.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" overwrite: "+this.Ga.toString()+")"},Zb.prototype.Xc=function(){return this.path.e()?new Zb(this.source,G):new Zb(this.source,H(this.path))},Zb.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" listen_complete)"},g=ac.prototype,g.Oa=function(t,e){return new ac(this.La,this.wa.Oa(t,e,this.La).Y(null,null,!1,null,null))},g.remove=function(t){return new ac(this.La,this.wa.remove(t,this.La).Y(null,null,!1,null,null))},g.get=function(t){for(var e,r=this.wa;!r.e();){if(e=this.La(t,r.key),0===e)return r.value;0>e?r=r.left:e>0&&(r=r.right)}return null},g.e=function(){return this.wa.e()},g.count=function(){return this.wa.count()},g.Sc=function(){return this.wa.Sc()},g.fc=function(){return this.wa.fc()},g.ia=function(t){return this.wa.ia(t)},g.Xb=function(t){return new dc(this.wa,null,this.La,!1,t)},g.Yb=function(t,e){return new dc(this.wa,t,this.La,!1,e)},g.$b=function(t,e){return new dc(this.wa,t,this.La,!0,e)},g.sf=function(t){return new dc(this.wa,null,this.La,!0,t)},g=fc.prototype,g.Y=function(t,e,r,n,i){return new fc(null!=t?t:this.key,null!=e?e:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)},g.count=function(){return this.left.count()+1+this.right.count()},g.e=function(){return!1},g.ia=function(t){return this.left.ia(t)||t(this.key,this.value)||this.right.ia(t)},g.Sc=function(){return gc(this).key},g.fc=function(){return this.right.e()?this.key:this.right.fc()},g.Oa=function(t,e,r){var n,i;return i=this,n=r(t,i.key),i=0>n?i.Y(null,null,null,i.left.Oa(t,e,r),null):0===n?i.Y(null,e,null,null,null):i.Y(null,null,null,null,i.right.Oa(t,e,r)),hc(i)},g.remove=function(t,e){var r,n;if(r=this,0>e(t,r.key))r.left.e()||r.left.fa()||r.left.left.fa()||(r=jc(r)),r=r.Y(null,null,null,r.left.remove(t,e),null);else{if(r.left.fa()&&(r=kc(r)),r.right.e()||r.right.fa()||r.right.left.fa()||(r=lc(r),r.left.left.fa()&&(r=kc(r),r=lc(r))),0===e(t,r.key)){if(r.right.e())return bc;n=gc(r.right),r=r.Y(n.key,n.value,null,null,ic(r.right))}r=r.Y(null,null,null,null,r.right.remove(t,e))}return hc(r)},g.fa=function(){return this.color},g=nc.prototype,g.Y=function(){return this},g.Oa=function(t,e){return new fc(t,e,null)},g.remove=function(){return this},g.count=function(){return 0},g.e=function(){return!0},g.ia=function(){return!1},g.Sc=function(){return null},g.fc=function(){return null},g.fa=function(){return!1};var bc=new nc;uc.prototype.set=function(t,e){null==e?delete this.wc[t]:this.wc[t]=e},uc.prototype.get=function(t){return v(this.wc,t)?this.wc[t]:null},uc.prototype.remove=function(t){delete this.wc[t]},uc.prototype.wf=!0,g=vc.prototype,g.set=function(t,e){null==e?this.Fc.removeItem(this.Pd+t):this.Fc.setItem(this.Pd+t,B(e))},g.get=function(t){return t=this.Fc.getItem(this.Pd+t),null==t?null:nb(t)},g.remove=function(t){this.Fc.removeItem(this.Pd+t)},g.wf=!1,g.toString=function(){return this.Fc.toString()};var xc=wc("localStorage"),yc=wc("sessionStorage");zc.prototype.toString=function(){var t=(this.kb?"https://":"http://")+this.host;return this.Od&&(t+="<"+this.Od+">"),t};var Ec=function(){var t=1;return function(){return t++}}(),Bb=null,Kc=!0,Yc=/^-?\d{1,10}$/;cd.prototype.hg=function(t,e){if(null==t.Wa||null==e.Wa)throw Fc("Should only compare child_ events.");return this.g.compare(new F(t.Wa,t.Ja),new F(e.Wa,e.Ja))},g=id.prototype,g.Kf=function(t){return"value"===t},g.createEvent=function(t,e){var r=e.n.g;return new Gb("value",this,new Q(t.Ja,e.Ib(),r))},g.Vb=function(t){var e=this.rb;if("cancel"===t.ze()){K(this.pb,"Raising a cancel event on a listener with no cancel callback");var r=this.pb;return function(){r.call(e,t.error)}}var n=this.Rb;return function(){n.call(e,t.Zd)}},g.gf=function(t,e){return this.pb?new Hb(this,t,e):null},g.matches=function(t){return t instanceof id?t.Rb&&this.Rb?t.Rb===this.Rb&&t.rb===this.rb:!0:!1},g.tf=function(){return null!==this.Rb},g=jd.prototype,g.Kf=function(t){return t="children_added"===t?"child_added":t,("children_removed"===t?"child_removed":t)in this.ha},g.gf=function(t,e){return this.pb?new Hb(this,t,e):null},g.createEvent=function(t,e){K(null!=t.Wa,"Child events should have a childName.");var r=e.Ib().u(t.Wa);return new Gb(t.type,this,new Q(t.Ja,r,e.n.g),t.Qd)},g.Vb=function(t){var e=this.rb;if("cancel"===t.ze()){K(this.pb,"Raising a cancel event on a listener with no cancel callback");var r=this.pb;return function(){r.call(e,t.error)}}var n=this.ha[t.ud];return function(){n.call(e,t.Zd,t.Qd)}},g.matches=function(t){if(t instanceof jd){if(!this.ha||!t.ha)return!0;if(this.rb===t.rb){var e=pa(t.ha);if(e===pa(this.ha)){if(1===e){var e=qa(t.ha),r=qa(this.ha);return!(r!==e||t.ha[e]&&this.ha[r]&&t.ha[e]!==this.ha[r])}return oa(this.ha,function(e,r){return t.ha[r]===e})}}}return!1},g.tf=function(){return null!==this.ha},g=kd.prototype,g.G=function(t,e,r,n,i,o){return K(t.Jc(this.g),"A node must be indexed if only a child is updated"),i=t.R(e),i.Q(n).ca(r.Q(n))&&i.e()==r.e()?t:(null!=o&&(r.e()?t.Da(e)?hd(o,new D("child_removed",i,e)):K(t.K(),"A child remove without an old child only makes sense on a leaf node"):i.e()?hd(o,new D("child_added",r,e)):hd(o,new D("child_changed",r,e,i))),t.K()&&r.e()?t:t.U(e,r).lb(this.g))},g.xa=function(t,e,r){return null!=r&&(t.K()||t.P(N,function(t,n){e.Da(t)||hd(r,new D("child_removed",n,t))}),e.K()||e.P(N,function(e,n){if(t.Da(e)){var i=t.R(e);i.ca(n)||hd(r,new D("child_changed",n,e,i))}else hd(r,new D("child_added",n,e))})),e.lb(this.g)},g.ga=function(t,e){return t.e()?C:t.ga(e)},g.Na=function(){return!1},g.Wb=function(){return this},g=ld.prototype,g.matches=function(t){return 0>=this.g.compare(this.ed,t)&&0>=this.g.compare(t,this.Gc)},g.G=function(t,e,r,n,i,o){return this.matches(new F(e,r))||(r=C),this.Be.G(t,e,r,n,i,o)},g.xa=function(t,e,r){e.K()&&(e=C);var n=e.lb(this.g),n=n.ga(C),i=this;return e.P(N,function(t,e){i.matches(new F(t,e))||(n=n.U(t,C))}),this.Be.xa(t,n,r)},g.ga=function(t){return t},g.Na=function(){return!0},g.Wb=function(){return this.Be},g=qd.prototype,g.G=function(t,e,r,n,i,o){return this.sa.matches(new F(e,r))||(r=C),t.R(e).ca(r)?t:t.Db()<this.ka?this.sa.Wb().G(t,e,r,n,i,o):sd(this,t,e,r,i,o)},g.xa=function(t,e,r){var n;if(e.K()||e.e())n=C.lb(this.g);else if(2*this.ka<e.Db()&&e.Jc(this.g)){n=C.lb(this.g),e=this.Jb?e.$b(this.sa.Gc,this.g):e.Yb(this.sa.ed,this.g);for(var i=0;0<e.Pa.length&&i<this.ka;){var o,a=J(e);if(!(o=this.Jb?0>=this.g.compare(this.sa.ed,a):0>=this.g.compare(a,this.sa.Gc)))break;n=n.U(a.name,a.S),i++}}else{n=e.lb(this.g),n=n.ga(C);var s,h,c;if(this.Jb){e=n.sf(this.g),s=this.sa.Gc,h=this.sa.ed;var u=td(this.g);c=function(t,e){return u(e,t)}}else e=n.Xb(this.g),s=this.sa.ed,h=this.sa.Gc,c=td(this.g);for(var i=0,l=!1;0<e.Pa.length;)a=J(e),!l&&0>=c(s,a)&&(l=!0),(o=l&&i<this.ka&&0>=c(a,h))?i++:n=n.U(a.name,C)}return this.sa.Wb().xa(t,n,r)},g.ga=function(t){return t},g.Na=function(){return!0},g.Wb=function(){return this.sa.Wb()},xd.prototype.ab=function(t,e,r,n){var i,o=new gd;if(e.type===Yb)e.source.we?r=yd(this,t,e.path,e.Ga,r,n,o):(K(e.source.pf,"Unknown source."),i=e.source.af||Jb(t.w())&&!e.path.e(),r=Ad(this,t,e.path,e.Ga,r,n,i,o));else if(e.type===Bd)e.source.we?r=Cd(this,t,e.path,e.children,r,n,o):(K(e.source.pf,"Unknown source."),i=e.source.af||Jb(t.w()),r=Dd(this,t,e.path,e.children,r,n,i,o));else if(e.type===Ed)if(e.Vd)if(e=e.path,null!=r.tc(e))r=t;else{if(i=new rb(r,t,n),n=t.O.j(),e.e()||".priority"===E(e))Ib(t.w())?e=r.za(ub(t)):(e=t.w().j(),K(e instanceof R,"serverChildren would be complete if leaf node"),e=r.yc(e)),e=this.V.xa(n,e,o);else{var a=E(e),s=r.xc(a,t.w());null==s&&sb(t.w(),a)&&(s=n.R(a)),e=null!=s?this.V.G(n,a,s,H(e),i,o):t.O.j().Da(a)?this.V.G(n,a,C,H(e),i,o):n,e.e()&&Ib(t.w())&&(n=r.za(ub(t)),n.K()&&(e=this.V.xa(e,n,o)))}n=Ib(t.w())||null!=r.tc(G),r=Fd(t,e,n,this.V.Na())}else r=Gd(this,t,e.path,e.Qb,r,n,o);else{if(e.type!==$b)throw Fc("Unknown operation type: "+e.type);n=e.path,e=t.w(),i=e.j(),a=e.ea||n.e(),r=Hd(this,new Id(t.O,new tb(i,a,e.Ub)),n,r,qb,o)}return o=ra(o.bb),n=r,e=n.O,e.ea&&(i=e.j().K()||e.j().e(),a=Jd(t),(0<o.length||!t.O.ea||i&&!e.j().ca(a)||!e.j().C().ca(a.C()))&&o.push(Eb(Jd(n)))),new wd(r,o)};var Sd={};Rd.prototype.Ad=function(t,e){return 0!==this.compare(new F("[MIN_NAME]",t),new F("[MIN_NAME]",e))},Rd.prototype.Tc=function(){return Td},ma(Ud,Rd),g=Ud.prototype,g.Ic=function(t){return!t.Q(this.cc).e()},g.compare=function(t,e){var r=t.S.Q(this.cc),n=e.S.Q(this.cc),r=r.Dc(n);return 0===r?Vb(t.name,e.name):r},g.Pc=function(t,e){var r=M(t),r=C.G(this.cc,r);return new F(e,r)},g.Qc=function(){var t=C.G(this.cc,Vd);return new F("[MAX_NAME]",t)},g.toString=function(){return this.cc.slice().join("/")},ma(Wd,Rd),g=Wd.prototype,g.compare=function(t,e){var r=t.S.C(),n=e.S.C(),r=r.Dc(n);return 0===r?Vb(t.name,e.name):r},g.Ic=function(t){return!t.C().e()},g.Ad=function(t,e){return!t.C().ca(e.C())},g.Tc=function(){return Td},g.Qc=function(){return new F("[MAX_NAME]",new tc("[PRIORITY-POST]",Vd))},g.Pc=function(t,e){var r=M(t);return new F(e,new tc("[PRIORITY-POST]",r))},g.toString=function(){return".priority"};var N=new Wd;ma(Xd,Rd),g=Xd.prototype,g.compare=function(t,e){return Vb(t.name,e.name)},g.Ic=function(){throw Fc("KeyIndex.isDefinedOn not expected to be called.")},g.Ad=function(){return!1},g.Tc=function(){return Td},g.Qc=function(){return new F("[MAX_NAME]",C)},g.Pc=function(t){return K(p(t),"KeyIndex indexValue must always be a string."),new F(t,C)},g.toString=function(){return".key"};var Qd=new Xd;ma(Yd,Rd),g=Yd.prototype,g.compare=function(t,e){var r=t.S.Dc(e.S);return 0===r?Vb(t.name,e.name):r},g.Ic=function(){return!0},g.Ad=function(t,e){return!t.ca(e)},g.Tc=function(){return Td},g.Qc=function(){return Zd},g.Pc=function(t,e){var r=M(t);return new F(e,r)},g.toString=function(){return".value"};var $d=new Yd,be=new ae;g=ae.prototype,g.He=function(t){var e=ce(this);return e.ja=!0,e.ka=t,e.Nb="",e},g.Ie=function(t){var e=ce(this);return e.ja=!0,e.ka=t,e.Nb="l",e},g.Je=function(t){var e=ce(this);return e.ja=!0,e.ka=t,e.Nb="r",e},g.$d=function(t,e){var r=ce(this);return r.ma=!0,n(t)||(t=null),r.ec=t,null!=e?(r.Lb=!0,r.xb=e):(r.Lb=!1,r.xb=""),r},g.td=function(t,e){var r=ce(this);return r.pa=!0,n(t)||(t=null),r.bc=t,n(e)?(r.Tb=!0,r.vb=e):(r.ah=!1,r.vb=""),r},g.toString=function(){return B(ee(this))},he.prototype.get=function(t){var e=w(this.Bd,t);if(!e)throw Error("No index defined for "+t);return e===Sd?null:e};var le=new he({".priority":Sd},{".priority":N}),ne=["object","boolean","number","string"];g=tc.prototype,g.K=function(){return!0},g.C=function(){return this.aa},g.ga=function(t){return new tc(this.B,t)},g.R=function(t){return".priority"===t?this.aa:C},g.Q=function(t){return t.e()?this:".priority"===E(t)?this.aa:C},g.Da=function(){return!1},g.rf=function(){return null},g.U=function(t,e){return".priority"===t?this.ga(e):e.e()&&".priority"!==t?this:C.U(t,e).ga(this.aa)},g.G=function(t,e){var r=E(t);return null===r?e:e.e()&&".priority"!==r?this:(K(".priority"!==r||1===Kd(t),".priority must be the last token in a path"),this.U(r,C.G(H(t),e)))},g.e=function(){return!1},g.Db=function(){return 0},g.P=function(){return!1},g.I=function(t){return t&&!this.C().e()?{".value":this.Ca(),".priority":this.C().I()}:this.Ca()},g.hash=function(){if(null===this.Cb){var t="";this.aa.e()||(t+="priority:"+oe(this.aa.I())+":");var e=typeof this.B,t=t+(e+":"),t="number"===e?t+Xc(this.B):t+this.B;this.Cb=Hc(t)}return this.Cb},g.Ca=function(){return this.B},g.Dc=function(t){if(t===C)return 1;if(t instanceof R)return-1;K(t.K(),"Unknown node type");var e=typeof t.B,r=typeof this.B,n=Na(ne,e),i=Na(ne,r);return K(n>=0,"Unknown leaf type: "+e),K(i>=0,"Unknown leaf type: "+r),n===i?"object"===r?0:this.B<t.B?-1:this.B===t.B?0:1:i-n},g.lb=function(){return this},g.Jc=function(){return!0},g.ca=function(t){return t===this?!0:t.K()?this.B===t.B&&this.aa.ca(t.aa):!1},g.toString=function(){return B(this.I(!0))},g=R.prototype,g.K=function(){return!1},g.C=function(){return this.aa||C},g.ga=function(t){return this.m.e()?this:new R(this.m,t,this.wb)},g.R=function(t){return".priority"===t?this.C():(t=this.m.get(t),null===t?C:t)},g.Q=function(t){var e=E(t);return null===e?this:this.R(e).Q(H(t))},g.Da=function(t){return null!==this.m.get(t)},g.U=function(t,e){if(K(e,"We should always be passing snapshot nodes"),".priority"===t)return this.ga(e);var r,n,i=new F(t,e);return e.e()?(r=this.m.remove(t),i=ke(this.wb,i,this.m)):(r=this.m.Oa(t,e),i=ie(this.wb,i,this.m)),n=r.e()?C:this.aa,new R(r,n,i)},g.G=function(t,e){var r=E(t);if(null===r)return e;K(".priority"!==E(t)||1===Kd(t),".priority must be the last token in a path");var n=this.R(r).G(H(t),e);return this.U(r,n)},g.e=function(){return this.m.e()},g.Db=function(){return this.m.count()};var pe=/^(0|[1-9]\d*)$/;g=R.prototype,g.I=function(t){if(this.e())return null;var e={},r=0,n=0,i=!0;if(this.P(N,function(o,a){e[o]=a.I(t),r++,i&&pe.test(o)?n=Math.max(n,Number(o)):i=!1}),!t&&i&&2*r>n){var o,a=[];for(o in e)a[o]=e[o];return a}return t&&!this.C().e()&&(e[".priority"]=this.C().I()),e},g.hash=function(){if(null===this.Cb){var t="";this.C().e()||(t+="priority:"+oe(this.C().I())+":"),this.P(N,function(e,r){var n=r.hash();""!==n&&(t+=":"+e+":"+n)}),this.Cb=""===t?"":Hc(t)}return this.Cb},g.rf=function(t,e,r){return(r=qe(this,r))?(t=cc(r,new F(t,e)))?t.name:null:cc(this.m,t)},g.P=function(t,e){var r=qe(this,t);return r?r.ia(function(t){return e(t.name,t.S)}):this.m.ia(e)},g.Xb=function(t){return this.Yb(t.Tc(),t)},g.Yb=function(t,e){var r=qe(this,e);if(r)return r.Yb(t,function(t){return t});for(var r=this.m.Yb(t.name,Tb),n=ec(r);null!=n&&0>e.compare(n,t);)J(r),n=ec(r);return r},g.sf=function(t){return this.$b(t.Qc(),t);
},g.$b=function(t,e){var r=qe(this,e);if(r)return r.$b(t,function(t){return t});for(var r=this.m.$b(t.name,Tb),n=ec(r);null!=n&&0<e.compare(n,t);)J(r),n=ec(r);return r},g.Dc=function(t){return this.e()?t.e()?0:-1:t.K()||t.e()?1:t===Vd?-1:0},g.lb=function(t){if(t===Qd||ta(this.wb.dc,t.toString()))return this;var e=this.wb,r=this.m;K(t!==Qd,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n=[],i=!1,r=r.Xb(Tb),o=J(r);o;)i=i||t.Ic(o.S),n.push(o),o=J(r);return n=i?je(n,td(t)):Sd,i=t.toString(),r=xa(e.dc),r[i]=t,t=xa(e.Bd),t[i]=n,new R(this.m,this.aa,new he(t,r))},g.Jc=function(t){return t===Qd||ta(this.wb.dc,t.toString())},g.ca=function(t){if(t===this)return!0;if(t.K())return!1;if(this.C().ca(t.C())&&this.m.count()===t.m.count()){var e=this.Xb(N);t=t.Xb(N);for(var r=J(e),n=J(t);r&&n;){if(r.name!==n.name||!r.S.ca(n.S))return!1;r=J(e),n=J(t)}return null===r&&null===n}return!1},g.toString=function(){return B(this.I(!0))};var re=Math.log(2),C=new R(new ac(Wb),null,le);ma(ue,R),g=ue.prototype,g.Dc=function(t){return t===this?0:1},g.ca=function(t){return t===this},g.C=function(){return this},g.R=function(){return C},g.e=function(){return!1};var Vd=new ue,Td=new F("[MIN_NAME]",C),Zd=new F("[MAX_NAME]",Vd);Id.prototype.w=function(){return this.Yd},g=ve.prototype,g.w=function(){return this.Ka.w().j()},g.fb=function(t){var e=ub(this.Ka);return e&&(S(this.W.n)||!t.e()&&!e.R(E(t)).e())?e.Q(t):null},g.e=function(){return 0===this.Xa.length},g.Pb=function(t){this.Xa.push(t)},g.jb=function(t,e){var r=[];if(e){K(null==t,"A cancel should cancel all event registrations.");var n=this.W.path;Oa(this.Xa,function(t){(t=t.gf(e,n))&&r.push(t)})}if(t){for(var i=[],o=0;o<this.Xa.length;++o){var a=this.Xa[o];if(a.matches(t)){if(t.tf()){i=i.concat(this.Xa.slice(o+1));break}}else i.push(a)}this.Xa=i}else this.Xa=[];return r},g.ab=function(t,e,r){t.type===Bd&&null!==t.source.Hb&&(K(ub(this.Ka),"We should always have a full cache before handling merges"),K(Jd(this.Ka),"Missing event cache, even though we have a server cache"));var n=this.Ka;return t=this.Hf.ab(n,t,e,r),e=this.Hf,r=t.je,K(r.O.j().Jc(e.V.g),"Event snap not indexed"),K(r.w().j().Jc(e.V.g),"Server snap not indexed"),K(Ib(t.je.w())||!Ib(n.w()),"Once a server snap is complete, it should never go back"),this.Ka=t.je,xe(this,t.fg,t.je.O.j(),null)},ze.prototype.Xc=function(t){return this.path.e()?(t=this.children.subtree(new L(t)),t.e()?null:t.value?new Xb(this.source,G,t.value):new ze(this.source,G,t)):(K(E(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new ze(this.source,H(this.path),this.children))},ze.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},g=Ae.prototype,g.yf=function(t,e,r,n){var i=t.path.toString();this.f("Listen called for "+i+" "+t.va());var o=Be(t,r),a={};this.$[o]=a,t=ge(t.n);var s=this;Ce(this,i+".json",t,function(t,e){var h=e;404===t&&(t=h=null),null===t&&s.Gb(i,h,!1,r),w(s.$,o)===a&&n(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},g.Rf=function(t,e){var r=Be(t,e);delete this.$[r]},g.M=function(t,e){this.Aa=t;var r=$c(t),n=r.data,r=r.Bc&&r.Bc.exp;e&&e("ok",{auth:n,expires:r})},g.ge=function(t){this.Aa=null,t("ok",null)},g.Me=function(){},g.Cf=function(){},g.Jd=function(){},g.put=function(){},g.zf=function(){},g.Ue=function(){},De.prototype.fe=function(t,e){var r;r=this.Oc[t]||[];var n=r.length;if(n>0){for(var i=Array(n),o=0;n>o;o++)i[o]=r[o];r=i}else r=[];for(n=0;n<r.length;n++)r[n].zc.apply(r[n].Ma,Array.prototype.slice.call(arguments,1))},De.prototype.Eb=function(t,e,r){Ee(this,t),this.Oc[t]=this.Oc[t]||[],this.Oc[t].push({zc:e,Ma:r}),(t=this.Ae(t))&&e.apply(r,t)},De.prototype.ic=function(t,e,r){Ee(this,t),t=this.Oc[t]||[];for(var n=0;n<t.length;n++)if(t[n].zc===e&&(!r||r===t[n].Ma)){t.splice(n,1);break}};var Fe=function(){var t=0,e=[];return function(r){var n=r===t;t=r;for(var i=Array(8),o=7;o>=0;o--)i[o]="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".charAt(r%64),r=Math.floor(r/64);if(K(0===r,"Cannot push at time == 0"),r=i.join(""),n){for(o=11;o>=0&&63===e[o];o--)e[o]=0;e[o]++}else for(o=0;12>o;o++)e[o]=Math.floor(64*Math.random());for(o=0;12>o;o++)r+="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".charAt(e[o]);return K(20===r.length,"nextPushId: Length should be 20."),r}}();ma(Ge,De),Ge.prototype.Ae=function(t){return K("online"===t,"Unknown event type: "+t),[this.kc]},ca(Ge),ma(He,De),He.prototype.Ae=function(t){return K("visible"===t,"Unknown event type: "+t),[this.Ob]},ca(He),g=L.prototype,g.toString=function(){for(var t="",e=this.Z;e<this.o.length;e++)""!==this.o[e]&&(t+="/"+this.o[e]);return t||"/"},g.slice=function(t){return this.o.slice(this.Z+(t||0))},g.parent=function(){if(this.Z>=this.o.length)return null;for(var t=[],e=this.Z;e<this.o.length-1;e++)t.push(this.o[e]);return new L(t,0)},g.u=function(t){for(var e=[],r=this.Z;r<this.o.length;r++)e.push(this.o[r]);if(t instanceof L)for(r=t.Z;r<t.o.length;r++)e.push(t.o[r]);else for(t=t.split("/"),r=0;r<t.length;r++)0<t[r].length&&e.push(t[r]);return new L(e,0)},g.e=function(){return this.Z>=this.o.length},g.ca=function(t){if(Kd(this)!==Kd(t))return!1;for(var e=this.Z,r=t.Z;e<=this.o.length;e++,r++)if(this.o[e]!==t.o[r])return!1;return!0},g.contains=function(t){var e=this.Z,r=t.Z;if(Kd(this)>Kd(t))return!1;for(;e<this.o.length;){if(this.o[e]!==t.o[r])return!1;++e,++r}return!0};var G=new L("");Je.prototype.push=function(t){0<this.Qa.length&&(this.Ha+=1),this.Qa.push(t),this.Ha+=Zc(t),Ke(this)},Je.prototype.pop=function(){var t=this.Qa.pop();this.Ha-=Zc(t),0<this.Qa.length&&--this.Ha};var Ne=new ac(function(t,e){return t===e?0:e>t?-1:1});g=Me.prototype,g.e=function(){return null===this.value&&this.children.e()},g.subtree=function(t){if(t.e())return this;var e=this.children.get(E(t));return null!==e?e.subtree(H(t)):Pd},g.set=function(t,e){if(t.e())return new Me(e,this.children);var r=E(t),n=(this.children.get(r)||Pd).set(H(t),e),r=this.children.Oa(r,n);return new Me(this.value,r)},g.remove=function(t){if(t.e())return this.children.e()?Pd:new Me(null,this.children);var e=E(t),r=this.children.get(e);return r?(t=r.remove(H(t)),e=t.e()?this.children.remove(e):this.children.Oa(e,t),null===this.value&&e.e()?Pd:new Me(this.value,e)):this},g.get=function(t){if(t.e())return this.value;var e=this.children.get(E(t));return e?e.get(H(t)):null};var Pd=new Me(null);Me.prototype.toString=function(){var t={};return Md(this,function(e,r){t[e.toString()]=r.toString()}),B(t)},Ze.prototype.Xc=function(t){return this.path.e()?null!=this.Qb.value?(K(this.Qb.children.e(),"affectedTree should not have overlapping affected paths."),this):(t=this.Qb.subtree(new L(t)),new Ze(G,t,this.Vd)):(K(E(this.path)===t,"operationForChild called for unrelated child."),new Ze(H(this.path),this.Qb,this.Vd))},Ze.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" ack write revert="+this.Vd+" affectedTree="+this.Qb+")"};var Yb=0,Bd=1,Ed=2,$b=3,$e=new af(!0,!1,null,!1),bf=new af(!1,!0,null,!1);af.prototype.toString=function(){return this.we?"user":this.af?"server(queryID="+this.Hb+")":"server"};var df=new cf(new Me(null));cf.prototype.Rd=function(t){return t.e()?df:(t=Od(this.X,t,Pd),new cf(t))},cf.prototype.e=function(){return this.X.e()},cf.prototype.apply=function(t){return kf(G,this.X,t)},g=lf.prototype,g.Rd=function(t){var e=Ua(this.na,function(e){return e.kd===t});K(e>=0,"removeWrite called with nonexistent writeId.");var n=this.na[e];this.na.splice(e,1);for(var i=n.visible,o=!1,a=this.na.length-1;i&&a>=0;){var s=this.na[a];s.visible&&(a>=e&&nf(s,n.path)?i=!1:n.path.contains(s.path)&&(o=!0)),a--}if(i){if(o)this.T=of(this.na,pf,G),this.Mc=0<this.na.length?this.na[this.na.length-1].kd:-1;else if(n.Ga)this.T=this.T.Rd(n.path);else{var h=this;r(n.children,function(t,e){h.T=h.T.Rd(n.path.u(e))})}return!0}return!1},g.za=function(t,e,r,n){if(r||n){var i=jf(this.T,t);return!n&&i.e()?e:n||null!=e||null!=gf(i,G)?(i=of(this.na,function(e){return(e.visible||n)&&(!r||!(0<=Na(r,e.kd)))&&(e.path.contains(t)||t.contains(e.path))},t),e=e||C,i.apply(e)):null}return i=gf(this.T,t),null!=i?i:(i=jf(this.T,t),i.e()?e:null!=e||null!=gf(i,G)?(e=e||C,i.apply(e)):null)},g.yc=function(t,e){var r=C,n=gf(this.T,t);if(n)n.K()||n.P(N,function(t,e){r=r.U(t,e)});else if(e){var i=jf(this.T,t);e.P(N,function(t,e){var n=jf(i,new L(t)).apply(e);r=r.U(t,n)}),Oa(hf(i),function(t){r=r.U(t.name,t.S)})}else i=jf(this.T,t),Oa(hf(i),function(t){r=r.U(t.name,t.S)});return r},g.ld=function(t,e,r,n){return K(r||n,"Either existingEventSnap or existingServerSnap must exist"),t=t.u(e),null!=gf(this.T,t)?null:(t=jf(this.T,t),t.e()?n.Q(e):t.apply(n.Q(e)))},g.xc=function(t,e,r){t=t.u(e);var n=gf(this.T,t);return null!=n?n:sb(r,e)?jf(this.T,t).apply(r.j().R(e)):null},g.tc=function(t){return gf(this.T,t)},g.ne=function(t,e,r,n,i,o){var a;if(t=jf(this.T,t),a=gf(t,G),null==a){if(null==e)return[];a=t.apply(e)}if(a=a.lb(o),a.e()||a.K())return[];for(e=[],t=td(o),i=i?a.$b(r,o):a.Yb(r,o),o=J(i);o&&e.length<n;)0!==t(o,r)&&e.push(o),o=J(i);return e},g=qf.prototype,g.za=function(t,e,r){return this.X.za(this.Mb,t,e,r)},g.yc=function(t){return this.X.yc(this.Mb,t)},g.ld=function(t,e,r){return this.X.ld(this.Mb,t,e,r)},g.tc=function(t){return this.X.tc(this.Mb.u(t))},g.ne=function(t,e,r,n,i){return this.X.ne(this.Mb,t,e,r,n,i)},g.xc=function(t,e){return this.X.xc(this.Mb,t,e)},g.u=function(t){return new qf(this.Mb.u(t),this.X)},g=rf.prototype,g.e=function(){return wa(this.ya)},g.ab=function(t,e,n){var i=t.source.Hb;if(null!==i)return i=w(this.ya,i),K(null!=i,"SyncTree gave us an op for an invalid query."),i.ab(t,e,n);var o=[];return r(this.ya,function(r){o=o.concat(r.ab(t,e,n))}),o},g.Pb=function(t,e,r,n,i){var o=t.va(),a=w(this.ya,o);if(!a){var a=r.za(i?n:null),s=!1;a?s=!0:(a=n instanceof R?r.yc(n):C,s=!1),a=new ve(t,new Id(new tb(a,s,!1),new tb(n,i,!1))),this.ya[o]=a}return a.Pb(e),ye(a,e)},g.jb=function(t,e,n){var i=t.va(),o=[],a=[],s=null!=sf(this);if("default"===i){var h=this;r(this.ya,function(t,r){a=a.concat(t.jb(e,n)),t.e()&&(delete h.ya[r],S(t.W.n)||o.push(t.W))})}else{var c=w(this.ya,i);c&&(a=a.concat(c.jb(e,n)),c.e()&&(delete this.ya[i],S(c.W.n)||o.push(c.W)))}return s&&null==sf(this)&&o.push(new U(t.k,t.path)),{Kg:o,mg:a}},g.fb=function(t){var e=null;return r(this.ya,function(r){e=e||r.fb(t)}),e},vf.prototype.Pb=function(t,e){var r=t.path,n=null,i=!1;Ve(this.ta,r,function(t,e){var o=T(t,r);return n=e.fb(o),i=i||null!=sf(e),!n});var o=this.ta.get(r);o?(i=i||null!=sf(o),n=n||o.fb(G)):(o=new rf,this.ta=this.ta.set(r,o));var a;null!=n?a=!0:(a=!1,n=C,Ye(this.ta.subtree(r),function(t,e){var r=e.fb(G);r&&(n=n.U(t,r))}));var s=null!=uf(o,t);if(!s&&!S(t.n)){var h=Gf(t);K(!(h in this.mc),"View does not exist, but we have a tag");var c=Hf++;this.mc[h]=c,this.$e["_"+c]=h}return a=o.Pb(t,e,new qf(r,this.ib),n,a),s||i||(o=uf(o,t),a=a.concat(If(this,t,o))),a},vf.prototype.jb=function(t,e,r){var n=t.path,i=this.ta.get(n),o=[];if(i&&("default"===t.va()||null!=uf(i,t))){o=i.jb(t,e,r),i.e()&&(this.ta=this.ta.remove(n)),i=o.Kg,o=o.mg,e=-1!==Ua(i,function(t){return S(t.n)});var a=Te(this.ta,n,function(t,e){return null!=sf(e)});if(e&&!a&&(n=this.ta.subtree(n),!n.e()))for(var n=Jf(n),s=0;s<n.length;++s){var h=n[s],c=h.W,h=Kf(this,h);this.Nc.Xe(Lf(c),Mf(this,c),h.xd,h.H)}if(!a&&0<i.length&&!r)if(e)this.Nc.ae(Lf(t),null);else{var u=this;Oa(i,function(t){t.va();var e=u.mc[Gf(t)];u.Nc.ae(Lf(t),e)})}Nf(this,i)}return o},vf.prototype.za=function(t,e){var r=this.ib,n=Te(this.ta,t,function(e,r){var n=T(e,t);return(n=r.fb(n))?n:void 0});return r.za(t,n,e,!0)};var Hf=1;g=Rf.prototype,g.Ca=function(){return this.A.value},g.clear=function(){this.A.value=null,this.A.children={},this.A.nd=0,Uf(this)},g.wd=function(){return 0<this.A.nd},g.e=function(){return null===this.Ca()&&!this.wd()},g.P=function(t){var e=this;r(this.A.children,function(r,n){t(new Rf(n,e,r))})},g.path=function(){return new L(null===this.Zc?this.Gd:this.Zc.path()+"/"+this.Gd)},g.name=function(){return this.Gd},g.parent=function(){return this.Zc};var Xf=/[\[\].#$\/\u0000-\u001F\u007F]/,Yf=/[\[\].#$\u0000-\u001F\u007F]/,Zf=/^[a-zA-Z][a-zA-Z._\-+]+$/;g=pg.prototype,g.add=function(t,e){this.set[t]=null!==e?e:!0},g.contains=function(t){return v(this.set,t)},g.get=function(t){return this.contains(t)?this.set[t]:void 0},g.remove=function(t){delete this.set[t]},g.clear=function(){this.set={}},g.e=function(){return wa(this.set)},g.count=function(){return pa(this.set)},g.keys=function(){var t=[];return r(this.set,function(e,r){t.push(r)}),t},qc.prototype.find=function(t){if(null!=this.B)return this.B.Q(t);if(t.e()||null==this.m)return null;var e=E(t);return t=H(t),this.m.contains(e)?this.m.get(e).find(t):null},qc.prototype.nc=function(t,e){if(t.e())this.B=e,this.m=null;else if(null!==this.B)this.B=this.B.G(t,e);else{null==this.m&&(this.m=new pg);var r=E(t);this.m.contains(r)||this.m.add(r,new qc),r=this.m.get(r),t=H(t),r.nc(t,e)}},qc.prototype.P=function(t){null!==this.m&&qg(this.m,function(e,r){t(e,r)})};var sg="auth.firebase.com",ug=["remember","redirectTo"];wg.prototype.set=function(t,e){if(!e){if(!this.be.length)throw Error("fb.login.SessionManager : No storage options available!");e=this.be[0]}e.set(this.Qe,t)},wg.prototype.get=function(){var t=Qa(this.be,q(this.qg,this)),t=Pa(t,function(t){return null!==t});return Xa(t,function(t,e){return ad(e.token)-ad(t.token)}),0<t.length?t.shift():null},wg.prototype.qg=function(t){try{var e=t.get(this.Qe);if(e&&e.token)return e}catch(r){}return null},wg.prototype.clear=function(){var t=this;Oa(this.be,function(e){e.remove(t.Qe)})},Ig.prototype.jc=function(t){var e,r=this;try{e=nb(t.data)}catch(n){}e&&"request"===e.a&&(Dg(window,"message",this.jc),this.ce=t.origin,this.Ac&&setTimeout(function(){r.Ac(r.ce,e.d,function(t,e){r.dg=!e,r.Ac=void 0,Jg(r,{a:"response",d:t,forceKeepWindowOpen:e})})},0))},Ig.prototype.Bg=function(){try{Dg(this.zd,"message",this.Bf)}catch(t){}this.Ac&&(Jg(this,{a:"error",d:"unknown closed window"}),this.Ac=void 0);try{window.close()}catch(e){}},Ig.prototype.Bf=function(t){if(this.dg&&"die"===t.data)try{window.close()}catch(e){}},Kg.prototype.open=function(t,e){yc.set("redirect_request_id",this.pc),yc.set("redirect_request_id",this.pc),e.requestId=this.pc,e.redirectTo=e.redirectTo||window.location.href,t+=(/\?/.test(t)?"":"?")+kb(e),window.location=t},Kg.isAvailable=function(){return!zg()&&!yg()},Kg.prototype.Cc=function(){return"redirect"};var Lg={NETWORK_ERROR:"Unable to contact the Firebase server.",SERVER_ERROR:"An unknown server error occurred.",TRANSPORT_UNAVAILABLE:"There are no login transports available for the requested method.",REQUEST_INTERRUPTED:"The browser redirected the page before the login request could complete.",USER_CANCELLED:"The user cancelled authentication."};Ng.prototype.open=function(t,e,r){function n(t){if(o&&(document.body.removeChild(o),o=void 0),u&&(u=clearInterval(u)),Dg(window,"message",i),Dg(window,"unload",n),c&&!t)try{c.close()}catch(e){a.postMessage("die",h)}c=a=void 0}function i(t){if(t.origin===h)try{var e=nb(t.data);"ready"===e.a?a.postMessage(l,h):"error"===e.a?(n(!1),r&&(r(e.d),r=null)):"response"===e.a&&(n(e.forceKeepWindowOpen),r&&(r(null,e.d),r=null))}catch(i){}}var o,a,s=Ag(8);if(!this.options.relay_url)return r(Error("invalid arguments: origin of url and relay_url must match"));var h=Eg(t);if(h!==Eg(this.options.relay_url))r&&setTimeout(function(){r(Error("invalid arguments: origin of url and relay_url must match"))},0);else{s&&(o=document.createElement("iframe"),o.setAttribute("src",this.options.relay_url),o.style.display="none",o.setAttribute("name","__winchan_relay_frame"),document.body.appendChild(o),a=o.contentWindow),t+=(/\?/.test(t)?"":"?")+kb(e);var c=window.open(t,this.options.window_name,this.options.window_features);a||(a=c);var u=setInterval(function(){c&&c.closed&&(n(!1),r&&(r(Mg("USER_CANCELLED")),r=null))},500),l=B({a:"request",d:e});Cg(window,"unload",n),Cg(window,"message",i)}},Ng.isAvailable=function(){var t;return(t="postMessage"in window&&!zg())&&((t=yg()||"undefined"!=typeof navigator&&(!!xg().match(/Windows Phone/)||!!window.Windows&&/^ms-appx:/.test(location.href)))||(t=xg(),t="undefined"!=typeof navigator&&"undefined"!=typeof window&&!!(t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)||t.match(/CriOS/)||t.match(/Twitter for iPhone/)||t.match(/FBAN\/FBIOS/)||window.navigator.standalone)),t=!t),t&&!xg().match(/PhantomJS/)},Ng.prototype.Cc=function(){return"popup"},Og.prototype.open=function(t,e,r){function n(){r&&(r(Mg("REQUEST_INTERRUPTED")),r=null)}var i,o=new XMLHttpRequest,a=this.options.method.toUpperCase();if(Cg(window,"beforeunload",n),o.onreadystatechange=function(){if(r&&4===o.readyState){var t;if(200<=o.status&&300>o.status){try{t=nb(o.responseText)}catch(e){}r(null,t)}else r(500<=o.status&&600>o.status?Mg("SERVER_ERROR"):Mg("NETWORK_ERROR"));r=null,Dg(window,"beforeunload",n)}},"GET"===a)t+=(/\?/.test(t)?"":"?")+kb(e),i=null;else{var s=this.options.headers.content_type;"application/json"===s&&(i=B(e)),"application/x-www-form-urlencoded"===s&&(i=kb(e))}o.open(a,t,!0),t={"X-Requested-With":"XMLHttpRequest",Accept:"application/json;text/plain"},za(t,this.options.headers);for(var h in t)o.setRequestHeader(h,t[h]);o.send(i)},Og.isAvailable=function(){var t;return(t=!!window.XMLHttpRequest)&&(t=xg(),t=!(t.match(/MSIE/)||t.match(/Trident/))||Ag(10)),t},Og.prototype.Cc=function(){return"json"},Pg.prototype.open=function(t,e,r){function n(){r&&(r(Mg("USER_CANCELLED")),r=null)}var i,o=this,a=Pc(sg);e.requestId=this.pc,e.redirectTo=a.scheme+"://"+a.host+"/blank/page.html",t+=/\?/.test(t)?"":"?",t+=kb(e),(i=window.open(t,"_blank","location=no"))&&ha(i.addEventListener)?(i.addEventListener("loadstart",function(t){var e;if(e=t&&t.url)t:{try{var s=document.createElement("a");s.href=t.url,e=s.host===a.host&&"/blank/page.html"===s.pathname;break t}catch(h){}e=!1}e&&(t=Fg(t.url),i.removeEventListener("exit",n),i.close(),t=new tg(null,null,{requestId:o.pc,requestKey:t}),o.Ef.requestWithCredential("/auth/session",t,r),r=null)}),i.addEventListener("exit",n)):r(Mg("TRANSPORT_UNAVAILABLE"))},Pg.isAvailable=function(){return yg()},Pg.prototype.Cc=function(){return"redirect"},Qg.prototype.open=function(t,e,r){function n(){r&&(r(Mg("REQUEST_INTERRUPTED")),r=null)}function i(){setTimeout(function(){window.__firebase_auth_jsonp[o]=void 0,wa(window.__firebase_auth_jsonp)&&(window.__firebase_auth_jsonp=void 0);try{var t=document.getElementById(o);t&&t.parentNode.removeChild(t)}catch(e){}},1),Dg(window,"beforeunload",n)}var o="fn"+(new Date).getTime()+Math.floor(99999*Math.random());e[this.options.callback_parameter]="__firebase_auth_jsonp."+o,t+=(/\?/.test(t)?"":"?")+kb(e),Cg(window,"beforeunload",n),window.__firebase_auth_jsonp[o]=function(t){r&&(r(null,t),r=null),i()},Rg(o,t,r)},Qg.isAvailable=function(){return"undefined"!=typeof document&&null!=document.createElement},Qg.prototype.Cc=function(){return"json"},ma(Sg,De),g=Sg.prototype,g.xe=function(){return this.mb||null},g.se=function(t,e){ah(this);var r=vg(t);r.$a._method="POST",this.qc("/users",r,function(t,r){t?P(e,t):P(e,t,r)})},g.Te=function(t,e){var r=this;ah(this);var n="/users/"+encodeURIComponent(t.email),i=vg(t);i.$a._method="DELETE",this.qc(n,i,function(t,n){!t&&n&&n.uid&&r.mb&&r.mb.uid&&r.mb.uid===n.uid&&Zg(r),P(e,t)})},g.pe=function(t,e){ah(this);var r="/users/"+encodeURIComponent(t.email)+"/password",n=vg(t);n.$a._method="PUT",n.$a.password=t.newPassword,this.qc(r,n,function(t){P(e,t)})},g.oe=function(t,e){ah(this);var r="/users/"+encodeURIComponent(t.oldEmail)+"/email",n=vg(t);n.$a._method="PUT",n.$a.email=t.newEmail,n.$a.password=t.password,this.qc(r,n,function(t){P(e,t)})},g.Ve=function(t,e){ah(this);var r="/users/"+encodeURIComponent(t.email)+"/password",n=vg(t);n.$a._method="POST",this.qc(r,n,function(t){P(e,t)})},g.qc=function(t,e,r){dh(this,[Og,Qg],t,e,r)},g.Ae=function(t){return K("auth_status"===t,'initial event must be of type "auth_status"'),this.Se?null:[this.mb]};var Cc="websocket",Dc="long_polling",ih,jh;hh.prototype.open=function(t,e){this.hf=0,this.la=e,this.Af=new eh(t),this.zb=!1;var r=this;this.qb=setTimeout(function(){r.f("Timed out trying to connect."),r.gb(),r.qb=null},Math.floor(3e4)),Rc(function(){if(!r.zb){r.Sa=new kh(function(t,e,n,i,o){if(lh(r,arguments),r.Sa)if(r.qb&&(clearTimeout(r.qb),r.qb=null),r.Hc=!0,"start"==t)r.id=e,r.Gf=n;else{if("close"!==t)throw Error("Unrecognized command received: "+t);e?(r.Sa.Xd=!1,fh(r.Af,e,function(){r.gb()})):r.gb()}},function(t,e){lh(r,arguments),gh(r.Af,t,e)},function(){r.gb()},r.jd);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),r.Sa.he&&(t.cb=r.Sa.he),t.v="5",r.Qf&&(t.s=r.Qf),r.Bb&&(t.ls=r.Bb),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f"),t=r.jd(t),r.f("Connecting via long-poll to "+t),mh(r.Sa,t,function(){})}})},hh.prototype.start=function(){var t=this.Sa,e=this.Gf;for(t.ug=this.id,t.vg=e,t.le=!0;nh(t););t=this.id,e=this.Gf,this.gc=document.createElement("iframe");var r={dframe:"t"};r.id=t,r.pw=e,this.gc.src=this.jd(r),this.gc.style.display="none",document.body.appendChild(this.gc)},hh.isAvailable=function(){return ih||!jh&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.Xg)&&!0},g=hh.prototype,g.Ed=function(){},g.dd=function(){this.zb=!0,this.Sa&&(this.Sa.close(),this.Sa=null),this.gc&&(document.body.removeChild(this.gc),this.gc=null),this.qb&&(clearTimeout(this.qb),this.qb=null)},g.gb=function(){this.zb||(this.f("Longpoll is closing itself"),this.dd(),this.la&&(this.la(this.Hc),this.la=null))},g.close=function(){this.zb||(this.f("Longpoll is being closed."),this.dd())},g.send=function(t){t=B(t),this.ob+=t.length,Ob(this.Ua,"bytes_sent",t.length),t=Ic(t),t=fb(t,!0),t=Vc(t,1840);for(var e=0;e<t.length;e++){var r=this.Sa;r.ad.push({Mg:this.hf,Ug:t.length,kf:t[e]}),r.le&&nh(r),this.hf++}},kh.prototype.close=function(){if(this.le=!1,this.Ea){this.Ea.eb.body.innerHTML="";var t=this;setTimeout(function(){null!==t.Ea&&(document.body.removeChild(t.Ea),t.Ea=null)},Math.floor(0))}var e=this.hb;e&&(this.hb=null,e())};var ph=null;"undefined"!=typeof MozWebSocket?ph=MozWebSocket:"undefined"!=typeof WebSocket&&(ph=WebSocket);var rh;qh.prototype.open=function(t,e){this.hb=e,this.zg=t,this.f("Websocket connecting to "+this.ef),this.Hc=!1,xc.set("previous_websocket_failure",!0);try{this.ua=new ph(this.ef)}catch(r){this.f("Error instantiating WebSocket.");var n=r.message||r.data;return n&&this.f(n),void this.gb()}var i=this;this.ua.onopen=function(){i.f("Websocket connected."),i.Hc=!0},this.ua.onclose=function(){i.f("Websocket connection was disconnected."),i.ua=null,i.gb()},this.ua.onmessage=function(t){if(null!==i.ua)if(t=t.data,i.nb+=t.length,Ob(i.Ua,"bytes_received",t.length),sh(i),null!==i.frames)th(i,t);else{t:{if(K(null===i.frames,"We already have a frame buffer"),6>=t.length){var e=Number(t);if(!isNaN(e)){i.bf=e,i.frames=[],t=null;break t}}i.bf=1,i.frames=[]}null!==t&&th(i,t)}},this.ua.onerror=function(t){i.f("WebSocket error.  Closing connection."),(t=t.message||t.data)&&i.f(t),i.gb()}},qh.prototype.start=function(){},qh.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&4.4>parseFloat(e[1])&&(t=!0)}return!t&&null!==ph&&!rh},qh.responsesRequiredToBeHealthy=2,qh.healthyTimeout=3e4,g=qh.prototype,g.Ed=function(){xc.remove("previous_websocket_failure")},g.send=function(t){sh(this),t=B(t),this.ob+=t.length,Ob(this.Ua,"bytes_sent",t.length),t=Vc(t,16384),1<t.length&&this.ua.send(String(t.length));for(var e=0;e<t.length;e++)this.ua.send(t[e])},g.dd=function(){this.zb=!0,this.Kc&&(clearInterval(this.Kc),this.Kc=null),this.ua&&(this.ua.close(),this.ua=null)},g.gb=function(){this.zb||(this.f("WebSocket is closing itself"),this.dd(),this.hb&&(this.hb(this.Hc),this.hb=null))},g.close=function(){this.zb||(this.f("WebSocket is being closed"),this.dd())};var wh=[hh,qh];yh.prototype.Fa=function(t){Jh(this,{t:"d",d:t})},yh.prototype.Id=function(t){Gh(this),this.jc(t)},yh.prototype.close=function(){2!==this.Ta&&(this.f("Closing realtime connection."),this.Ta=2,Fh(this),this.la&&(this.la(),this.la=null))};var Lh=0,Nh=0;g=Kh.prototype,g.Fa=function(t,e,r){var n=++this.Lg;t={r:n,a:t,b:e},this.f(B(t)),K(this.oa,"sendRequest call when we're not connected not allowed."),this.Ia.Fa(t),r&&(this.Td[n]=r)},g.yf=function(t,e,r,n){var i=t.va(),o=t.path.toString();this.f("Listen called for "+o+" "+i),this.$[o]=this.$[o]||{},K(fe(t.n)||!S(t.n),"listen() called for non-default but complete query"),K(!this.$[o][i],"listen() called twice for same path/queryId."),t={H:n,xd:e,Ig:t,tag:r},this.$[o][i]=t,this.oa&&Oh(this,t)},g.M=function(t,e,r){this.Aa={ig:t,of:!1,zc:e,md:r},this.f("Authenticating using credential: "+t),Qh(this),(e=40==t.length)||(t=$c(t).Bc,e="object"==typeof t&&!0===w(t,"admin")),e&&(this.f("Admin auth credential detected.  Reducing max reconnect time."),this.Fd=3e4)},g.ge=function(t){delete this.Aa,this.oa&&this.Fa("unauth",{},function(e){t(e.s,e.d)})},g.Rf=function(t,e){var r=t.path.toString(),n=t.va();if(this.f("Unlisten called for "+r+" "+n),K(fe(t.n)||!S(t.n),"unlisten() called for non-default but complete query"),Ph(this,r,n)&&this.oa){var i=ee(t.n);this.f("Unlisten on "+r+" for "+n),r={p:r},e&&(r.q=i,r.t=e),this.Fa("n",r)}},g.Me=function(t,e,r){this.oa?Rh(this,"o",t,e,r):this.Vc.push({$c:t,action:"o",data:e,H:r})},g.Cf=function(t,e,r){this.oa?Rh(this,"om",t,e,r):this.Vc.push({$c:t,action:"om",data:e,H:r})},g.Jd=function(t,e){this.oa?Rh(this,"oc",t,null,e):this.Vc.push({$c:t,action:"oc",data:null,H:e})},g.put=function(t,e,r,n){Sh(this,"p",t,e,r,n)},g.zf=function(t,e,r,n){Sh(this,"m",t,e,r,n)},g.Ue=function(t){this.oa&&(t={c:t},this.f("reportStats",t),this.Fa("s",t,function(t){"ok"!==t.s&&this.f("reportStats","Error sending stats: "+t.d)}))},g.Id=function(t){if("r"in t){this.f("from server: "+B(t));var e=t.r,r=this.Td[e];r&&(delete this.Td[e],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&(e=t.a,r=t.b,this.f("handleServerMessage",e,r),"d"===e?this.Gb(r.p,r.d,!1,r.t):"m"===e?this.Gb(r.p,r.d,!0,r.t):"c"===e?Uh(this,r.p,r.q):"ac"===e?(t=r.s,e=r.d,r=this.Aa,delete this.Aa,r&&r.md&&r.md(t,e)):"sd"===e?this.We?this.We(r):"msg"in r&&"undefined"!=typeof console&&console.log("FIREBASE: "+r.msg.replace("\n","\nFIREBASE: ")):Nc("Unrecognized action received from server: "+B(e)+"\nAre you using the latest client?"))}},g.Wc=function(t,e){if(this.f("connection ready"),this.oa=!0,this.Lc=(new Date).getTime(),this.Oe({serverTimeOffset:t-(new Date).getTime()}),this.Bb=e,this.nf){var r={};r["sdk.js."+hb.replace(/\./g,"-")]=1,yg()&&(r["framework.cordova"]=1),this.Ue(r)}Vh(this),this.nf=!1,this.Uc(!0)},g.Cg=function(t){t&&!this.Ob&&this.Za===this.Fd&&(this.f("Window became visible.  Reducing delay."),this.Za=1e3,this.Ia||Mh(this,0)),this.Ob=t},g.Ag=function(t){t?(this.f("Browser went online."),this.Za=1e3,this.Ia||Mh(this,0)):(this.f("Browser went offline.  Killing connection."),this.Ia&&this.Ia.close())},g.Df=function(){this.f("data client disconnected"),this.oa=!1,this.Ia=null;for(var t=0;t<this.qa.length;t++){var e=this.qa[t];e&&"h"in e.Jf&&e.Jg&&(e.H&&e.H("disconnect"),delete this.qa[t],this.Yc--)}0===this.Yc&&(this.qa=[]),this.Td={},Xh(this)&&(this.Ob?this.Lc&&(3e4<(new Date).getTime()-this.Lc&&(this.Za=1e3),this.Lc=null):(this.f("Window isn't visible.  Delaying reconnect."),this.Za=this.Fd,this.Ge=(new Date).getTime()),t=Math.max(0,this.Za-((new Date).getTime()-this.Ge)),t*=Math.random(),this.f("Trying to reconnect in "+t+"ms"),Mh(this,t),this.Za=Math.min(this.Fd,1.3*this.Za)),this.Uc(!1)},g.yb=function(){this.Ee=!0,this.Ia?this.Ia.close():(this.sb&&(clearTimeout(this.sb),this.sb=null),this.oa&&this.Df())},g.rc=function(){this.Ee=!1,this.Za=1e3,this.Ia||Mh(this,0)};var V={og:function(){ih=rh=!0}};V.forceLongPolling=V.og,V.pg=function(){jh=!0},V.forceWebSockets=V.pg,V.Pg=function(t,e){t.k.Ra.We=e},V.setSecurityDebugCallback=V.Pg,V.Ye=function(t,e){t.k.Ye(e)},V.stats=V.Ye,V.Ze=function(t,e){t.k.Ze(e)},V.statsIncrementCounter=V.Ze,V.sd=function(t){return t.k.sd},V.dataUpdateCount=V.sd,V.sg=function(t,e){t.k.De=e},V.interceptServerData=V.sg,V.yg=function(t){new Ig(t)},V.onPopupOpen=V.yg,V.Ng=function(t){sg=t},V.setAuthenticationServer=V.Ng,Q.prototype.I=function(){return x("Firebase.DataSnapshot.val",0,0,arguments.length),this.A.I()},Q.prototype.val=Q.prototype.I,Q.prototype.mf=function(){return x("Firebase.DataSnapshot.exportVal",0,0,arguments.length),this.A.I(!0)},Q.prototype.exportVal=Q.prototype.mf,Q.prototype.ng=function(){return x("Firebase.DataSnapshot.exists",0,0,arguments.length),!this.A.e()},Q.prototype.exists=Q.prototype.ng,Q.prototype.u=function(t){x("Firebase.DataSnapshot.child",0,1,arguments.length),ga(t)&&(t=String(t)),ig("Firebase.DataSnapshot.child",t);var e=new L(t),r=this.W.u(e);return new Q(this.A.Q(e),r,N)},Q.prototype.child=Q.prototype.u,Q.prototype.Da=function(t){x("Firebase.DataSnapshot.hasChild",1,1,arguments.length),ig("Firebase.DataSnapshot.hasChild",t);var e=new L(t);return!this.A.Q(e).e()},Q.prototype.hasChild=Q.prototype.Da,Q.prototype.C=function(){return x("Firebase.DataSnapshot.getPriority",0,0,arguments.length),this.A.C().I()},Q.prototype.getPriority=Q.prototype.C,Q.prototype.forEach=function(t){if(x("Firebase.DataSnapshot.forEach",1,1,arguments.length),A("Firebase.DataSnapshot.forEach",1,t,!1),this.A.K())return!1;var e=this;return!!this.A.P(this.g,function(r,n){return t(new Q(n,e.W.u(r),N))})},Q.prototype.forEach=Q.prototype.forEach,Q.prototype.wd=function(){return x("Firebase.DataSnapshot.hasChildren",0,0,arguments.length),this.A.K()?!1:!this.A.e()},Q.prototype.hasChildren=Q.prototype.wd,Q.prototype.name=function(){return O("Firebase.DataSnapshot.name() being deprecated. Please use Firebase.DataSnapshot.key() instead."),x("Firebase.DataSnapshot.name",0,0,arguments.length),this.key()},Q.prototype.name=Q.prototype.name,Q.prototype.key=function(){return x("Firebase.DataSnapshot.key",0,0,arguments.length),this.W.key()},Q.prototype.key=Q.prototype.key,Q.prototype.Db=function(){return x("Firebase.DataSnapshot.numChildren",0,0,arguments.length),this.A.Db()},Q.prototype.numChildren=Q.prototype.Db,Q.prototype.Ib=function(){return x("Firebase.DataSnapshot.ref",0,0,arguments.length),this.W},Q.prototype.ref=Q.prototype.Ib,g=Yh.prototype,g.toString=function(){return(this.F.kb?"https://":"http://")+this.F.host},g.name=function(){return this.F.hc},g.Gb=function(t,e,r,n){this.sd++;var i=new L(t);e=this.De?this.De(t,e):e,t=[],n?r?(e=na(e,function(t){return M(t)}),t=Ff(this.L,i,e,n)):(e=M(e),t=Bf(this.L,i,e,n)):r?(n=na(e,function(t){return M(t)}),t=Af(this.L,i,n)):(n=M(e),t=xf(this.L,new Xb(bf,i,n))),n=i,0<t.length&&(n=bi(this,i)),Ab(this.da,n,t)},g.Uc=function(t){Zh(this,"connected",t),!1===t&&ci(this)},g.Oe=function(t){var e=this;Wc(t,function(t,r){Zh(e,r,t)})},g.Le=function(t){Zh(this,"authenticated",t)},g.Kb=function(t,e,r,n){this.f("set",{path:t.toString(),value:e,$g:r});var i=ai(this);e=M(e,r);var i=sc(e,i),o=this.Hd++,i=wf(this.L,t,i,o,!0);wb(this.da,i);var a=this;this.ba.put(t.toString(),e.I(!0),function(e,r){var i="ok"===e;i||O("set at "+t+" failed: "+e),i=zf(a.L,o,!i),Ab(a.da,t,i),di(n,e,r)}),i=ei(this,t),bi(this,i),Ab(this.da,i,[])},g.update=function(t,e,n){this.f("update",{path:t.toString(),value:e});var i=!0,o=ai(this),a={};if(r(e,function(t,e){i=!1;var r=M(t);a[e]=sc(r,o)}),i)Cb("update() called with empty data.  Don't do anything."),di(n,"ok");else{var s=this.Hd++,h=yf(this.L,t,a,s);wb(this.da,h);var c=this;this.ba.zf(t.toString(),e,function(e,r){var i="ok"===e;i||O("update at "+t+" failed: "+e);
var i=zf(c.L,s,!i),o=t;0<i.length&&(o=bi(c,t)),Ab(c.da,o,i),di(n,e,r)}),e=ei(this,t),bi(this,e),Ab(this.da,t,[])}},g.Jd=function(t,e){var r=this;this.ba.Jd(t.toString(),function(n,i){"ok"===n&&rg(r.la,t),di(e,n,i)})},g.yb=function(){this.Ra&&this.Ra.yb()},g.rc=function(){this.Ra&&this.Ra.rc()},g.Ye=function(t){if("undefined"!=typeof console){t?(this.fd||(this.fd=new Lb(this.Ua)),t=this.fd.get()):t=this.Ua.get();var e,r=Ra(sa(t),function(t,e){return Math.max(e.length,t)},0);for(e in t){for(var n=t[e],i=e.length;r+2>i;i++)e+=" ";console.log(e+n)}}},g.Ze=function(t){Ob(this.Ua,t),this.Sg.Of[t]=!0},g.f=function(t){var e="";this.Ra&&(e=this.Ra.id+":"),Cb(e,arguments)},W.prototype.yb=function(){for(var t in this.oc)this.oc[t].yb()},W.prototype.rc=function(){for(var t in this.oc)this.oc[t].rc()},W.prototype.ve=function(){this.Sf=!0},ca(W),W.prototype.interrupt=W.prototype.yb,W.prototype.resume=W.prototype.rc,X.prototype.cancel=function(t){x("Firebase.onDisconnect().cancel",0,1,arguments.length),A("Firebase.onDisconnect().cancel",1,t,!0),this.bd.Jd(this.ra,t||null)},X.prototype.cancel=X.prototype.cancel,X.prototype.remove=function(t){x("Firebase.onDisconnect().remove",0,1,arguments.length),jg("Firebase.onDisconnect().remove",this.ra),A("Firebase.onDisconnect().remove",1,t,!0),fi(this.bd,this.ra,null,t)},X.prototype.remove=X.prototype.remove,X.prototype.set=function(t,e){x("Firebase.onDisconnect().set",1,2,arguments.length),jg("Firebase.onDisconnect().set",this.ra),bg("Firebase.onDisconnect().set",t,this.ra,!1),A("Firebase.onDisconnect().set",2,e,!0),fi(this.bd,this.ra,t,e)},X.prototype.set=X.prototype.set,X.prototype.Kb=function(t,e,r){x("Firebase.onDisconnect().setWithPriority",2,3,arguments.length),jg("Firebase.onDisconnect().setWithPriority",this.ra),bg("Firebase.onDisconnect().setWithPriority",t,this.ra,!1),fg("Firebase.onDisconnect().setWithPriority",2,e),A("Firebase.onDisconnect().setWithPriority",3,r,!0),gi(this.bd,this.ra,t,e,r)},X.prototype.setWithPriority=X.prototype.Kb,X.prototype.update=function(t,e){if(x("Firebase.onDisconnect().update",1,2,arguments.length),jg("Firebase.onDisconnect().update",this.ra),ea(t)){for(var r={},n=0;n<t.length;++n)r[""+n]=t[n];t=r,O("Passing an Array to Firebase.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}eg("Firebase.onDisconnect().update",t,this.ra),A("Firebase.onDisconnect().update",2,e,!0),hi(this.bd,this.ra,t,e)},X.prototype.update=X.prototype.update,g=Y.prototype,g.Ib=function(){return x("Query.ref",0,0,arguments.length),new U(this.k,this.path)},g.Eb=function(t,e,r,n){x("Query.on",2,4,arguments.length),gg("Query.on",t,!1),A("Query.on",2,e,!1);var i=vi("Query.on",r,n);if("value"===t)ii(this.k,this,new id(e,i.cancel||null,i.Ma||null));else{var o={};o[t]=e,ii(this.k,this,new jd(o,i.cancel,i.Ma))}return e},g.ic=function(t,e,r){x("Query.off",0,3,arguments.length),gg("Query.off",t,!0),A("Query.off",2,e,!0),mb("Query.off",3,r);var n=null,i=null;"value"===t?n=new id(e||null,null,r||null):t&&(e&&(i={},i[t]=e),n=new jd(i,null,r||null)),i=this.k,n=".info"===E(this.path)?i.Cd.jb(this,n):i.L.jb(this,n),yb(i.da,this.path,n)},g.Dg=function(t,e){function r(a){o&&(o=!1,i.ic(t,r),e.call(n.Ma,a))}x("Query.once",2,4,arguments.length),gg("Query.once",t,!1),A("Query.once",2,e,!1);var n=vi("Query.once",arguments[2],arguments[3]),i=this,o=!0;this.Eb(t,r,function(e){i.ic(t,r),n.cancel&&n.cancel.call(n.Ma,e)})},g.He=function(t){if(O("Query.limit() being deprecated. Please use Query.limitToFirst() or Query.limitToLast() instead."),x("Query.limit",1,1,arguments.length),!ga(t)||Math.floor(t)!==t||0>=t)throw Error("Query.limit: First argument must be a positive integer.");if(this.n.ja)throw Error("Query.limit: Limit was already set (by another call to limit, limitToFirst, orlimitToLast.");var e=this.n.He(t);return ti(e),new Y(this.k,this.path,e,this.lc)},g.Ie=function(t){if(x("Query.limitToFirst",1,1,arguments.length),!ga(t)||Math.floor(t)!==t||0>=t)throw Error("Query.limitToFirst: First argument must be a positive integer.");if(this.n.ja)throw Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Y(this.k,this.path,this.n.Ie(t),this.lc)},g.Je=function(t){if(x("Query.limitToLast",1,1,arguments.length),!ga(t)||Math.floor(t)!==t||0>=t)throw Error("Query.limitToLast: First argument must be a positive integer.");if(this.n.ja)throw Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Y(this.k,this.path,this.n.Je(t),this.lc)},g.Eg=function(t){if(x("Query.orderByChild",1,1,arguments.length),"$key"===t)throw Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ig("Query.orderByChild",t),ui(this,"Query.orderByChild");var e=new L(t);if(e.e())throw Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");return e=new Ud(e),e=de(this.n,e),si(e),new Y(this.k,this.path,e,!0)},g.Fg=function(){x("Query.orderByKey",0,0,arguments.length),ui(this,"Query.orderByKey");var t=de(this.n,Qd);return si(t),new Y(this.k,this.path,t,!0)},g.Gg=function(){x("Query.orderByPriority",0,0,arguments.length),ui(this,"Query.orderByPriority");var t=de(this.n,N);return si(t),new Y(this.k,this.path,t,!0)},g.Hg=function(){x("Query.orderByValue",0,0,arguments.length),ui(this,"Query.orderByValue");var t=de(this.n,$d);return si(t),new Y(this.k,this.path,t,!0)},g.$d=function(t,e){x("Query.startAt",0,2,arguments.length),bg("Query.startAt",t,this.path,!0),hg("Query.startAt",e);var r=this.n.$d(t,e);if(ti(r),si(r),this.n.ma)throw Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return n(t)||(e=t=null),new Y(this.k,this.path,r,this.lc)},g.td=function(t,e){x("Query.endAt",0,2,arguments.length),bg("Query.endAt",t,this.path,!0),hg("Query.endAt",e);var r=this.n.td(t,e);if(ti(r),si(r),this.n.pa)throw Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Y(this.k,this.path,r,this.lc)},g.kg=function(t,e){if(x("Query.equalTo",1,2,arguments.length),bg("Query.equalTo",t,this.path,!1),hg("Query.equalTo",e),this.n.ma)throw Error("Query.equalTo: Starting point was already set (by another call to endAt or equalTo).");if(this.n.pa)throw Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.$d(t,e).td(t,e)},g.toString=function(){x("Query.toString",0,0,arguments.length);for(var t=this.path,e="",r=t.Z;r<t.o.length;r++)""!==t.o[r]&&(e+="/"+encodeURIComponent(String(t.o[r])));return this.k.toString()+(e||"/")},g.va=function(){var t=Uc(ee(this.n));return"{}"===t?"default":t},Y.prototype.ref=Y.prototype.Ib,Y.prototype.on=Y.prototype.Eb,Y.prototype.off=Y.prototype.ic,Y.prototype.once=Y.prototype.Dg,Y.prototype.limit=Y.prototype.He,Y.prototype.limitToFirst=Y.prototype.Ie,Y.prototype.limitToLast=Y.prototype.Je,Y.prototype.orderByChild=Y.prototype.Eg,Y.prototype.orderByKey=Y.prototype.Fg,Y.prototype.orderByPriority=Y.prototype.Gg,Y.prototype.orderByValue=Y.prototype.Hg,Y.prototype.startAt=Y.prototype.$d,Y.prototype.endAt=Y.prototype.td,Y.prototype.equalTo=Y.prototype.kg,Y.prototype.toString=Y.prototype.toString;var Z={};Z.vc=Kh,Z.DataConnection=Z.vc,Kh.prototype.Rg=function(t,e){this.Fa("q",{p:t},e)},Z.vc.prototype.simpleListen=Z.vc.prototype.Rg,Kh.prototype.jg=function(t,e){this.Fa("echo",{d:t},e)},Z.vc.prototype.echo=Z.vc.prototype.jg,Kh.prototype.interrupt=Kh.prototype.yb,Z.Vf=yh,Z.RealTimeConnection=Z.Vf,yh.prototype.sendRequest=yh.prototype.Fa,yh.prototype.close=yh.prototype.close,Z.rg=function(t){var e=Kh.prototype.put;return Kh.prototype.put=function(r,i,o,a){n(a)&&(a=t()),e.call(this,r,i,o,a)},function(){Kh.prototype.put=e}},Z.hijackHash=Z.rg,Z.Uf=zc,Z.ConnectionTarget=Z.Uf,Z.va=function(t){return t.va()},Z.queryIdentifier=Z.va,Z.tg=function(t){return t.k.Ra.$},Z.listens=Z.tg,Z.ve=function(t){t.ve()},Z.forceRestClient=Z.ve,ma(U,Y);var wi=U,xi=["Firebase"],yi=aa;xi[0]in yi||!yi.execScript||yi.execScript("var "+xi[0]);for(var zi;xi.length&&(zi=xi.shift());)!xi.length&&n(wi)?yi[zi]=wi:yi=yi[zi]?yi[zi]:yi[zi]={};U.goOffline=function(){x("Firebase.goOffline",0,0,arguments.length),W.ub().yb()},U.goOnline=function(){x("Firebase.goOnline",0,0,arguments.length),W.ub().rc()},U.enableLogging=Lc,U.ServerValue={TIMESTAMP:{".sv":"timestamp"}},U.SDK_VERSION=hb,U.INTERNAL=V,U.Context=W,U.TEST_ACCESS=Z,U.prototype.name=function(){return O("Firebase.name() being deprecated. Please use Firebase.key() instead."),x("Firebase.name",0,0,arguments.length),this.key()},U.prototype.name=U.prototype.name,U.prototype.key=function(){return x("Firebase.key",0,0,arguments.length),this.path.e()?null:Ld(this.path)},U.prototype.key=U.prototype.key,U.prototype.u=function(t){if(x("Firebase.child",1,1,arguments.length),ga(t))t=String(t);else if(!(t instanceof L))if(null===E(this.path)){var e=t;e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ig("Firebase.child",e)}else ig("Firebase.child",t);return new U(this.k,this.path.u(t))},U.prototype.child=U.prototype.u,U.prototype.parent=function(){x("Firebase.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new U(this.k,t)},U.prototype.parent=U.prototype.parent,U.prototype.root=function(){x("Firebase.ref",0,0,arguments.length);for(var t=this;null!==t.parent();)t=t.parent();return t},U.prototype.root=U.prototype.root,U.prototype.set=function(t,e){x("Firebase.set",1,2,arguments.length),jg("Firebase.set",this.path),bg("Firebase.set",t,this.path,!1),A("Firebase.set",2,e,!0),this.k.Kb(this.path,t,null,e||null)},U.prototype.set=U.prototype.set,U.prototype.update=function(t,e){if(x("Firebase.update",1,2,arguments.length),jg("Firebase.update",this.path),ea(t)){for(var r={},n=0;n<t.length;++n)r[""+n]=t[n];t=r,O("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}eg("Firebase.update",t,this.path),A("Firebase.update",2,e,!0),this.k.update(this.path,t,e||null)},U.prototype.update=U.prototype.update,U.prototype.Kb=function(t,e,r){if(x("Firebase.setWithPriority",2,3,arguments.length),jg("Firebase.setWithPriority",this.path),bg("Firebase.setWithPriority",t,this.path,!1),fg("Firebase.setWithPriority",2,e),A("Firebase.setWithPriority",3,r,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.setWithPriority failed: "+this.key()+" is a read-only object.";this.k.Kb(this.path,t,e,r||null)},U.prototype.setWithPriority=U.prototype.Kb,U.prototype.remove=function(t){x("Firebase.remove",0,1,arguments.length),jg("Firebase.remove",this.path),A("Firebase.remove",1,t,!0),this.set(null,t)},U.prototype.remove=U.prototype.remove,U.prototype.transaction=function(t,e,r){if(x("Firebase.transaction",1,3,arguments.length),jg("Firebase.transaction",this.path),A("Firebase.transaction",1,t,!1),A("Firebase.transaction",2,e,!0),n(r)&&"boolean"!=typeof r)throw Error(y("Firebase.transaction",3,!0)+"must be a boolean.");if(".length"===this.key()||".keys"===this.key())throw"Firebase.transaction failed: "+this.key()+" is a read-only object.";"undefined"==typeof r&&(r=!0),ji(this.k,this.path,t,e||null,r)},U.prototype.transaction=U.prototype.transaction,U.prototype.Og=function(t,e){x("Firebase.setPriority",1,2,arguments.length),jg("Firebase.setPriority",this.path),fg("Firebase.setPriority",1,t),A("Firebase.setPriority",2,e,!0),this.k.Kb(this.path.u(".priority"),t,null,e)},U.prototype.setPriority=U.prototype.Og,U.prototype.push=function(t,e){x("Firebase.push",0,2,arguments.length),jg("Firebase.push",this.path),bg("Firebase.push",t,this.path,!0),A("Firebase.push",2,e,!0);var r=$h(this.k),r=Fe(r),r=this.u(r);return"undefined"!=typeof t&&null!==t&&r.set(t,e),r},U.prototype.push=U.prototype.push,U.prototype.hb=function(){return jg("Firebase.onDisconnect",this.path),new X(this.k,this.path)},U.prototype.onDisconnect=U.prototype.hb,U.prototype.M=function(t,e,r){O("FirebaseRef.auth() being deprecated. Please use FirebaseRef.authWithCustomToken() instead."),x("Firebase.auth",1,3,arguments.length),kg("Firebase.auth",t),A("Firebase.auth",2,e,!0),A("Firebase.auth",3,e,!0),Yg(this.k.M,t,{},{remember:"none"},e,r)},U.prototype.auth=U.prototype.M,U.prototype.ge=function(t){x("Firebase.unauth",0,1,arguments.length),A("Firebase.unauth",1,t,!0),Zg(this.k.M,t)},U.prototype.unauth=U.prototype.ge,U.prototype.xe=function(){return x("Firebase.getAuth",0,0,arguments.length),this.k.M.xe()},U.prototype.getAuth=U.prototype.xe,U.prototype.xg=function(t,e){x("Firebase.onAuth",1,2,arguments.length),A("Firebase.onAuth",1,t,!1),mb("Firebase.onAuth",2,e),this.k.M.Eb("auth_status",t,e)},U.prototype.onAuth=U.prototype.xg,U.prototype.wg=function(t,e){x("Firebase.offAuth",1,2,arguments.length),A("Firebase.offAuth",1,t,!1),mb("Firebase.offAuth",2,e),this.k.M.ic("auth_status",t,e)},U.prototype.offAuth=U.prototype.wg,U.prototype.Zf=function(t,e,r){x("Firebase.authWithCustomToken",2,3,arguments.length),kg("Firebase.authWithCustomToken",t),A("Firebase.authWithCustomToken",2,e,!1),ng("Firebase.authWithCustomToken",3,r,!0),Yg(this.k.M,t,{},r||{},e)},U.prototype.authWithCustomToken=U.prototype.Zf,U.prototype.$f=function(t,e,r){x("Firebase.authWithOAuthPopup",2,3,arguments.length),mg("Firebase.authWithOAuthPopup",t),A("Firebase.authWithOAuthPopup",2,e,!1),ng("Firebase.authWithOAuthPopup",3,r,!0),ch(this.k.M,t,r,e)},U.prototype.authWithOAuthPopup=U.prototype.$f,U.prototype.ag=function(t,e,r){x("Firebase.authWithOAuthRedirect",2,3,arguments.length),mg("Firebase.authWithOAuthRedirect",t),A("Firebase.authWithOAuthRedirect",2,e,!1),ng("Firebase.authWithOAuthRedirect",3,r,!0);var n=this.k.M;ah(n);var i=[Kg],o=vg(r);"anonymous"===t||"firebase"===t?P(e,Mg("TRANSPORT_UNAVAILABLE")):(yc.set("redirect_client_options",o.od),bh(n,i,"/auth/"+t,o,e))},U.prototype.authWithOAuthRedirect=U.prototype.ag,U.prototype.bg=function(t,e,r,n){x("Firebase.authWithOAuthToken",3,4,arguments.length),mg("Firebase.authWithOAuthToken",t),A("Firebase.authWithOAuthToken",3,r,!1),ng("Firebase.authWithOAuthToken",4,n,!0),p(e)?(lg("Firebase.authWithOAuthToken",2,e),$g(this.k.M,t+"/token",{access_token:e},n,r)):(ng("Firebase.authWithOAuthToken",2,e,!1),$g(this.k.M,t+"/token",e,n,r))},U.prototype.authWithOAuthToken=U.prototype.bg,U.prototype.Yf=function(t,e){x("Firebase.authAnonymously",1,2,arguments.length),A("Firebase.authAnonymously",1,t,!1),ng("Firebase.authAnonymously",2,e,!0),$g(this.k.M,"anonymous",{},e,t)},U.prototype.authAnonymously=U.prototype.Yf,U.prototype.cg=function(t,e,r){x("Firebase.authWithPassword",2,3,arguments.length),ng("Firebase.authWithPassword",1,t,!1),og("Firebase.authWithPassword",t,"email"),og("Firebase.authWithPassword",t,"password"),A("Firebase.authWithPassword",2,e,!1),ng("Firebase.authWithPassword",3,r,!0),$g(this.k.M,"password",t,r,e)},U.prototype.authWithPassword=U.prototype.cg,U.prototype.se=function(t,e){x("Firebase.createUser",2,2,arguments.length),ng("Firebase.createUser",1,t,!1),og("Firebase.createUser",t,"email"),og("Firebase.createUser",t,"password"),A("Firebase.createUser",2,e,!1),this.k.M.se(t,e)},U.prototype.createUser=U.prototype.se,U.prototype.Te=function(t,e){x("Firebase.removeUser",2,2,arguments.length),ng("Firebase.removeUser",1,t,!1),og("Firebase.removeUser",t,"email"),og("Firebase.removeUser",t,"password"),A("Firebase.removeUser",2,e,!1),this.k.M.Te(t,e)},U.prototype.removeUser=U.prototype.Te,U.prototype.pe=function(t,e){x("Firebase.changePassword",2,2,arguments.length),ng("Firebase.changePassword",1,t,!1),og("Firebase.changePassword",t,"email"),og("Firebase.changePassword",t,"oldPassword"),og("Firebase.changePassword",t,"newPassword"),A("Firebase.changePassword",2,e,!1),this.k.M.pe(t,e)},U.prototype.changePassword=U.prototype.pe,U.prototype.oe=function(t,e){x("Firebase.changeEmail",2,2,arguments.length),ng("Firebase.changeEmail",1,t,!1),og("Firebase.changeEmail",t,"oldEmail"),og("Firebase.changeEmail",t,"newEmail"),og("Firebase.changeEmail",t,"password"),A("Firebase.changeEmail",2,e,!1),this.k.M.oe(t,e)},U.prototype.changeEmail=U.prototype.oe,U.prototype.Ve=function(t,e){x("Firebase.resetPassword",2,2,arguments.length),ng("Firebase.resetPassword",1,t,!1),og("Firebase.resetPassword",t,"email"),A("Firebase.resetPassword",2,e,!1),this.k.M.Ve(t,e)},U.prototype.resetPassword=U.prototype.Ve}(),module.exports=Firebase},{}],12:[function(t,e,r){!function(r,n,i){"use strict";!function o(e,r,n){function i(s,h){if(!r[s]){if(!e[s]){var c="function"==typeof t&&t;if(!h&&c)return c(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return i(r?r:t)},l,l.exports,o,e,r,n)}return r[s].exports}for(var a="function"==typeof t&&t,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t){var e,o,a,s,h=function(t){return t&&t.__esModule?t:{"default":t}},c=t("./modules/handle-dom"),u=t("./modules/utils"),l=t("./modules/handle-swal-dom"),f=t("./modules/handle-click"),p=t("./modules/handle-key"),d=h(p),m=t("./modules/default-params"),g=h(m),v=t("./modules/set-params"),y=h(v);a=s=function(){function t(t){var e=a;return e[t]===i?g["default"][t]:e[t]}var a=arguments[0];if(c.addClass(n.body,"stop-scrolling"),l.resetInput(),a===i)return u.logStr("SweetAlert expects at least 1 attribute!"),!1;var h=u.extend({},g["default"]);switch(typeof a){case"string":h.title=a,h.text=arguments[1]||"",h.type=arguments[2]||"";break;case"object":if(a.title===i)return u.logStr('Missing "title" argument!'),!1;h.title=a.title;for(var p in g["default"])h[p]=t(p);h.confirmButtonText=h.showCancelButton?"Confirm":g["default"].confirmButtonText,h.confirmButtonText=t("confirmButtonText"),h.doneFunction=arguments[1]||null;break;default:return u.logStr('Unexpected type of argument! Expected "string" or "object", got '+typeof a),!1}y["default"](h),l.fixVerticalPosition(),l.openModal(arguments[1]);for(var m=l.getModal(),v=m.querySelectorAll("button"),b=["onclick","onmouseover","onmouseout","onmousedown","onmouseup","onfocus"],x=function(t){return f.handleButton(t,h,m)},w=0;w<v.length;w++)for(var M=0;M<b.length;M++){var S=b[M];v[w][S]=x}l.getOverlay().onclick=x,e=r.onkeydown;var _=function(t){return d["default"](t,h,m)};r.onkeydown=_,r.onfocus=function(){setTimeout(function(){o!==i&&(o.focus(),o=i)},0)},s.enableButtons()},a.setDefaults=s.setDefaults=function(t){if(!t)throw new Error("userParams is required");if("object"!=typeof t)throw new Error("userParams has to be a object");u.extend(g["default"],t)},a.close=s.close=function(){var t=l.getModal();c.fadeOut(l.getOverlay(),5),c.fadeOut(t,5),c.removeClass(t,"showSweetAlert"),c.addClass(t,"hideSweetAlert"),c.removeClass(t,"visible");var a=t.querySelector(".sa-icon.sa-success");c.removeClass(a,"animate"),c.removeClass(a.querySelector(".sa-tip"),"animateSuccessTip"),c.removeClass(a.querySelector(".sa-long"),"animateSuccessLong");var s=t.querySelector(".sa-icon.sa-error");c.removeClass(s,"animateErrorIcon"),c.removeClass(s.querySelector(".sa-x-mark"),"animateXMark");var h=t.querySelector(".sa-icon.sa-warning");return c.removeClass(h,"pulseWarning"),c.removeClass(h.querySelector(".sa-body"),"pulseWarningIns"),c.removeClass(h.querySelector(".sa-dot"),"pulseWarningIns"),setTimeout(function(){var e=t.getAttribute("data-custom-class");c.removeClass(t,e)},300),c.removeClass(n.body,"stop-scrolling"),r.onkeydown=e,r.previousActiveElement&&r.previousActiveElement.focus(),o=i,clearTimeout(t.timeout),!0},a.showInputError=s.showInputError=function(t){var e=l.getModal(),r=e.querySelector(".sa-input-error");c.addClass(r,"show");var n=e.querySelector(".sa-error-container");c.addClass(n,"show"),n.querySelector("p").innerHTML=t,setTimeout(function(){a.enableButtons()},1),e.querySelector("input").focus()},a.resetInputError=s.resetInputError=function(t){if(t&&13===t.keyCode)return!1;var e=l.getModal(),r=e.querySelector(".sa-input-error");c.removeClass(r,"show");var n=e.querySelector(".sa-error-container");c.removeClass(n,"show")},a.disableButtons=s.disableButtons=function(){var t=l.getModal(),e=t.querySelector("button.confirm"),r=t.querySelector("button.cancel");e.disabled=!0,r.disabled=!0},a.enableButtons=s.enableButtons=function(){var t=l.getModal(),e=t.querySelector("button.confirm"),r=t.querySelector("button.cancel");e.disabled=!1,r.disabled=!1},"undefined"!=typeof r?r.sweetAlert=r.swal=a:u.logStr("SweetAlert is a frontend module!")},{"./modules/default-params":2,"./modules/handle-click":3,"./modules/handle-dom":4,"./modules/handle-key":5,"./modules/handle-swal-dom":6,"./modules/set-params":8,"./modules/utils":9}],2:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n={title:"",text:"",type:null,allowOutsideClick:!1,showConfirmButton:!0,showCancelButton:!1,closeOnConfirm:!0,closeOnCancel:!0,confirmButtonText:"OK",confirmButtonColor:"#8CD4F5",cancelButtonText:"Cancel",imageUrl:null,imageSize:null,timer:null,customClass:"",html:!1,animation:!0,allowEscapeKey:!0,inputType:"text",inputPlaceholder:"",inputValue:"",showLoaderOnConfirm:!1};r["default"]=n,e.exports=r["default"]},{}],3:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var i=t("./utils"),o=(t("./handle-swal-dom"),t("./handle-dom")),a=function(t,e,n){function a(t){d&&e.confirmButtonColor&&(p.style.backgroundColor=t)}var c,u,l,f=t||r.event,p=f.target||f.srcElement,d=-1!==p.className.indexOf("confirm"),m=-1!==p.className.indexOf("sweet-overlay"),g=o.hasClass(n,"visible"),v=e.doneFunction&&"true"===n.getAttribute("data-has-done-function");switch(d&&e.confirmButtonColor&&(c=e.confirmButtonColor,u=i.colorLuminance(c,-.04),l=i.colorLuminance(c,-.14)),f.type){case"mouseover":a(u);break;case"mouseout":a(c);break;case"mousedown":a(l);break;case"mouseup":a(u);break;case"focus":var y=n.querySelector("button.confirm"),b=n.querySelector("button.cancel");d?b.style.boxShadow="none":y.style.boxShadow="none";break;case"click":var x=n===p,w=o.isDescendant(n,p);if(!x&&!w&&g&&!e.allowOutsideClick)break;d&&v&&g?s(n,e):v&&g||m?h(n,e):o.isDescendant(n,p)&&"BUTTON"===p.tagName&&sweetAlert.close()}},s=function(t,e){var r=!0;o.hasClass(t,"show-input")&&(r=t.querySelector("input").value,r||(r="")),e.doneFunction(r),e.closeOnConfirm&&sweetAlert.close(),e.showLoaderOnConfirm&&sweetAlert.disableButtons()},h=function(t,e){var r=String(e.doneFunction).replace(/\s/g,""),n="function("===r.substring(0,9)&&")"!==r.substring(9,10);n&&e.doneFunction(!1),e.closeOnCancel&&sweetAlert.close()};n["default"]={handleButton:a,handleConfirm:s,handleCancel:h},e.exports=n["default"]},{"./handle-dom":4,"./handle-swal-dom":6,"./utils":9}],4:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var o=function(t,e){return new RegExp(" "+e+" ").test(" "+t.className+" ")},a=function(t,e){o(t,e)||(t.className+=" "+e)},s=function(t,e){var r=" "+t.className.replace(/[\t\r\n]/g," ")+" ";if(o(t,e)){for(;r.indexOf(" "+e+" ")>=0;)r=r.replace(" "+e+" "," ");t.className=r.replace(/^\s+|\s+$/g,"")}},h=function(t){var e=n.createElement("div");return e.appendChild(n.createTextNode(t)),e.innerHTML},c=function(t){t.style.opacity="",t.style.display="block"},u=function(t){if(t&&!t.length)return c(t);for(var e=0;e<t.length;++e)c(t[e])},l=function(t){t.style.opacity="",t.style.display="none"},f=function(t){if(t&&!t.length)return l(t);for(var e=0;e<t.length;++e)l(t[e])},p=function(t,e){for(var r=e.parentNode;null!==r;){if(r===t)return!0;r=r.parentNode}return!1},d=function(t){t.style.left="-9999px",t.style.display="block";var e,r=t.clientHeight;return e="undefined"!=typeof getComputedStyle?parseInt(getComputedStyle(t).getPropertyValue("padding-top"),10):parseInt(t.currentStyle.padding),t.style.left="",t.style.display="none","-"+parseInt((r+e)/2)+"px"},m=function(t,e){if(+t.style.opacity<1){e=e||16,t.style.opacity=0,t.style.display="block";var r=+new Date,n=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){t.style.opacity=+t.style.opacity+(new Date-r)/100,r=+new Date,+t.style.opacity<1&&setTimeout(n,e)});n()}t.style.display="block"},g=function(t,e){e=e||16,t.style.opacity=1;var r=+new Date,n=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){t.style.opacity=+t.style.opacity-(new Date-r)/100,r=+new Date,+t.style.opacity>0?setTimeout(n,e):t.style.display="none"});n()},v=function(t){if("function"==typeof MouseEvent){var e=new MouseEvent("click",{view:r,bubbles:!1,cancelable:!0});t.dispatchEvent(e)}else if(n.createEvent){var i=n.createEvent("MouseEvents");i.initEvent("click",!1,!1),t.dispatchEvent(i)}else n.createEventObject?t.fireEvent("onclick"):"function"==typeof t.onclick&&t.onclick()},y=function(t){"function"==typeof t.stopPropagation?(t.stopPropagation(),t.preventDefault()):r.event&&r.event.hasOwnProperty("cancelBubble")&&(r.event.cancelBubble=!0)};i.hasClass=o,i.addClass=a,i.removeClass=s,i.escapeHtml=h,i._show=c,i.show=u,i._hide=l,i.hide=f,i.isDescendant=p,i.getTopMargin=d,i.fadeIn=m,i.fadeOut=g,i.fireClick=v,i.stopEventPropagation=y},{}],5:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var o=t("./handle-dom"),a=t("./handle-swal-dom"),s=function(t,e,n){var s=t||r.event,h=s.keyCode||s.which,c=n.querySelector("button.confirm"),u=n.querySelector("button.cancel"),l=n.querySelectorAll("button[tabindex]");if(-1!==[9,13,32,27].indexOf(h)){for(var f=s.target||s.srcElement,p=-1,d=0;d<l.length;d++)if(f===l[d]){p=d;break}9===h?(f=-1===p?c:p===l.length-1?l[0]:l[p+1],o.stopEventPropagation(s),f.focus(),e.confirmButtonColor&&a.setFocusStyle(f,e.confirmButtonColor)):13===h?("INPUT"===f.tagName&&(f=c,c.focus()),f=-1===p?c:i):27===h&&e.allowEscapeKey===!0?(f=u,o.fireClick(f,s)):f=i}};n["default"]=s,e.exports=n["default"]},{"./handle-dom":4,"./handle-swal-dom":6}],6:[function(t,e,i){var o=function(t){return t&&t.__esModule?t:{"default":t}};Object.defineProperty(i,"__esModule",{value:!0});var a=t("./utils"),s=t("./handle-dom"),h=t("./default-params"),c=o(h),u=t("./injected-html"),l=o(u),f=".sweet-alert",p=".sweet-overlay",d=function(){var t=n.createElement("div");for(t.innerHTML=l["default"];t.firstChild;)n.body.appendChild(t.firstChild)},m=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=n.querySelector(f);return t||(d(),t=m()),t}),g=function(){var t=m();return t?t.querySelector("input"):void 0},v=function(){return n.querySelector(p)},y=function(t,e){var r=a.hexToRgb(e);t.style.boxShadow="0 0 2px rgba("+r+", 0.8), inset 0 0 0 1px rgba(0, 0, 0, 0.05)"},b=function(t){var e=m();s.fadeIn(v(),10),s.show(e),s.addClass(e,"showSweetAlert"),s.removeClass(e,"hideSweetAlert"),r.previousActiveElement=n.activeElement;var i=e.querySelector("button.confirm");i.focus(),setTimeout(function(){s.addClass(e,"visible")},500);var o=e.getAttribute("data-timer");if("null"!==o&&""!==o){var a=t;e.timeout=setTimeout(function(){var t=(a||null)&&"true"===e.getAttribute("data-has-done-function");t?a(null):sweetAlert.close()},o)}},x=function(){var t=m(),e=g();s.removeClass(t,"show-input"),e.value=c["default"].inputValue,e.setAttribute("type",c["default"].inputType),e.setAttribute("placeholder",c["default"].inputPlaceholder),w()},w=function(t){if(t&&13===t.keyCode)return!1;var e=m(),r=e.querySelector(".sa-input-error");s.removeClass(r,"show");var n=e.querySelector(".sa-error-container");s.removeClass(n,"show")},M=function(){var t=m();t.style.marginTop=s.getTopMargin(m())};i.sweetAlertInitialize=d,i.getModal=m,i.getOverlay=v,i.getInput=g,i.setFocusStyle=y,i.openModal=b,i.resetInput=x,i.resetInputError=w,i.fixVerticalPosition=M},{"./default-params":2,"./handle-dom":4,"./injected-html":7,"./utils":9}],7:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n='<div class="sweet-overlay" tabIndex="-1"></div><div class="sweet-alert"><div class="sa-icon sa-error">\n      <span class="sa-x-mark">\n        <span class="sa-line sa-left"></span>\n        <span class="sa-line sa-right"></span>\n      </span>\n    </div><div class="sa-icon sa-warning">\n      <span class="sa-body"></span>\n      <span class="sa-dot"></span>\n    </div><div class="sa-icon sa-info"></div><div class="sa-icon sa-success">\n      <span class="sa-line sa-tip"></span>\n      <span class="sa-line sa-long"></span>\n\n      <div class="sa-placeholder"></div>\n      <div class="sa-fix"></div>\n    </div><div class="sa-icon sa-custom"></div><h2>Title</h2>\n    <p>Text</p>\n    <fieldset>\n      <input type="text" tabIndex="3" />\n      <div class="sa-input-error"></div>\n    </fieldset><div class="sa-error-container">\n      <div class="icon">!</div>\n      <p>Not valid!</p>\n    </div><div class="sa-button-container">\n      <button class="cancel" tabIndex="2">Cancel</button>\n      <div class="sa-confirm-button-container">\n        <button class="confirm" tabIndex="1">OK</button><div class="la-ball-fall">\n          <div></div>\n          <div></div>\n          <div></div>\n        </div>\n      </div>\n    </div></div>';r["default"]=n,e.exports=r["default"]},{}],8:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n=t("./utils"),o=t("./handle-swal-dom"),a=t("./handle-dom"),s=["error","warning","info","success","input","prompt"],h=function(t){var e=o.getModal(),r=e.querySelector("h2"),h=e.querySelector("p"),c=e.querySelector("button.cancel"),u=e.querySelector("button.confirm");if(r.innerHTML=t.html?t.title:a.escapeHtml(t.title).split("\n").join("<br>"),h.innerHTML=t.html?t.text:a.escapeHtml(t.text||"").split("\n").join("<br>"),t.text&&a.show(h),t.customClass)a.addClass(e,t.customClass),e.setAttribute("data-custom-class",t.customClass);else{var l=e.getAttribute("data-custom-class");a.removeClass(e,l),e.setAttribute("data-custom-class","")}if(a.hide(e.querySelectorAll(".sa-icon")),t.type&&!n.isIE8()){var f=function(){for(var r=!1,n=0;n<s.length;n++)if(t.type===s[n]){r=!0;break}if(!r)return logStr("Unknown alert type: "+t.type),{v:!1};var h=["success","error","warning","info"],c=i;-1!==h.indexOf(t.type)&&(c=e.querySelector(".sa-icon.sa-"+t.type),a.show(c));var u=o.getInput();switch(t.type){case"success":a.addClass(c,"animate"),a.addClass(c.querySelector(".sa-tip"),"animateSuccessTip"),a.addClass(c.querySelector(".sa-long"),"animateSuccessLong");break;case"error":a.addClass(c,"animateErrorIcon"),a.addClass(c.querySelector(".sa-x-mark"),"animateXMark");break;case"warning":a.addClass(c,"pulseWarning"),a.addClass(c.querySelector(".sa-body"),"pulseWarningIns"),a.addClass(c.querySelector(".sa-dot"),"pulseWarningIns");break;case"input":case"prompt":u.setAttribute("type",t.inputType),u.value=t.inputValue,u.setAttribute("placeholder",t.inputPlaceholder),a.addClass(e,"show-input"),setTimeout(function(){u.focus(),u.addEventListener("keyup",swal.resetInputError)},400)}}();if("object"==typeof f)return f.v}if(t.imageUrl){var p=e.querySelector(".sa-icon.sa-custom");p.style.backgroundImage="url("+t.imageUrl+")",a.show(p);var d=80,m=80;if(t.imageSize){var g=t.imageSize.toString().split("x"),v=g[0],y=g[1];v&&y?(d=v,m=y):logStr("Parameter imageSize expects value with format WIDTHxHEIGHT, got "+t.imageSize)}p.setAttribute("style",p.getAttribute("style")+"width:"+d+"px; height:"+m+"px")}e.setAttribute("data-has-cancel-button",t.showCancelButton),t.showCancelButton?c.style.display="inline-block":a.hide(c),e.setAttribute("data-has-confirm-button",t.showConfirmButton),t.showConfirmButton?u.style.display="inline-block":a.hide(u),t.cancelButtonText&&(c.innerHTML=a.escapeHtml(t.cancelButtonText)),
t.confirmButtonText&&(u.innerHTML=a.escapeHtml(t.confirmButtonText)),t.confirmButtonColor&&(u.style.backgroundColor=t.confirmButtonColor,u.style.borderLeftColor=t.confirmLoadingButtonColor,u.style.borderRightColor=t.confirmLoadingButtonColor,o.setFocusStyle(u,t.confirmButtonColor)),e.setAttribute("data-allow-outside-click",t.allowOutsideClick);var b=t.doneFunction?!0:!1;e.setAttribute("data-has-done-function",b),t.animation?"string"==typeof t.animation?e.setAttribute("data-animation",t.animation):e.setAttribute("data-animation","pop"):e.setAttribute("data-animation","none"),e.setAttribute("data-timer",t.timer)};r["default"]=h,e.exports=r["default"]},{"./handle-dom":4,"./handle-swal-dom":6,"./utils":9}],9:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},o=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?parseInt(e[1],16)+", "+parseInt(e[2],16)+", "+parseInt(e[3],16):null},a=function(){return r.attachEvent&&!r.addEventListener},s=function(t){r.console&&r.console.log("SweetAlert: "+t)},h=function(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var r,n,i="#";for(n=0;3>n;n++)r=parseInt(t.substr(2*n,2),16),r=Math.round(Math.min(Math.max(0,r+r*e),255)).toString(16),i+=("00"+r).substr(r.length);return i};n.extend=i,n.hexToRgb=o,n.isIE8=a,n.logStr=s,n.colorLuminance=h},{}]},{},[1]),"function"==typeof define&&define.amd?define(function(){return sweetAlert}):"undefined"!=typeof e&&e.exports&&(e.exports=sweetAlert)}(window,document)},{}],13:[function(t,e,r){e.exports=function(t){function e(e,n){function i(){return 2*Math.PI/60/60*g.autoRotateSpeed}function o(){return Math.pow(.95,g.zoomSpeed)}function a(t){if(g.enabled!==!1){if(t.preventDefault(),t.button===g.mouseButtons.ORBIT){if(g.noRotate===!0)return;U=D.ROTATE,y.set(t.clientX,t.clientY)}else if(t.button===g.mouseButtons.ZOOM){if(g.noZoom===!0)return;U=D.DOLLY,T.set(t.clientX,t.clientY)}else if(t.button===g.mouseButtons.PAN){if(g.noPan===!0)return;U=D.PAN,w.set(t.clientX,t.clientY)}U!==D.NONE&&(document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",h,!1),g.dispatchEvent(V))}}function s(t){if(g.enabled!==!1){t.preventDefault();var e=g.domElement===document?g.domElement.body:g.domElement;if(U===D.ROTATE){if(g.noRotate===!0)return;b.set(t.clientX,t.clientY),x.subVectors(b,y),g.rotateLeft(2*Math.PI*x.x/e.clientWidth*g.rotateSpeed),g.rotateUp(2*Math.PI*x.y/e.clientHeight*g.rotateSpeed),y.copy(b)}else if(U===D.DOLLY){if(g.noZoom===!0)return;C.set(t.clientX,t.clientY),A.subVectors(C,T),A.y>0?g.dollyIn():A.y<0&&g.dollyOut(),T.copy(C)}else if(U===D.PAN){if(g.noPan===!0)return;M.set(t.clientX,t.clientY),S.subVectors(M,w),g.pan(S.x,S.y),w.copy(M)}U!==D.NONE&&g.update()}}function h(){g.enabled!==!1&&(document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",h,!1),g.dispatchEvent(G),U=D.NONE)}function c(t){if(g.enabled!==!1&&g.noZoom!==!0&&U===D.NONE){t.preventDefault(),t.stopPropagation();var e=0;void 0!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),e>0?g.dollyOut():0>e&&g.dollyIn(),g.update(),g.dispatchEvent(V),g.dispatchEvent(G)}}function u(t){if(g.enabled!==!1&&g.noKeys!==!0&&g.noPan!==!0)switch(t.keyCode){case g.keys.UP:g.pan(0,g.keyPanSpeed),g.update();break;case g.keys.BOTTOM:g.pan(0,-g.keyPanSpeed),g.update();break;case g.keys.LEFT:g.pan(g.keyPanSpeed,0),g.update();break;case g.keys.RIGHT:g.pan(-g.keyPanSpeed,0),g.update()}}function l(t){if(g.enabled!==!1){switch(t.touches.length){case 1:if(g.noRotate===!0)return;U=D.TOUCH_ROTATE,y.set(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(g.noZoom===!0)return;U=D.TOUCH_DOLLY;var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);T.set(0,n);break;case 3:if(g.noPan===!0)return;U=D.TOUCH_PAN,w.set(t.touches[0].pageX,t.touches[0].pageY);break;default:U=D.NONE}U!==D.NONE&&g.dispatchEvent(V)}}function f(t){if(g.enabled!==!1){t.preventDefault(),t.stopPropagation();var e=g.domElement===document?g.domElement.body:g.domElement;switch(t.touches.length){case 1:if(g.noRotate===!0)return;if(U!==D.TOUCH_ROTATE)return;b.set(t.touches[0].pageX,t.touches[0].pageY),x.subVectors(b,y),g.rotateLeft(2*Math.PI*x.x/e.clientWidth*g.rotateSpeed),g.rotateUp(2*Math.PI*x.y/e.clientHeight*g.rotateSpeed),y.copy(b),g.update();break;case 2:if(g.noZoom===!0)return;if(U!==D.TOUCH_DOLLY)return;var r=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(r*r+n*n);C.set(0,i),A.subVectors(C,T),A.y>0?g.dollyOut():A.y<0&&g.dollyIn(),T.copy(C),g.update();break;case 3:if(g.noPan===!0)return;if(U!==D.TOUCH_PAN)return;M.set(t.touches[0].pageX,t.touches[0].pageY),S.subVectors(M,w),g.pan(S.x,S.y),w.copy(M),g.update();break;default:U=D.NONE}}}function p(){g.enabled!==!1&&(g.dispatchEvent(G),U=D.NONE)}this.object=e,this.domElement=void 0!==n?n:document,this.enabled=!0,this.target=new t.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:r.LEFT,ZOOM:r.MIDDLE,PAN:r.RIGHT};var d,m,g=this,v=1e-6,y=new t.Vector2,b=new t.Vector2,x=new t.Vector2,w=new t.Vector2,M=new t.Vector2,S=new t.Vector2,_=new t.Vector3,E=new t.Vector3,T=new t.Vector2,C=new t.Vector2,A=new t.Vector2,L=0,P=0,F=1,R=new t.Vector3,k=new t.Vector3,O=new t.Quaternion,D={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},U=D.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var B=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),I=B.clone().inverse(),N={type:"change"},V={type:"start"},G={type:"end"};this.rotateLeft=function(t){void 0===t&&(t=i()),P-=t},this.rotateUp=function(t){void 0===t&&(t=i()),L-=t},this.panLeft=function(t){var e=this.object.matrix.elements;_.set(e[0],e[1],e[2]),_.multiplyScalar(-t),R.add(_)},this.panUp=function(t){var e=this.object.matrix.elements;_.set(e[4],e[5],e[6]),_.multiplyScalar(t),R.add(_)},this.pan=function(e,r){var n=g.domElement===document?g.domElement.body:g.domElement;if(g.object instanceof t.PerspectiveCamera){var i=g.object.position,o=i.clone().sub(g.target),a=o.length();a*=Math.tan(g.object.fov/2*Math.PI/180),g.panLeft(2*e*a/n.clientHeight),g.panUp(2*r*a/n.clientHeight)}else g.object instanceof t.OrthographicCamera?(g.panLeft(e*(g.object.right-g.object.left)/n.clientWidth),g.panUp(r*(g.object.top-g.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=o()),g.object instanceof t.PerspectiveCamera?F/=e:g.object instanceof t.OrthographicCamera?(g.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),g.object.updateProjectionMatrix(),g.dispatchEvent(N)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){void 0===e&&(e=o()),g.object instanceof t.PerspectiveCamera?F*=e:g.object instanceof t.OrthographicCamera?(g.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),g.object.updateProjectionMatrix(),g.dispatchEvent(N)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var t=this.object.position;E.copy(t).sub(this.target),E.applyQuaternion(B),d=Math.atan2(E.x,E.z),m=Math.atan2(Math.sqrt(E.x*E.x+E.z*E.z),E.y),this.autoRotate&&U===D.NONE&&this.rotateLeft(i()),d+=P,m+=L,d=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,d)),m=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,m)),m=Math.max(v,Math.min(Math.PI-v,m));var e=E.length()*F;e=Math.max(this.minDistance,Math.min(this.maxDistance,e)),this.target.add(R),E.x=e*Math.sin(m)*Math.sin(d),E.y=e*Math.cos(m),E.z=e*Math.sin(m)*Math.cos(d),E.applyQuaternion(I),t.copy(this.target).add(E),this.object.lookAt(this.target),P=0,L=0,F=1,R.set(0,0,0),(k.distanceToSquared(this.object.position)>v||8*(1-O.dot(this.object.quaternion))>v)&&(this.dispatchEvent(N),k.copy(this.object.position),O.copy(this.object.quaternion))},this.reset=function(){U=D.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(N),this.update()},this.getPolarAngle=function(){return m},this.getAzimuthalAngle=function(){return d},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",p,!1),this.domElement.addEventListener("touchmove",f,!1),window.addEventListener("keydown",u,!1),this.update()}var r=t.MOUSE;return r||(r={LEFT:0,MIDDLE:1,RIGHT:2}),e.prototype=Object.create(t.EventDispatcher.prototype),e.prototype.constructor=e,e}},{}],14:[function(t,e,r){var n={REVISION:"72"};"function"==typeof define&&define.amd?define("three",n):"undefined"!=typeof r&&"undefined"!=typeof e&&(e.exports=n),(void 0===self.requestAnimationFrame||void 0===self.cancelAnimationFrame)&&!function(){for(var t=0,e=["ms","moz","webkit","o"],r=0;r<e.length&&!self.requestAnimationFrame;++r)self.requestAnimationFrame=self[e[r]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[e[r]+"CancelAnimationFrame"]||self[e[r]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(e){var r=Date.now(),n=Math.max(0,16-(r-t)),i=self.setTimeout(function(){e(r+n)},n);return t=r+n,i}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(t){self.clearTimeout(t)})}(),void 0===Math.sign&&(Math.sign=function(t){return 0>t?-1:t>0?1:+t}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),n.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},n.CullFaceNone=0,n.CullFaceBack=1,n.CullFaceFront=2,n.CullFaceFrontBack=3,n.FrontFaceDirectionCW=0,n.FrontFaceDirectionCCW=1,n.BasicShadowMap=0,n.PCFShadowMap=1,n.PCFSoftShadowMap=2,n.FrontSide=0,n.BackSide=1,n.DoubleSide=2,n.FlatShading=1,n.SmoothShading=2,n.NoColors=0,n.FaceColors=1,n.VertexColors=2,n.NoBlending=0,n.NormalBlending=1,n.AdditiveBlending=2,n.SubtractiveBlending=3,n.MultiplyBlending=4,n.CustomBlending=5,n.AddEquation=100,n.SubtractEquation=101,n.ReverseSubtractEquation=102,n.MinEquation=103,n.MaxEquation=104,n.ZeroFactor=200,n.OneFactor=201,n.SrcColorFactor=202,n.OneMinusSrcColorFactor=203,n.SrcAlphaFactor=204,n.OneMinusSrcAlphaFactor=205,n.DstAlphaFactor=206,n.OneMinusDstAlphaFactor=207,n.DstColorFactor=208,n.OneMinusDstColorFactor=209,n.SrcAlphaSaturateFactor=210,n.NeverDepth=0,n.AlwaysDepth=1,n.LessDepth=2,n.LessEqualDepth=3,n.EqualDepth=4,n.GreaterEqualDepth=5,n.GreaterDepth=6,n.NotEqualDepth=7,n.MultiplyOperation=0,n.MixOperation=1,n.AddOperation=2,n.UVMapping=300,n.CubeReflectionMapping=301,n.CubeRefractionMapping=302,n.EquirectangularReflectionMapping=303,n.EquirectangularRefractionMapping=304,n.SphericalReflectionMapping=305,n.RepeatWrapping=1e3,n.ClampToEdgeWrapping=1001,n.MirroredRepeatWrapping=1002,n.NearestFilter=1003,n.NearestMipMapNearestFilter=1004,n.NearestMipMapLinearFilter=1005,n.LinearFilter=1006,n.LinearMipMapNearestFilter=1007,n.LinearMipMapLinearFilter=1008,n.UnsignedByteType=1009,n.ByteType=1010,n.ShortType=1011,n.UnsignedShortType=1012,n.IntType=1013,n.UnsignedIntType=1014,n.FloatType=1015,n.HalfFloatType=1025,n.UnsignedShort4444Type=1016,n.UnsignedShort5551Type=1017,n.UnsignedShort565Type=1018,n.AlphaFormat=1019,n.RGBFormat=1020,n.RGBAFormat=1021,n.LuminanceFormat=1022,n.LuminanceAlphaFormat=1023,n.RGBEFormat=n.RGBAFormat,n.RGB_S3TC_DXT1_Format=2001,n.RGBA_S3TC_DXT1_Format=2002,n.RGBA_S3TC_DXT3_Format=2003,n.RGBA_S3TC_DXT5_Format=2004,n.RGB_PVRTC_4BPPV1_Format=2100,n.RGB_PVRTC_2BPPV1_Format=2101,n.RGBA_PVRTC_4BPPV1_Format=2102,n.RGBA_PVRTC_2BPPV1_Format=2103,n.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(t,e){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},n.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},n.Color=function(t){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(t)},n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,set:function(t){return t instanceof n.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?t+6*(e-t)*r:.5>r?e:2/3>r?t+6*(e-t)*(2/3-r):t}return function(e,r,i){if(e=n.Math.euclideanModulo(e,1),r=n.Math.clamp(r,0,1),i=n.Math.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{var o=.5>=i?i*(1+r):i+r-i*r,a=2*i-o;this.r=t(a,o,e+1/3),this.g=t(a,o,e),this.b=t(a,o,e-1/3)}return this}}(),setStyle:function(t){var e,r=function(e){var r=parseFloat(e);return 1>r&&console.warn("THREE.Color: Alpha component of color "+t+" will be ignored."),r};if(e=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,o=e[1],a=e[2];switch(o){case"rgb":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,this;break;case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,r(i[4]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,r(i[4]),this;break;case"hsl":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(a)){var s=parseFloat(i[1]),h=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return this.setHSL(s,h,c)}break;case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(a)){var s=parseFloat(i[1]),h=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return r(i[4]),this.setHSL(s,h,c)}}}else if(e=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=e[1],l=u.length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(t&&t.length>0){var u=n.ColorKeywords[t];void 0!==u?this.setHex(u):console.warn("THREE.Color: Unknown color "+t)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(){var t=this.r,e=this.g,r=this.b;return this.r=t*t,this.g=e*e,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,r,n=t||{h:0,s:0,l:0},i=this.r,o=this.g,a=this.b,s=Math.max(i,o,a),h=Math.min(i,o,a),c=(h+s)/2;if(h===s)e=0,r=0;else{var u=s-h;switch(r=.5>=c?u/(s+h):u/(2-s-h),s){case i:e=(o-a)/u+(a>o?6:0);break;case o:e=(a-i)/u+2;break;case a:e=(i-o)/u+4}e/=6}return n.h=e,n.s=r,n.l=c,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,r){var n=this.getHSL();return n.h+=t,n.s+=e,n.l+=r,this.setHSL(n.h,n.s,n.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t){return this.r=t[0],this.g=t[1],this.b=t[2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}},n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},n.Quaternion=function(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1},n.Quaternion.prototype={constructor:n.Quaternion,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(t instanceof n.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(t._x/2),i=Math.cos(t._y/2),o=Math.cos(t._z/2),a=Math.sin(t._x/2),s=Math.sin(t._y/2),h=Math.sin(t._z/2),c=t.order;return"XYZ"===c?(this._x=a*i*o+r*s*h,this._y=r*s*o-a*i*h,this._z=r*i*h+a*s*o,this._w=r*i*o-a*s*h):"YXZ"===c?(this._x=a*i*o+r*s*h,this._y=r*s*o-a*i*h,this._z=r*i*h-a*s*o,this._w=r*i*o+a*s*h):"ZXY"===c?(this._x=a*i*o-r*s*h,this._y=r*s*o+a*i*h,this._z=r*i*h+a*s*o,this._w=r*i*o-a*s*h):"ZYX"===c?(this._x=a*i*o-r*s*h,this._y=r*s*o+a*i*h,this._z=r*i*h-a*s*o,this._w=r*i*o+a*s*h):"YZX"===c?(this._x=a*i*o+r*s*h,this._y=r*s*o+a*i*h,this._z=r*i*h-a*s*o,this._w=r*i*o-a*s*h):"XZY"===c&&(this._x=a*i*o-r*s*h,this._y=r*s*o-a*i*h,this._z=r*i*h+a*s*o,this._w=r*i*o+a*s*h),e!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],h=r[9],c=r[2],u=r[6],l=r[10],f=n+s+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(u-h)*e,this._y=(o-c)*e,this._z=(a-i)*e):n>s&&n>l?(e=2*Math.sqrt(1+n-s-l),this._w=(u-h)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+c)/e):s>l?(e=2*Math.sqrt(1+s-n-l),this._w=(o-c)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(h+u)/e):(e=2*Math.sqrt(1+l-n-s),this._w=(a-i)/e,this._x=(o+c)/e,this._y=(h+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e,r=1e-6;return function(i,o){return void 0===t&&(t=new n.Vector3),e=i.dot(o)+1,r>e?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,o),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,a=e._x,s=e._y,h=e._z,c=e._w;return this._x=r*c+o*a+n*h-i*s,this._y=n*c+o*s+i*a-r*h,this._z=i*c+o*h+r*s-n*a,this._w=o*c-r*a-n*s-i*h,this.onChangeCallback(),this},multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*t._w+r*t._x+n*t._y+i*t._z;if(0>a?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var c=Math.sin((1-e)*s)/h,u=Math.sin(e*s)/h;return this._w=o*c+this._w*u,this._x=r*c+this._x*u,this._y=n*c+this._y*u,this._z=i*c+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},n.Quaternion.slerp=function(t,e,r,n){return r.copy(t).slerp(e,n)},n.Vector2=function(t,e){this.x=t||0,this.y=e||0},n.Vector2.prototype={constructor:n.Vector2,set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e}else this.x=0,this.y=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},clampScalar:function(){var t,e;return function(r,i){return void 0===t&&(t=new n.Vector2,e=new n.Vector2),t.set(r,r),e.set(i,i),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromAttribute:function(t,e,r){return void 0===r&&(r=0),e=e*t.itemSize+r,this.x=t.array[e],this.y=t.array[e+1],this}},n.Vector3=function(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0},n.Vector3.prototype={constructor:n.Vector3,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t;return function(e){return e instanceof n.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new n.Quaternion),this.applyQuaternion(t.setFromEuler(e)),this}}(),applyAxisAngle:function(){var t;return function(e,r){return void 0===t&&(t=new n.Quaternion),this.applyQuaternion(t.setFromAxisAngle(e,r)),this}}(),applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n+i[12],this.y=i[1]*e+i[5]*r+i[9]*n+i[13],this.z=i[2]*e+i[6]*r+i[10]*n+i[14],this},applyProjection:function(t){
var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=t.w,h=s*e+o*n-a*r,c=s*r+a*e-i*n,u=s*n+i*r-o*e,l=-i*e-o*r-a*n;return this.x=h*s+l*-i+c*-a-u*-o,this.y=c*s+l*-o+u*-i-h*-a,this.z=u*s+l*-a+h*-o-c*-i,this},project:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},clampScalar:function(){var t,e;return function(r,i){return void 0===t&&(t=new n.Vector3,e=new n.Vector3),t.set(r,r,r),e.set(i,i,i),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t),this},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var r=this.x,n=this.y,i=this.z;return this.x=n*t.z-i*t.y,this.y=i*t.x-r*t.z,this.z=r*t.y-n*t.x,this},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(){var t,e;return function(r){return void 0===t&&(t=new n.Vector3),t.copy(r).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t;return function(e){return void 0===t&&(t=new n.Vector3),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0===t&&(t=new n.Vector3),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/(this.length()*t.length());return Math.acos(n.Math.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},setEulerFromRotationMatrix:function(t,e){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(t,e){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),r=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),n=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){var r=4*t,n=e.elements;return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromAttribute:function(t,e,r){return void 0===r&&(r=0),e=e*t.itemSize+r,this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this}},n.Vector4=function(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1},n.Vector4.prototype={constructor:n.Vector4,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e,this.z*=e,this.w*=e}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return 1e-4>e?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=.01,a=.1,s=t.elements,h=s[0],c=s[4],u=s[8],l=s[1],f=s[5],p=s[9],d=s[2],m=s[6],g=s[10];if(Math.abs(c-l)<o&&Math.abs(u-d)<o&&Math.abs(p-m)<o){if(Math.abs(c+l)<a&&Math.abs(u+d)<a&&Math.abs(p+m)<a&&Math.abs(h+f+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var v=(h+1)/2,y=(f+1)/2,b=(g+1)/2,x=(c+l)/4,w=(u+d)/4,M=(p+m)/4;return v>y&&v>b?o>v?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(v),n=x/r,i=w/r):y>b?o>y?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(y),r=x/n,i=M/n):o>b?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(b),r=w/i,n=M/i),this.set(r,n,i,e),this}var S=Math.sqrt((m-p)*(m-p)+(u-d)*(u-d)+(l-c)*(l-c));return Math.abs(S)<.001&&(S=1),this.x=(m-p)/S,this.y=(u-d)/S,this.z=(l-c)/S,this.w=Math.acos((h+f+g-1)/2),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this.w>t.w&&(this.w=t.w),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this.w<t.w&&(this.w=t.w),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this.w<t.w?this.w=t.w:this.w>e.w&&(this.w=e.w),this},clampScalar:function(){var t,e;return function(r,i){return void 0===t&&(t=new n.Vector4,e=new n.Vector4),t.set(r,r,r,r),e.set(i,i,i,i),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t),this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromAttribute:function(t,e,r){return void 0===r&&(r=0),e=e*t.itemSize+r,this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this.w=t.array[e+3],this}},n.Euler=function(t,e,r,i){this._x=t||0,this._y=e||0,this._z=r||0,this._order=i||n.Euler.DefaultOrder},n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n.Euler.DefaultOrder="XYZ",n.Euler.prototype={constructor:n.Euler,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var i=n.Math.clamp,o=t.elements,a=o[0],s=o[4],h=o[8],c=o[1],u=o[5],l=o[9],f=o[2],p=o[6],d=o[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(p,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(h,d),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-f,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-f,d),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(c,a))):"ZYX"===e?(this._y=Math.asin(-i(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===e?(this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-f,a)):(this._x=0,this._y=Math.atan2(h,d))):"XZY"===e?(this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(p,u),this._y=Math.atan2(h,a)):(this._x=Math.atan2(-l,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(e,r,i){return void 0===t&&(t=new n.Matrix4),t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,i),this}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new n.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new n.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},n.Line3=function(t,e){this.start=void 0!==t?t:new n.Vector3,this.end=void 0!==e?e:new n.Vector3},n.Line3.prototype={constructor:n.Line3,set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},center:function(t){var e=t||new n.Vector3;return e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){var e=t||new n.Vector3;return e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var r=e||new n.Vector3;return this.delta(r).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new n.Vector3,e=new n.Vector3;return function(r,i){t.subVectors(r,this.start),e.subVectors(this.end,this.start);var o=e.dot(e),a=e.dot(t),s=a/o;return i&&(s=n.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(t,e,r){var i=this.closestPointToPointParameter(t,e),o=r||new n.Vector3;return this.delta(o).multiplyScalar(i).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}},n.Box2=function(t,e){this.min=void 0!==t?t:new n.Vector2(1/0,1/0),this.max=void 0!==e?e:new n.Vector2(-(1/0),-(1/0))},n.Box2.prototype={constructor:n.Box2,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;r>e;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new n.Vector2;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){var e=t||new n.Vector2;return e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var e=t||new n.Vector2;return e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y?!0:!1},getParameter:function(t,e){var r=e||new n.Vector2;return r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y?!1:!0},clampPoint:function(t,e){var r=e||new n.Vector2;return r.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new n.Vector2;return function(e){var r=t.copy(e).clamp(this.min,this.max);return r.sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},n.Box3=function(t,e){this.min=void 0!==t?t:new n.Vector3(1/0,1/0,1/0),this.max=void 0!==e?e:new n.Vector3(-(1/0),-(1/0),-(1/0))},n.Box3.prototype={constructor:n.Box3,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;r>e;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new n.Vector3;return function(e,r){var n=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(){var t=new n.Vector3;return function(e){var r=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){var i=e.geometry;if(void 0!==i)if(i instanceof n.Geometry)for(var o=i.vertices,a=0,s=o.length;s>a;a++)t.copy(o[a]),t.applyMatrix4(e.matrixWorld),r.expandByPoint(t);else if(i instanceof n.BufferGeometry&&void 0!==i.attributes.position)for(var h=i.attributes.position.array,a=0,s=h.length;s>a;a+=3)t.set(h[a],h[a+1],h[a+2]),t.applyMatrix4(e.matrixWorld),r.expandByPoint(t)}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){var e=t||new n.Vector3;return e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var e=t||new n.Vector3;return e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z?!0:!1},getParameter:function(t,e){var r=e||new n.Vector3;return r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?!1:!0},clampPoint:function(t,e){var r=e||new n.Vector3;return r.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new n.Vector3;return function(e){var r=t.copy(e).clamp(this.min,this.max);return r.sub(e).length()}}(),getBoundingSphere:function(){var t=new n.Vector3;return function(e){var r=e||new n.Sphere;return r.center=this.center(),r.radius=.5*this.size(t).length(),r}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},n.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},n.Matrix3.prototype={constructor:n.Matrix3,set:function(t,e,r,n,i,o,a,s,h){var c=this.elements;return c[0]=t,c[3]=e,c[6]=r,c[1]=n,c[4]=i,c[7]=o,c[2]=a,c[5]=s,c[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t;return function(e,r,i){void 0===t&&(t=new n.Vector3),void 0===r&&(r=0),void 0===i&&(i=e.length);for(var o=0,a=r;i>o;o+=3,a+=3)t.fromArray(e,a),t.applyMatrix3(this),t.toArray(e,a);return e}}(),applyToBuffer:function(){var t;return function(e,r,i){void 0===t&&(t=new n.Vector3),void 0===r&&(r=0),void 0===i&&(i=e.length/e.itemSize);for(var o=0,a=r;i>o;o++,a++)t.x=e.getX(a),t.y=e.getY(a),t.z=e.getZ(a),t.applyMatrix3(this),e.setXYZ(t.x,t.y,t.z);return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],c=t[8];return e*o*c-e*a*h-r*i*c+r*a*s+n*i*h-n*o*s},getInverse:function(t,e){var r=t.elements,n=this.elements;n[0]=r[10]*r[5]-r[6]*r[9],n[1]=-r[10]*r[1]+r[2]*r[9],n[2]=r[6]*r[1]-r[2]*r[5],n[3]=-r[10]*r[4]+r[6]*r[8],n[4]=r[10]*r[0]-r[2]*r[8],n[5]=-r[6]*r[0]+r[2]*r[4],n[6]=r[9]*r[4]-r[5]*r[8],n[7]=-r[9]*r[0]+r[1]*r[8],n[8]=r[5]*r[0]-r[1]*r[4];var i=r[0]*n[0]+r[1]*n[3]+r[2]*n[6];if(0===i){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},flattenToArrayOffset:function(t,e){var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t},getNormalMatrix:function(t){return this.getInverse(t).transpose(),this},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}},n.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},n.Matrix4.prototype={constructor:n.Matrix4,set:function(t,e,r,n,i,o,a,s,h,c,u,l,f,p,d,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=h,g[6]=c,g[10]=u,g[14]=l,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new n.Matrix4).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){var n=this.elements;return t.set(n[0],n[1],n[2]),e.set(n[4],n[5],n[6]),r.set(n[8],n[9],n[10]),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(e){void 0===t&&(t=new n.Vector3);var r=this.elements,i=e.elements,o=1/t.set(i[0],i[1],i[2]).length(),a=1/t.set(i[4],i[5],i[6]).length(),s=1/t.set(i[8],i[9],i[10]).length();return r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[8]=i[8]*s,r[9]=i[9]*s,r[10]=i[10]*s,this}}(),makeRotationFromEuler:function(t){t instanceof n.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,i=t.y,o=t.z,a=Math.cos(r),s=Math.sin(r),h=Math.cos(i),c=Math.sin(i),u=Math.cos(o),l=Math.sin(o);if("XYZ"===t.order){var f=a*u,p=a*l,d=s*u,m=s*l;e[0]=h*u,e[4]=-h*l,e[8]=c,e[1]=p+d*c,e[5]=f-m*c,e[9]=-s*h,e[2]=m-f*c,e[6]=d+p*c,e[10]=a*h}else if("YXZ"===t.order){var g=h*u,v=h*l,y=c*u,b=c*l;e[0]=g+b*s,e[4]=y*s-v,e[8]=a*c,e[1]=a*l,e[5]=a*u,e[9]=-s,e[2]=v*s-y,e[6]=b+g*s,e[10]=a*h}else if("ZXY"===t.order){var g=h*u,v=h*l,y=c*u,b=c*l;e[0]=g-b*s,e[4]=-a*l,e[8]=y+v*s,e[1]=v+y*s,e[5]=a*u,e[9]=b-g*s,e[2]=-a*c,e[6]=s,e[10]=a*h}else if("ZYX"===t.order){var f=a*u,p=a*l,d=s*u,m=s*l;e[0]=h*u,e[4]=d*c-p,e[8]=f*c+m,e[1]=h*l,e[5]=m*c+f,e[9]=p*c-d,e[2]=-c,e[6]=s*h,e[10]=a*h}else if("YZX"===t.order){var x=a*h,w=a*c,M=s*h,S=s*c;e[0]=h*u,e[4]=S-x*l,e[8]=M*l+w,e[1]=l,e[5]=a*u,e[9]=-s*u,e[2]=-c*u,e[6]=w*l+M,e[10]=x-S*l}else if("XZY"===t.order){var x=a*h,w=a*c,M=s*h,S=s*c;e[0]=h*u,e[4]=-l,e[8]=c*u,e[1]=x*l+S,e[5]=a*u,e[9]=w*l-M,e[2]=M*l-w,e[6]=s*u,e[10]=S*l+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},makeRotationFromQuaternion:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z,o=t.w,a=r+r,s=n+n,h=i+i,c=r*a,u=r*s,l=r*h,f=n*s,p=n*h,d=i*h,m=o*a,g=o*s,v=o*h;return e[0]=1-(f+d),e[4]=u-v,e[8]=l+g,e[1]=u+v,e[5]=1-(c+d),e[9]=p-m,e[2]=l-g,e[6]=p+m,e[10]=1-(c+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t,e,r;return function(i,o,a){void 0===t&&(t=new n.Vector3),void 0===e&&(e=new n.Vector3),void 0===r&&(r=new n.Vector3);var s=this.elements;return r.subVectors(i,o).normalize(),0===r.length()&&(r.z=1),t.crossVectors(a,r).normalize(),0===t.length()&&(r.x+=1e-4,t.crossVectors(a,r).normalize()),e.crossVectors(r,t),s[0]=t.x,s[4]=e.x,s[8]=r.x,s[1]=t.y,s[5]=e.y,s[9]=r.y,s[2]=t.z,s[6]=e.z,s[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[4],s=r[8],h=r[12],c=r[1],u=r[5],l=r[9],f=r[13],p=r[2],d=r[6],m=r[10],g=r[14],v=r[3],y=r[7],b=r[11],x=r[15],w=n[0],M=n[4],S=n[8],_=n[12],E=n[1],T=n[5],C=n[9],A=n[13],L=n[2],P=n[6],F=n[10],R=n[14],k=n[3],O=n[7],D=n[11],U=n[15];return i[0]=o*w+a*E+s*L+h*k,i[4]=o*M+a*T+s*P+h*O,i[8]=o*S+a*C+s*F+h*D,i[12]=o*_+a*A+s*R+h*U,i[1]=c*w+u*E+l*L+f*k,i[5]=c*M+u*T+l*P+f*O,i[9]=c*S+u*C+l*F+f*D,i[13]=c*_+u*A+l*R+f*U,i[2]=p*w+d*E+m*L+g*k,i[6]=p*M+d*T+m*P+g*O,i[10]=p*S+d*C+m*F+g*D,i[14]=p*_+d*A+m*R+g*U,i[3]=v*w+y*E+b*L+x*k,i[7]=v*M+y*T+b*P+x*O,i[11]=v*S+y*C+b*F+x*D,i[15]=v*_+y*A+b*R+x*U,this},multiplyToArray:function(t,e,r){var n=this.elements;return this.multiplyMatrices(t,e),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),t.applyProjection(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t;return function(e,r,i){void 0===t&&(t=new n.Vector3),void 0===r&&(r=0),void 0===i&&(i=e.length);for(var o=0,a=r;i>o;o+=3,a+=3)t.fromArray(e,a),t.applyMatrix4(this),t.toArray(e,a);return e}}(),applyToBuffer:function(){var t;return function(e,r,i){void 0===t&&(t=new n.Vector3),void 0===r&&(r=0),void 0===i&&(i=e.length/e.itemSize);for(var o=0,a=r;i>o;o++,a++)t.x=e.getX(a),t.y=e.getY(a),t.z=e.getZ(a),t.applyMatrix4(this),e.setXYZ(t.x,t.y,t.z);return e}}(),rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],h=t[13],c=t[2],u=t[6],l=t[10],f=t[14],p=t[3],d=t[7],m=t[11],g=t[15];return p*(+i*s*u-n*h*u-i*a*l+r*h*l+n*a*f-r*s*f)+d*(+e*s*f-e*h*l+i*o*l-n*o*f+n*h*c-i*s*c)+m*(+e*h*u-e*a*f-i*o*u+r*o*f+i*a*c-r*h*c)+g*(-n*a*c-e*s*u+e*a*l+n*o*u-r*o*l+r*s*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t},getPosition:function(){var t;return function(){void 0===t&&(t=new n.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14]);
}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],o=n[4],a=n[8],s=n[12],h=n[1],c=n[5],u=n[9],l=n[13],f=n[2],p=n[6],d=n[10],m=n[14],g=n[3],v=n[7],y=n[11],b=n[15];r[0]=u*m*v-l*d*v+l*p*y-c*m*y-u*p*b+c*d*b,r[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*b-o*d*b,r[8]=a*l*v-s*u*v+s*c*y-o*l*y-a*c*b+o*u*b,r[12]=s*u*p-a*l*p-s*c*d+o*l*d+a*c*m-o*u*m,r[1]=l*d*g-u*m*g-l*f*y+h*m*y+u*f*b-h*d*b,r[5]=a*m*g-s*d*g+s*f*y-i*m*y-a*f*b+i*d*b,r[9]=s*u*g-a*l*g-s*h*y+i*l*y+a*h*b-i*u*b,r[13]=a*l*f-s*u*f+s*h*d-i*l*d-a*h*m+i*u*m,r[2]=c*m*g-l*p*g+l*f*v-h*m*v-c*f*b+h*p*b,r[6]=s*p*g-o*m*g-s*f*v+i*m*v+o*f*b-i*p*b,r[10]=o*l*g-s*c*g+s*h*v-i*l*v-o*h*b+i*c*b,r[14]=s*c*f-o*l*f-s*h*p+i*l*p+o*h*m-i*c*m,r[3]=u*p*g-c*d*g-u*f*v+h*d*v+c*f*y-h*p*y,r[7]=o*d*g-a*p*g+a*f*v-i*d*v-o*f*y+i*p*y,r[11]=a*c*g-o*u*g-a*h*v+i*u*v+o*h*y-i*c*y,r[15]=o*u*f-a*c*f+a*h*p-i*u*p-o*h*d+i*c*d;var x=i*r[0]+h*r[4]+f*r[8]+g*r[12];if(0===x){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this},translate:function(t){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(t){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(t){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(t){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(t,e){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(r,n)))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,a=t.y,s=t.z,h=i*o,c=i*a;return this.set(h*o+r,h*a-n*s,h*s+n*a,0,h*a+n*s,c*a+r,c*s-n*o,0,h*s-n*a,c*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t,e;return function(r,i,o){void 0===t&&(t=new n.Vector3),void 0===e&&(e=new n.Matrix4);var a=this.elements,s=t.set(a[0],a[1],a[2]).length(),h=t.set(a[4],a[5],a[6]).length(),c=t.set(a[8],a[9],a[10]).length(),u=this.determinant();0>u&&(s=-s),r.x=a[12],r.y=a[13],r.z=a[14],e.elements.set(this.elements);var l=1/s,f=1/h,p=1/c;return e.elements[0]*=l,e.elements[1]*=l,e.elements[2]*=l,e.elements[4]*=f,e.elements[5]*=f,e.elements[6]*=f,e.elements[8]*=p,e.elements[9]*=p,e.elements[10]*=p,i.setFromRotationMatrix(e),o.x=s,o.y=h,o.z=c,this}}(),makeFrustum:function(t,e,r,n,i,o){var a=this.elements,s=2*i/(e-t),h=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),l=-(o+i)/(o-i),f=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=h,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,e,r,i){var o=r*Math.tan(n.Math.degToRad(.5*t)),a=-o,s=a*e,h=o*e;return this.makeFrustum(s,h,a,o,r,i)},makeOrthographic:function(t,e,r,n,i,o){var a=this.elements,s=e-t,h=r-n,c=o-i,u=(e+t)/s,l=(r+n)/h,f=(o+i)/c;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;16>n;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}},n.Ray=function(t,e){this.origin=void 0!==t?t:new n.Vector3,this.direction=void 0!==e?e:new n.Vector3},n.Ray.prototype={constructor:n.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){var r=e||new n.Vector3;return r.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new n.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var r=e||new n.Vector3;r.subVectors(t,this.origin);var i=r.dot(this.direction);return 0>i?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new n.Vector3;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Vector3;return function(n,i,o,a){t.copy(n).add(i).multiplyScalar(.5),e.copy(i).sub(n).normalize(),r.copy(this.origin).sub(t);var s,h,c,u,l=.5*n.distanceTo(i),f=-this.direction.dot(e),p=r.dot(this.direction),d=-r.dot(e),m=r.lengthSq(),g=Math.abs(1-f*f);if(g>0)if(s=f*d-p,h=f*p-d,u=l*g,s>=0)if(h>=-u)if(u>=h){var v=1/g;s*=v,h*=v,c=s*(s+f*h+2*p)+h*(f*s+h+2*d)+m}else h=l,s=Math.max(0,-(f*h+p)),c=-s*s+h*(h+2*d)+m;else h=-l,s=Math.max(0,-(f*h+p)),c=-s*s+h*(h+2*d)+m;else-u>=h?(s=Math.max(0,-(-f*l+p)),h=s>0?-l:Math.min(Math.max(-l,-d),l),c=-s*s+h*(h+2*d)+m):u>=h?(s=0,h=Math.min(Math.max(-l,-d),l),c=h*(h+2*d)+m):(s=Math.max(0,-(f*l+p)),h=s>0?l:Math.min(Math.max(-l,-d),l),c=-s*s+h*(h+2*d)+m);else h=f>0?-l:l,s=Math.max(0,-(f*h+p)),c=-s*s+h*(h+2*d)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(e).multiplyScalar(h).add(t),c}}(),isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},intersectSphere:function(){var t=new n.Vector3;return function(e,r){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),i=t.dot(t)-n*n,o=e.radius*e.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=n-a,h=n+a;return 0>s&&0>h?null:0>s?this.at(h,r):this.at(s,r)}}(),isIntersectionPlane:function(t){var e=t.distanceToPoint(this.origin);if(0===e)return!0;var r=t.normal.dot(this.direction);return 0>r*e?!0:!1},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},isIntersectionBox:function(){var t=new n.Vector3;return function(e){return null!==this.intersectBox(e,t)}}(),intersectBox:function(t,e){var r,n,i,o,a,s,h=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,l=this.origin;return h>=0?(r=(t.min.x-l.x)*h,n=(t.max.x-l.x)*h):(r=(t.max.x-l.x)*h,n=(t.min.x-l.x)*h),c>=0?(i=(t.min.y-l.y)*c,o=(t.max.y-l.y)*c):(i=(t.max.y-l.y)*c,o=(t.min.y-l.y)*c),r>o||i>n?null:((i>r||r!==r)&&(r=i),(n>o||n!==n)&&(n=o),u>=0?(a=(t.min.z-l.z)*u,s=(t.max.z-l.z)*u):(a=(t.max.z-l.z)*u,s=(t.min.z-l.z)*u),r>s||a>n?null:((a>r||r!==r)&&(r=a),(n>s||n!==n)&&(n=s),0>n?null:this.at(r>=0?r:n,e)))},intersectTriangle:function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Vector3,i=new n.Vector3;return function(n,o,a,s,h){e.subVectors(o,n),r.subVectors(a,n),i.crossVectors(e,r);var c,u=this.direction.dot(i);if(u>0){if(s)return null;c=1}else{if(!(0>u))return null;c=-1,u=-u}t.subVectors(this.origin,n);var l=c*this.direction.dot(r.crossVectors(t,r));if(0>l)return null;var f=c*this.direction.dot(e.cross(t));if(0>f)return null;if(l+f>u)return null;var p=-c*t.dot(i);return 0>p?null:this.at(p/u,h)}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},n.Sphere=function(t,e){this.center=void 0!==t?t:new n.Vector3,this.radius=void 0!==e?e:0},n.Sphere.prototype={constructor:n.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new n.Box3;return function(e,r){var n=this.center;void 0!==r?n.copy(r):t.setFromPoints(e).center(n);for(var i=0,o=0,a=e.length;a>o;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(t,e){var r=this.center.distanceToSquared(t),i=e||new n.Vector3;return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){var e=t||new n.Box3;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},n.Frustum=function(t,e,r,i,o,a){this.planes=[void 0!==t?t:new n.Plane,void 0!==e?e:new n.Plane,void 0!==r?r:new n.Plane,void 0!==i?i:new n.Plane,void 0!==o?o:new n.Plane,void 0!==a?a:new n.Plane]},n.Frustum.prototype={constructor:n.Frustum,set:function(t,e,r,n,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;6>r;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],h=r[5],c=r[6],u=r[7],l=r[8],f=r[9],p=r[10],d=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return e[0].setComponents(a-n,u-s,d-l,y-m).normalize(),e[1].setComponents(a+n,u+s,d+l,y+m).normalize(),e[2].setComponents(a+i,u+h,d+f,y+g).normalize(),e[3].setComponents(a-i,u-h,d-f,y-g).normalize(),e[4].setComponents(a-o,u-c,d-p,y-v).normalize(),e[5].setComponents(a+o,u+c,d+p,y+v).normalize(),this},intersectsObject:function(){var t=new n.Sphere;return function(e){var r=e.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),t.copy(r.boundingSphere),t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;6>i;i++){var o=e[i].distanceToPoint(r);if(n>o)return!1}return!0},intersectsBox:function(){var t=new n.Vector3,e=new n.Vector3;return function(r){for(var n=this.planes,i=0;6>i;i++){var o=n[i];t.x=o.normal.x>0?r.min.x:r.max.x,e.x=o.normal.x>0?r.max.x:r.min.x,t.y=o.normal.y>0?r.min.y:r.max.y,e.y=o.normal.y>0?r.max.y:r.min.y,t.z=o.normal.z>0?r.min.z:r.max.z,e.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(t),s=o.distanceToPoint(e);if(0>a&&0>s)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,r=0;6>r;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}},n.Plane=function(t,e){this.normal=void 0!==t?t:new n.Vector3(1,0,0),this.constant=void 0!==e?e:0},n.Plane.prototype={constructor:n.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new n.Vector3,e=new n.Vector3;return function(r,n,i){var o=t.subVectors(i,n).cross(e.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var r=this.distanceToPoint(t),i=e||new n.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return 0>e&&r>0||0>r&&e>0},intersectLine:function(){var t=new n.Vector3;return function(e,r){var i=r||new n.Vector3,o=e.delta(t),a=this.normal.dot(o);if(0===a)return 0===this.distanceToPoint(e.start)?i.copy(e.start):void 0;var s=-(e.start.dot(this.normal)+this.constant)/a;return 0>s||s>1?void 0:i.copy(o).multiplyScalar(s).add(e.start)}}(),coplanarPoint:function(t){var e=t||new n.Vector3;return e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Matrix3;return function(n,i){var o=i||r.getNormalMatrix(n),a=t.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(e);return s.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},n.Math={generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),n=0;return function(){for(var i=0;36>i;i++)8===i||13===i||18===i||23===i?r[i]="-":14===i?r[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,r[i]=e[19===i?3&t|8:t]);return r.join("")}}(),clamp:function(t,e,r){return e>t?e:t>r?r:t},clampBottom:function(t,e){return e>t?e:t},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},smoothstep:function(t,e,r){return e>=t?0:t>=r?1:(t=(t-e)/(r-e),t*t*(3-2*t))},smootherstep:function(t,e,r){return e>=t?0:t>=r?1:(t=(t-e)/(r-e),t*t*t*(t*(6*t-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}(),isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t}},n.Spline=function(t){function e(t,e,r,n,i,o,a){var s=.5*(r-t),h=.5*(n-e);return(2*(e-r)+s+h)*a+(-3*(e-r)-2*s-h)*o+s*i+e}this.points=t;var r,i,o,a,s,h,c,u,l,f=[],p={x:0,y:0,z:0};this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}},this.getPoint=function(t){return r=(this.points.length-1)*t,i=Math.floor(r),o=r-i,f[0]=0===i?i:i-1,f[1]=i,f[2]=i>this.points.length-2?this.points.length-1:i+1,f[3]=i>this.points.length-3?this.points.length-1:i+2,h=this.points[f[0]],c=this.points[f[1]],u=this.points[f[2]],l=this.points[f[3]],a=o*o,s=o*a,p.x=e(h.x,c.x,u.x,l.x,o,a,s),p.y=e(h.y,c.y,u.y,l.y,o,a,s),p.z=e(h.z,c.z,u.z,l.z,o,a,s),p},this.getControlPointsArray=function(){var t,e,r=this.points.length,n=[];for(t=0;r>t;t++)e=this.points[t],n[t]=[e.x,e.y,e.z];return n},this.getLength=function(t){var e,r,i,o,a=0,s=0,h=0,c=new n.Vector3,u=new n.Vector3,l=[],f=0;for(l[0]=0,t||(t=100),i=this.points.length*t,c.copy(this.points[0]),e=1;i>e;e++)r=e/i,o=this.getPoint(r),u.copy(o),f+=u.distanceTo(c),c.copy(o),a=(this.points.length-1)*r,s=Math.floor(a),s!==h&&(l[s]=f,h=s);return l[l.length]=f,{chunks:l,total:f}},this.reparametrizeByArcLength=function(t){var e,r,i,o,a,s,h,c,u=[],l=new n.Vector3,f=this.getLength();for(u.push(l.copy(this.points[0]).clone()),e=1;e<this.points.length;e++){for(s=f.chunks[e]-f.chunks[e-1],h=Math.ceil(t*s/f.total),o=(e-1)/(this.points.length-1),a=e/(this.points.length-1),r=1;h-1>r;r++)i=o+r*(1/h)*(a-o),c=this.getPoint(i),u.push(l.copy(c).clone());u.push(l.copy(this.points[e]).clone())}this.points=u}},n.Triangle=function(t,e,r){this.a=void 0!==t?t:new n.Vector3,this.b=void 0!==e?e:new n.Vector3,this.c=void 0!==r?r:new n.Vector3},n.Triangle.normal=function(){var t=new n.Vector3;return function(e,r,i,o){var a=o||new n.Vector3;a.subVectors(i,r),t.subVectors(e,r),a.cross(t);var s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),n.Triangle.barycoordFromPoint=function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Vector3;return function(i,o,a,s,h){t.subVectors(s,o),e.subVectors(a,o),r.subVectors(i,o);var c=t.dot(t),u=t.dot(e),l=t.dot(r),f=e.dot(e),p=e.dot(r),d=c*f-u*u,m=h||new n.Vector3;if(0===d)return m.set(-2,-1,-1);var g=1/d,v=(f*l-u*p)*g,y=(c*p-u*l)*g;return m.set(1-v-y,y,v)}}(),n.Triangle.containsPoint=function(){var t=new n.Vector3;return function(e,r,i,o){var a=n.Triangle.barycoordFromPoint(e,r,i,o,t);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),n.Triangle.prototype={constructor:n.Triangle,set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new n.Vector3,e=new n.Vector3;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){var e=t||new n.Vector3;return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return n.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){var e=t||new n.Plane;return e.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return n.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return n.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},n.Clock=function(t){this.autoStart=void 0!==t?t:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},n.Clock.prototype={constructor:n.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();t=.001*(e-this.oldTime),this.oldTime=e,this.elapsedTime+=t}return t}},n.EventDispatcher=function(){},n.EventDispatcher.prototype={constructor:n.EventDispatcher,apply:function(t){t.addEventListener=n.EventDispatcher.prototype.addEventListener,t.hasEventListener=n.EventDispatcher.prototype.hasEventListener,t.removeEventListener=n.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=n.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)?!0:!1},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners,n=r[t];if(void 0!==n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners,r=e[t.type];if(void 0!==r){t.target=this;for(var n=[],i=r.length,o=0;i>o;o++)n[o]=r[o];for(var o=0;i>o;o++)n[o].call(this,t)}}}},function(t){function e(t,e){return t.distance-e.distance}t.Raycaster=function(e,r,n,i){this.ray=new t.Ray(e,r),this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})};var r=function(t,e,n,i){if(t.visible!==!1&&(t.raycast(e,n),i===!0))for(var o=t.children,a=0,s=o.length;s>a;a++)r(o[a],e,n,!0)};t.Raycaster.prototype={constructor:t.Raycaster,linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(e,r){r instanceof t.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(r).sub(this.ray.origin).normalize()):r instanceof t.OrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,n){var i=[];return r(t,this,i,n),i.sort(e),i},intersectObjects:function(t,n){var i=[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var o=0,a=t.length;a>o;o++)r(t[o],this,i,n);return i.sort(e),i}}}(n),n.Object3D=function(){Object.defineProperty(this,"id",{value:n.Object3DIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.Object3D.DefaultUp.clone();var t=new n.Vector3,e=new n.Euler,r=new n.Quaternion,i=new n.Vector3(1,1,1),o=function(){r.setFromEuler(e,!1)},a=function(){e.setFromQuaternion(r,void 0,!1)};e.onChange(o),r.onChange(a),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:i},modelViewMatrix:{value:new n.Matrix4},normalMatrix:{value:new n.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.matrixAutoUpdate=n.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},n.Object3D.DefaultUp=new n.Vector3(0,1,0),n.Object3D.DefaultMatrixAutoUpdate=!0,n.Object3D.prototype={constructor:n.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(t){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=t},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(t){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(t){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new n.Quaternion;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new n.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new n.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new n.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new n.Vector3;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},translateX:function(){var t=new n.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new n.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new n.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new n.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new n.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t instanceof n.Object3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var r=this.children.indexOf(t);-1!==r&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;n>r;r++){var i=this.children[r],o=i.getObjectByProperty(t,e);if(void 0!==o)return o}return void 0},getWorldPosition:function(t){var e=t||new n.Vector3;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new n.Vector3,e=new n.Vector3;return function(r){var i=r||new n.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,i,e),i}}(),getWorldRotation:function(){var t=new n.Quaternion;return function(e){var r=e||new n.Euler;return this.getWorldQuaternion(t),r.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new n.Vector3,e=new n.Quaternion;return function(r){var i=r||new n.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,i),i}}(),getWorldDirection:function(){var t=new n.Quaternion;return function(e){var r=e||new n.Vector3;return this.getWorldQuaternion(t),r.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;n>r;r++)e[r].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,r=0,n=e.length;n>r;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||t===!0)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,r=this.children.length;r>e;e++)this.children[e].updateMatrixWorld(t)},toJSON:function(t){function e(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}var r=void 0===t,n={},i={object:n};if(r&&(t={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"}),n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),this.visible!==!0&&(n.visible=this.visible),n.matrix=this.matrix.toArray(),this.children.length>0){n.children=[];for(var o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(r){var a=e(t.geometries),s=e(t.materials),h=e(t.textures),c=e(t.images);a.length>0&&(i.geometries=a),s.length>0&&(i.materials=s),h.length>0&&(i.textures=h),c.length>0&&(i.images=c)}return i},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.rotationAutoUpdate=t.rotationAutoUpdate,this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}return this}},n.EventDispatcher.prototype.apply(n.Object3D.prototype),n.Object3DIdCount=0,n.Face3=function(t,e,r,i,o,a){this.a=t,this.b=e,this.c=r,this.normal=i instanceof n.Vector3?i:new n.Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=o instanceof n.Color?o:new n.Color,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=void 0!==a?a:0},n.Face3.prototype={constructor:n.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;r>e;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,r=t.vertexColors.length;r>e;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}},n.Face4=function(t,e,r,i,o,a,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new n.Face3(t,e,r,o,a,s)},n.BufferAttribute=function(t,e){this.uuid=n.Math.generateUUID(),this.array=t,this.itemSize=e,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},n.BufferAttribute.prototype={constructor:n.BufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(t){t===!0&&this.version++},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;i>n;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,i=0,o=t.length;o>i;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new n.Color),e[r++]=a.r,e[r++]=a.g,e[r++]=a.b}return this},copyIndicesArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;i>n;n++){var o=t[n];e[r++]=o.a,e[r++]=o.b,e[r++]=o.c}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,i=0,o=t.length;o>i;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new n.Vector2),e[r++]=a.x,e[r++]=a.y}
return this},copyVector3sArray:function(t){for(var e=this.array,r=0,i=0,o=t.length;o>i;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new n.Vector3),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,i=0,o=t.length;o>i;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new n.Vector4),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z,e[r++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},clone:function(){return(new this.constructor).copy(this)}},n.Int8Attribute=function(t,e){return new n.BufferAttribute(new Int8Array(t),e)},n.Uint8Attribute=function(t,e){return new n.BufferAttribute(new Uint8Array(t),e)},n.Uint8ClampedAttribute=function(t,e){return new n.BufferAttribute(new Uint8ClampedArray(t),e)},n.Int16Attribute=function(t,e){return new n.BufferAttribute(new Int16Array(t),e)},n.Uint16Attribute=function(t,e){return new n.BufferAttribute(new Uint16Array(t),e)},n.Int32Attribute=function(t,e){return new n.BufferAttribute(new Int32Array(t),e)},n.Uint32Attribute=function(t,e){return new n.BufferAttribute(new Uint32Array(t),e)},n.Float32Attribute=function(t,e){return new n.BufferAttribute(new Float32Array(t),e)},n.Float64Attribute=function(t,e){return new n.BufferAttribute(new Float64Array(t),e)},n.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new n.BufferAttribute(t,e).setDynamic(!0)},n.InstancedBufferAttribute=function(t,e,r){n.BufferAttribute.call(this,t,e),this.meshPerAttribute=r||1},n.InstancedBufferAttribute.prototype=Object.create(n.BufferAttribute.prototype),n.InstancedBufferAttribute.prototype.constructor=n.InstancedBufferAttribute,n.InstancedBufferAttribute.prototype.copy=function(t){return n.BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},n.InterleavedBuffer=function(t,e){this.uuid=n.Math.generateUUID(),this.array=t,this.stride=e,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},n.InterleavedBuffer.prototype={constructor:n.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(t){t===!0&&this.version++},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){this.array=new t.array.constructor(t.array),this.stride=t.stride,this.dynamic=t.dynamic},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;i>n;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)}},n.InstancedInterleavedBuffer=function(t,e,r){n.InterleavedBuffer.call(this,t,e),this.meshPerAttribute=r||1},n.InstancedInterleavedBuffer.prototype=Object.create(n.InterleavedBuffer.prototype),n.InstancedInterleavedBuffer.prototype.constructor=n.InstancedInterleavedBuffer,n.InstancedInterleavedBuffer.prototype.copy=function(t){return n.InterleavedBuffer.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},n.InterleavedBufferAttribute=function(t,e,r){this.uuid=n.Math.generateUUID(),this.data=t,this.itemSize=e,this.offset=r},n.InterleavedBufferAttribute.prototype={constructor:n.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}},n.Geometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},n.Geometry.prototype={constructor:n.Geometry,applyMatrix:function(t){for(var e=(new n.Matrix3).getNormalMatrix(t),r=0,i=this.vertices.length;i>r;r++){var o=this.vertices[r];o.applyMatrix4(t)}for(var r=0,i=this.faces.length;i>r;r++){var a=this.faces[r];a.normal.applyMatrix3(e).normalize();for(var s=0,h=a.vertexNormals.length;h>s;s++)a.vertexNormals[s].applyMatrix3(e).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},rotateX:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,r,i){return void 0===t&&(t=new n.Matrix4),t.makeTranslation(e,r,i),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,r,i){return void 0===t&&(t=new n.Matrix4),t.makeScale(e,r,i),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new n.Object3D),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,i=t.attributes,o=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,s=void 0!==i.color?i.color.array:void 0,h=void 0!==i.uv?i.uv.array:void 0,c=void 0!==i.uv2?i.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],l=[],f=[],p=0,d=0,m=0;p<o.length;p+=3,d+=2,m+=4)e.vertices.push(new n.Vector3(o[p],o[p+1],o[p+2])),void 0!==a&&u.push(new n.Vector3(a[p],a[p+1],a[p+2])),void 0!==s&&e.colors.push(new n.Color(s[p],s[p+1],s[p+2])),void 0!==h&&l.push(new n.Vector2(h[d],h[d+1])),void 0!==c&&f.push(new n.Vector2(c[d],c[d+1]));var g=function(t,r,i){var o=void 0!==a?[u[t].clone(),u[r].clone(),u[i].clone()]:[],p=void 0!==s?[e.colors[t].clone(),e.colors[r].clone(),e.colors[i].clone()]:[],d=new n.Face3(t,r,i,o,p);e.faces.push(d),void 0!==h&&e.faceVertexUvs[0].push([l[t].clone(),l[r].clone(),l[i].clone()]),void 0!==c&&e.faceVertexUvs[1].push([f[t].clone(),f[r].clone(),f[i].clone()])};if(void 0!==r){var v=t.groups;if(v.length>0)for(var p=0;p<v.length;p++)for(var y=v[p],b=y.start,x=y.count,d=b,w=b+x;w>d;d+=3)g(r[d],r[d+1],r[d+2]);else for(var p=0;p<r.length;p+=3)g(r[p],r[p+1],r[p+2])}else for(var p=0;p<o.length/3;p+=3)g(p,p+1,p+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,i=new n.Matrix4;return i.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var t=new n.Vector3,e=new n.Vector3,r=0,i=this.faces.length;i>r;r++){var o=this.faces[r],a=this.vertices[o.a],s=this.vertices[o.b],h=this.vertices[o.c];t.subVectors(h,s),e.subVectors(a,s),t.cross(e),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t){var e,r,i,o,a,s;for(s=new Array(this.vertices.length),e=0,r=this.vertices.length;r>e;e++)s[e]=new n.Vector3;if(t){var h,c,u,l=new n.Vector3,f=new n.Vector3;for(i=0,o=this.faces.length;o>i;i++)a=this.faces[i],h=this.vertices[a.a],c=this.vertices[a.b],u=this.vertices[a.c],l.subVectors(u,c),f.subVectors(h,c),l.cross(f),s[a.a].add(l),s[a.b].add(l),s[a.c].add(l)}else for(i=0,o=this.faces.length;o>i;i++)a=this.faces[i],s[a.a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(e=0,r=this.vertices.length;r>e;e++)s[e].normalize();for(i=0,o=this.faces.length;o>i;i++){a=this.faces[i];var p=a.vertexNormals;3===p.length?(p[0].copy(s[a.a]),p[1].copy(s[a.b]),p[2].copy(s[a.c])):(p[0]=s[a.a].clone(),p[1]=s[a.b].clone(),p[2]=s[a.c].clone())}},computeMorphNormals:function(){var t,e,r,i,o;for(r=0,i=this.faces.length;i>r;r++)for(o=this.faces[r],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),t=0,e=o.vertexNormals.length;e>t;t++)o.__originalVertexNormals[t]?o.__originalVertexNormals[t].copy(o.vertexNormals[t]):o.__originalVertexNormals[t]=o.vertexNormals[t].clone();var a=new n.Geometry;for(a.faces=this.faces,t=0,e=this.morphTargets.length;e>t;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s,h,c=this.morphNormals[t].faceNormals,u=this.morphNormals[t].vertexNormals;for(r=0,i=this.faces.length;i>r;r++)s=new n.Vector3,h={a:new n.Vector3,b:new n.Vector3,c:new n.Vector3},c.push(s),u.push(h)}var l=this.morphNormals[t];a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals();var s,h;for(r=0,i=this.faces.length;i>r;r++)o=this.faces[r],s=l.faceNormals[r],h=l.vertexNormals[r],s.copy(o.normal),h.a.copy(o.vertexNormals[0]),h.b.copy(o.vertexNormals[1]),h.c.copy(o.vertexNormals[2])}for(r=0,i=this.faces.length;i>r;r++)o=this.faces[r],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var t=0,e=this.vertices,r=0,n=e.length;n>r;r++)r>0&&(t+=e[r].distanceTo(e[r-1])),this.lineDistances[r]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t instanceof n.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);var i,o=this.vertices.length,a=this.vertices,s=t.vertices,h=this.faces,c=t.faces,u=this.faceVertexUvs[0],l=t.faceVertexUvs[0];void 0===r&&(r=0),void 0!==e&&(i=(new n.Matrix3).getNormalMatrix(e));for(var f=0,p=s.length;p>f;f++){var d=s[f],m=d.clone();void 0!==e&&m.applyMatrix4(e),a.push(m)}for(f=0,p=c.length;p>f;f++){var g,v,y,b=c[f],x=b.vertexNormals,w=b.vertexColors;g=new n.Face3(b.a+o,b.b+o,b.c+o),g.normal.copy(b.normal),void 0!==i&&g.normal.applyMatrix3(i).normalize();for(var M=0,S=x.length;S>M;M++)v=x[M].clone(),void 0!==i&&v.applyMatrix3(i).normalize(),g.vertexNormals.push(v);g.color.copy(b.color);for(var M=0,S=w.length;S>M;M++)y=w[M],g.vertexColors.push(y.clone());g.materialIndex=b.materialIndex+r,h.push(g)}for(f=0,p=l.length;p>f;f++){var _=l[f],E=[];if(void 0!==_){for(var M=0,S=_.length;S>M;M++)E.push(_[M].clone());u.push(E)}}},mergeMesh:function(t){return t instanceof n.Mesh==!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t):(t.matrixAutoUpdate&&t.updateMatrix(),void this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,r,n,i,o,a,s,h={},c=[],u=[],l=4,f=Math.pow(10,l);for(r=0,n=this.vertices.length;n>r;r++)t=this.vertices[r],e=Math.round(t.x*f)+"_"+Math.round(t.y*f)+"_"+Math.round(t.z*f),void 0===h[e]?(h[e]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[h[e]];var p=[];for(r=0,n=this.faces.length;n>r;r++){i=this.faces[r],i.a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var d=-1,m=0;3>m;m++)if(o[m]===o[(m+1)%3]){d=m,p.push(r);break}}for(r=p.length-1;r>=0;r--){var g=p[r];for(this.faces.splice(g,1),a=0,s=this.faceVertexUvs.length;s>a;a++)this.faceVertexUvs[a].splice(g,1)}var v=this.vertices.length-c.length;return this.vertices=c,v},toJSON:function(){function t(t,e,r){return r?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==f[e]?f[e]:(f[e]=l.length/3,l.push(t.x,t.y,t.z),f[e])}function r(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==d[e]?d[e]:(d[e]=p.length,p.push(t.getHex()),d[e])}function n(t){var e=t.x.toString()+t.y.toString();return void 0!==g[e]?g[e]:(g[e]=m.length/2,m.push(t.x,t.y),g[e])}var i={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(i[a]=o[a]);return i}for(var s=[],h=0;h<this.vertices.length;h++){var c=this.vertices[h];s.push(c.x,c.y,c.z)}for(var u=[],l=[],f={},p=[],d={},m=[],g={},h=0;h<this.faces.length;h++){var v=this.faces[h],y=!1,b=!1,x=void 0!==this.faceVertexUvs[0][h],w=v.normal.length()>0,M=v.vertexNormals.length>0,S=1!==v.color.r||1!==v.color.g||1!==v.color.b,_=v.vertexColors.length>0,E=0;if(E=t(E,0,0),E=t(E,1,y),E=t(E,2,b),E=t(E,3,x),E=t(E,4,w),E=t(E,5,M),E=t(E,6,S),E=t(E,7,_),u.push(E),u.push(v.a,v.b,v.c),x){var T=this.faceVertexUvs[0][h];u.push(n(T[0]),n(T[1]),n(T[2]))}if(w&&u.push(e(v.normal)),M){var C=v.vertexNormals;u.push(e(C[0]),e(C[1]),e(C[2]))}if(S&&u.push(r(v.color)),_){var A=v.vertexColors;u.push(r(A[0]),r(A[1]),r(A[2]))}}return i.data={},i.data.vertices=s,i.data.normals=l,p.length>0&&(i.data.colors=p),m.length>0&&(i.data.uvs=[m]),i.data.faces=u,i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var e=t.vertices,r=0,n=e.length;n>r;r++)this.vertices.push(e[r].clone());for(var i=t.faces,r=0,n=i.length;n>r;r++)this.faces.push(i[r].clone());for(var r=0,n=t.faceVertexUvs.length;n>r;r++){var o=t.faceVertexUvs[r];void 0===this.faceVertexUvs[r]&&(this.faceVertexUvs[r]=[]);for(var a=0,s=o.length;s>a;a++){for(var h=o[a],c=[],u=0,l=h.length;l>u;u++){var f=h[u];c.push(f.clone())}this.faceVertexUvs[r].push(c)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.Geometry.prototype),n.GeometryIdCount=0,n.DirectGeometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},n.DirectGeometry.prototype={constructor:n.DirectGeometry,computeBoundingBox:n.Geometry.prototype.computeBoundingBox,computeBoundingSphere:n.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(t){for(var e,r,n=[],i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,n.push(e)),e={start:3*o,materialIndex:r})}void 0!==e&&(e.count=3*o-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e=t.faces,r=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,h=s.length;if(h>0){for(var c=[],u=0;h>u;u++)c[u]=[];this.morphTargets.position=c}var l=t.morphNormals,f=l.length;if(f>0){for(var p=[],u=0;f>u;u++)p[u]=[];this.morphTargets.normal=p}for(var d=t.skinIndices,m=t.skinWeights,g=d.length===r.length,v=m.length===r.length,u=0;u<e.length;u++){var y=e[u];this.vertices.push(r[y.a],r[y.b],r[y.c]);var b=y.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var x=y.normal;this.normals.push(x,x,x)}var w=y.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var M=y.color;this.colors.push(M,M,M)}if(o===!0){var S=i[0][u];void 0!==S?this.uvs.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new n.Vector2,new n.Vector2,new n.Vector2))}if(a===!0){var S=i[1][u];void 0!==S?this.uvs2.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new n.Vector2,new n.Vector2,new n.Vector2))}for(var _=0;h>_;_++){var E=s[_].vertices;c[_].push(E[y.a],E[y.b],E[y.c])}for(var _=0;f>_;_++){var T=l[_].vertexNormals[u];p[_].push(T.a,T.b,T.c)}g&&this.skinIndices.push(d[y.a],d[y.b],d[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.DirectGeometry.prototype),n.BufferGeometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},n.BufferGeometry.prototype={constructor:n.BufferGeometry,addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},getIndex:function(){return this.index},setIndex:function(t){this.index=t},addAttribute:function(t,e){return e instanceof n.BufferAttribute==!1&&e instanceof n.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new n.BufferAttribute(arguments[1],arguments[2]))):"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):void(this.attributes[t]=e)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){delete this.attributes[t]},get drawcalls(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups},get offsets(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToVector3Array(e.array),e.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var i=(new n.Matrix3).getNormalMatrix(t);i.applyToVector3Array(r.array),r.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},rotateX:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0===t&&(t=new n.Matrix4),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,r,i){return void 0===t&&(t=new n.Matrix4),t.makeTranslation(e,r,i),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,r,i){return void 0===t&&(t=new n.Matrix4),t.makeScale(e,r,i),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new n.Object3D),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.center().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t instanceof n.Points||t instanceof n.Line){var r=new n.Float32Attribute(3*e.vertices.length,3),i=new n.Float32Attribute(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var o=new n.Float32Attribute(e.lineDistances.length,1);this.addAttribute("lineDistance",o.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t instanceof n.Mesh&&e instanceof n.Geometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t instanceof n.Mesh){var r=e.__directGeometry;if(void 0===r)return this.fromGeometry(e);r.verticesNeedUpdate=e.verticesNeedUpdate,r.normalsNeedUpdate=e.normalsNeedUpdate,r.colorsNeedUpdate=e.colorsNeedUpdate,r.uvsNeedUpdate=e.uvsNeedUpdate,r.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=r}if(e.verticesNeedUpdate===!0){var i=this.attributes.position;void 0!==i&&(i.copyVector3sArray(e.vertices),i.needsUpdate=!0),e.verticesNeedUpdate=!1}if(e.normalsNeedUpdate===!0){var i=this.attributes.normal;void 0!==i&&(i.copyVector3sArray(e.normals),i.needsUpdate=!0),e.normalsNeedUpdate=!1}if(e.colorsNeedUpdate===!0){var i=this.attributes.color;void 0!==i&&(i.copyColorsArray(e.colors),i.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){var i=this.attributes.lineDistance;void 0!==i&&(i.copyArray(e.lineDistances),i.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new n.DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new n.BufferAttribute(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new n.BufferAttribute(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var i=new Float32Array(3*t.colors.length);this.addAttribute("color",new n.BufferAttribute(i,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var o=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new n.BufferAttribute(o,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new n.BufferAttribute(a,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var s=t.vertices.length>65535?Uint32Array:Uint16Array,h=new s(3*t.indices.length);this.setIndex(new n.BufferAttribute(h,1).copyIndicesArray(t.indices))}this.groups=t.groups;for(var c in t.morphTargets){for(var u=[],l=t.morphTargets[c],f=0,p=l.length;p>f;f++){var d=l[f],m=new n.Float32Attribute(3*d.length,3);u.push(m.copyVector3sArray(d))}this.morphAttributes[c]=u}if(t.skinIndices.length>0){var g=new n.Float32Attribute(4*t.skinIndices.length,4);this.addAttribute("skinIndex",g.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var v=new n.Float32Attribute(4*t.skinWeights.length,4);this.addAttribute("skinWeight",v.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){var t=new n.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new n.Box3);var e=this.attributes.position.array;if(e){var r=this.boundingBox;r.makeEmpty();for(var i=0,o=e.length;o>i;i+=3)t.fromArray(e,i),r.expandByPoint(t)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var t=new n.Box3,e=new n.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere);var r=this.attributes.position.array;if(r){t.makeEmpty();for(var i=this.boundingSphere.center,o=0,a=r.length;a>o;o+=3)e.fromArray(r,o),t.expandByPoint(e);t.center(i);for(var s=0,o=0,a=r.length;a>o;o+=3)e.fromArray(r,o),s=Math.max(s,i.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,r=this.groups;if(e.position){var i=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new n.BufferAttribute(new Float32Array(i.length),3));else for(var o=e.normal.array,a=0,s=o.length;s>a;a++)o[a]=0;var h,c,u,o=e.normal.array,l=new n.Vector3,f=new n.Vector3,p=new n.Vector3,d=new n.Vector3,m=new n.Vector3;if(t){var g=t.array;0===r.length&&this.addGroup(0,g.length);for(var v=0,y=r.length;y>v;++v)for(var b=r[v],x=b.start,w=b.count,a=x,s=x+w;s>a;a+=3)h=3*g[a+0],c=3*g[a+1],u=3*g[a+2],l.fromArray(i,h),f.fromArray(i,c),p.fromArray(i,u),d.subVectors(p,f),m.subVectors(l,f),d.cross(m),o[h]+=d.x,o[h+1]+=d.y,o[h+2]+=d.z,o[c]+=d.x,o[c+1]+=d.y,o[c+2]+=d.z,o[u]+=d.x,o[u+1]+=d.y,o[u+2]+=d.z}else for(var a=0,s=i.length;s>a;a+=9)l.fromArray(i,a),f.fromArray(i,a+3),p.fromArray(i,a+6),d.subVectors(p,f),m.subVectors(l,f),d.cross(m),o[a]=d.x,o[a+1]=d.y,o[a+2]=d.z,o[a+3]=d.x,o[a+4]=d.y,o[a+5]=d.z,o[a+6]=d.x,o[a+7]=d.y,o[a+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(t){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(t,e){if(t instanceof n.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0);var r=this.attributes;for(var i in r)if(void 0!==t.attributes[i])for(var o=r[i],a=o.array,s=t.attributes[i],h=s.array,c=s.itemSize,u=0,l=c*e;u<h.length;u++,l++)a[l]=h[u];return this},normalizeNormals:function(){for(var t,e,r,n,i=this.attributes.normal.array,o=0,a=i.length;a>o;o+=3)t=i[o],e=i[o+1],r=i[o+2],n=1/Math.sqrt(t*t+e*e+r*r),i[o]*=n,i[o+1]*=n,i[o+2]*=n},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var a=o[r],i=Array.prototype.slice.call(a.array);t.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:i}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var h=this.boundingSphere;return null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new this.constructor).copy(this)},copy:function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var r=t.attributes;for(var n in r){var i=r[n];this.addAttribute(n,i.clone())}for(var o=t.groups,a=0,s=o.length;s>a;a++){var h=o[a];this.addGroup(h.start,h.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.BufferGeometry.prototype),n.BufferGeometry.MaxIndex=65535,n.InstancedBufferGeometry=function(){n.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},n.InstancedBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.InstancedBufferGeometry.prototype.constructor=n.InstancedBufferGeometry,n.InstancedBufferGeometry.prototype.addGroup=function(t,e,r){this.groups.push({start:t,count:e,instances:r})},n.InstancedBufferGeometry.prototype.copy=function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var r=t.attributes;for(var n in r){var i=r[n];this.addAttribute(n,i.clone())}for(var o=t.groups,a=0,s=o.length;s>a;a++){var h=o[a];this.addGroup(h.start,h.count,h.instances)}return this},n.EventDispatcher.prototype.apply(n.InstancedBufferGeometry.prototype),n.Camera=function(){n.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4},n.Camera.prototype=Object.create(n.Object3D.prototype),n.Camera.prototype.constructor=n.Camera,n.Camera.prototype.getWorldDirection=function(){var t=new n.Quaternion;return function(e){var r=e||new n.Vector3;return this.getWorldQuaternion(t),r.set(0,0,-1).applyQuaternion(t)}}(),n.Camera.prototype.lookAt=function(){var t=new n.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),n.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},n.Camera.prototype.copy=function(t){return n.Object3D.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},n.CubeCamera=function(t,e,r){n.Object3D.call(this),this.type="CubeCamera";var i=90,o=1,a=new n.PerspectiveCamera(i,o,t,e);a.up.set(0,-1,0),a.lookAt(new n.Vector3(1,0,0)),this.add(a);var s=new n.PerspectiveCamera(i,o,t,e);s.up.set(0,-1,0),s.lookAt(new n.Vector3(-1,0,0)),this.add(s);var h=new n.PerspectiveCamera(i,o,t,e);h.up.set(0,0,1),h.lookAt(new n.Vector3(0,1,0)),this.add(h);var c=new n.PerspectiveCamera(i,o,t,e);
c.up.set(0,0,-1),c.lookAt(new n.Vector3(0,-1,0)),this.add(c);var u=new n.PerspectiveCamera(i,o,t,e);u.up.set(0,-1,0),u.lookAt(new n.Vector3(0,0,1)),this.add(u);var l=new n.PerspectiveCamera(i,o,t,e);l.up.set(0,-1,0),l.lookAt(new n.Vector3(0,0,-1)),this.add(l),this.renderTarget=new n.WebGLRenderTargetCube(r,r,{format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter}),this.updateCubeMap=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,n=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,t.render(e,a,r),r.activeCubeFace=1,t.render(e,s,r),r.activeCubeFace=2,t.render(e,h,r),r.activeCubeFace=3,t.render(e,c,r),r.activeCubeFace=4,t.render(e,u,r),r.generateMipmaps=n,r.activeCubeFace=5,t.render(e,l,r),t.setRenderTarget(null)}},n.CubeCamera.prototype=Object.create(n.Object3D.prototype),n.CubeCamera.prototype.constructor=n.CubeCamera,n.OrthographicCamera=function(t,e,r,i,o,a){n.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=t,this.right=e,this.top=r,this.bottom=i,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},n.OrthographicCamera.prototype=Object.create(n.Camera.prototype),n.OrthographicCamera.prototype.constructor=n.OrthographicCamera,n.OrthographicCamera.prototype.updateProjectionMatrix=function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-t,r+t,n+e,n-e,this.near,this.far)},n.OrthographicCamera.prototype.copy=function(t){return n.Camera.prototype.copy.call(this,t),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this},n.OrthographicCamera.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,e},n.PerspectiveCamera=function(t,e,r,i){n.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype=Object.create(n.Camera.prototype),n.PerspectiveCamera.prototype.constructor=n.PerspectiveCamera,n.PerspectiveCamera.prototype.setLens=function(t,e){void 0===e&&(e=24),this.fov=2*n.Math.radToDeg(Math.atan(e/(2*t))),this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.setViewOffset=function(t,e,r,n,i,o){this.fullWidth=t,this.fullHeight=e,this.x=r,this.y=n,this.width=i,this.height=o,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var t=n.Math.radToDeg(2*Math.atan(Math.tan(.5*n.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var e=this.fullWidth/this.fullHeight,r=Math.tan(n.Math.degToRad(.5*t))*this.near,i=-r,o=e*i,a=e*r,s=Math.abs(a-o),h=Math.abs(r-i);this.projectionMatrix.makeFrustum(o+this.x*s/this.fullWidth,o+(this.x+this.width)*s/this.fullWidth,r-(this.y+this.height)*h/this.fullHeight,r-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(t,this.aspect,this.near,this.far)},n.PerspectiveCamera.prototype.copy=function(t){return n.Camera.prototype.copy.call(this,t),this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this},n.PerspectiveCamera.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.fov=this.fov,e.object.aspect=this.aspect,e.object.near=this.near,e.object.far=this.far,e},n.Light=function(t){n.Object3D.call(this),this.type="Light",this.color=new n.Color(t)},n.Light.prototype=Object.create(n.Object3D.prototype),n.Light.prototype.constructor=n.Light,n.Light.prototype.copy=function(t){return n.Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this},n.AmbientLight=function(t){n.Light.call(this,t),this.type="AmbientLight"},n.AmbientLight.prototype=Object.create(n.Light.prototype),n.AmbientLight.prototype.constructor=n.AmbientLight,n.AmbientLight.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e},n.DirectionalLight=function(t,e){n.Light.call(this,t),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new n.Object3D,this.intensity=void 0!==e?e:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.DirectionalLight.prototype=Object.create(n.Light.prototype),n.DirectionalLight.prototype.constructor=n.DirectionalLight,n.DirectionalLight.prototype.copy=function(t){return n.Light.prototype.copy.call(this,t),this.intensity=t.intensity,this.target=t.target.clone(),this.castShadow=t.castShadow,this.onlyShadow=t.onlyShadow,this.shadowCameraNear=t.shadowCameraNear,this.shadowCameraFar=t.shadowCameraFar,this.shadowCameraLeft=t.shadowCameraLeft,this.shadowCameraRight=t.shadowCameraRight,this.shadowCameraTop=t.shadowCameraTop,this.shadowCameraBottom=t.shadowCameraBottom,this.shadowCameraVisible=t.shadowCameraVisible,this.shadowBias=t.shadowBias,this.shadowDarkness=t.shadowDarkness,this.shadowMapWidth=t.shadowMapWidth,this.shadowMapHeight=t.shadowMapHeight,this},n.DirectionalLight.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,e},n.HemisphereLight=function(t,e,r){n.Light.call(this,t),this.type="HemisphereLight",this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new n.Color(e),this.intensity=void 0!==r?r:1},n.HemisphereLight.prototype=Object.create(n.Light.prototype),n.HemisphereLight.prototype.constructor=n.HemisphereLight,n.HemisphereLight.prototype.copy=function(t){return n.Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this.intensity=t.intensity,this},n.HemisphereLight.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.groundColor=this.groundColor.getHex(),e.object.intensity=this.intensity,e},n.PointLight=function(t,e,r,i){n.Light.call(this,t),this.type="PointLight",this.intensity=void 0!==e?e:1,this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1},n.PointLight.prototype=Object.create(n.Light.prototype),n.PointLight.prototype.constructor=n.PointLight,n.PointLight.prototype.copy=function(t){return n.Light.prototype.copy.call(this,t),this.intensity=t.intensity,this.distance=t.distance,this.decay=t.decay,this},n.PointLight.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,e.object.distance=this.distance,e.object.decay=this.decay,e},n.SpotLight=function(t,e,r,i,o,a){n.Light.call(this,t),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new n.Object3D,this.intensity=void 0!==e?e:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==o?o:10,this.decay=void 0!==a?a:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.SpotLight.prototype=Object.create(n.Light.prototype),n.SpotLight.prototype.constructor=n.SpotLight,n.SpotLight.prototype.copy=function(t){return n.Light.prototype.copy.call(this,t),this.intensity=t.intensity,this.distance=t.distance,this.angle=t.angle,this.exponent=t.exponent,this.decay=t.decay,this.target=t.target.clone(),this.castShadow=t.castShadow,this.onlyShadow=t.onlyShadow,this.shadowCameraNear=t.shadowCameraNear,this.shadowCameraFar=t.shadowCameraFar,this.shadowCameraFov=t.shadowCameraFov,this.shadowCameraVisible=t.shadowCameraVisible,this.shadowBias=t.shadowBias,this.shadowDarkness=t.shadowDarkness,this.shadowMapWidth=t.shadowMapWidth,this.shadowMapHeight=t.shadowMapHeight,this},n.SpotLight.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,e.object.distance=this.distance,e.object.angle=this.angle,e.object.exponent=this.exponent,e.object.decay=this.decay,e},n.Cache={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){return this.enabled!==!1?this.files[t]:void 0},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},n.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},n.Loader.prototype={constructor:n.Loader,crossOrigin:void 0,extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e,r){for(var n=[],i=0;i<t.length;++i)n[i]=this.createMaterial(t[i],e,r);return n},createMaterial:function(){var t;return function(e,r,i){function o(t){var e=Math.log(t)/Math.LN2;return Math.pow(2,Math.round(e))}function a(e,a,s,h,c,u,l){var f,p=r+s,d=n.Loader.Handlers.get(p);if(null!==d?f=d.load(p):(f=new n.Texture,d=t,d.setCrossOrigin(i),d.load(p,function(t){if(n.Math.isPowerOfTwo(t.width)===!1||n.Math.isPowerOfTwo(t.height)===!1){var e=o(t.width),r=o(t.height),i=document.createElement("canvas");i.width=e,i.height=r;var a=i.getContext("2d");a.drawImage(t,0,0,e,r),f.image=i}else f.image=t;f.needsUpdate=!0})),f.sourceFile=s,h&&(f.repeat.set(h[0],h[1]),1!==h[0]&&(f.wrapS=n.RepeatWrapping),1!==h[1]&&(f.wrapT=n.RepeatWrapping)),c&&f.offset.set(c[0],c[1]),u){var m={repeat:n.RepeatWrapping,mirror:n.MirroredRepeatWrapping};void 0!==m[u[0]]&&(f.wrapS=m[u[0]]),void 0!==m[u[1]]&&(f.wrapT=m[u[1]])}l&&(f.anisotropy=l),e[a]=f}function s(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]}var h=this;void 0===i&&void 0!==h.crossOrigin&&(i=h.crossOrigin),void 0===t&&(t=new n.ImageLoader);var c="MeshLambertMaterial",u={};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?c="MeshPhongMaterial":"basic"===l&&(c="MeshBasicMaterial")}void 0!==e.blending&&void 0!==n[e.blending]&&(u.blending=n[e.blending]),void 0!==e.transparent&&(u.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(u.transparent=!0),void 0!==e.depthTest&&(u.depthTest=e.depthTest),void 0!==e.depthWrite&&(u.depthWrite=e.depthWrite),void 0!==e.visible&&(u.visible=e.visible),void 0!==e.flipSided&&(u.side=n.BackSide),void 0!==e.doubleSided&&(u.side=n.DoubleSide),void 0!==e.wireframe&&(u.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?u.vertexColors=n.FaceColors:e.vertexColors&&(u.vertexColors=n.VertexColors)),e.colorDiffuse?u.color=s(e.colorDiffuse):e.DbgColor&&(u.color=e.DbgColor),e.colorEmissive&&(u.emissive=s(e.colorEmissive)),"MeshPhongMaterial"===c&&(e.colorSpecular&&(u.specular=s(e.colorSpecular)),e.specularCoef&&(u.shininess=e.specularCoef)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(u.opacity=e.opacity),r&&(e.mapDiffuse&&a(u,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&a(u,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapAO&&a(u,"aoMap",e.mapAO,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy),e.mapBump&&a(u,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&a(u,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&a(u,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&a(u,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy)),e.mapBumpScale&&(u.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(u.normalScale=new n.Vector2(e.mapNormalFactor,e.mapNormalFactor));var f=new n[c](u);return void 0!==e.DbgName&&(f.name=e.DbgName),f}}()},n.Loader.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=0,r=this.handlers.length;r>e;e+=2){var n=this.handlers[e],i=this.handlers[e+1];if(n.test(t))return i}return null}},n.XHRLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager},n.XHRLoader.prototype={constructor:n.XHRLoader,load:function(t,e,r,i){var o=this,a=n.Cache.get(t);if(void 0!==a)return e&&setTimeout(function(){e(a)},0),a;var s=new XMLHttpRequest;return s.open("GET",t,!0),s.addEventListener("load",function(r){n.Cache.add(t,this.response),e&&e(this.response),o.manager.itemEnd(t)},!1),void 0!==r&&s.addEventListener("progress",function(t){r(t)},!1),s.addEventListener("error",function(e){i&&i(e),o.manager.itemError(t)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.send(null),o.manager.itemStart(t),s},setResponseType:function(t){this.responseType=t},setCrossOrigin:function(t){this.crossOrigin=t},setWithCredentials:function(t){this.withCredentials=t}},n.ImageLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager},n.ImageLoader.prototype={constructor:n.ImageLoader,load:function(t,e,r,i){var o=this,a=n.Cache.get(t);if(void 0!==a)return e&&setTimeout(function(){e(a)},0),a;var s=document.createElement("img");return s.addEventListener("load",function(r){n.Cache.add(t,this),e&&e(this),o.manager.itemEnd(t)},!1),void 0!==r&&s.addEventListener("progress",function(t){r(t)},!1),s.addEventListener("error",function(e){i&&i(e),o.manager.itemError(t)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),o.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){this.crossOrigin=t}},n.JSONLoader=function(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:n.DefaultLoadingManager,this.withCredentials=!1},n.JSONLoader.prototype={constructor:n.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(t,e,r,i){var o=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:n.Loader.prototype.extractUrlBase(t),s=new n.XHRLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setWithCredentials(this.withCredentials),s.load(t,function(r){var n=JSON.parse(r),i=n.metadata;if(void 0!==i){if("object"===i.type)return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===i.type)return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}var s=o.parse(n,a);e(s.geometry,s.materials)})},setCrossOrigin:function(t){this.crossOrigin=t},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){function r(e){function r(t,e){return t&1<<e}var i,o,s,h,c,u,l,f,p,d,m,g,v,y,b,x,w,M,S,_,E,T,C,A,L,P,F,R=t.faces,k=t.vertices,O=t.normals,D=t.colors,U=0;if(void 0!==t.uvs){for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&U++;for(i=0;U>i;i++)a.faceVertexUvs[i]=[]}for(h=0,c=k.length;c>h;)M=new n.Vector3,M.x=k[h++]*e,M.y=k[h++]*e,M.z=k[h++]*e,a.vertices.push(M);for(h=0,c=R.length;c>h;)if(d=R[h++],m=r(d,0),g=r(d,1),v=r(d,3),y=r(d,4),b=r(d,5),x=r(d,6),w=r(d,7),m){if(_=new n.Face3,_.a=R[h],_.b=R[h+1],_.c=R[h+3],E=new n.Face3,E.a=R[h+1],E.b=R[h+2],E.c=R[h+3],h+=4,g&&(p=R[h++],_.materialIndex=p,E.materialIndex=p),s=a.faces.length,v)for(i=0;U>i;i++)for(A=t.uvs[i],a.faceVertexUvs[i][s]=[],a.faceVertexUvs[i][s+1]=[],o=0;4>o;o++)f=R[h++],P=A[2*f],F=A[2*f+1],L=new n.Vector2(P,F),2!==o&&a.faceVertexUvs[i][s].push(L),0!==o&&a.faceVertexUvs[i][s+1].push(L);if(y&&(l=3*R[h++],_.normal.set(O[l++],O[l++],O[l]),E.normal.copy(_.normal)),b)for(i=0;4>i;i++)l=3*R[h++],C=new n.Vector3(O[l++],O[l++],O[l]),2!==i&&_.vertexNormals.push(C),0!==i&&E.vertexNormals.push(C);if(x&&(u=R[h++],T=D[u],_.color.setHex(T),E.color.setHex(T)),w)for(i=0;4>i;i++)u=R[h++],T=D[u],2!==i&&_.vertexColors.push(new n.Color(T)),0!==i&&E.vertexColors.push(new n.Color(T));a.faces.push(_),a.faces.push(E)}else{if(S=new n.Face3,S.a=R[h++],S.b=R[h++],S.c=R[h++],g&&(p=R[h++],S.materialIndex=p),s=a.faces.length,v)for(i=0;U>i;i++)for(A=t.uvs[i],a.faceVertexUvs[i][s]=[],o=0;3>o;o++)f=R[h++],P=A[2*f],F=A[2*f+1],L=new n.Vector2(P,F),a.faceVertexUvs[i][s].push(L);if(y&&(l=3*R[h++],S.normal.set(O[l++],O[l++],O[l])),b)for(i=0;3>i;i++)l=3*R[h++],C=new n.Vector3(O[l++],O[l++],O[l]),S.vertexNormals.push(C);if(x&&(u=R[h++],S.color.setHex(D[u])),w)for(i=0;3>i;i++)u=R[h++],S.vertexColors.push(new n.Color(D[u]));a.faces.push(S)}}function i(){var e=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var r=0,i=t.skinWeights.length;i>r;r+=e){var o=t.skinWeights[r],s=e>1?t.skinWeights[r+1]:0,h=e>2?t.skinWeights[r+2]:0,c=e>3?t.skinWeights[r+3]:0;a.skinWeights.push(new n.Vector4(o,s,h,c))}if(t.skinIndices)for(var r=0,i=t.skinIndices.length;i>r;r+=e){var u=t.skinIndices[r],l=e>1?t.skinIndices[r+1]:0,f=e>2?t.skinIndices[r+2]:0,p=e>3?t.skinIndices[r+3]:0;a.skinIndices.push(new n.Vector4(u,l,f,p))}a.bones=t.bones,a.bones&&a.bones.length>0&&(a.skinWeights.length!==a.skinIndices.length||a.skinIndices.length!==a.vertices.length)&&console.warn("When skinning, number of vertices ("+a.vertices.length+"), skinIndices ("+a.skinIndices.length+"), and skinWeights ("+a.skinWeights.length+") should match."),a.animation=t.animation,a.animations=t.animations}function o(e){if(void 0!==t.morphTargets){var r,i,o,s,h,c;for(r=0,i=t.morphTargets.length;i>r;r++)for(a.morphTargets[r]={},a.morphTargets[r].name=t.morphTargets[r].name,a.morphTargets[r].vertices=[],h=a.morphTargets[r].vertices,c=t.morphTargets[r].vertices,o=0,s=c.length;s>o;o+=3){var u=new n.Vector3;u.x=c[o]*e,u.y=c[o+1]*e,u.z=c[o+2]*e,h.push(u)}}if(void 0!==t.morphColors){var r,i,l,f,p,d,m;for(r=0,i=t.morphColors.length;i>r;r++)for(a.morphColors[r]={},a.morphColors[r].name=t.morphColors[r].name,a.morphColors[r].colors=[],p=a.morphColors[r].colors,d=t.morphColors[r].colors,l=0,f=d.length;f>l;l+=3)m=new n.Color(16755200),m.setRGB(d[l],d[l+1],d[l+2]),p.push(m)}}var a=new n.Geometry,s=void 0!==t.scale?1/t.scale:1;if(r(s),i(),o(s),a.computeFaceNormals(),a.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)return{geometry:a};var h=n.Loader.prototype.initMaterials(t.materials,e,this.crossOrigin);return{geometry:a,materials:h}}},n.LoadingManager=function(t,e,r){var n=this,i=!1,o=0,a=0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){a++,i===!1&&void 0!==n.onStart&&n.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)}},n.DefaultLoadingManager=new n.LoadingManager,n.BufferGeometryLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager},n.BufferGeometryLoader.prototype={constructor:n.BufferGeometryLoader,load:function(t,e,r,i){var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(t,function(t){e(o.parse(JSON.parse(t)))},r,i)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=new n.BufferGeometry,r=t.data.index;if(void 0!==r){var i=new self[r.type](r.array);e.setIndex(new n.BufferAttribute(i,1))}var o=t.data.attributes;for(var a in o){var s=o[a],i=new self[s.type](s.array);e.addAttribute(a,new n.BufferAttribute(i,s.itemSize))}var h=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==h)for(var c=0,u=h.length;c!==u;++c){var l=h[c];e.addGroup(l.start,l.count)}var f=t.data.boundingSphere;if(void 0!==f){var p=new n.Vector3;void 0!==f.center&&p.fromArray(f.center),e.boundingSphere=new n.Sphere(p,f.radius)}return e}},n.MaterialLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.textures={}},n.MaterialLoader.prototype={constructor:n.MaterialLoader,load:function(t,e,r,i){var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(t,function(t){e(o.parse(JSON.parse(t)))},r,i)},setCrossOrigin:function(t){this.crossOrigin=t},setTextures:function(t){this.textures=t},getTexture:function(t){var e=this.textures;return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]},parse:function(t){var e=new n[t.type];if(e.uuid=t.uuid,void 0!==t.name&&(e.name=t.name),void 0!==t.color&&e.color.setHex(t.color),void 0!==t.emissive&&e.emissive.setHex(t.emissive),void 0!==t.specular&&e.specular.setHex(t.specular),void 0!==t.shininess&&(e.shininess=t.shininess),void 0!==t.uniforms&&(e.uniforms=t.uniforms),void 0!==t.vertexShader&&(e.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(e.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(e.vertexColors=t.vertexColors),void 0!==t.shading&&(e.shading=t.shading),void 0!==t.blending&&(e.blending=t.blending),void 0!==t.side&&(e.side=t.side),void 0!==t.opacity&&(e.opacity=t.opacity),void 0!==t.transparent&&(e.transparent=t.transparent),void 0!==t.alphaTest&&(e.alphaTest=t.alphaTest),void 0!==t.depthTest&&(e.depthTest=t.depthTest),void 0!==t.depthWrite&&(e.depthWrite=t.depthWrite),void 0!==t.wireframe&&(e.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(e.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.size&&(e.size=t.size),void 0!==t.sizeAttenuation&&(e.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(e.map=this.getTexture(t.map)),void 0!==t.alphaMap&&(e.alphaMap=this.getTexture(t.alphaMap),e.transparent=!0),void 0!==t.bumpMap&&(e.bumpMap=this.getTexture(t.bumpMap)),void 0!==t.bumpScale&&(e.bumpScale=t.bumpScale),void 0!==t.normalMap&&(e.normalMap=this.getTexture(t.normalMap)),t.normalScale&&(e.normalScale=new n.Vector2(t.normalScale,t.normalScale)),void 0!==t.displacementMap&&(e.displacementMap=this.getTexture(t.displacementMap)),void 0!==t.displacementScale&&(e.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(e.displacementBias=t.displacementBias),void 0!==t.specularMap&&(e.specularMap=this.getTexture(t.specularMap)),void 0!==t.envMap&&(e.envMap=this.getTexture(t.envMap),e.combine=n.MultiplyOperation),t.reflectivity&&(e.reflectivity=t.reflectivity),void 0!==t.lightMap&&(e.lightMap=this.getTexture(t.lightMap)),void 0!==t.lightMapIntensity&&(e.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(e.aoMap=this.getTexture(t.aoMap)),void 0!==t.aoMapIntensity&&(e.aoMapIntensity=t.aoMapIntensity),void 0!==t.materials)for(var r=0,i=t.materials.length;i>r;r++)e.materials.push(this.parse(t.materials[r]));return e}},n.ObjectLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.texturePath=""},n.ObjectLoader.prototype={constructor:n.ObjectLoader,load:function(t,e,r,i){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var o=this,a=new n.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(t,function(t){o.parse(JSON.parse(t),e)},r,i)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=this.parseGeometries(t.geometries),n=this.parseImages(t.images,function(){void 0!==e&&e(a)}),i=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,i),a=this.parseObject(t.object,r,o);return(void 0===t.images||0===t.images.length)&&void 0!==e&&e(a),a},parseGeometries:function(t){var e={};if(void 0!==t)for(var r=new n.JSONLoader,i=new n.BufferGeometryLoader,o=0,a=t.length;a>o;o++){var s,h=t[o];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new n[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new n.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleBufferGeometry":s=new n.CircleBufferGeometry(h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CircleGeometry":s=new n.CircleGeometry(h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":s=new n.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":s=new n.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"SphereBufferGeometry":s=new n.SphereBufferGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":s=new n.DodecahedronGeometry(h.radius,h.detail);break;case"IcosahedronGeometry":s=new n.IcosahedronGeometry(h.radius,h.detail);break;case"OctahedronGeometry":s=new n.OctahedronGeometry(h.radius,h.detail);break;case"TetrahedronGeometry":s=new n.TetrahedronGeometry(h.radius,h.detail);break;case"RingGeometry":s=new n.RingGeometry(h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":s=new n.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new n.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"TextGeometry":s=new n.TextGeometry(h.text,h.data);break;case"BufferGeometry":s=i.parse(h);break;case"Geometry":s=r.parse(h.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}s.uuid=h.uuid,void 0!==h.name&&(s.name=h.name),e[h.uuid]=s}return e},parseMaterials:function(t,e){var r={};if(void 0!==t){var i=new n.MaterialLoader;i.setTextures(e);for(var o=0,a=t.length;a>o;o++){var s=i.parse(t[o]);r[s.uuid]=s}}return r},parseImages:function(t,e){function r(t){return i.manager.itemStart(t),s.load(t,function(){i.manager.itemEnd(t)})}var i=this,o={};if(void 0!==t&&t.length>0){var a=new n.LoadingManager(e),s=new n.ImageLoader(a);s.setCrossOrigin(this.crossOrigin);for(var h=0,c=t.length;c>h;h++){var u=t[h],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:i.texturePath+u.url;o[u.uuid]=r(l)}}return o},parseTextures:function(t,e){function r(t){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),n[t])}var i={};if(void 0!==t)for(var o=0,a=t.length;a>o;o++){var s=t[o];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var h=new n.Texture(e[s.image]);h.needsUpdate=!0,h.uuid=s.uuid,void 0!==s.name&&(h.name=s.name),void 0!==s.mapping&&(h.mapping=r(s.mapping)),void 0!==s.offset&&(h.offset=new n.Vector2(s.offset[0],s.offset[1])),void 0!==s.repeat&&(h.repeat=new n.Vector2(s.repeat[0],s.repeat[1])),void 0!==s.minFilter&&(h.minFilter=r(s.minFilter)),void 0!==s.magFilter&&(h.magFilter=r(s.magFilter)),void 0!==s.anisotropy&&(h.anisotropy=s.anisotropy),Array.isArray(s.wrap)&&(h.wrapS=r(s.wrap[0]),h.wrapT=r(s.wrap[1])),i[s.uuid]=h}return i},parseObject:function(){var t=new n.Matrix4;return function(e,r,i){var o,a=function(t){return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),r[t]},s=function(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]};switch(e.type){case"Scene":o=new n.Scene;break;case"PerspectiveCamera":o=new n.PerspectiveCamera(e.fov,e.aspect,e.near,e.far);break;case"OrthographicCamera":o=new n.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":o=new n.AmbientLight(e.color);break;case"DirectionalLight":o=new n.DirectionalLight(e.color,e.intensity);break;case"PointLight":o=new n.PointLight(e.color,e.intensity,e.distance,e.decay);break;case"SpotLight":o=new n.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent,e.decay);break;case"HemisphereLight":o=new n.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"Mesh":o=new n.Mesh(a(e.geometry),s(e.material));break;case"LOD":o=new n.LOD;break;case"Line":o=new n.Line(a(e.geometry),s(e.material),e.mode);break;case"PointCloud":case"Points":o=new n.Points(a(e.geometry),s(e.material));break;case"Sprite":o=new n.Sprite(s(e.material));break;case"Group":o=new n.Group;break;default:o=new n.Object3D}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.children)for(var h in e.children)o.add(this.parseObject(e.children[h],r,i));if("LOD"===e.type)for(var c=e.levels,u=0;u<c.length;u++){var l=c[u],h=o.getObjectByProperty("uuid",l.object);void 0!==h&&o.addLevel(h,l.distance)}return o}}()},n.TextureLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager},n.TextureLoader.prototype={constructor:n.TextureLoader,load:function(t,e,r,i){var o=this,a=new n.ImageLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(t,function(t){var r=new n.Texture(t);r.needsUpdate=!0,void 0!==e&&e(r)},r,i)},setCrossOrigin:function(t){this.crossOrigin=t}},n.DataTextureLoader=n.BinaryTextureLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this._parser=null},n.BinaryTextureLoader.prototype={constructor:n.BinaryTextureLoader,load:function(t,e,r,i){var o=this,a=new n.DataTexture,s=new n.XHRLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setResponseType("arraybuffer"),s.load(t,function(t){var r=o._parser(t);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:n.ClampToEdgeWrapping,a.wrapT=void 0!==r.wrapT?r.wrapT:n.ClampToEdgeWrapping,a.magFilter=void 0!==r.magFilter?r.magFilter:n.LinearFilter,a.minFilter=void 0!==r.minFilter?r.minFilter:n.LinearMipMapLinearFilter,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=n.LinearFilter),a.needsUpdate=!0,e&&e(a,r))},r,i),a},setCrossOrigin:function(t){this.crossOrigin=t}},n.CompressedTextureLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this._parser=null},n.CompressedTextureLoader.prototype={constructor:n.CompressedTextureLoader,load:function(t,e,r,i){var o=this,a=[],s=new n.CompressedTexture;s.image=a;var h=new n.XHRLoader(this.manager);if(h.setCrossOrigin(this.crossOrigin),h.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=function(u){h.load(t[u],function(t){var r=o._parser(t,!0);a[u]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},c+=1,6===c&&(1===r.mipmapCount&&(s.minFilter=n.LinearFilter),s.format=r.format,s.needsUpdate=!0,e&&e(s))},r,i)},l=0,f=t.length;f>l;++l)u(l);else h.load(t,function(t){var r=o._parser(t,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,h=0;i>h;h++){a[h]={mipmaps:[]};for(var c=0;c<r.mipmapCount;c++)a[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+c]),a[h].format=r.format,a[h].width=r.width,a[h].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=n.LinearFilter),
s.format=r.format,s.needsUpdate=!0,e&&e(s)},r,i);return s},setCrossOrigin:function(t){this.crossOrigin=t}},n.Material=function(){Object.defineProperty(this,"id",{value:n.MaterialIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="Material",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.blending=n.NormalBlending,this.blendSrc=n.SrcAlphaFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=n.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},n.Material.prototype={constructor:n.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){t===!0&&this.update(),this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r){var i=this[e];void 0!==i?i instanceof n.Color?i.set(r):i instanceof n.Vector3&&r instanceof n.Vector3?i.copy(r):"overdraw"===e?this[e]=Number(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};return e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),this.color instanceof n.Color&&(e.color=this.color.getHex()),this.emissive instanceof n.Color&&(e.emissive=this.emissive.getHex()),this.specular instanceof n.Color&&(e.specular=this.specular.getHex()),void 0!==this.shininess&&(e.shininess=this.shininess),this.map instanceof n.Texture&&(e.map=this.map.toJSON(t).uuid),this.alphaMap instanceof n.Texture&&(e.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap instanceof n.Texture&&(e.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap instanceof n.Texture&&(e.bumpMap=this.bumpMap.toJSON(t).uuid,e.bumpScale=this.bumpScale),this.normalMap instanceof n.Texture&&(e.normalMap=this.normalMap.toJSON(t).uuid,e.normalScale=this.normalScale),this.displacementMap instanceof n.Texture&&(e.displacementMap=this.displacementMap.toJSON(t).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.specularMap instanceof n.Texture&&(e.specularMap=this.specularMap.toJSON(t).uuid),this.envMap instanceof n.Texture&&(e.envMap=this.envMap.toJSON(t).uuid,e.reflectivity=this.reflectivity),void 0!==this.size&&(e.size=this.size),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==n.NoColors&&(e.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==n.SmoothShading&&(e.shading=this.shading),void 0!==this.blending&&this.blending!==n.NormalBlending&&(e.blending=this.blending),void 0!==this.side&&this.side!==n.FrontSide&&(e.side=this.side),this.opacity<1&&(e.opacity=this.opacity),this.transparent===!0&&(e.transparent=this.transparent),this.alphaTest>0&&(e.alphaTest=this.alphaTest),this.wireframe===!0&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),e},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.side=t.side,this.opacity=t.opacity,this.transparent=t.transparent,this.blending=t.blending,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.overdraw=t.overdraw,this.visible=t.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(t){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new n.Color}},n.EventDispatcher.prototype.apply(n.Material.prototype),n.MaterialIdCount=0,n.LineBasicMaterial=function(t){n.Material.call(this),this.type="LineBasicMaterial",this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=n.NoColors,this.fog=!0,this.setValues(t)},n.LineBasicMaterial.prototype=Object.create(n.Material.prototype),n.LineBasicMaterial.prototype.constructor=n.LineBasicMaterial,n.LineBasicMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.vertexColors=t.vertexColors,this.fog=t.fog,this},n.LineDashedMaterial=function(t){n.Material.call(this),this.type="LineDashedMaterial",this.color=new n.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},n.LineDashedMaterial.prototype=Object.create(n.Material.prototype),n.LineDashedMaterial.prototype.constructor=n.LineDashedMaterial,n.LineDashedMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this.vertexColors=t.vertexColors,this.fog=t.fog,this},n.MeshBasicMaterial=function(t){n.Material.call(this),this.type="MeshBasicMaterial",this.color=new n.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)},n.MeshBasicMaterial.prototype=Object.create(n.Material.prototype),n.MeshBasicMaterial.prototype.constructor=n.MeshBasicMaterial,n.MeshBasicMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},n.MeshLambertMaterial=function(t){n.Material.call(this),this.type="MeshLambertMaterial",this.color=new n.Color(16777215),this.emissive=new n.Color(0),this.map=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},n.MeshLambertMaterial.prototype=Object.create(n.Material.prototype),n.MeshLambertMaterial.prototype.constructor=n.MeshLambertMaterial,n.MeshLambertMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.emissive.copy(t.emissive),this.map=t.map,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},n.MeshPhongMaterial=function(t){n.Material.call(this),this.type="MeshPhongMaterial",this.color=new n.Color(16777215),this.emissive=new n.Color(0),this.specular=new n.Color(1118481),this.shininess=30,this.metal=!1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},n.MeshPhongMaterial.prototype=Object.create(n.Material.prototype),n.MeshPhongMaterial.prototype.constructor=n.MeshPhongMaterial,n.MeshPhongMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.emissive.copy(t.emissive),this.specular.copy(t.specular),this.shininess=t.shininess,this.metal=t.metal,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissiveMap=t.emissiveMap,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.fog=t.fog,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},n.MeshDepthMaterial=function(t){n.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},n.MeshDepthMaterial.prototype=Object.create(n.Material.prototype),n.MeshDepthMaterial.prototype.constructor=n.MeshDepthMaterial,n.MeshDepthMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},n.MeshNormalMaterial=function(t){n.Material.call(this,t),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},n.MeshNormalMaterial.prototype=Object.create(n.Material.prototype),n.MeshNormalMaterial.prototype.constructor=n.MeshNormalMaterial,n.MeshNormalMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},n.MultiMaterial=function(t){this.uuid=n.Math.generateUUID(),this.type="MultiMaterial",this.materials=t instanceof Array?t:[],this.visible=!0},n.MultiMaterial.prototype={constructor:n.MultiMaterial,toJSON:function(){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},e=0,r=this.materials.length;r>e;e++)t.materials.push(this.materials[e].toJSON());return t.visible=this.visible,t},clone:function(){for(var t=new this.constructor,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t.visible=this.visible,t}},n.MeshFaceMaterial=n.MultiMaterial,n.PointsMaterial=function(t){n.Material.call(this),this.type="PointsMaterial",this.color=new n.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=n.NoColors,this.fog=!0,this.setValues(t)},n.PointsMaterial.prototype=Object.create(n.Material.prototype),n.PointsMaterial.prototype.constructor=n.PointsMaterial,n.PointsMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.vertexColors=t.vertexColors,this.fog=t.fog,this},n.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new n.PointsMaterial(t)},n.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new n.PointsMaterial(t)},n.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new n.PointsMaterial(t)},n.ShaderMaterial=function(t){n.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=n.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.derivatives=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))},n.ShaderMaterial.prototype=Object.create(n.Material.prototype),n.ShaderMaterial.prototype.constructor=n.ShaderMaterial,n.ShaderMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=n.UniformsUtils.clone(t.uniforms),this.attributes=t.attributes,this.defines=t.defines,this.shading=t.shading,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.vertexColors=t.vertexColors,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.derivatives=t.derivatives,this},n.ShaderMaterial.prototype.toJSON=function(t){var e=n.Material.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.attributes=this.attributes,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},n.RawShaderMaterial=function(t){n.ShaderMaterial.call(this,t),this.type="RawShaderMaterial"},n.RawShaderMaterial.prototype=Object.create(n.ShaderMaterial.prototype),n.RawShaderMaterial.prototype.constructor=n.RawShaderMaterial,n.SpriteMaterial=function(t){n.Material.call(this),this.type="SpriteMaterial",this.color=new n.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(t)},n.SpriteMaterial.prototype=Object.create(n.Material.prototype),n.SpriteMaterial.prototype.constructor=n.SpriteMaterial,n.SpriteMaterial.prototype.copy=function(t){return n.Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this.fog=t.fog,this},n.Texture=function(t,e,r,i,o,a,s,h,c){Object.defineProperty(this,"id",{value:n.TextureIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==t?t:n.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:n.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:n.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:n.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:n.LinearFilter,this.minFilter=void 0!==a?a:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:n.RGBAFormat,this.type=void 0!==h?h:n.UnsignedByteType,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},n.Texture.DEFAULT_IMAGE=void 0,n.Texture.DEFAULT_MAPPING=n.UVMapping,n.Texture.prototype={constructor:n.Texture,set needsUpdate(t){t===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this},toJSON:function(t){function e(t){var e;return void 0!==t.toDataURL?e=t:(e=document.createElement("canvas"),e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height)),e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=n.Math.generateUUID()),void 0===t.images[i.uuid]&&(t.images[i.uuid]={uuid:i.uuid,url:e(i)}),r.image=i.uuid}return t.textures[this.uuid]=r,r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===n.UVMapping){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case n.RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case n.ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case n.MirroredRepeatWrapping:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case n.RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case n.ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case n.MirroredRepeatWrapping:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}},n.EventDispatcher.prototype.apply(n.Texture.prototype),n.TextureIdCount=0,n.CanvasTexture=function(t,e,r,i,o,a,s,h,c){n.Texture.call(this,t,e,r,i,o,a,s,h,c),this.needsUpdate=!0},n.CanvasTexture.prototype=Object.create(n.Texture.prototype),n.CanvasTexture.prototype.constructor=n.CanvasTexture,n.CubeTexture=function(t,e,r,i,o,a,s,h,c){e=void 0!==e?e:n.CubeReflectionMapping,n.Texture.call(this,t,e,r,i,o,a,s,h,c),this.images=t,this.flipY=!1},n.CubeTexture.prototype=Object.create(n.Texture.prototype),n.CubeTexture.prototype.constructor=n.CubeTexture,n.CubeTexture.prototype.copy=function(t){return n.Texture.prototype.copy.call(this,t),this.images=t.images,this},n.CompressedTexture=function(t,e,r,i,o,a,s,h,c,u,l){n.Texture.call(this,null,a,s,h,c,u,i,o,l),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1},n.CompressedTexture.prototype=Object.create(n.Texture.prototype),n.CompressedTexture.prototype.constructor=n.CompressedTexture,n.DataTexture=function(t,e,r,i,o,a,s,h,c,u,l){n.Texture.call(this,null,a,s,h,c,u,i,o,l),this.image={data:t,width:e,height:r},this.magFilter=void 0!==c?c:n.NearestFilter,this.minFilter=void 0!==u?u:n.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},n.DataTexture.prototype=Object.create(n.Texture.prototype),n.DataTexture.prototype.constructor=n.DataTexture,n.VideoTexture=function(t,e,r,i,o,a,s,h,c){n.Texture.call(this,t,e,r,i,o,a,s,h,c),this.generateMipmaps=!1;var u=this,l=function(){requestAnimationFrame(l),t.readyState===t.HAVE_ENOUGH_DATA&&(u.needsUpdate=!0)};l()},n.VideoTexture.prototype=Object.create(n.Texture.prototype),n.VideoTexture.prototype.constructor=n.VideoTexture,n.Group=function(){n.Object3D.call(this),this.type="Group"},n.Group.prototype=Object.create(n.Object3D.prototype),n.Group.prototype.constructor=n.Group,n.Points=function(t,e){n.Object3D.call(this),this.type="Points",this.geometry=void 0!==t?t:new n.Geometry,this.material=void 0!==e?e:new n.PointsMaterial({color:16777215*Math.random()})},n.Points.prototype=Object.create(n.Object3D.prototype),n.Points.prototype.constructor=n.Points,n.Points.prototype.raycast=function(){var t=new n.Matrix4,e=new n.Ray;return function(r,i){function o(t,n){var o=e.distanceSqToPoint(t);if(u>o){var s=e.closestPointToPoint(t);s.applyMatrix4(a.matrixWorld);var h=r.ray.origin.distanceTo(s);if(h<r.near||h>r.far)return;i.push({distance:h,distanceToRay:Math.sqrt(o),point:s.clone(),index:n,face:null,object:a})}}var a=this,s=a.geometry,h=r.params.Points.threshold;if(t.getInverse(this.matrixWorld),e.copy(r.ray).applyMatrix4(t),null===s.boundingBox||e.isIntersectionBox(s.boundingBox)!==!1){var c=h/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,l=new n.Vector3;if(s instanceof n.BufferGeometry){var f=s.index,p=s.attributes,d=p.position.array;if(null!==f)for(var m=f.array,g=0,v=m.length;v>g;g++){var y=m[g];l.fromArray(d,3*y),o(l,y)}else for(var g=0,b=d.length/3;b>g;g++)l.fromArray(d,3*g),o(l,g)}else for(var x=s.vertices,g=0,b=x.length;b>g;g++)o(x[g],g)}}}(),n.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},n.Points.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON()),void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON()),e.object.geometry=this.geometry.uuid,e.object.material=this.material.uuid,e},n.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new n.Points(t,e)},n.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new n.Points(t,e)},n.Line=function(t,e,r){return 1===r?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new n.LineSegments(t,e)):(n.Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new n.Geometry,void(this.material=void 0!==e?e:new n.LineBasicMaterial({color:16777215*Math.random()})))},n.Line.prototype=Object.create(n.Object3D.prototype),n.Line.prototype.constructor=n.Line,n.Line.prototype.raycast=function(){var t=new n.Matrix4,e=new n.Ray,r=new n.Sphere;return function(i,o){var a=i.linePrecision,s=a*a,h=this.geometry;if(null===h.boundingSphere&&h.computeBoundingSphere(),r.copy(h.boundingSphere),r.applyMatrix4(this.matrixWorld),i.ray.isIntersectionSphere(r)!==!1){t.getInverse(this.matrixWorld),e.copy(i.ray).applyMatrix4(t);var c=new n.Vector3,u=new n.Vector3,l=new n.Vector3,f=new n.Vector3,p=this instanceof n.LineSegments?2:1;if(h instanceof n.BufferGeometry){var d=h.index,m=h.attributes;if(null!==d)for(var g=d.array,v=m.position.array,y=0,b=g.length-1;b>y;y+=p){var x=g[y],w=g[y+1];c.fromArray(v,3*x),u.fromArray(v,3*w);var M=e.distanceSqToSegment(c,u,f,l);if(!(M>s)){f.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(f);S<i.near||S>i.far||o.push({distance:S,point:l.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else for(var v=m.position.array,y=0,b=v.length/3-1;b>y;y+=p){c.fromArray(v,3*y),u.fromArray(v,3*y+3);var M=e.distanceSqToSegment(c,u,f,l);if(!(M>s)){f.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(f);S<i.near||S>i.far||o.push({distance:S,point:l.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}else if(h instanceof n.Geometry)for(var _=h.vertices,E=_.length,y=0;E-1>y;y+=p){var M=e.distanceSqToSegment(_[y],_[y+1],f,l);if(!(M>s)){f.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(f);S<i.near||S>i.far||o.push({distance:S,point:l.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),n.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},n.Line.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON()),void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON()),e.object.geometry=this.geometry.uuid,e.object.material=this.material.uuid,e},n.LineStrip=0,n.LinePieces=1,n.LineSegments=function(t,e){n.Line.call(this,t,e),this.type="LineSegments"},n.LineSegments.prototype=Object.create(n.Line.prototype),n.LineSegments.prototype.constructor=n.LineSegments,n.Mesh=function(t,e){n.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new n.Geometry,this.material=void 0!==e?e:new n.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},n.Mesh.prototype=Object.create(n.Object3D.prototype),n.Mesh.prototype.constructor=n.Mesh,n.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,e=this.geometry.morphTargets.length;e>t;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}},n.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},n.Mesh.prototype.raycast=function(){function t(t,e,r,i,o,a,s){return n.Triangle.barycoordFromPoint(t,e,r,i,d),o.multiplyScalar(d.x),a.multiplyScalar(d.y),s.multiplyScalar(d.z),o.add(a).add(s),o.clone()}var e=new n.Matrix4,r=new n.Ray,i=new n.Sphere,o=new n.Vector3,a=new n.Vector3,s=new n.Vector3,h=new n.Vector3,c=new n.Vector3,u=new n.Vector3,l=new n.Vector2,f=new n.Vector2,p=new n.Vector2,d=new n.Vector3,m=new n.Vector3,g=new n.Vector3;return function(d,v){var y=this.geometry,b=this.material;if(void 0!==b&&(null===y.boundingSphere&&y.computeBoundingSphere(),i.copy(y.boundingSphere),i.applyMatrix4(this.matrixWorld),d.ray.isIntersectionSphere(i)!==!1&&(e.getInverse(this.matrixWorld),r.copy(d.ray).applyMatrix4(e),null===y.boundingBox||r.isIntersectionBox(y.boundingBox)!==!1))){var x,w,M;if(y instanceof n.BufferGeometry){var S=y.index,_=y.attributes;if(null!==S)for(var E=S.array,T=_.position.array,C=0,A=E.length;A>C;C+=3){if(x=E[C],w=E[C+1],M=E[C+2],o.fromArray(T,3*x),a.fromArray(T,3*w),s.fromArray(T,3*M),b.side===n.BackSide){if(null===r.intersectTriangle(s,a,o,!0,m))continue}else if(null===r.intersectTriangle(o,a,s,b.side!==n.DoubleSide,m))continue;g.copy(m),g.applyMatrix4(this.matrixWorld);var L=d.ray.origin.distanceTo(g);if(!(L<d.near||L>d.far)){var P;if(void 0!==_.uv){var F=_.uv.array;l.fromArray(F,2*x),f.fromArray(F,2*w),p.fromArray(F,2*M),P=t(m,o,a,s,l,f,p)}v.push({distance:L,point:g.clone(),uv:P,face:new n.Face3(x,w,M,n.Triangle.normal(o,a,s)),faceIndex:Math.floor(C/3),object:this})}}else for(var T=_.position.array,C=0,A=T.length;A>C;C+=9){if(o.fromArray(T,C),a.fromArray(T,C+3),s.fromArray(T,C+6),b.side===n.BackSide){if(null===r.intersectTriangle(s,a,o,!0,m))continue}else if(null===r.intersectTriangle(o,a,s,b.side!==n.DoubleSide,m))continue;g.copy(m),g.applyMatrix4(this.matrixWorld);var L=d.ray.origin.distanceTo(g);if(!(L<d.near||L>d.far)){var P;if(void 0!==_.uv){var F=_.uv.array;l.fromArray(F,C),f.fromArray(F,C+2),p.fromArray(F,C+4),P=t(m,o,a,s,l,f,p)}x=C/3,w=x+1,M=x+2,v.push({distance:L,point:g.clone(),uv:P,face:new n.Face3(x,w,M,n.Triangle.normal(o,a,s)),index:x,object:this})}}}else if(y instanceof n.Geometry)for(var R=b instanceof n.MeshFaceMaterial,k=R===!0?b.materials:null,O=y.vertices,D=y.faces,U=0,B=D.length;B>U;U++){var I=D[U],N=R===!0?k[I.materialIndex]:b;if(void 0!==N){if(x=O[I.a],w=O[I.b],M=O[I.c],N.morphTargets===!0){var V=y.morphTargets,G=this.morphTargetInfluences;o.set(0,0,0),a.set(0,0,0),s.set(0,0,0);for(var z=0,j=V.length;j>z;z++){var H=G[z];if(0!==H){var W=V[z].vertices;o.addScaledVector(h.subVectors(W[I.a],x),H),a.addScaledVector(c.subVectors(W[I.b],w),H),s.addScaledVector(u.subVectors(W[I.c],M),H)}}o.add(x),a.add(w),s.add(M),x=o,w=a,M=s}if(N.side===n.BackSide){if(null===r.intersectTriangle(M,w,x,!0,m))continue}else if(null===r.intersectTriangle(x,w,M,N.side!==n.DoubleSide,m))continue;g.copy(m),g.applyMatrix4(this.matrixWorld);var L=d.ray.origin.distanceTo(g);if(!(L<d.near||L>d.far)){var P;if(y.faceVertexUvs[0].length>0){var F=y.faceVertexUvs[0][U];l.copy(F[0]),f.copy(F[1]),p.copy(F[2]),P=t(m,x,w,M,l,f,p)}v.push({distance:L,point:g.clone(),uv:P,face:I,faceIndex:U,object:this})}}}}}}(),n.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},n.Mesh.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),e.object.geometry=this.geometry.uuid,e.object.material=this.material.uuid,e},n.Bone=function(t){n.Object3D.call(this),this.type="Bone",this.skin=t},n.Bone.prototype=Object.create(n.Object3D.prototype),n.Bone.prototype.constructor=n.Bone,n.Bone.prototype.copy=function(t){return n.Object3D.prototype.copy.call(this,t),this.skin=t.skin,this},n.Skeleton=function(t,e,r){if(this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new n.Matrix4,t=t||[],this.bones=t.slice(0),this.useVertexTexture){var i=Math.sqrt(4*this.bones.length);i=n.Math.nextPowerOfTwo(Math.ceil(i)),i=Math.max(i,4),this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new n.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,n.RGBAFormat,n.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var o=0,a=this.bones.length;a>o;o++)this.boneInverses.push(new n.Matrix4)}},n.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var t=0,e=this.bones.length;e>t;t++){var r=new n.Matrix4;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},n.Skeleton.prototype.pose=function(){for(var t,e=0,r=this.bones.length;r>e;e++)t=this.bones[e],t&&t.matrixWorld.getInverse(this.boneInverses[e]);for(var e=0,r=this.bones.length;r>e;e++)t=this.bones[e],t&&(t.parent?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},n.Skeleton.prototype.update=function(){var t=new n.Matrix4;return function(){for(var e=0,r=this.bones.length;r>e;e++){var n=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;t.multiplyMatrices(n,this.boneInverses[e]),t.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),n.Skeleton.prototype.clone=function(){return new n.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},n.SkinnedMesh=function(t,e,r){n.Mesh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new n.Matrix4,this.bindMatrixInverse=new n.Matrix4;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var o,a,s=0,h=this.geometry.bones.length;h>s;++s)a=this.geometry.bones[s],o=new n.Bone(this),i.push(o),o.name=a.name,o.position.fromArray(a.pos),o.quaternion.fromArray(a.rotq),void 0!==a.scl&&o.scale.fromArray(a.scl);for(var s=0,h=this.geometry.bones.length;h>s;++s)a=this.geometry.bones[s],
-1!==a.parent?i[a.parent].add(i[s]):this.add(i[s])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new n.Skeleton(i,void 0,r),this.matrixWorld)},n.SkinnedMesh.prototype=Object.create(n.Mesh.prototype),n.SkinnedMesh.prototype.constructor=n.SkinnedMesh,n.SkinnedMesh.prototype.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},n.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},n.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof n.Geometry)for(var t=0;t<this.geometry.skinIndices.length;t++){var e=this.geometry.skinWeights[t],r=1/e.lengthManhattan();r!==1/0?e.multiplyScalar(r):e.set(1)}},n.SkinnedMesh.prototype.updateMatrixWorld=function(t){n.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},n.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},n.MorphAnimMesh=function(t,e){n.Mesh.call(this,t,e),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,t.morphTargets.length-1)},n.MorphAnimMesh.prototype=Object.create(n.Mesh.prototype),n.MorphAnimMesh.prototype.constructor=n.MorphAnimMesh,n.MorphAnimMesh.prototype.setFrameRange=function(t,e){this.startKeyframe=t,this.endKeyframe=e,this.length=this.endKeyframe-this.startKeyframe+1},n.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},n.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},n.MorphAnimMesh.prototype.parseAnimations=function(){var t=this.geometry;t.animations||(t.animations={});for(var e,r=t.animations,n=/([a-z]+)_?(\d+)/,i=0,o=t.morphTargets.length;o>i;i++){var a=t.morphTargets[i],s=a.name.match(n);if(s&&s.length>1){var h=s[1];r[h]||(r[h]={start:1/0,end:-(1/0)});var c=r[h];i<c.start&&(c.start=i),i>c.end&&(c.end=i),e||(e=h)}}t.firstAnimation=e},n.MorphAnimMesh.prototype.setAnimationLabel=function(t,e,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[t]={start:e,end:r}},n.MorphAnimMesh.prototype.playAnimation=function(t,e){var r=this.geometry.animations[t];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/e),this.time=0):console.warn("THREE.MorphAnimMesh: animation["+t+"] undefined in .playAnimation()")},n.MorphAnimMesh.prototype.updateAnimation=function(t){var e=this.duration/this.length;this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+n.Math.clamp(Math.floor(this.time/e),0,this.length-1),i=this.morphTargetInfluences;r!==this.currentKeyframe&&(i[this.lastKeyframe]=0,i[this.currentKeyframe]=1,i[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var o=this.time%e/e;this.directionBackwards&&(o=1-o),i[this.currentKeyframe]=o,i[this.lastKeyframe]=1-o},n.MorphAnimMesh.prototype.interpolateTargets=function(t,e,r){for(var n=this.morphTargetInfluences,i=0,o=n.length;o>i;i++)n[i]=0;t>-1&&(n[t]=1-r),e>-1&&(n[e]=r)},n.MorphAnimMesh.prototype.copy=function(t){return n.Mesh.prototype.copy.call(this,t),this.duration=t.duration,this.mirroredLoop=t.mirroredLoop,this.time=t.time,this.lastKeyframe=t.lastKeyframe,this.currentKeyframe=t.currentKeyframe,this.direction=t.direction,this.directionBackwards=t.directionBackwards,this},n.LOD=function(){n.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},n.LOD.prototype=Object.create(n.Object3D.prototype),n.LOD.prototype.constructor=n.LOD,n.LOD.prototype.addLevel=function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);r.splice(n,0,{distance:e,object:t}),this.add(t)},n.LOD.prototype.getObjectForDistance=function(t){for(var e=this.levels,r=1,n=e.length;n>r&&!(t<e[r].distance);r++);return e[r-1].object},n.LOD.prototype.raycast=function(){var t=new n.Vector3;return function(e,r){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,r)}}(),n.LOD.prototype.update=function(){var t=new n.Vector3,e=new n.Vector3;return function(r){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var i=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,a=n.length;a>o&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;a>o;o++)n[o].object.visible=!1}}}(),n.LOD.prototype.copy=function(t){n.Object3D.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,i=e.length;i>r;r++){var o=e[r];this.addLevel(o.object.clone(),o.distance)}return this},n.LOD.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,i=0,o=r.length;o>i;i++){var a=r[i];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e},n.Sprite=function(){var t=new Uint16Array([0,1,2,0,2,3]),e=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),i=new n.BufferGeometry;return i.setIndex(new n.BufferAttribute(t,1)),i.addAttribute("position",new n.BufferAttribute(e,3)),i.addAttribute("uv",new n.BufferAttribute(r,2)),function(t){n.Object3D.call(this),this.type="Sprite",this.geometry=i,this.material=void 0!==t?t:new n.SpriteMaterial}}(),n.Sprite.prototype=Object.create(n.Object3D.prototype),n.Sprite.prototype.constructor=n.Sprite,n.Sprite.prototype.raycast=function(){var t=new n.Vector3;return function(e,r){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.distanceSqToPoint(t),i=this.scale.x*this.scale.y;n>i||r.push({distance:Math.sqrt(n),point:this.position,face:null,object:this})}}(),n.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},n.Sprite.prototype.toJSON=function(t){var e=n.Object3D.prototype.toJSON.call(this,t);return void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON()),e.object.material=this.material.uuid,e},n.Particle=n.Sprite,n.LensFlare=function(t,e,r,i,o){n.Object3D.call(this),this.lensFlares=[],this.positionScreen=new n.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,r,i,o)},n.LensFlare.prototype=Object.create(n.Object3D.prototype),n.LensFlare.prototype.constructor=n.LensFlare,n.LensFlare.prototype.add=function(t,e,r,i,o,a){void 0===e&&(e=-1),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=new n.Color(16777215)),void 0===i&&(i=n.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:t,size:e,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:o,blending:i})},n.LensFlare.prototype.updateLensFlares=function(){var t,e,r=this.lensFlares.length,n=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(t=0;r>t;t++)e=this.lensFlares[t],e.x=this.positionScreen.x+n*e.distance,e.y=this.positionScreen.y+i*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)},n.LensFlare.prototype.copy=function(t){n.Object3D.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,r=t.lensFlares.length;r>e;e++)this.lensFlares.push(t.lensFlares[e]);return this},n.Scene=function(){n.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},n.Scene.prototype=Object.create(n.Object3D.prototype),n.Scene.prototype.constructor=n.Scene,n.Scene.prototype.copy=function(t){return n.Object3D.prototype.copy.call(this,t),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},n.Fog=function(t,e,r){this.name="",this.color=new n.Color(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3},n.Fog.prototype.clone=function(){return new n.Fog(this.color.getHex(),this.near,this.far)},n.FogExp2=function(t,e){this.name="",this.color=new n.Color(t),this.density=void 0!==e?e:25e-5},n.FogExp2.prototype.clone=function(){return new n.FogExp2(this.color.getHex(),this.density)},n.ShaderChunk={},n.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",n.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",n.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",n.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n	totalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",n.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif",n.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",n.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",n.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",n.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",n.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",n.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",n.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif",n.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n	// Original approximation by Christophe Schlick '94\n	//;float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n	// Optimized variant (presented by Epic at SIGGRAPH '13)\n	float fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n	// geometry term is (n⋅l)(n⋅v) / 4(n⋅l)(n⋅v)\n\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n	// factor of 1/PI in distribution term omitted\n\n	return ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n	vec3 halfDir = normalize( lightDir + viewDir );\n\n	//float dotNL = saturate( dot( normal, lightDir ) );\n	//float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotLH = saturate( dot( lightDir, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n",n.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",n.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",n.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n",n.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",n.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n",n.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",n.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",n.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",n.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",n.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",n.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",n.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	totalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n",n.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif",n.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n",n.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		// attenuation\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n			// attenuation\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n			// diffuse\n\n			float dotProduct = dot( normal, lightDir );\n\n			vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			float hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack += ambientLightColor;\n\n#endif\n",n.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lightPosition = pointLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		// attenuation\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		// diffuse\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n		// specular\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n			// attenuation\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n			// diffuse\n\n			float cosineTerm = saturate( dot( normal, lightDir ) );\n\n			totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n			// specular\n\n			vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n			totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n		// diffuse\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * cosineTerm;\n\n		// specular\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalDiffuseLight += lightColor;\n\n		// specular (sky term only)\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * max( dotProduct, 0.0 );\n\n	}\n\n#endif\n\n#ifdef METAL\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\n\n#else\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\n\n#endif\n",n.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n",n.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",n.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n",n.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",n.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",n.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n",n.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",n.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",n.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n",n.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",n.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",n.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",n.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",n.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",n.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n",n.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",n.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",
n.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			if ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n		#endif\n\n	}\n\n	outgoingLight = outgoingLight * shadowColor;\n\n#endif\n",n.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",n.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",n.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",n.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",n.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",n.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",n.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",n.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",n.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",n.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif",n.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif",n.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif",n.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n\n#endif",n.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",n.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",n.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n",n.UniformsUtils={merge:function(t){for(var e={},r=0;r<t.length;r++){var n=this.clone(t[r]);for(var i in n)e[i]=n[i]}return e},clone:function(t){var e={};for(var r in t){e[r]={};for(var i in t[r]){var o=t[r][i];o instanceof n.Color||o instanceof n.Vector2||o instanceof n.Vector3||o instanceof n.Vector4||o instanceof n.Matrix3||o instanceof n.Matrix4||o instanceof n.Texture?e[r][i]=o.clone():Array.isArray(o)?e[r][i]=o.slice():e[r][i]=o}}return e}},n.UniformsLib={common:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new n.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},n.ShaderLib={basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.fog,n.UniformsLib.shadowmap]),vertexShader:[n.ShaderChunk.common,n.ShaderChunk.uv_pars_vertex,n.ShaderChunk.uv2_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.uv_vertex,n.ShaderChunk.uv2_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",n.ShaderChunk.beginnormal_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"	#endif",n.ShaderChunk.begin_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.project_vertex,n.ShaderChunk.logdepthbuf_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.uv_pars_fragment,n.ShaderChunk.uv2_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.alphamap_pars_fragment,n.ShaderChunk.aomap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = vec3( 1.0 );",n.ShaderChunk.logdepthbuf_fragment,n.ShaderChunk.map_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.alphamap_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.aomap_fragment,"	outgoingLight = diffuseColor.rgb * totalAmbientLight;",n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{emissive:{type:"c",value:new n.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",n.ShaderChunk.common,n.ShaderChunk.uv_pars_vertex,n.ShaderChunk.uv2_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.lights_lambert_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.uv_vertex,n.ShaderChunk.uv2_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.beginnormal_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,n.ShaderChunk.begin_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.project_vertex,n.ShaderChunk.logdepthbuf_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.lights_lambert_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.uv_pars_fragment,n.ShaderChunk.uv2_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.alphamap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",n.ShaderChunk.logdepthbuf_fragment,n.ShaderChunk.map_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.alphamap_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * vLightFront + emissive;","		else","			outgoingLight += diffuseColor.rgb * vLightBack + emissive;","	#else","		outgoingLight += diffuseColor.rgb * vLightFront + emissive;","	#endif",n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.displacementmap,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",n.ShaderChunk.common,n.ShaderChunk.uv_pars_vertex,n.ShaderChunk.uv2_pars_vertex,n.ShaderChunk.displacementmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.lights_phong_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.uv_vertex,n.ShaderChunk.uv2_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.beginnormal_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",n.ShaderChunk.begin_vertex,n.ShaderChunk.displacementmap_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.project_vertex,n.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.lights_phong_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.uv_pars_fragment,n.ShaderChunk.uv2_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.alphamap_pars_fragment,n.ShaderChunk.aomap_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.emissivemap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.lights_phong_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.bumpmap_pars_fragment,n.ShaderChunk.normalmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 totalEmissiveLight = emissive;",n.ShaderChunk.logdepthbuf_fragment,n.ShaderChunk.map_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.alphamap_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.aomap_fragment,n.ShaderChunk.emissivemap_fragment,n.ShaderChunk.lights_phong_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:n.UniformsUtils.merge([n.UniformsLib.points,n.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",n.ShaderChunk.common,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk.logdepthbuf_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_particle_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );",n.ShaderChunk.logdepthbuf_fragment,n.ShaderChunk.map_particle_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.alphatest_fragment,"	outgoingLight = diffuseColor.rgb;",n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",n.ShaderChunk.common,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",n.ShaderChunk.common,n.ShaderChunk.color_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",n.ShaderChunk.logdepthbuf_fragment,n.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",n.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[n.ShaderChunk.common,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.begin_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.project_vertex,n.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",n.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",n.ShaderChunk.common,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",n.ShaderChunk.begin_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.project_vertex,n.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",n.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",n.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",n.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",n.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",n.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[n.ShaderChunk.common,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.begin_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.project_vertex,n.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[n.ShaderChunk.common,n.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",n.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}},n.WebGLRenderer=function(t){function e(t,e,r,n){ot===!0&&(t*=n,e*=n,r*=n),zt.clearColor(t,e,r,n)}function r(){qt.init(),zt.viewport(At,Lt,Pt,Ft),e(st.r,st.g,st.b,ht)}function i(){Mt=null,Tt=null,Et="",_t=-1,It=!0,qt.reset()}function o(t){t.preventDefault(),i(),r(),Kt.clear()}function a(t){var e=t.target;e.removeEventListener("dispose",a),c(e),Vt.textures--}function s(t){var e=t.target;e.removeEventListener("dispose",s),u(e),Vt.textures--}function h(t){var e=t.target;e.removeEventListener("dispose",h),l(e)}function c(t){var e=Kt.get(t);if(t.image&&e.__image__webglTextureCube)zt.deleteTexture(e.__image__webglTextureCube);else{if(void 0===e.__webglInit)return;zt.deleteTexture(e.__webglTexture)}Kt["delete"](t)}function u(t){var e=Kt.get(t);if(t&&void 0!==e.__webglTexture){if(zt.deleteTexture(e.__webglTexture),t instanceof n.WebGLRenderTargetCube)for(var r=0;6>r;r++)zt.deleteFramebuffer(e.__webglFramebuffer[r]),zt.deleteRenderbuffer(e.__webglRenderbuffer[r]);else zt.deleteFramebuffer(e.__webglFramebuffer),zt.deleteRenderbuffer(e.__webglRenderbuffer);Kt["delete"](t)}}function l(t){f(t),Kt["delete"](t)}function f(t){var e=Kt.get(t).program;t.program=void 0,void 0!==e&&Qt.releaseProgram(e)}function p(t,e,r,i){var o;if(r instanceof n.InstancedBufferGeometry&&(o=Wt.get("ANGLE_instanced_arrays"),null===o))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0),qt.initAttributes();var a=r.attributes,s=e.getAttributes(),h=t.defaultAttributeValues;for(var c in s){var u=s[c];if(u>=0){var l=a[c];if(void 0!==l){qt.enableAttribute(u);var f=l.itemSize,p=Yt.getAttributeBuffer(l);if(l instanceof n.InterleavedBufferAttribute){var d=l.data,m=d.stride,g=l.offset;if(zt.bindBuffer(zt.ARRAY_BUFFER,p),zt.vertexAttribPointer(u,f,zt.FLOAT,!1,m*d.array.BYTES_PER_ELEMENT,(i*m+g)*d.array.BYTES_PER_ELEMENT),d instanceof n.InstancedInterleavedBuffer){if(null===o)return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.");o.vertexAttribDivisorANGLE(u,d.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=d.meshPerAttribute*d.count)}}else if(zt.bindBuffer(zt.ARRAY_BUFFER,p),zt.vertexAttribPointer(u,f,zt.FLOAT,!1,0,i*f*4),l instanceof n.InstancedBufferAttribute){if(null===o)return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.");o.vertexAttribDivisorANGLE(u,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)}}else if(void 0!==h){var v=h[c];if(void 0!==v)switch(v.length){case 2:zt.vertexAttrib2fv(u,v);break;case 3:zt.vertexAttrib3fv(u,v);break;case 4:zt.vertexAttrib4fv(u,v);break;default:zt.vertexAttrib1fv(u,v)}}}}qt.disableUnusedAttributes()}function d(t,e){return e[0]-t[0]}function m(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function g(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function v(t){var e,r;t.material.transparent?(e=gt,r=++vt):(e=dt,r=++mt),r<e.length?e[r]=t:e.push(t)}function y(t,e,r,n,i){
var o,a;r.transparent?(o=ft,a=++pt):(o=ut,a=++lt);var s=o[a];void 0!==s?(s.id=t.id,s.object=t,s.geometry=e,s.material=r,s.z=Ut.z,s.group=i):(s={id:t.id,object:t,geometry:e,material:r,z:Ut.z,group:i},o.push(s))}function b(t){if(t.visible!==!1){if(t instanceof n.Light)ct.push(t);else if(t instanceof n.Sprite)bt.push(t);else if(t instanceof n.LensFlare)xt.push(t);else if(t instanceof n.ImmediateRenderObject)v(t);else if((t instanceof n.Mesh||t instanceof n.Line||t instanceof n.Points)&&(t instanceof n.SkinnedMesh&&t.skeleton.update(),t.frustumCulled===!1||Ot.intersectsObject(t)===!0)){var e=t.material;if(e.visible===!0){wt.sortObjects===!0&&(Ut.setFromMatrixPosition(t.matrixWorld),Ut.applyProjection(Dt));var r=Yt.update(t);if(e instanceof n.MeshFaceMaterial)for(var i=r.groups,o=e.materials,a=0,s=i.length;s>a;a++){var h=i[a],c=o[h.materialIndex];c.visible===!0&&y(t,r,c,Ut.z,h)}else y(t,r,e,Ut.z)}}for(var u=t.children,a=0,s=u.length;s>a;a++)b(u[a])}}function x(t,e,r,n,i){for(var o=0,a=t.length;a>o;o++){var s=t[o],h=s.object,c=s.geometry,u=void 0===i?s.material:i,l=s.group;h.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),wt.renderBufferDirect(e,r,n,c,u,h,l)}}function w(t,e,r,n,i){for(var o=i,a=0,s=t.length;s>a;a++){var h=t[a];h.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),void 0===i&&(o=h.material),S(o);var c=E(e,r,n,o,h);Et="",h.render(function(t){wt.renderBufferImmediate(t,c,o)})}}function M(t,e,r,i){var o=Kt.get(t),a=Qt.getParameters(t,e,r,i),s=Qt.getProgramCode(t,a),c=o.program,u=!0;if(void 0===c)t.addEventListener("dispose",h);else if(c.code!==s)f(t);else{if(void 0!==a.shaderID)return;u=!1}if(u){if(a.shaderID){var l=n.ShaderLib[a.shaderID];o.__webglShader={name:t.type,uniforms:n.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else o.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=o.__webglShader,c=Qt.acquireProgram(t,a,s),o.program=c,t.program=c}var p=c.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<wt.maxMorphTargets;d++)p["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals)for(t.numSupportedMorphNormals=0,d=0;d<wt.maxMorphNormals;d++)p["morphNormal"+d]>=0&&t.numSupportedMorphNormals++;o.uniformsList=[];var m=o.program.getUniforms();for(var g in o.__webglShader.uniforms){var v=m[g];v&&o.uniformsList.push([o.__webglShader.uniforms[g],v])}}function S(t){_(t),t.transparent===!0?qt.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha):qt.setBlending(n.NoBlending),qt.setDepthFunc(t.depthFunc),qt.setDepthTest(t.depthTest),qt.setDepthWrite(t.depthWrite),qt.setColorWrite(t.colorWrite),qt.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function _(t){t.side!==n.DoubleSide?qt.enable(zt.CULL_FACE):qt.disable(zt.CULL_FACE),qt.setFlipSided(t.side===n.BackSide)}function E(t,e,r,i,o){Ct=0;var a=Kt.get(i);(i.needsUpdate||!a.program)&&(M(i,e,r,o),i.needsUpdate=!1);var s=!1,h=!1,c=!1,u=a.program,l=u.getUniforms(),f=a.__webglShader.uniforms;if(u.id!==Mt&&(zt.useProgram(u.program),Mt=u.id,s=!0,h=!0,c=!0),i.id!==_t&&(-1===_t&&(c=!0),_t=i.id,h=!0),(s||t!==Tt)&&(zt.uniformMatrix4fv(l.projectionMatrix,!1,t.projectionMatrix.elements),Xt.logarithmicDepthBuffer&&zt.uniform1f(l.logDepthBufFC,2/(Math.log(t.far+1)/Math.LN2)),t!==Tt&&(Tt=t),(i instanceof n.ShaderMaterial||i instanceof n.MeshPhongMaterial||i.envMap)&&void 0!==l.cameraPosition&&(Ut.setFromMatrixPosition(t.matrixWorld),zt.uniform3f(l.cameraPosition,Ut.x,Ut.y,Ut.z)),(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshBasicMaterial||i instanceof n.ShaderMaterial||i.skinning)&&void 0!==l.viewMatrix&&zt.uniformMatrix4fv(l.viewMatrix,!1,t.matrixWorldInverse.elements)),i.skinning)if(o.bindMatrix&&void 0!==l.bindMatrix&&zt.uniformMatrix4fv(l.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&void 0!==l.bindMatrixInverse&&zt.uniformMatrix4fv(l.bindMatrixInverse,!1,o.bindMatrixInverse.elements),Xt.floatVertexTextures&&o.skeleton&&o.skeleton.useVertexTexture){if(void 0!==l.boneTexture){var p=U();zt.uniform1i(l.boneTexture,p),wt.setTexture(o.skeleton.boneTexture,p)}void 0!==l.boneTextureWidth&&zt.uniform1i(l.boneTextureWidth,o.skeleton.boneTextureWidth),void 0!==l.boneTextureHeight&&zt.uniform1i(l.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&void 0!==l.boneGlobalMatrices&&zt.uniformMatrix4fv(l.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return h&&(r&&i.fog&&P(f,r),(i instanceof n.MeshPhongMaterial||i instanceof n.MeshLambertMaterial||i.lights)&&(It&&(c=!0,N(e,t),It=!1),c?(R(f,Nt),k(f,!0)):k(f,!1)),(i instanceof n.MeshBasicMaterial||i instanceof n.MeshLambertMaterial||i instanceof n.MeshPhongMaterial)&&T(f,i),i instanceof n.LineBasicMaterial?C(f,i):i instanceof n.LineDashedMaterial?(C(f,i),A(f,i)):i instanceof n.PointsMaterial?L(f,i):i instanceof n.MeshPhongMaterial?F(f,i):i instanceof n.MeshDepthMaterial?(f.mNear.value=t.near,f.mFar.value=t.far,f.opacity.value=i.opacity):i instanceof n.MeshNormalMaterial&&(f.opacity.value=i.opacity),o.receiveShadow&&!i._shadowPass&&O(f,e),B(a.uniformsList)),D(l,o),void 0!==l.modelMatrix&&zt.uniformMatrix4fv(l.modelMatrix,!1,o.matrixWorld.elements),u}function T(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&(t.emissive.value=e.emissive),t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var r;if(e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r){var i=r.offset,o=r.repeat;t.offsetRepeat.value.set(i.x,i.y,o.x,o.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap instanceof n.WebGLRenderTargetCube?1:-1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}function C(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function A(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function L(t,e){if(t.psColor.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size,t.scale.value=Q.height/2,t.map.value=e.map,null!==e.map){var r=e.map.offset,n=e.map.repeat;t.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}}function P(t,e){t.fogColor.value=e.color,e instanceof n.Fog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e instanceof n.FogExp2&&(t.fogDensity.value=e.density)}function F(t,e){t.specular.value=e.specular,t.shininess.value=e.shininess,e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function R(t,e){t.ambientLightColor.value=e.ambient,t.directionalLightColor.value=e.directional.colors,t.directionalLightDirection.value=e.directional.positions,t.pointLightColor.value=e.point.colors,t.pointLightPosition.value=e.point.positions,t.pointLightDistance.value=e.point.distances,t.pointLightDecay.value=e.point.decays,t.spotLightColor.value=e.spot.colors,t.spotLightPosition.value=e.spot.positions,t.spotLightDistance.value=e.spot.distances,t.spotLightDirection.value=e.spot.directions,t.spotLightAngleCos.value=e.spot.anglesCos,t.spotLightExponent.value=e.spot.exponents,t.spotLightDecay.value=e.spot.decays,t.hemisphereLightSkyColor.value=e.hemi.skyColors,t.hemisphereLightGroundColor.value=e.hemi.groundColors,t.hemisphereLightDirection.value=e.hemi.positions}function k(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLightColor.needsUpdate=e,t.directionalLightDirection.needsUpdate=e,t.pointLightColor.needsUpdate=e,t.pointLightPosition.needsUpdate=e,t.pointLightDistance.needsUpdate=e,t.pointLightDecay.needsUpdate=e,t.spotLightColor.needsUpdate=e,t.spotLightPosition.needsUpdate=e,t.spotLightDistance.needsUpdate=e,t.spotLightDirection.needsUpdate=e,t.spotLightAngleCos.needsUpdate=e,t.spotLightExponent.needsUpdate=e,t.spotLightDecay.needsUpdate=e,t.hemisphereLightSkyColor.needsUpdate=e,t.hemisphereLightGroundColor.needsUpdate=e,t.hemisphereLightDirection.needsUpdate=e}function O(t,e){if(t.shadowMatrix)for(var r=0,i=0,o=e.length;o>i;i++){var a=e[i];a.castShadow&&(a instanceof n.SpotLight||a instanceof n.DirectionalLight)&&(t.shadowMap.value[r]=a.shadowMap,t.shadowMapSize.value[r]=a.shadowMapSize,t.shadowMatrix.value[r]=a.shadowMatrix,t.shadowDarkness.value[r]=a.shadowDarkness,t.shadowBias.value[r]=a.shadowBias,r++)}}function D(t,e){zt.uniformMatrix4fv(t.modelViewMatrix,!1,e.modelViewMatrix.elements),t.normalMatrix&&zt.uniformMatrix3fv(t.normalMatrix,!1,e.normalMatrix.elements)}function U(){var t=Ct;return t>=Xt.maxTextures&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+Xt.maxTextures),Ct+=1,t}function B(t){for(var e,r,i=0,o=t.length;o>i;i++){var a=t[i][0];if(a.needsUpdate!==!1){var s=a.type,h=a.value,c=t[i][1];switch(s){case"1i":zt.uniform1i(c,h);break;case"1f":zt.uniform1f(c,h);break;case"2f":zt.uniform2f(c,h[0],h[1]);break;case"3f":zt.uniform3f(c,h[0],h[1],h[2]);break;case"4f":zt.uniform4f(c,h[0],h[1],h[2],h[3]);break;case"1iv":zt.uniform1iv(c,h);break;case"3iv":zt.uniform3iv(c,h);break;case"1fv":zt.uniform1fv(c,h);break;case"2fv":zt.uniform2fv(c,h);break;case"3fv":zt.uniform3fv(c,h);break;case"4fv":zt.uniform4fv(c,h);break;case"Matrix3fv":zt.uniformMatrix3fv(c,!1,h);break;case"Matrix4fv":zt.uniformMatrix4fv(c,!1,h);break;case"i":zt.uniform1i(c,h);break;case"f":zt.uniform1f(c,h);break;case"v2":zt.uniform2f(c,h.x,h.y);break;case"v3":zt.uniform3f(c,h.x,h.y,h.z);break;case"v4":zt.uniform4f(c,h.x,h.y,h.z,h.w);break;case"c":zt.uniform3f(c,h.r,h.g,h.b);break;case"iv1":zt.uniform1iv(c,h);break;case"iv":zt.uniform3iv(c,h);break;case"fv1":zt.uniform1fv(c,h);break;case"fv":zt.uniform3fv(c,h);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*h.length));for(var u=0,l=0,f=h.length;f>u;u++,l+=2)a._array[l+0]=h[u].x,a._array[l+1]=h[u].y;zt.uniform2fv(c,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*h.length));for(var u=0,p=0,f=h.length;f>u;u++,p+=3)a._array[p+0]=h[u].x,a._array[p+1]=h[u].y,a._array[p+2]=h[u].z;zt.uniform3fv(c,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*h.length));for(var u=0,d=0,f=h.length;f>u;u++,d+=4)a._array[d+0]=h[u].x,a._array[d+1]=h[u].y,a._array[d+2]=h[u].z,a._array[d+3]=h[u].w;zt.uniform4fv(c,a._array);break;case"m3":zt.uniformMatrix3fv(c,!1,h.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*h.length));for(var u=0,f=h.length;f>u;u++)h[u].flattenToArrayOffset(a._array,9*u);zt.uniformMatrix3fv(c,!1,a._array);break;case"m4":zt.uniformMatrix4fv(c,!1,h.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*h.length));for(var u=0,f=h.length;f>u;u++)h[u].flattenToArrayOffset(a._array,16*u);zt.uniformMatrix4fv(c,!1,a._array);break;case"t":if(e=h,r=U(),zt.uniform1i(c,r),!e)continue;e instanceof n.CubeTexture||Array.isArray(e.image)&&6===e.image.length?j(e,r):e instanceof n.WebGLRenderTargetCube?H(e,r):wt.setTexture(e,r);break;case"tv":void 0===a._array&&(a._array=[]);for(var u=0,f=a.value.length;f>u;u++)a._array[u]=U();zt.uniform1iv(c,a._array);for(var u=0,f=a.value.length;f>u;u++)e=a.value[u],r=a._array[u],e&&wt.setTexture(e,r);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}}function I(t,e,r,n){t[e+0]=r.r*n,t[e+1]=r.g*n,t[e+2]=r.b*n}function N(t,e){var r,i,o,a,s,h,c,u,l=0,f=0,p=0,d=Nt,m=e.matrixWorldInverse,g=d.directional.colors,v=d.directional.positions,y=d.point.colors,b=d.point.positions,x=d.point.distances,w=d.point.decays,M=d.spot.colors,S=d.spot.positions,_=d.spot.distances,E=d.spot.directions,T=d.spot.anglesCos,C=d.spot.exponents,A=d.spot.decays,L=d.hemi.skyColors,P=d.hemi.groundColors,F=d.hemi.positions,R=0,k=0,O=0,D=0,U=0,B=0,N=0,V=0,G=0,z=0,j=0,H=0;for(r=0,i=t.length;i>r;r++)if(o=t[r],!o.onlyShadow)if(a=o.color,c=o.intensity,u=o.distance,o instanceof n.AmbientLight){if(!o.visible)continue;l+=a.r,f+=a.g,p+=a.b}else if(o instanceof n.DirectionalLight){if(U+=1,!o.visible)continue;Bt.setFromMatrixPosition(o.matrixWorld),Ut.setFromMatrixPosition(o.target.matrixWorld),Bt.sub(Ut),Bt.transformDirection(m),G=3*R,v[G+0]=Bt.x,v[G+1]=Bt.y,v[G+2]=Bt.z,I(g,G,a,c),R+=1}else if(o instanceof n.PointLight){if(B+=1,!o.visible)continue;z=3*k,I(y,z,a,c),Ut.setFromMatrixPosition(o.matrixWorld),Ut.applyMatrix4(m),b[z+0]=Ut.x,b[z+1]=Ut.y,b[z+2]=Ut.z,x[k]=u,w[k]=0===o.distance?0:o.decay,k+=1}else if(o instanceof n.SpotLight){if(N+=1,!o.visible)continue;j=3*O,I(M,j,a,c),Bt.setFromMatrixPosition(o.matrixWorld),Ut.copy(Bt).applyMatrix4(m),S[j+0]=Ut.x,S[j+1]=Ut.y,S[j+2]=Ut.z,_[O]=u,Ut.setFromMatrixPosition(o.target.matrixWorld),Bt.sub(Ut),Bt.transformDirection(m),E[j+0]=Bt.x,E[j+1]=Bt.y,E[j+2]=Bt.z,T[O]=Math.cos(o.angle),C[O]=o.exponent,A[O]=0===o.distance?0:o.decay,O+=1}else if(o instanceof n.HemisphereLight){if(V+=1,!o.visible)continue;Bt.setFromMatrixPosition(o.matrixWorld),Bt.transformDirection(m),H=3*D,F[H+0]=Bt.x,F[H+1]=Bt.y,F[H+2]=Bt.z,s=o.color,h=o.groundColor,I(L,H,s,c),I(P,H,h,c),D+=1}for(r=3*R,i=Math.max(g.length,3*U);i>r;r++)g[r]=0;for(r=3*k,i=Math.max(y.length,3*B);i>r;r++)y[r]=0;for(r=3*O,i=Math.max(M.length,3*N);i>r;r++)M[r]=0;for(r=3*D,i=Math.max(L.length,3*V);i>r;r++)L[r]=0;for(r=3*D,i=Math.max(P.length,3*V);i>r;r++)P[r]=0;d.directional.length=R,d.point.length=k,d.spot.length=O,d.hemi.length=D,d.ambient[0]=l,d.ambient[1]=f,d.ambient[2]=p}function V(t,e,r){var i;if(r?(zt.texParameteri(t,zt.TEXTURE_WRAP_S,Y(e.wrapS)),zt.texParameteri(t,zt.TEXTURE_WRAP_T,Y(e.wrapT)),zt.texParameteri(t,zt.TEXTURE_MAG_FILTER,Y(e.magFilter)),zt.texParameteri(t,zt.TEXTURE_MIN_FILTER,Y(e.minFilter))):(zt.texParameteri(t,zt.TEXTURE_WRAP_S,zt.CLAMP_TO_EDGE),zt.texParameteri(t,zt.TEXTURE_WRAP_T,zt.CLAMP_TO_EDGE),(e.wrapS!==n.ClampToEdgeWrapping||e.wrapT!==n.ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+e.sourceFile+" )"),zt.texParameteri(t,zt.TEXTURE_MAG_FILTER,K(e.magFilter)),zt.texParameteri(t,zt.TEXTURE_MIN_FILTER,K(e.minFilter)),e.minFilter!==n.NearestFilter&&e.minFilter!==n.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+e.sourceFile+" )")),i=Wt.get("EXT_texture_filter_anisotropic")){if(e.type===n.FloatType&&null===Wt.get("OES_texture_float_linear"))return;if(e.type===n.HalfFloatType&&null===Wt.get("OES_texture_half_float_linear"))return;(e.anisotropy>1||Kt.get(e).__currentAnisotropy)&&(zt.texParameterf(t,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,wt.getMaxAnisotropy())),Kt.get(e).__currentAnisotropy=e.anisotropy)}}function G(t,e,r){void 0===t.__webglInit&&(t.__webglInit=!0,e.__webglInit=!0,e.addEventListener("dispose",a),t.__webglTexture=zt.createTexture(),Vt.textures++),qt.activeTexture(zt.TEXTURE0+r),qt.bindTexture(zt.TEXTURE_2D,t.__webglTexture),zt.pixelStorei(zt.UNPACK_FLIP_Y_WEBGL,e.flipY),zt.pixelStorei(zt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),zt.pixelStorei(zt.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=z(e.image,Xt.maxTextureSize);var i=e.image,o=n.Math.isPowerOfTwo(i.width)&&n.Math.isPowerOfTwo(i.height),s=Y(e.format),h=Y(e.type);V(zt.TEXTURE_2D,e,o);var c,u=e.mipmaps;if(e instanceof n.DataTexture)if(u.length>0&&o){for(var l=0,f=u.length;f>l;l++)c=u[l],qt.texImage2D(zt.TEXTURE_2D,l,s,c.width,c.height,0,s,h,c.data);e.generateMipmaps=!1}else qt.texImage2D(zt.TEXTURE_2D,0,s,i.width,i.height,0,s,h,i.data);else if(e instanceof n.CompressedTexture)for(var l=0,f=u.length;f>l;l++)c=u[l],e.format!==n.RGBAFormat&&e.format!==n.RGBFormat?qt.getCompressedTextureFormats().indexOf(s)>-1?qt.compressedTexImage2D(zt.TEXTURE_2D,l,s,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qt.texImage2D(zt.TEXTURE_2D,l,s,c.width,c.height,0,s,h,c.data);else if(u.length>0&&o){for(var l=0,f=u.length;f>l;l++)c=u[l],qt.texImage2D(zt.TEXTURE_2D,l,s,s,h,c);e.generateMipmaps=!1}else qt.texImage2D(zt.TEXTURE_2D,0,s,s,h,e.image);e.generateMipmaps&&o&&zt.generateMipmap(zt.TEXTURE_2D),t.__version=e.version,e.onUpdate&&e.onUpdate(e)}function z(t,e){if(t.width>e||t.height>e){var r=e/Math.max(t.width,t.height),n=document.createElement("canvas");n.width=Math.floor(t.width*r),n.height=Math.floor(t.height*r);var i=n.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function j(t,e){var r=Kt.get(t);if(6===t.image.length)if(t.version>0&&r.__version!==t.version){r.__image__webglTextureCube||(t.addEventListener("dispose",a),r.__image__webglTextureCube=zt.createTexture(),Vt.textures++),qt.activeTexture(zt.TEXTURE0+e),qt.bindTexture(zt.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),zt.pixelStorei(zt.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var i=t instanceof n.CompressedTexture,o=t.image[0]instanceof n.DataTexture,s=[],h=0;6>h;h++)!wt.autoScaleCubemaps||i||o?s[h]=o?t.image[h].image:t.image[h]:s[h]=z(t.image[h],Xt.maxCubemapSize);var c=s[0],u=n.Math.isPowerOfTwo(c.width)&&n.Math.isPowerOfTwo(c.height),l=Y(t.format),f=Y(t.type);V(zt.TEXTURE_CUBE_MAP,t,u);for(var h=0;6>h;h++)if(i)for(var p,d=s[h].mipmaps,m=0,g=d.length;g>m;m++)p=d[m],t.format!==n.RGBAFormat&&t.format!==n.RGBFormat?qt.getCompressedTextureFormats().indexOf(l)>-1?qt.compressedTexImage2D(zt.TEXTURE_CUBE_MAP_POSITIVE_X+h,m,l,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):qt.texImage2D(zt.TEXTURE_CUBE_MAP_POSITIVE_X+h,m,l,p.width,p.height,0,l,f,p.data);else o?qt.texImage2D(zt.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,s[h].width,s[h].height,0,l,f,s[h].data):qt.texImage2D(zt.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,l,f,s[h]);t.generateMipmaps&&u&&zt.generateMipmap(zt.TEXTURE_CUBE_MAP),r.__version=t.version,t.onUpdate&&t.onUpdate(t)}else qt.activeTexture(zt.TEXTURE0+e),qt.bindTexture(zt.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}function H(t,e){qt.activeTexture(zt.TEXTURE0+e),qt.bindTexture(zt.TEXTURE_CUBE_MAP,Kt.get(t).__webglTexture)}function W(t,e,r){zt.bindFramebuffer(zt.FRAMEBUFFER,t),zt.framebufferTexture2D(zt.FRAMEBUFFER,zt.COLOR_ATTACHMENT0,r,Kt.get(e).__webglTexture,0)}function X(t,e){zt.bindRenderbuffer(zt.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(zt.renderbufferStorage(zt.RENDERBUFFER,zt.DEPTH_COMPONENT16,e.width,e.height),zt.framebufferRenderbuffer(zt.FRAMEBUFFER,zt.DEPTH_ATTACHMENT,zt.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(zt.renderbufferStorage(zt.RENDERBUFFER,zt.DEPTH_STENCIL,e.width,e.height),zt.framebufferRenderbuffer(zt.FRAMEBUFFER,zt.DEPTH_STENCIL_ATTACHMENT,zt.RENDERBUFFER,t)):zt.renderbufferStorage(zt.RENDERBUFFER,zt.RGBA4,e.width,e.height)}function q(t){t instanceof n.WebGLRenderTargetCube?(qt.bindTexture(zt.TEXTURE_CUBE_MAP,Kt.get(t).__webglTexture),zt.generateMipmap(zt.TEXTURE_CUBE_MAP),qt.bindTexture(zt.TEXTURE_CUBE_MAP,null)):(qt.bindTexture(zt.TEXTURE_2D,Kt.get(t).__webglTexture),zt.generateMipmap(zt.TEXTURE_2D),qt.bindTexture(zt.TEXTURE_2D,null))}function K(t){return t===n.NearestFilter||t===n.NearestMipMapNearestFilter||t===n.NearestMipMapLinearFilter?zt.NEAREST:zt.LINEAR}function Y(t){var e;if(t===n.RepeatWrapping)return zt.REPEAT;if(t===n.ClampToEdgeWrapping)return zt.CLAMP_TO_EDGE;if(t===n.MirroredRepeatWrapping)return zt.MIRRORED_REPEAT;if(t===n.NearestFilter)return zt.NEAREST;if(t===n.NearestMipMapNearestFilter)return zt.NEAREST_MIPMAP_NEAREST;if(t===n.NearestMipMapLinearFilter)return zt.NEAREST_MIPMAP_LINEAR;if(t===n.LinearFilter)return zt.LINEAR;if(t===n.LinearMipMapNearestFilter)return zt.LINEAR_MIPMAP_NEAREST;if(t===n.LinearMipMapLinearFilter)return zt.LINEAR_MIPMAP_LINEAR;if(t===n.UnsignedByteType)return zt.UNSIGNED_BYTE;if(t===n.UnsignedShort4444Type)return zt.UNSIGNED_SHORT_4_4_4_4;if(t===n.UnsignedShort5551Type)return zt.UNSIGNED_SHORT_5_5_5_1;if(t===n.UnsignedShort565Type)return zt.UNSIGNED_SHORT_5_6_5;if(t===n.ByteType)return zt.BYTE;if(t===n.ShortType)return zt.SHORT;if(t===n.UnsignedShortType)return zt.UNSIGNED_SHORT;if(t===n.IntType)return zt.INT;if(t===n.UnsignedIntType)return zt.UNSIGNED_INT;if(t===n.FloatType)return zt.FLOAT;if(e=Wt.get("OES_texture_half_float"),null!==e&&t===n.HalfFloatType)return e.HALF_FLOAT_OES;if(t===n.AlphaFormat)return zt.ALPHA;if(t===n.RGBFormat)return zt.RGB;if(t===n.RGBAFormat)return zt.RGBA;if(t===n.LuminanceFormat)return zt.LUMINANCE;if(t===n.LuminanceAlphaFormat)return zt.LUMINANCE_ALPHA;if(t===n.AddEquation)return zt.FUNC_ADD;if(t===n.SubtractEquation)return zt.FUNC_SUBTRACT;if(t===n.ReverseSubtractEquation)return zt.FUNC_REVERSE_SUBTRACT;if(t===n.ZeroFactor)return zt.ZERO;if(t===n.OneFactor)return zt.ONE;if(t===n.SrcColorFactor)return zt.SRC_COLOR;if(t===n.OneMinusSrcColorFactor)return zt.ONE_MINUS_SRC_COLOR;if(t===n.SrcAlphaFactor)return zt.SRC_ALPHA;if(t===n.OneMinusSrcAlphaFactor)return zt.ONE_MINUS_SRC_ALPHA;if(t===n.DstAlphaFactor)return zt.DST_ALPHA;if(t===n.OneMinusDstAlphaFactor)return zt.ONE_MINUS_DST_ALPHA;if(t===n.DstColorFactor)return zt.DST_COLOR;if(t===n.OneMinusDstColorFactor)return zt.ONE_MINUS_DST_COLOR;if(t===n.SrcAlphaSaturateFactor)return zt.SRC_ALPHA_SATURATE;if(e=Wt.get("WEBGL_compressed_texture_s3tc"),null!==e){if(t===n.RGB_S3TC_DXT1_Format)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===n.RGBA_S3TC_DXT1_Format)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===n.RGBA_S3TC_DXT3_Format)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===n.RGBA_S3TC_DXT5_Format)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e=Wt.get("WEBGL_compressed_texture_pvrtc"),null!==e){if(t===n.RGB_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===n.RGB_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===n.RGBA_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===n.RGBA_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e=Wt.get("EXT_blend_minmax"),null!==e){if(t===n.MinEquation)return e.MIN_EXT;if(t===n.MaxEquation)return e.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",n.REVISION),t=t||{};var Q=void 0!==t.canvas?t.canvas:document.createElement("canvas"),Z=void 0!==t.context?t.context:null,J=Q.width,$=Q.height,tt=1,et=void 0!==t.alpha?t.alpha:!1,rt=void 0!==t.depth?t.depth:!0,nt=void 0!==t.stencil?t.stencil:!0,it=void 0!==t.antialias?t.antialias:!1,ot=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,at=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,st=new n.Color(0),ht=0,ct=[],ut=[],lt=-1,ft=[],pt=-1,dt=[],mt=-1,gt=[],vt=-1,yt=new Float32Array(8),bt=[],xt=[];this.domElement=Q,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var wt=this,Mt=null,St=null,_t=-1,Et="",Tt=null,Ct=0,At=0,Lt=0,Pt=Q.width,Ft=Q.height,Rt=0,kt=0,Ot=new n.Frustum,Dt=new n.Matrix4,Ut=new n.Vector3,Bt=new n.Vector3,It=!0,Nt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Vt={geometries:0,textures:0},Gt={calls:0,vertices:0,faces:0,points:0};this.info={render:Gt,memory:Vt,programs:null};var zt;try{var jt={alpha:et,depth:rt,stencil:nt,antialias:it,premultipliedAlpha:ot,preserveDrawingBuffer:at};if(zt=Z||Q.getContext("webgl",jt)||Q.getContext("experimental-webgl",jt),null===zt)throw null!==Q.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";Q.addEventListener("webglcontextlost",o,!1)}catch(Ht){console.error("THREE.WebGLRenderer: "+Ht)}var Wt=new n.WebGLExtensions(zt);Wt.get("OES_texture_float"),Wt.get("OES_texture_float_linear"),Wt.get("OES_texture_half_float"),Wt.get("OES_texture_half_float_linear"),Wt.get("OES_standard_derivatives"),Wt.get("ANGLE_instanced_arrays"),Wt.get("OES_element_index_uint")&&(n.BufferGeometry.MaxIndex=4294967296);var Xt=new n.WebGLCapabilities(zt,Wt,t),qt=new n.WebGLState(zt,Wt,Y),Kt=new n.WebGLProperties,Yt=new n.WebGLObjects(zt,Kt,this.info),Qt=new n.WebGLPrograms(this,Xt);this.info.programs=Qt.programs;var Zt=new n.WebGLBufferRenderer(zt,Wt,Gt),Jt=new n.WebGLIndexedBufferRenderer(zt,Wt,Gt);r(),this.context=zt,this.capabilities=Xt,this.extensions=Wt,this.state=qt;var $t=new n.WebGLShadowMap(this,ct,Yt);this.shadowMap=$t;var te=new n.SpritePlugin(this,bt),ee=new n.LensFlarePlugin(this,xt);this.getContext=function(){return zt},this.getContextAttributes=function(){return zt.getContextAttributes()},this.forceContextLoss=function(){Wt.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var t;return function(){if(void 0!==t)return t;var e=Wt.get("EXT_texture_filter_anisotropic");return t=null!==e?zt.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return Xt.precision},this.getPixelRatio=function(){return tt},this.setPixelRatio=function(t){void 0!==t&&(tt=t)},this.getSize=function(){return{width:J,height:$}},this.setSize=function(t,e,r){J=t,$=e,Q.width=t*tt,Q.height=e*tt,r!==!1&&(Q.style.width=t+"px",Q.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,r,n){At=t*tt,Lt=e*tt,Pt=r*tt,Ft=n*tt,zt.viewport(At,Lt,Pt,Ft)},this.setScissor=function(t,e,r,n){zt.scissor(t*tt,e*tt,r*tt,n*tt)},this.enableScissorTest=function(t){qt.setScissorTest(t)},this.getClearColor=function(){return st},this.setClearColor=function(t,r){st.set(t),ht=void 0!==r?r:1,e(st.r,st.g,st.b,ht)},this.getClearAlpha=function(){return ht},this.setClearAlpha=function(t){ht=t,e(st.r,st.g,st.b,ht)},this.clear=function(t,e,r){var n=0;(void 0===t||t)&&(n|=zt.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=zt.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=zt.STENCIL_BUFFER_BIT),zt.clear(n)},this.clearColor=function(){zt.clear(zt.COLOR_BUFFER_BIT)},this.clearDepth=function(){zt.clear(zt.DEPTH_BUFFER_BIT)},this.clearStencil=function(){zt.clear(zt.STENCIL_BUFFER_BIT)},this.clearTarget=function(t,e,r,n){this.setRenderTarget(t),this.clear(e,r,n)},this.resetGLState=i,this.dispose=function(){Q.removeEventListener("webglcontextlost",o,!1)},this.renderBufferImmediate=function(t,e,r){qt.initAttributes();var i=Kt.get(t);t.hasPositions&&!i.position&&(i.position=zt.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=zt.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=zt.createBuffer()),t.hasColors&&!i.color&&(i.color=zt.createBuffer());var o=e.getAttributes();if(t.hasPositions&&(zt.bindBuffer(zt.ARRAY_BUFFER,i.position),zt.bufferData(zt.ARRAY_BUFFER,t.positionArray,zt.DYNAMIC_DRAW),qt.enableAttribute(o.position),zt.vertexAttribPointer(o.position,3,zt.FLOAT,!1,0,0)),t.hasNormals){if(zt.bindBuffer(zt.ARRAY_BUFFER,i.normal),"MeshPhongMaterial"!==r.type&&r.shading===n.FlatShading)for(var a=0,s=3*t.count;s>a;a+=9){var h=t.normalArray,c=(h[a+0]+h[a+3]+h[a+6])/3,u=(h[a+1]+h[a+4]+h[a+7])/3,l=(h[a+2]+h[a+5]+h[a+8])/3;h[a+0]=c,h[a+1]=u,h[a+2]=l,h[a+3]=c,h[a+4]=u,h[a+5]=l,h[a+6]=c,h[a+7]=u,h[a+8]=l}zt.bufferData(zt.ARRAY_BUFFER,t.normalArray,zt.DYNAMIC_DRAW),qt.enableAttribute(o.normal),zt.vertexAttribPointer(o.normal,3,zt.FLOAT,!1,0,0)}t.hasUvs&&r.map&&(zt.bindBuffer(zt.ARRAY_BUFFER,i.uv),zt.bufferData(zt.ARRAY_BUFFER,t.uvArray,zt.DYNAMIC_DRAW),qt.enableAttribute(o.uv),zt.vertexAttribPointer(o.uv,2,zt.FLOAT,!1,0,0)),t.hasColors&&r.vertexColors!==n.NoColors&&(zt.bindBuffer(zt.ARRAY_BUFFER,i.color),zt.bufferData(zt.ARRAY_BUFFER,t.colorArray,zt.DYNAMIC_DRAW),qt.enableAttribute(o.color),zt.vertexAttribPointer(o.color,3,zt.FLOAT,!1,0,0)),qt.disableUnusedAttributes(),zt.drawArrays(zt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,i,o,a,s){S(o);var h=E(t,e,r,o,a),c=!1,u=i.id+"_"+h.id+"_"+o.wireframe;u!==Et&&(Et=u,c=!0);var l=a.morphTargetInfluences;if(void 0!==l){for(var f=[],m=0,g=l.length;g>m;m++){var v=l[m];f.push([v,m])}f.sort(d),f.length>8&&(f.length=8);for(var y=i.morphAttributes,m=0,g=f.length;g>m;m++){var v=f[m];if(yt[m]=v[0],0!==v[0]){var b=v[1];o.morphTargets===!0&&y.position&&i.addAttribute("morphTarget"+m,y.position[b]),o.morphNormals===!0&&y.normal&&i.addAttribute("morphNormal"+m,y.normal[b])}else o.morphTargets===!0&&i.removeAttribute("morphTarget"+m),o.morphNormals===!0&&i.removeAttribute("morphNormal"+m)}var x=h.getUniforms();null!==x.morphTargetInfluences&&zt.uniform1fv(x.morphTargetInfluences,yt),c=!0}var b=i.index,w=i.attributes.position;o.wireframe===!0&&(b=Yt.getWireframeAttribute(i));var M;if(null!==b?(M=Jt,M.setIndex(b)):M=Zt,c&&(p(o,h,i),null!==b&&zt.bindBuffer(zt.ELEMENT_ARRAY_BUFFER,Yt.getAttributeBuffer(b))),void 0===s){var _;_=null!==b?b.array.length:w.count;var T=i.drawRange;s={start:T.start,count:Math.min(T.count,_)}}if(a instanceof n.Mesh)o.wireframe===!0?(qt.setLineWidth(o.wireframeLinewidth*tt),M.setMode(zt.LINES)):M.setMode(zt.TRIANGLES),i instanceof n.InstancedBufferGeometry&&i.maxInstancedCount>0?M.renderInstances(i):M.render(s.start,s.count);else if(a instanceof n.Line){var C=o.linewidth;void 0===C&&(C=1),qt.setLineWidth(C*tt),a instanceof n.LineSegments?M.setMode(zt.LINES):M.setMode(zt.LINE_STRIP),M.render(s.start,s.count)}else a instanceof n.Points&&(M.setMode(zt.POINTS),M.render(s.start,s.count))},this.render=function(t,e,r,i){if(e instanceof n.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o=t.fog;if(Et="",_t=-1,Tt=null,It=!0,t.autoUpdate===!0&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),Dt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Ot.setFromMatrix(Dt),ct.length=0,lt=-1,pt=-1,mt=-1,vt=-1,bt.length=0,xt.length=0,b(t),ut.length=lt+1,ft.length=pt+1,dt.length=mt+1,gt.length=vt+1,wt.sortObjects===!0&&(ut.sort(m),ft.sort(g)),$t.render(t,e),Gt.calls=0,Gt.vertices=0,Gt.faces=0,Gt.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),t.overrideMaterial){var a=t.overrideMaterial;x(ut,e,ct,o,a),x(ft,e,ct,o,a),w(dt,e,ct,o,a),w(gt,e,ct,o,a)}else qt.setBlending(n.NoBlending),x(ut,e,ct,o),w(dt,e,ct,o),x(ft,e,ct,o),w(gt,e,ct,o);te.render(t,e),ee.render(t,e,Rt,kt),r&&r.generateMipmaps&&r.minFilter!==n.NearestFilter&&r.minFilter!==n.LinearFilter&&q(r),qt.setDepthTest(!0),qt.setDepthWrite(!0),qt.setColorWrite(!0)},this.setFaceCulling=function(t,e){t===n.CullFaceNone?qt.disable(zt.CULL_FACE):(e===n.FrontFaceDirectionCW?zt.frontFace(zt.CW):zt.frontFace(zt.CCW),t===n.CullFaceBack?zt.cullFace(zt.BACK):t===n.CullFaceFront?zt.cullFace(zt.FRONT):zt.cullFace(zt.FRONT_AND_BACK),qt.enable(zt.CULL_FACE))},this.setTexture=function(t,e){var r=Kt.get(t);if(t.version>0&&r.__version!==t.version){var n=t.image;return void 0===n?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t):n.complete===!1?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t):void G(r,t,e)}qt.activeTexture(zt.TEXTURE0+e),qt.bindTexture(zt.TEXTURE_2D,r.__webglTexture)},this.setRenderTarget=function(t){
var e=t instanceof n.WebGLRenderTargetCube;if(t&&void 0===Kt.get(t).__webglFramebuffer){var r=Kt.get(t);void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",s),r.__webglTexture=zt.createTexture(),Vt.textures++;var i=n.Math.isPowerOfTwo(t.width)&&n.Math.isPowerOfTwo(t.height),o=Y(t.format),a=Y(t.type);if(e){r.__webglFramebuffer=[],r.__webglRenderbuffer=[],qt.bindTexture(zt.TEXTURE_CUBE_MAP,r.__webglTexture),V(zt.TEXTURE_CUBE_MAP,t,i);for(var h=0;6>h;h++)r.__webglFramebuffer[h]=zt.createFramebuffer(),r.__webglRenderbuffer[h]=zt.createRenderbuffer(),qt.texImage2D(zt.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,o,t.width,t.height,0,o,a,null),W(r.__webglFramebuffer[h],t,zt.TEXTURE_CUBE_MAP_POSITIVE_X+h),X(r.__webglRenderbuffer[h],t);t.generateMipmaps&&i&&zt.generateMipmap(zt.TEXTURE_CUBE_MAP)}else r.__webglFramebuffer=zt.createFramebuffer(),t.shareDepthFrom?r.__webglRenderbuffer=t.shareDepthFrom.__webglRenderbuffer:r.__webglRenderbuffer=zt.createRenderbuffer(),qt.bindTexture(zt.TEXTURE_2D,r.__webglTexture),V(zt.TEXTURE_2D,t,i),qt.texImage2D(zt.TEXTURE_2D,0,o,t.width,t.height,0,o,a,null),W(r.__webglFramebuffer,t,zt.TEXTURE_2D),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?zt.framebufferRenderbuffer(zt.FRAMEBUFFER,zt.DEPTH_ATTACHMENT,zt.RENDERBUFFER,r.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&zt.framebufferRenderbuffer(zt.FRAMEBUFFER,zt.DEPTH_STENCIL_ATTACHMENT,zt.RENDERBUFFER,r.__webglRenderbuffer):X(r.__webglRenderbuffer,t),t.generateMipmaps&&i&&zt.generateMipmap(zt.TEXTURE_2D);e?qt.bindTexture(zt.TEXTURE_CUBE_MAP,null):qt.bindTexture(zt.TEXTURE_2D,null),zt.bindRenderbuffer(zt.RENDERBUFFER,null),zt.bindFramebuffer(zt.FRAMEBUFFER,null)}var c,u,l,f,p;if(t){var r=Kt.get(t);c=e?r.__webglFramebuffer[t.activeCubeFace]:r.__webglFramebuffer,u=t.width,l=t.height,f=0,p=0}else c=null,u=Pt,l=Ft,f=At,p=Lt;c!==St&&(zt.bindFramebuffer(zt.FRAMEBUFFER,c),zt.viewport(f,p,u,l),St=c),Rt=u,kt=l},this.readRenderTargetPixels=function(t,e,r,i,o,a){if(!(t instanceof n.WebGLRenderTarget))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(Kt.get(t).__webglFramebuffer){if(t.format!==n.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var s=!1;Kt.get(t).__webglFramebuffer!==St&&(zt.bindFramebuffer(zt.FRAMEBUFFER,Kt.get(t).__webglFramebuffer),s=!0),zt.checkFramebufferStatus(zt.FRAMEBUFFER)===zt.FRAMEBUFFER_COMPLETE?zt.readPixels(e,r,i,o,zt.RGBA,zt.UNSIGNED_BYTE,a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&zt.bindFramebuffer(zt.FRAMEBUFFER,St)}},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),Wt.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),Wt.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),Wt.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),Wt.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),Wt.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),Wt.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return Xt.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),Wt.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return $t.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),$t.enabled=t}},shadowMapType:{get:function(){return $t.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),$t.type=t}},shadowMapCullFace:{get:function(){return $t.cullFace},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),$t.cullFace=t}},shadowMapDebug:{get:function(){return $t.debug},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),$t.debug=t}}})},n.WebGLRenderTarget=function(t,e,r){this.uuid=n.Math.generateUUID(),this.width=t,this.height=e,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:n.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:n.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:n.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:n.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.format=void 0!==r.format?r.format:n.RGBAFormat,this.type=void 0!==r.type?r.type:n.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==r.shareDepthFrom?r.shareDepthFrom:null},n.WebGLRenderTarget.prototype={constructor:n.WebGLRenderTarget,setSize:function(t,e){(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.dispose())},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.format=t.format,this.type=t.type,this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.generateMipmaps=t.generateMipmaps,this.shareDepthFrom=t.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},n.EventDispatcher.prototype.apply(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube=function(t,e,r){n.WebGLRenderTarget.call(this,t,e,r),this.activeCubeFace=0},n.WebGLRenderTargetCube.prototype=Object.create(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube.prototype.constructor=n.WebGLRenderTargetCube,n.WebGLBufferRenderer=function(t,e,r){function i(t){s=t}function o(e,n){t.drawArrays(s,e,n),r.calls++,r.vertices+=n,s===t.TRIANGLES&&(r.faces+=n/3)}function a(t){var r=e.get("ANGLE_instanced_arrays");if(null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var i=t.attributes.position;i instanceof n.InterleavedBufferAttribute?r.drawArraysInstancedANGLE(s,0,i.data.count,t.maxInstancedCount):r.drawArraysInstancedANGLE(s,0,i.count,t.maxInstancedCount)}var s;this.setMode=i,this.render=o,this.renderInstances=a},n.WebGLIndexedBufferRenderer=function(t,e,r){function n(t){s=t}function i(r){r.array instanceof Uint32Array&&e.get("OES_element_index_uint")?(h=t.UNSIGNED_INT,c=4):(h=t.UNSIGNED_SHORT,c=2)}function o(e,n){t.drawElements(s,n,h,e*c),r.calls++,r.vertices+=n,s===t.TRIANGLES&&(r.faces+=n/3)}function a(t){var r=e.get("ANGLE_instanced_arrays");if(null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var n=t.index;r.drawElementsInstancedANGLE(s,n.array.length,h,0,t.maxInstancedCount)}var s,h,c;this.setMode=n,this.setIndex=i,this.render=o,this.renderInstances=a},n.WebGLExtensions=function(t){var e={};this.get=function(r){if(void 0!==e[r])return e[r];var n;switch(r){case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}},n.WebGLCapabilities=function(t,e,r){function n(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=n,this.precision=void 0!==r.precision?r.precision:"highp",this.logarithmicDepthBuffer=void 0!==r.logarithmicDepthBuffer?r.logarithmicDepthBuffer:!1,this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.maxFragmentUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!e.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var i=n(this.precision);i!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",i,"instead."),this.precision=i),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!e.get("EXT_frag_depth"))},n.WebGLGeometries=function(t,e,r){function i(t){var e=t.geometry;if(void 0!==u[e.id])return u[e.id];e.addEventListener("dispose",o);var i;return e instanceof n.BufferGeometry?i=e:e instanceof n.Geometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new n.BufferGeometry).setFromObject(t)),i=e._bufferGeometry),u[e.id]=i,r.memory.geometries++,i}function o(t){var n=t.target,i=u[n.id];h(i.attributes),n.removeEventListener("dispose",o),delete u[n.id];var a=e.get(n);a.wireframe&&s(a.wireframe),r.memory.geometries--}function a(t){return t instanceof n.InterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function s(e){var r=a(e);void 0!==r&&(t.deleteBuffer(r),c(e))}function h(t){for(var e in t)s(t[e])}function c(t){t instanceof n.InterleavedBufferAttribute?e["delete"](t.data):e["delete"](t)}var u={};this.get=i},n.WebGLObjects=function(t,e,r){function i(e){var r=l.get(e);e.geometry instanceof n.Geometry&&r.updateFromObject(e);var i=r.index,a=r.attributes;null!==i&&o(i,t.ELEMENT_ARRAY_BUFFER);for(var s in a)o(a[s],t.ARRAY_BUFFER);var h=r.morphAttributes;for(var s in h)for(var c=h[s],u=0,f=c.length;f>u;u++)o(c[u],t.ARRAY_BUFFER);return r}function o(t,r){var i=t instanceof n.InterleavedBufferAttribute?t.data:t,o=e.get(i);void 0===o.__webglBuffer?a(o,i,r):o.version!==i.version&&s(o,i,r)}function a(e,r,n){e.__webglBuffer=t.createBuffer(),t.bindBuffer(n,e.__webglBuffer);var i=r.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW;t.bufferData(n,r.array,i),e.version=r.version}function s(e,r,n){t.bindBuffer(n,e.__webglBuffer),r.dynamic===!1||-1===r.updateRange.count?t.bufferSubData(n,0,r.array):0===r.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,r.updateRange.offset*r.array.BYTES_PER_ELEMENT,r.array.subarray(r.updateRange.offset,r.updateRange.offset+r.updateRange.count)),r.updateRange.count=0),e.version=r.version}function h(t){return t instanceof n.InterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function c(r){var i=e.get(r);if(void 0!==i.wireframe)return i.wireframe;var a=[],s=r.index,h=r.attributes,c=h.position;if(null!==s)for(var l={},f=s.array,p=0,d=f.length;d>p;p+=3){var m=f[p+0],g=f[p+1],v=f[p+2];u(l,m,g)&&a.push(m,g),u(l,g,v)&&a.push(g,v),u(l,v,m)&&a.push(v,m)}else for(var f=h.position.array,p=0,d=f.length/3-1;d>p;p+=3){var m=p+0,g=p+1,v=p+2;a.push(m,g,g,v,v,m)}var y=c.count>65535?Uint32Array:Uint16Array,b=new n.BufferAttribute(new y(a),1);return o(b,t.ELEMENT_ARRAY_BUFFER),i.wireframe=b,b}function u(t,e,r){if(e>r){var n=e;e=r,r=n}var i=t[e];return void 0===i?(t[e]=[r],!0):-1===i.indexOf(r)?(i.push(r),!0):!1}var l=new n.WebGLGeometries(t,e,r);this.getAttributeBuffer=h,this.getWireframeAttribute=c,this.update=i},n.WebGLProgram=function(){function t(t){var e=[];for(var r in t){var n=t[r];n!==!1&&e.push("#define "+r+" "+n)}return e.join("\n")}function e(t,e,r){for(var n={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=0;i>o;o++){var a=t.getActiveUniform(e,o),s=a.name,h=t.getUniformLocation(e,s),c=s.lastIndexOf("[0]");-1!==c&&c===s.length-3&&(n[s.substr(0,c)]=h),n[s]=h}return n}function r(t,e,r){for(var n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;i>o;o++){var a=t.getActiveAttrib(e,o),s=a.name;n[s]=t.getAttribLocation(e,s)}return n}function i(t){return""!==t}var o=0;return function(a,s,h,c){var u=a.context,l=h.defines,f=h.__webglShader.vertexShader,p=h.__webglShader.fragmentShader,d="SHADOWMAP_TYPE_BASIC";c.shadowMapType===n.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":c.shadowMapType===n.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var m="ENVMAP_TYPE_CUBE",g="ENVMAP_MODE_REFLECTION",v="ENVMAP_BLENDING_MULTIPLY";if(c.envMap){switch(h.envMap.mapping){case n.CubeReflectionMapping:case n.CubeRefractionMapping:m="ENVMAP_TYPE_CUBE";break;case n.EquirectangularReflectionMapping:case n.EquirectangularRefractionMapping:m="ENVMAP_TYPE_EQUIREC";break;case n.SphericalReflectionMapping:m="ENVMAP_TYPE_SPHERE"}switch(h.envMap.mapping){case n.CubeRefractionMapping:case n.EquirectangularRefractionMapping:g="ENVMAP_MODE_REFRACTION"}switch(h.combine){case n.MultiplyOperation:v="ENVMAP_BLENDING_MULTIPLY";break;case n.MixOperation:v="ENVMAP_BLENDING_MIX";break;case n.AddOperation:v="ENVMAP_BLENDING_ADD"}}var y,b,x=a.gammaFactor>0?a.gammaFactor:1,w=t(l),M=u.createProgram();h instanceof n.RawShaderMaterial?(y="",b=""):(y=["precision "+c.precision+" float;","precision "+c.precision+" int;","#define SHADER_NAME "+h.__webglShader.name,w,c.supportsVertexTextures?"#define VERTEX_TEXTURES":"",a.gammaInput?"#define GAMMA_INPUT":"",a.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,"#define MAX_DIR_LIGHTS "+c.maxDirLights,"#define MAX_POINT_LIGHTS "+c.maxPointLights,"#define MAX_SPOT_LIGHTS "+c.maxSpotLights,"#define MAX_HEMI_LIGHTS "+c.maxHemiLights,"#define MAX_SHADOWS "+c.maxShadows,"#define MAX_BONES "+c.maxBones,c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+g:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.vertexColors?"#define USE_COLOR":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.useVertexTexture?"#define BONE_TEXTURE":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&c.flatShading===!1?"#define USE_MORPHNORMALS":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+d:"",c.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(i).join("\n"),b=[c.bumpMap||c.normalMap||c.flatShading||h.derivatives?"#extension GL_OES_standard_derivatives : enable":"",c.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+c.precision+" float;","precision "+c.precision+" int;","#define SHADER_NAME "+h.__webglShader.name,w,"#define MAX_DIR_LIGHTS "+c.maxDirLights,"#define MAX_POINT_LIGHTS "+c.maxPointLights,"#define MAX_SPOT_LIGHTS "+c.maxSpotLights,"#define MAX_HEMI_LIGHTS "+c.maxHemiLights,"#define MAX_SHADOWS "+c.maxShadows,c.alphaTest?"#define ALPHATEST "+c.alphaTest:"",a.gammaInput?"#define GAMMA_INPUT":"",a.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+m:"",c.envMap?"#define "+g:"",c.envMap?"#define "+v:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.vertexColors?"#define USE_COLOR":"",c.flatShading?"#define FLAT_SHADED":"",c.metal?"#define METAL":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+d:"",c.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(i).join("\n"));var S=y+f,_=b+p,E=n.WebGLShader(u,u.VERTEX_SHADER,S),T=n.WebGLShader(u,u.FRAGMENT_SHADER,_);u.attachShader(M,E),u.attachShader(M,T),void 0!==h.index0AttributeName?u.bindAttribLocation(M,0,h.index0AttributeName):c.morphTargets===!0&&u.bindAttribLocation(M,0,"position"),u.linkProgram(M);var C=u.getProgramInfoLog(M),A=u.getShaderInfoLog(E),L=u.getShaderInfoLog(T),P=!0,F=!0;u.getProgramParameter(M,u.LINK_STATUS)===!1?(P=!1,console.error("THREE.WebGLProgram: shader error: ",u.getError(),"gl.VALIDATE_STATUS",u.getProgramParameter(M,u.VALIDATE_STATUS),"gl.getProgramInfoLog",C,A,L)):""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):(""===A||""===L)&&(F=!1),F&&(this.diagnostics={runnable:P,material:h,programLog:C,vertexShader:{log:A,prefix:y},fragmentShader:{log:L,prefix:b}}),u.deleteShader(E),u.deleteShader(T);var R;this.getUniforms=function(){return void 0===R&&(R=e(u,M)),R};var k;return this.getAttributes=function(){return void 0===k&&(k=r(u,M)),k},this.destroy=function(){u.deleteProgram(M),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=o++,this.code=s,this.usedTimes=1,this.program=M,this.vertexShader=E,this.fragmentShader=T,this}}(),n.WebGLPrograms=function(t,e){function r(t){if(e.floatVertexTextures&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var r=e.maxVertexUniforms,i=Math.floor((r-20)/4),o=i;return void 0!==t&&t instanceof n.SkinnedMesh&&(o=Math.min(t.skeleton.bones.length,o),o<t.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+t.skeleton.bones.length+", this GPU supports just "+o+" (try OpenGL instead of ANGLE)")),o}function i(t){for(var e=0,r=0,i=0,o=0,a=0,s=t.length;s>a;a++){var h=t[a];h.onlyShadow||h.visible===!1||(h instanceof n.DirectionalLight&&e++,h instanceof n.PointLight&&r++,h instanceof n.SpotLight&&i++,h instanceof n.HemisphereLight&&o++)}return{directional:e,point:r,spot:i,hemi:o}}function o(t){for(var e=0,r=0,i=t.length;i>r;r++){var o=t[r];o.castShadow&&(o instanceof n.SpotLight&&e++,o instanceof n.DirectionalLight&&e++)}return e}var a=[],s={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},h=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];this.getParameters=function(a,h,c,u){var l=s[a.type],f=i(h),p=o(h),d=r(u),m=t.getPrecision();null!==a.precision&&(m=e.getMaxPrecision(a.precision),m!==a.precision&&console.warn("THREE.WebGLRenderer.initMaterial:",a.precision,"not supported, using",m,"instead."));var g={shaderID:l,precision:m,supportsVertexTextures:e.vertexTextures,map:!!a.map,envMap:!!a.envMap,envMapMode:a.envMap&&a.envMap.mapping,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,displacementMap:!!a.displacementMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,combine:a.combine,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof n.FogExp2,flatShading:a.shading===n.FlatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:a.skinning,maxBones:d,useVertexTexture:e.floatVertexTextures&&u&&u.skeleton&&u.skeleton.useVertexTexture,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,maxDirLights:f.directional,maxPointLights:f.point,maxSpotLights:f.spot,maxHemiLights:f.hemi,maxShadows:p,shadowMapEnabled:t.shadowMap.enabled&&u.receiveShadow&&p>0,shadowMapType:t.shadowMap.type,shadowMapDebug:t.shadowMap.debug,alphaTest:a.alphaTest,metal:a.metal,doubleSided:a.side===n.DoubleSide,flipSided:a.side===n.BackSide};return g},this.getProgramCode=function(t,e){var r=[];if(e.shaderID?r.push(e.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);for(var i=0;i<h.length;i++){var o=h[i];r.push(o),r.push(e[o])}return r.join()},this.acquireProgram=function(e,r,i){for(var o,s=0,h=a.length;h>s;s++){var c=a[s];if(c.code===i){o=c,++o.usedTimes;break}}return void 0===o&&(o=new n.WebGLProgram(t,i,e,r),a.push(o)),o},this.releaseProgram=function(t){if(0===--t.usedTimes){var e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},this.programs=a},n.WebGLProperties=function(){var t={};this.get=function(e){var r=e.uuid,n=t[r];return void 0===n&&(n={},t[r]=n),n},this["delete"]=function(e){delete t[e.uuid]},this.clear=function(){t={}}},n.WebGLShader=function(){var t=function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")};return function(e,r,n){var i=e.createShader(r);return e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(i),t(n)),i}}(),n.WebGLShadowMap=function(t,e,r){function i(t,e){var r,i=t.geometry,o=void 0!==i.morphTargets&&i.morphTargets.length>0&&e.morphTargets,a=t instanceof n.SkinnedMesh&&e.skinning;return r=t.customDepthMaterial?t.customDepthMaterial:a?o?v:g:o?m:d,r.visible=e.visible,r.wireframe=e.wireframe,r.wireframeLinewidth=e.wireframeLinewidth,r}function o(t,e){if(t.visible!==!1){if((t instanceof n.Mesh||t instanceof n.Line||t instanceof n.Points)&&t.castShadow&&(t.frustumCulled===!1||h.intersectsObject(t)===!0)){var r=t.material;r.visible===!0&&(t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld),l.push(t))}for(var i=t.children,a=0,s=i.length;s>a;a++)o(i[a],e)}}var a=t.context,s=t.state,h=new n.Frustum,c=new n.Matrix4,u=(new n.Vector3,new n.Vector3,new n.Vector3),l=[],f=n.ShaderLib.depthRGBA,p=n.UniformsUtils.clone(f.uniforms),d=new n.ShaderMaterial({uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),m=new n.ShaderMaterial({uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,morphTargets:!0}),g=new n.ShaderMaterial({uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,skinning:!0}),v=new n.ShaderMaterial({uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,morphTargets:!0,skinning:!0});d._shadowPass=!0,m._shadowPass=!0,g._shadowPass=!0,v._shadowPass=!0;var y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n.PCFShadowMap,this.cullFace=n.CullFaceFront,this.render=function(f,p){if(y.enabled!==!1&&(y.autoUpdate!==!1||y.needsUpdate!==!1)){a.clearColor(1,1,1,1),s.disable(a.BLEND),s.enable(a.CULL_FACE),a.frontFace(a.CCW),y.cullFace===n.CullFaceFront?a.cullFace(a.FRONT):a.cullFace(a.BACK),s.setDepthTest(!0);for(var d=0,m=e.length;m>d;d++){var g=e[d];if(g.castShadow){if(!g.shadowMap){var v=n.LinearFilter;y.type===n.PCFSoftShadowMap&&(v=n.NearestFilter);var b={minFilter:v,magFilter:v,format:n.RGBAFormat};g.shadowMap=new n.WebGLRenderTarget(g.shadowMapWidth,g.shadowMapHeight,b),g.shadowMapSize=new n.Vector2(g.shadowMapWidth,g.shadowMapHeight),g.shadowMatrix=new n.Matrix4}if(!g.shadowCamera){if(g instanceof n.SpotLight)g.shadowCamera=new n.PerspectiveCamera(g.shadowCameraFov,g.shadowMapWidth/g.shadowMapHeight,g.shadowCameraNear,g.shadowCameraFar);else{if(!(g instanceof n.DirectionalLight)){console.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",g);continue}g.shadowCamera=new n.OrthographicCamera(g.shadowCameraLeft,g.shadowCameraRight,g.shadowCameraTop,g.shadowCameraBottom,g.shadowCameraNear,g.shadowCameraFar)}f.add(g.shadowCamera),f.autoUpdate===!0&&f.updateMatrixWorld()}g.shadowCameraVisible&&!g.cameraHelper&&(g.cameraHelper=new n.CameraHelper(g.shadowCamera),f.add(g.cameraHelper));var x=g.shadowMap,w=g.shadowMatrix,M=g.shadowCamera;M.position.setFromMatrixPosition(g.matrixWorld),u.setFromMatrixPosition(g.target.matrixWorld),M.lookAt(u),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),g.cameraHelper&&(g.cameraHelper.visible=g.shadowCameraVisible),g.shadowCameraVisible&&g.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(M.projectionMatrix),w.multiply(M.matrixWorldInverse),c.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),h.setFromMatrix(c),t.setRenderTarget(x),t.clear(),l.length=0,o(f,M);for(var S=0,_=l.length;_>S;S++){var E=l[S],T=r.update(E),C=E.material;if(C instanceof n.MeshFaceMaterial)for(var A=T.groups,L=C.materials,P=0,F=A.length;F>P;P++){var R=A[P],k=L[R.materialIndex];k.visible===!0&&t.renderBufferDirect(M,e,null,T,i(E,k),E,R)}else t.renderBufferDirect(M,e,null,T,i(E,C),E)}}}var O=t.getClearColor(),D=t.getClearAlpha();t.setClearColor(O,D),s.enable(a.BLEND),y.cullFace===n.CullFaceFront&&a.cullFace(a.BACK),t.resetGLState(),y.needsUpdate=!1}}},n.WebGLState=function(t,e,r){var i=this,o=new Uint8Array(16),a=new Uint8Array(16),s={},h=null,c=null,u=null,l=null,f=null,p=null,d=null,m=null,g=null,v=null,y=null,b=null,x=null,w=null,M=null,S=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),_=void 0,E={};this.init=function(){t.clearColor(0,0,0,1),t.clearDepth(1),t.clearStencil(0),this.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),this.enable(t.CULL_FACE),this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var t=0,e=o.length;e>t;t++)o[t]=0},this.enableAttribute=function(e){o[e]=1,0===a[e]&&(t.enableVertexAttribArray(e),a[e]=1)},this.disableUnusedAttributes=function(){for(var e=0,r=a.length;r>e;e++)a[e]!==o[e]&&(t.disableVertexAttribArray(e),a[e]=0)},this.enable=function(e){s[e]!==!0&&(t.enable(e),s[e]=!0)},this.disable=function(e){s[e]!==!1&&(t.disable(e),s[e]=!1)},this.getCompressedTextureFormats=function(){if(null===h&&(h=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")))for(var r=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<r.length;n++)h.push(r[n]);return h},this.setBlending=function(e,i,o,a,s,h,g){e!==c&&(e===n.NoBlending?this.disable(t.BLEND):e===n.AdditiveBlending?(this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):e===n.SubtractiveBlending?(this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):e===n.MultiplyBlending?(this.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):e===n.CustomBlending?this.enable(t.BLEND):(this.enable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),c=e),e===n.CustomBlending?(s=s||i,h=h||o,g=g||a,(i!==u||s!==p)&&(t.blendEquationSeparate(r(i),r(s)),u=i,p=s),(o!==l||a!==f||h!==d||g!==m)&&(t.blendFuncSeparate(r(o),r(a),r(h),r(g)),l=o,f=a,d=h,m=g)):(u=null,l=null,f=null,p=null,d=null,m=null)},this.setDepthFunc=function(e){if(g!==e){if(e)switch(e){case n.NeverDepth:t.depthFunc(t.NEVER);break;case n.AlwaysDepth:t.depthFunc(t.ALWAYS);break;case n.LessDepth:t.depthFunc(t.LESS);break;case n.LessEqualDepth:t.depthFunc(t.LEQUAL);break;case n.EqualDepth:t.depthFunc(t.EQUAL);break;case n.GreaterEqualDepth:t.depthFunc(t.GEQUAL);break;case n.GreaterDepth:t.depthFunc(t.GREATER);break;case n.NotEqualDepth:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);g=e}},this.setDepthTest=function(e){e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)},this.setDepthWrite=function(e){v!==e&&(t.depthMask(e),v=e)},this.setColorWrite=function(e){y!==e&&(t.colorMask(e,e,e,e),y=e)},this.setFlipSided=function(e){b!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),b=e)},this.setLineWidth=function(e){e!==x&&(t.lineWidth(e),x=e)},this.setPolygonOffset=function(e,r,n){e?this.enable(t.POLYGON_OFFSET_FILL):this.disable(t.POLYGON_OFFSET_FILL),!e||w===r&&M===n||(t.polygonOffset(r,n),w=r,M=n)},this.setScissorTest=function(e){
e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)},this.activeTexture=function(e){void 0===e&&(e=t.TEXTURE0+S-1),_!==e&&(t.activeTexture(e),_=e)},this.bindTexture=function(e,r){void 0===_&&i.activeTexture();var n=E[_];void 0===n&&(n={type:void 0,texture:void 0},E[_]=n),(n.type!==e||n.texture!==r)&&(t.bindTexture(e,r),n.type=e,n.texture=r)},this.compressedTexImage2D=function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error(e)}},this.texImage2D=function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error(e)}},this.reset=function(){for(var e=0;e<a.length;e++)1===a[e]&&(t.disableVertexAttribArray(e),a[e]=0);s={},h=null,c=null,v=null,y=null,b=null}},n.LensFlarePlugin=function(t,e){function r(e){var r=f.createProgram(),n=f.createShader(f.FRAGMENT_SHADER),i=f.createShader(f.VERTEX_SHADER),o="precision "+t.getPrecision()+" float;\n";return f.shaderSource(n,o+e.fragmentShader),f.shaderSource(i,o+e.vertexShader),f.compileShader(n),f.compileShader(i),f.attachShader(r,n),f.attachShader(r,i),f.linkProgram(r),r}var i,o,a,s,h,c,u,l,f=t.context,p=t.state,d=function(){var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),e=new Uint16Array([0,1,2,0,2,3]);i=f.createBuffer(),o=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,i),f.bufferData(f.ARRAY_BUFFER,t,f.STATIC_DRAW),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o),f.bufferData(f.ELEMENT_ARRAY_BUFFER,e,f.STATIC_DRAW),u=f.createTexture(),l=f.createTexture(),p.bindTexture(f.TEXTURE_2D,u),f.texImage2D(f.TEXTURE_2D,0,f.RGB,16,16,0,f.RGB,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),p.bindTexture(f.TEXTURE_2D,l),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,16,16,0,f.RGBA,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),c=f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var n;n=c?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=r(n),s={vertex:f.getAttribLocation(a,"position"),uv:f.getAttribLocation(a,"uv")},h={renderType:f.getUniformLocation(a,"renderType"),map:f.getUniformLocation(a,"map"),occlusionMap:f.getUniformLocation(a,"occlusionMap"),opacity:f.getUniformLocation(a,"opacity"),color:f.getUniformLocation(a,"color"),scale:f.getUniformLocation(a,"scale"),rotation:f.getUniformLocation(a,"rotation"),screenPosition:f.getUniformLocation(a,"screenPosition")}};this.render=function(r,m,g,v){if(0!==e.length){var y=new n.Vector3,b=v/g,x=.5*g,w=.5*v,M=16/v,S=new n.Vector2(M*b,M),_=new n.Vector3(1,1,0),E=new n.Vector2(1,1);void 0===a&&d(),f.useProgram(a),p.initAttributes(),p.enableAttribute(s.vertex),p.enableAttribute(s.uv),p.disableUnusedAttributes(),f.uniform1i(h.occlusionMap,0),f.uniform1i(h.map,1),f.bindBuffer(f.ARRAY_BUFFER,i),f.vertexAttribPointer(s.vertex,2,f.FLOAT,!1,16,0),f.vertexAttribPointer(s.uv,2,f.FLOAT,!1,16,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o),p.disable(f.CULL_FACE),f.depthMask(!1);for(var T=0,C=e.length;C>T;T++){M=16/v,S.set(M*b,M);var A=e[T];if(y.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]),y.applyMatrix4(m.matrixWorldInverse),y.applyProjection(m.projectionMatrix),_.copy(y),E.x=_.x*x+x,E.y=_.y*w+w,c||E.x>0&&E.x<g&&E.y>0&&E.y<v){p.activeTexture(f.TEXTURE0),p.bindTexture(f.TEXTURE_2D,null),p.activeTexture(f.TEXTURE1),p.bindTexture(f.TEXTURE_2D,u),f.copyTexImage2D(f.TEXTURE_2D,0,f.RGB,E.x-8,E.y-8,16,16,0),f.uniform1i(h.renderType,0),f.uniform2f(h.scale,S.x,S.y),f.uniform3f(h.screenPosition,_.x,_.y,_.z),p.disable(f.BLEND),p.enable(f.DEPTH_TEST),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),p.activeTexture(f.TEXTURE0),p.bindTexture(f.TEXTURE_2D,l),f.copyTexImage2D(f.TEXTURE_2D,0,f.RGBA,E.x-8,E.y-8,16,16,0),f.uniform1i(h.renderType,1),p.disable(f.DEPTH_TEST),p.activeTexture(f.TEXTURE1),p.bindTexture(f.TEXTURE_2D,u),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),A.positionScreen.copy(_),A.customUpdateCallback?A.customUpdateCallback(A):A.updateLensFlares(),f.uniform1i(h.renderType,2),p.enable(f.BLEND);for(var L=0,P=A.lensFlares.length;P>L;L++){var F=A.lensFlares[L];F.opacity>.001&&F.scale>.001&&(_.x=F.x,_.y=F.y,_.z=F.z,M=F.size*F.scale/v,S.x=M*b,S.y=M,f.uniform3f(h.screenPosition,_.x,_.y,_.z),f.uniform2f(h.scale,S.x,S.y),f.uniform1f(h.rotation,F.rotation),f.uniform1f(h.opacity,F.opacity),f.uniform3f(h.color,F.color.r,F.color.g,F.color.b),p.setBlending(F.blending,F.blendEquation,F.blendSrc,F.blendDst),t.setTexture(F.texture,1),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0))}}}p.enable(f.CULL_FACE),p.enable(f.DEPTH_TEST),f.depthMask(!0),t.resetGLState()}}},n.SpritePlugin=function(t,e){function r(){var e=l.createProgram(),r=l.createShader(l.VERTEX_SHADER),n=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(r,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(r),l.compileShader(n),l.attachShader(e,r),l.attachShader(e,n),l.linkProgram(e),e}function i(t,e){return t.z!==e.z?e.z-t.z:e.id-t.id}var o,a,s,h,c,u,l=t.context,f=t.state,p=new n.Vector3,d=new n.Quaternion,m=new n.Vector3,g=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),e=new Uint16Array([0,1,2,0,2,3]);o=l.createBuffer(),a=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,o),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a),l.bufferData(l.ELEMENT_ARRAY_BUFFER,e,l.STATIC_DRAW),s=r(),h={position:l.getAttribLocation(s,"position"),uv:l.getAttribLocation(s,"uv")},c={uvOffset:l.getUniformLocation(s,"uvOffset"),uvScale:l.getUniformLocation(s,"uvScale"),rotation:l.getUniformLocation(s,"rotation"),scale:l.getUniformLocation(s,"scale"),color:l.getUniformLocation(s,"color"),map:l.getUniformLocation(s,"map"),opacity:l.getUniformLocation(s,"opacity"),modelViewMatrix:l.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(s,"projectionMatrix"),fogType:l.getUniformLocation(s,"fogType"),fogDensity:l.getUniformLocation(s,"fogDensity"),fogNear:l.getUniformLocation(s,"fogNear"),fogFar:l.getUniformLocation(s,"fogFar"),fogColor:l.getUniformLocation(s,"fogColor"),alphaTest:l.getUniformLocation(s,"alphaTest")};var i=document.createElement("canvas");i.width=8,i.height=8;var f=i.getContext("2d");f.fillStyle="white",f.fillRect(0,0,8,8),u=new n.Texture(i),u.needsUpdate=!0};this.render=function(r,v){if(0!==e.length){void 0===s&&g(),l.useProgram(s),f.initAttributes(),f.enableAttribute(h.position),f.enableAttribute(h.uv),f.disableUnusedAttributes(),f.disable(l.CULL_FACE),f.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,o),l.vertexAttribPointer(h.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(h.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a),l.uniformMatrix4fv(c.projectionMatrix,!1,v.projectionMatrix.elements),f.activeTexture(l.TEXTURE0),l.uniform1i(c.map,0);var y=0,b=0,x=r.fog;x?(l.uniform3f(c.fogColor,x.color.r,x.color.g,x.color.b),x instanceof n.Fog?(l.uniform1f(c.fogNear,x.near),l.uniform1f(c.fogFar,x.far),l.uniform1i(c.fogType,1),y=1,b=1):x instanceof n.FogExp2&&(l.uniform1f(c.fogDensity,x.density),l.uniform1i(c.fogType,2),y=2,b=2)):(l.uniform1i(c.fogType,0),y=0,b=0);for(var w=0,M=e.length;M>w;w++){var S=e[w];S.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,S.matrixWorld),S.z=-S.modelViewMatrix.elements[14]}e.sort(i);for(var _=[],w=0,M=e.length;M>w;w++){var S=e[w],E=S.material;l.uniform1f(c.alphaTest,E.alphaTest),l.uniformMatrix4fv(c.modelViewMatrix,!1,S.modelViewMatrix.elements),S.matrixWorld.decompose(p,d,m),_[0]=m.x,_[1]=m.y;var T=0;r.fog&&E.fog&&(T=b),y!==T&&(l.uniform1i(c.fogType,T),y=T),null!==E.map?(l.uniform2f(c.uvOffset,E.map.offset.x,E.map.offset.y),l.uniform2f(c.uvScale,E.map.repeat.x,E.map.repeat.y)):(l.uniform2f(c.uvOffset,0,0),l.uniform2f(c.uvScale,1,1)),l.uniform1f(c.opacity,E.opacity),l.uniform3f(c.color,E.color.r,E.color.g,E.color.b),l.uniform1f(c.rotation,E.rotation),l.uniform2fv(c.scale,_),f.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),f.setDepthTest(E.depthTest),f.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?t.setTexture(E.map,0):t.setTexture(u,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}f.enable(l.CULL_FACE),t.resetGLState()}}},n.GeometryUtils={merge:function(t,e,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;e instanceof n.Mesh&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,e=e.geometry),t.merge(e,i,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},n.ImageUtils={crossOrigin:void 0,loadTexture:function(t,e,r,i){var o=new n.ImageLoader;o.crossOrigin=this.crossOrigin;var a=new n.Texture(void 0,e);return o.load(t,function(t){a.image=t,a.needsUpdate=!0,r&&r(a)},void 0,function(t){i&&i(t)}),a.sourceFile=t,a},loadTextureCube:function(t,e,r,i){var o=[],a=new n.ImageLoader;a.crossOrigin=this.crossOrigin;for(var s=new n.CubeTexture(o,e),h=0,c=function(e){a.load(t[e],function(t){s.images[e]=t,h+=1,6===h&&(s.needsUpdate=!0,r&&r(s))},void 0,i)},u=0,l=t.length;l>u;++u)c(u);return s},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(t,e){var r=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},n=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},i=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]};e=1|e;var o=t.width,a=t.height,s=document.createElement("canvas");s.width=o,s.height=a;var h=s.getContext("2d");h.drawImage(t,0,0);for(var c=h.getImageData(0,0,o,a).data,u=h.createImageData(o,a),l=u.data,f=0;o>f;f++)for(var p=0;a>p;p++){var d=0>p-1?0:p-1,m=p+1>a-1?a-1:p+1,g=0>f-1?0:f-1,v=f+1>o-1?o-1:f+1,y=[],b=[0,0,c[4*(p*o+f)]/255*e];y.push([-1,0,c[4*(p*o+g)]/255*e]),y.push([-1,-1,c[4*(d*o+g)]/255*e]),y.push([0,-1,c[4*(d*o+f)]/255*e]),y.push([1,-1,c[4*(d*o+v)]/255*e]),y.push([1,0,c[4*(p*o+v)]/255*e]),y.push([1,1,c[4*(m*o+v)]/255*e]),y.push([0,1,c[4*(m*o+f)]/255*e]),y.push([-1,1,c[4*(m*o+g)]/255*e]);for(var x=[],w=y.length,M=0;w>M;M++){var S=y[M],_=y[(M+1)%w];S=n(S,b),_=n(_,b),x.push(i(r(S,_)))}for(var E=[0,0,0],M=0;M<x.length;M++)E[0]+=x[M][0],E[1]+=x[M][1],E[2]+=x[M][2];E[0]/=x.length,E[1]/=x.length,E[2]/=x.length;var T=4*(p*o+f);l[T]=(E[0]+1)/2*255|0,l[T+1]=(E[1]+1)/2*255|0,l[T+2]=255*E[2]|0,l[T+3]=255}return h.putImageData(u,0,0),s},generateDataTexture:function(t,e,r){for(var i=t*e,o=new Uint8Array(3*i),a=Math.floor(255*r.r),s=Math.floor(255*r.g),h=Math.floor(255*r.b),c=0;i>c;c++)o[3*c]=a,o[3*c+1]=s,o[3*c+2]=h;var u=new n.DataTexture(o,t,e,n.RGBFormat);return u.needsUpdate=!0,u}},n.SceneUtils={createMultiMaterialObject:function(t,e){for(var r=new n.Group,i=0,o=e.length;o>i;i++)r.add(new n.Mesh(t,e[i]));return r},detach:function(t,e,r){t.applyMatrix(e.matrixWorld),e.remove(t),r.add(t)},attach:function(t,e,r){var i=new n.Matrix4;i.getInverse(r.matrixWorld),t.applyMatrix(i),e.remove(t),r.add(t)}},n.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face.toLowerCase()][this.weight][this.style]}catch(t){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(t){var e=t.familyName.toLowerCase(),r=this;return r.faces[e]=r.faces[e]||{},r.faces[e][t.cssFontWeight]=r.faces[e][t.cssFontWeight]||{},r.faces[e][t.cssFontWeight][t.cssFontStyle]=t,r.faces[e][t.cssFontWeight][t.cssFontStyle]=t,t},drawText:function(t){var e,r=this.getFace(),i=this.size/r.resolution,o=0,a=String(t).split(""),s=a.length,h=[];for(e=0;s>e;e++){var c=new n.Path,u=this.extractGlyphPoints(a[e],r,i,o,c);o+=u.offset,h.push(u.path)}var l=o/2;return{paths:h,offset:l}},extractGlyphPoints:function(t,e,r,i,o){var a,s,h,c,u,l,f,p,d,m,g,v,y,b,x,w,M,S,_,E=[],T=e.glyphs[t]||e.glyphs["?"];if(T){if(T.o)for(c=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),l=c.length,f=r,p=r,a=0;l>a;)switch(u=c[a++]){case"m":d=c[a++]*f+i,m=c[a++]*p,o.moveTo(d,m);break;case"l":d=c[a++]*f+i,m=c[a++]*p,o.lineTo(d,m);break;case"q":if(g=c[a++]*f+i,v=c[a++]*p,x=c[a++]*f+i,w=c[a++]*p,o.quadraticCurveTo(x,w,g,v),_=E[E.length-1])for(y=_.x,b=_.y,s=1,h=this.divisions;h>=s;s++){var C=s/h;n.Shape.Utils.b2(C,y,x,g),n.Shape.Utils.b2(C,b,w,v)}break;case"b":if(g=c[a++]*f+i,v=c[a++]*p,x=c[a++]*f+i,w=c[a++]*p,M=c[a++]*f+i,S=c[a++]*p,o.bezierCurveTo(x,w,M,S,g,v),_=E[E.length-1])for(y=_.x,b=_.y,s=1,h=this.divisions;h>=s;s++){var C=s/h;n.Shape.Utils.b3(C,y,x,M,g),n.Shape.Utils.b3(C,b,w,S,v)}}return{offset:T.ha*r,path:o}}}},n.FontUtils.generateShapes=function(t,e){e=e||{};var r=void 0!==e.size?e.size:100,i=void 0!==e.curveSegments?e.curveSegments:4,o=void 0!==e.font?e.font:"helvetiker",a=void 0!==e.weight?e.weight:"normal",s=void 0!==e.style?e.style:"normal";n.FontUtils.size=r,n.FontUtils.divisions=i,n.FontUtils.face=o,n.FontUtils.weight=a,n.FontUtils.style=s;for(var h=n.FontUtils.drawText(t),c=h.paths,u=[],l=0,f=c.length;f>l;l++)Array.prototype.push.apply(u,c[l].toShapes());return u},function(t){var e=1e-10,r=function(t,e){var r=t.length;if(3>r)return null;var o,a,s,h=[],c=[],u=[];if(n(t)>0)for(a=0;r>a;a++)c[a]=a;else for(a=0;r>a;a++)c[a]=r-1-a;var l=r,f=2*l;for(a=l-1;l>2;){if(f--<=0)return console.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),e?u:h;if(o=a,o>=l&&(o=0),a=o+1,a>=l&&(a=0),s=a+1,s>=l&&(s=0),i(t,o,a,s,l,c)){var p,d,m,g,v;for(p=c[o],d=c[a],m=c[s],h.push([t[p],t[d],t[m]]),u.push([c[o],c[a],c[s]]),g=a,v=a+1;l>v;g++,v++)c[g]=c[v];l--,f=2*l}}return e?u:h},n=function(t){for(var e=t.length,r=0,n=e-1,i=0;e>i;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},i=function(t,r,n,i,o,a){var s,h,c,u,l,f,p,d,m;if(h=t[a[r]].x,c=t[a[r]].y,u=t[a[n]].x,l=t[a[n]].y,f=t[a[i]].x,p=t[a[i]].y,e>(u-h)*(p-c)-(l-c)*(f-h))return!1;var g,v,y,b,x,w,M,S,_,E,T,C,A,L,P;for(g=f-u,v=p-l,y=h-f,b=c-p,x=u-h,w=l-c,s=0;o>s;s++)if(d=t[a[s]].x,m=t[a[s]].y,!(d===h&&m===c||d===u&&m===l||d===f&&m===p)&&(M=d-h,S=m-c,_=d-u,E=m-l,T=d-f,C=m-p,P=g*E-v*_,A=x*S-w*M,L=y*C-b*T,P>=-e&&L>=-e&&A>=-e))return!1;return!0};return t.Triangulate=r,t.Triangulate.area=n,t}(n.FontUtils),n.typeface_js={faces:n.FontUtils.faces,loadFace:n.FontUtils.loadFace},"undefined"!=typeof self&&(self._typeface_js=n.typeface_js),n.Audio=function(t){n.Object3D.call(this),this.type="Audio",this.context=t.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1},n.Audio.prototype=Object.create(n.Object3D.prototype),n.Audio.prototype.constructor=n.Audio,n.Audio.prototype.load=function(t){var e=this,r=new XMLHttpRequest;return r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(t){e.context.decodeAudioData(this.response,function(t){e.source.buffer=t,e.autoplay&&e.play()})},r.send(),this},n.Audio.prototype.play=function(){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");var t=this.context.createBufferSource();t.buffer=this.source.buffer,t.loop=this.source.loop,t.onended=this.source.onended,t.start(0,this.startTime),t.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=t,this.connect()},n.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},n.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},n.Audio.prototype.connect=function(){void 0!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.panner)):this.source.connect(this.panner)},n.Audio.prototype.disconnect=function(){void 0!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.panner)):this.source.disconnect(this.panner)},n.Audio.prototype.setFilter=function(t){this.isPlaying===!0?(this.disconnect(),this.filter=t,this.connect()):this.filter=t},n.Audio.prototype.getFilter=function(){return this.filter},n.Audio.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate)},n.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},n.Audio.prototype.onEnded=function(){this.isPlaying=!1},n.Audio.prototype.setLoop=function(t){this.source.loop=t},n.Audio.prototype.getLoop=function(){return this.source.loop},n.Audio.prototype.setRefDistance=function(t){this.panner.refDistance=t},n.Audio.prototype.getRefDistance=function(){return this.panner.refDistance},n.Audio.prototype.setRolloffFactor=function(t){this.panner.rolloffFactor=t},n.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},n.Audio.prototype.setVolume=function(t){this.gain.gain.value=t},n.Audio.prototype.getVolume=function(){return this.gain.gain.value},n.Audio.prototype.updateMatrixWorld=function(){var t=new n.Vector3;return function(e){n.Object3D.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}(),n.AudioListener=function(){n.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},n.AudioListener.prototype=Object.create(n.Object3D.prototype),n.AudioListener.prototype.constructor=n.AudioListener,n.AudioListener.prototype.updateMatrixWorld=function(){var t=new n.Vector3,e=new n.Quaternion,r=new n.Vector3,i=new n.Vector3;return function(o){n.Object3D.prototype.updateMatrixWorld.call(this,o);var a=this.context.listener,s=this.up;this.matrixWorld.decompose(t,e,r),i.set(0,0,-1).applyQuaternion(e),a.setPosition(t.x,t.y,t.z),a.setOrientation(i.x,i.y,i.z,s.x,s.y,s.z)}}(),n.Curve=function(){},n.Curve.prototype.getPoint=function(t){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},n.Curve.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},n.Curve.prototype.getPoints=function(t){t||(t=5);var e,r=[];for(e=0;t>=e;e++)r.push(this.getPoint(e/t));return r},n.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,r=[];for(e=0;t>=e;e++)r.push(this.getPointAt(e/t));return r},n.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},n.Curve.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;t>=r;r++)e=this.getPoint(r/t),o+=e.distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},n.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},n.Curve.prototype.getUtoTmapping=function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e?e:t*n[o-1];for(var a,s=0,h=o-1;h>=s;)if(i=Math.floor(s+(h-s)/2),a=n[i]-r,0>a)s=i+1;else{if(!(a>0)){h=i;break}h=i-1}if(i=h,n[i]===r){var c=i/(o-1);return c}var u=n[i],l=n[i+1],f=l-u,p=(r-u)/f,c=(i+p)/(o-1);return c},n.Curve.prototype.getTangent=function(t){var e=1e-4,r=t-e,n=t+e;0>r&&(r=0),n>1&&(n=1);var i=this.getPoint(r),o=this.getPoint(n),a=o.clone().sub(i);return a.normalize()},n.Curve.prototype.getTangentAt=function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},n.Curve.Utils={tangentQuadraticBezier:function(t,e,r,n){return 2*(1-t)*(r-e)+2*t*(n-r)},tangentCubicBezier:function(t,e,r,n,i){return-3*e*(1-t)*(1-t)+3*r*(1-t)*(1-t)-6*t*r*(1-t)+6*t*n*(1-t)-3*t*t*n+3*t*t*i},tangentSpline:function(t,e,r,n,i){var o=6*t*t-6*t,a=3*t*t-4*t+1,s=-6*t*t+6*t,h=3*t*t-2*t;return o+a+s+h},interpolate:function(t,e,r,n,i){var o=.5*(r-t),a=.5*(n-e),s=i*i,h=i*s;return(2*e-2*r+o+a)*h+(-3*e+3*r-2*o-a)*s+o*i+e}},n.Curve.create=function(t,e){return t.prototype=Object.create(n.Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},n.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},n.CurvePath.prototype=Object.create(n.Curve.prototype),n.CurvePath.prototype.constructor=n.CurvePath,n.CurvePath.prototype.add=function(t){this.curves.push(t)},n.CurvePath.prototype.checkConnection=function(){},n.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new n.LineCurve(e,t))},n.CurvePath.prototype.getPoint=function(t){for(var e,r,n=t*this.getLength(),i=this.getCurveLengths(),o=0;o<i.length;){if(i[o]>=n){e=i[o]-n,r=this.curves[o];var a=1-e/r.getLength();return r.getPointAt(a)}o++}return null},n.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},n.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;var t,e=[],r=0,n=this.curves.length;for(t=0;n>t;t++)r+=this.curves[t].getLength(),e.push(r);return this.cacheLengths=e,e},n.CurvePath.prototype.getBoundingBox=function(){var t,e,r,i,o,a,s=this.getPoints();t=e=Number.NEGATIVE_INFINITY,i=o=Number.POSITIVE_INFINITY;var h,c,u,l,f=s[0]instanceof n.Vector3;for(l=f?new n.Vector3:new n.Vector2,c=0,u=s.length;u>c;c++)h=s[c],h.x>t?t=h.x:h.x<i&&(i=h.x),h.y>e?e=h.y:h.y<o&&(o=h.y),f&&(h.z>r?r=h.z:h.z<a&&(a=h.z)),l.add(h);var p={minX:i,minY:o,maxX:t,maxY:e};return f&&(p.maxZ=r,p.minZ=a),p},n.CurvePath.prototype.createPointsGeometry=function(t){var e=this.getPoints(t,!0);return this.createGeometry(e)},n.CurvePath.prototype.createSpacedPointsGeometry=function(t){var e=this.getSpacedPoints(t,!0);return this.createGeometry(e)},n.CurvePath.prototype.createGeometry=function(t){for(var e=new n.Geometry,r=0;r<t.length;r++)e.vertices.push(new n.Vector3(t[r].x,t[r].y,t[r].z||0));return e},n.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)},n.CurvePath.prototype.getTransformedPoints=function(t,e){var r,n,i=this.getPoints(t);for(e||(e=this.bends),r=0,n=e.length;n>r;r++)i=this.getWrapPoints(i,e[r]);return i},n.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var r,n,i=this.getSpacedPoints(t);for(e||(e=this.bends),r=0,n=e.length;n>r;r++)i=this.getWrapPoints(i,e[r]);return i},n.CurvePath.prototype.getWrapPoints=function(t,e){var r,n,i,o,a,s,h=this.getBoundingBox();for(r=0,n=t.length;n>r;r++){i=t[r],o=i.x,a=i.y,s=o/h.maxX,s=e.getUtoTmapping(s,o);var c=e.getPoint(s),u=e.getTangent(s);u.set(-u.y,u.x).multiplyScalar(a),i.x=c.x+u.x,i.y=c.y+u.y}return t},n.Path=function(t){n.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},n.Path.prototype=Object.create(n.CurvePath.prototype),n.Path.prototype.constructor=n.Path,n.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},n.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;r>e;e++)this.lineTo(t[e].x,t[e].y)},n.Path.prototype.moveTo=function(t,e){var r=Array.prototype.slice.call(arguments);this.actions.push({action:n.PathActions.MOVE_TO,args:r})},n.Path.prototype.lineTo=function(t,e){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,o=i[i.length-2],a=i[i.length-1],s=new n.LineCurve(new n.Vector2(o,a),new n.Vector2(t,e));this.curves.push(s),this.actions.push({action:n.PathActions.LINE_TO,args:r})},n.Path.prototype.quadraticCurveTo=function(t,e,r,i){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1],c=new n.QuadraticBezierCurve(new n.Vector2(s,h),new n.Vector2(t,e),new n.Vector2(r,i));this.curves.push(c),this.actions.push({action:n.PathActions.QUADRATIC_CURVE_TO,args:o})},n.Path.prototype.bezierCurveTo=function(t,e,r,i,o,a){var s=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,c=h[h.length-2],u=h[h.length-1],l=new n.CubicBezierCurve(new n.Vector2(c,u),new n.Vector2(t,e),new n.Vector2(r,i),new n.Vector2(o,a));this.curves.push(l),this.actions.push({action:n.PathActions.BEZIER_CURVE_TO,args:s})},n.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],o=r[r.length-1],a=[new n.Vector2(i,o)];Array.prototype.push.apply(a,t);var s=new n.SplineCurve(a);this.curves.push(s),this.actions.push({action:n.PathActions.CSPLINE_THRU,args:e})},n.Path.prototype.arc=function(t,e,r,n,i,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(t+s,e+h,r,n,i,o)},n.Path.prototype.absarc=function(t,e,r,n,i,o){this.absellipse(t,e,r,r,n,i,o)},n.Path.prototype.ellipse=function(t,e,r,n,i,o,a,s){var h=this.actions[this.actions.length-1].args,c=h[h.length-2],u=h[h.length-1];this.absellipse(t+c,e+u,r,n,i,o,a,s)},n.Path.prototype.absellipse=function(t,e,r,i,o,a,s,h){var c=[t,e,r,i,o,a,s,h||0],u=new n.EllipseCurve(t,e,r,i,o,a,s,h);this.curves.push(u);var l=u.getPoint(1);c.push(l.x),c.push(l.y),this.actions.push({action:n.PathActions.ELLIPSE,args:c})},n.Path.prototype.getSpacedPoints=function(t,e){t||(t=40);for(var r=[],n=0;t>n;n++)r.push(this.getPoint(n/t));return r},n.Path.prototype.getPoints=function(t,e){if(this.useSpacedPoints)return this.getSpacedPoints(t,e);t=t||12;var r,i,o,a,s,h,c,u,l,f,p,d,m,g,v,y,b,x,w=[];for(r=0,i=this.actions.length;i>r;r++)switch(o=this.actions[r],a=o.action,s=o.args,a){case n.PathActions.MOVE_TO:w.push(new n.Vector2(s[0],s[1]));break;case n.PathActions.LINE_TO:w.push(new n.Vector2(s[0],s[1]));break;case n.PathActions.QUADRATIC_CURVE_TO:for(h=s[2],c=s[3],f=s[0],p=s[1],w.length>0?(g=w[w.length-1],d=g.x,m=g.y):(g=this.actions[r-1].args,d=g[g.length-2],m=g[g.length-1]),v=1;t>=v;v++)y=v/t,b=n.Shape.Utils.b2(y,d,f,h),x=n.Shape.Utils.b2(y,m,p,c),w.push(new n.Vector2(b,x));break;case n.PathActions.BEZIER_CURVE_TO:for(h=s[4],c=s[5],f=s[0],p=s[1],u=s[2],l=s[3],w.length>0?(g=w[w.length-1],d=g.x,m=g.y):(g=this.actions[r-1].args,d=g[g.length-2],m=g[g.length-1]),v=1;t>=v;v++)y=v/t,b=n.Shape.Utils.b3(y,d,f,u,h),x=n.Shape.Utils.b3(y,m,p,l,c),w.push(new n.Vector2(b,x));break;case n.PathActions.CSPLINE_THRU:g=this.actions[r-1].args;var M=new n.Vector2(g[g.length-2],g[g.length-1]),S=[M],_=t*s[0].length;S=S.concat(s[0]);var E=new n.SplineCurve(S);for(v=1;_>=v;v++)w.push(E.getPointAt(v/_));break;case n.PathActions.ARC:var T,C=s[0],A=s[1],L=s[2],P=s[3],F=s[4],R=!!s[5],k=F-P,O=2*t;for(v=1;O>=v;v++)y=v/O,R||(y=1-y),T=P+y*k,b=C+L*Math.cos(T),x=A+L*Math.sin(T),w.push(new n.Vector2(b,x));break;case n.PathActions.ELLIPSE:var T,D,U,C=s[0],A=s[1],B=s[2],I=s[3],P=s[4],F=s[5],R=!!s[6],N=s[7],k=F-P,O=2*t;for(0!==N&&(D=Math.cos(N),U=Math.sin(N)),v=1;O>=v;v++){if(y=v/O,R||(y=1-y),T=P+y*k,b=C+B*Math.cos(T),x=A+I*Math.sin(T),
0!==N){var V=b,G=x;b=(V-C)*D-(G-A)*U+C,x=(V-C)*U+(G-A)*D+A}w.push(new n.Vector2(b,x))}}var z=w[w.length-1],j=1e-10;return Math.abs(z.x-w[0].x)<j&&Math.abs(z.y-w[0].y)<j&&w.splice(w.length-1,1),e&&w.push(w[0]),w},n.Path.prototype.toShapes=function(t,e){function r(t){var e,r,i,o,a,s=[],h=new n.Path;for(e=0,r=t.length;r>e;e++)i=t[e],a=i.args,o=i.action,o===n.PathActions.MOVE_TO&&0!==h.actions.length&&(s.push(h),h=new n.Path),h[o].apply(h,a);return 0!==h.actions.length&&s.push(h),s}function i(t){for(var e=[],r=0,i=t.length;i>r;r++){var o=t[r],a=new n.Shape;a.actions=o.actions,a.curves=o.curves,e.push(a)}return e}function o(t,e){for(var r=1e-10,n=e.length,i=!1,o=n-1,a=0;n>a;o=a++){var s=e[o],h=e[a],c=h.x-s.x,u=h.y-s.y;if(Math.abs(u)>r){if(0>u&&(s=e[a],c=-c,h=e[o],u=-u),t.y<s.y||t.y>h.y)continue;if(t.y===s.y){if(t.x===s.x)return!0}else{var l=u*(t.x-s.x)-c*(t.y-s.y);if(0===l)return!0;if(0>l)continue;i=!i}}else{if(t.y!==s.y)continue;if(h.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=h.x)return!0}}return i}var a=r(this.actions);if(0===a.length)return[];if(e===!0)return i(a);var s,h,c,u=[];if(1===a.length)return h=a[0],c=new n.Shape,c.actions=h.actions,c.curves=h.curves,u.push(c),u;var l=!n.Shape.Utils.isClockWise(a[0].getPoints());l=t?!l:l;var f,p=[],d=[],m=[],g=0;d[g]=void 0,m[g]=[];var v,y;for(v=0,y=a.length;y>v;v++)h=a[v],f=h.getPoints(),s=n.Shape.Utils.isClockWise(f),s=t?!s:s,s?(!l&&d[g]&&g++,d[g]={s:new n.Shape,p:f},d[g].s.actions=h.actions,d[g].s.curves=h.curves,l&&g++,m[g]=[]):m[g].push({h:h,p:f[0]});if(!d[0])return i(a);if(d.length>1){for(var b=!1,x=[],w=0,M=d.length;M>w;w++)p[w]=[];for(var w=0,M=d.length;M>w;w++)for(var S=m[w],_=0;_<S.length;_++){for(var E=S[_],T=!0,C=0;C<d.length;C++)o(E.p,d[C].p)&&(w!==C&&x.push({froms:w,tos:C,hole:_}),T?(T=!1,p[C].push(E)):b=!0);T&&p[w].push(E)}x.length>0&&(b||(m=p))}var A,L,P;for(v=0,y=d.length;y>v;v++)for(c=d[v].s,u.push(c),A=m[v],L=0,P=A.length;P>L;L++)c.holes.push(A[L].h);return u},n.Shape=function(){n.Path.apply(this,arguments),this.holes=[]},n.Shape.prototype=Object.create(n.Path.prototype),n.Shape.prototype.constructor=n.Shape,n.Shape.prototype.extrude=function(t){var e=new n.ExtrudeGeometry(this,t);return e},n.Shape.prototype.makeGeometry=function(t){var e=new n.ShapeGeometry(this,t);return e},n.Shape.prototype.getPointsHoles=function(t){var e,r=this.holes.length,n=[];for(e=0;r>e;e++)n[e]=this.holes[e].getTransformedPoints(t,this.bends);return n},n.Shape.prototype.getSpacedPointsHoles=function(t){var e,r=this.holes.length,n=[];for(e=0;r>e;e++)n[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return n},n.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},n.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)},n.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}},n.Shape.Utils={triangulateShape:function(t,e){function r(t,e,r){return t.x!==e.x?t.x<e.x?t.x<=r.x&&r.x<=e.x:e.x<=r.x&&r.x<=t.x:t.y<e.y?t.y<=r.y&&r.y<=e.y:e.y<=r.y&&r.y<=t.y}function i(t,e,n,i,o){var a=1e-10,s=e.x-t.x,h=e.y-t.y,c=i.x-n.x,u=i.y-n.y,l=t.x-n.x,f=t.y-n.y,p=h*c-s*u,d=h*l-s*f;if(Math.abs(p)>a){var m;if(p>0){if(0>d||d>p)return[];if(m=u*l-c*f,0>m||m>p)return[]}else{if(d>0||p>d)return[];if(m=u*l-c*f,m>0||p>m)return[]}if(0===m)return!o||0!==d&&d!==p?[t]:[];if(m===p)return!o||0!==d&&d!==p?[e]:[];if(0===d)return[n];if(d===p)return[i];var g=m/p;return[{x:t.x+g*s,y:t.y+g*h}]}if(0!==d||u*l!==c*f)return[];var v=0===s&&0===h,y=0===c&&0===u;if(v&&y)return t.x!==n.x||t.y!==n.y?[]:[t];if(v)return r(n,i,t)?[t]:[];if(y)return r(t,e,n)?[n]:[];var b,x,w,M,S,_,E,T;return 0!==s?(t.x<e.x?(b=t,w=t.x,x=e,M=e.x):(b=e,w=e.x,x=t,M=t.x),n.x<i.x?(S=n,E=n.x,_=i,T=i.x):(S=i,E=i.x,_=n,T=n.x)):(t.y<e.y?(b=t,w=t.y,x=e,M=e.y):(b=e,w=e.y,x=t,M=t.y),n.y<i.y?(S=n,E=n.y,_=i,T=i.y):(S=i,E=i.y,_=n,T=n.y)),E>=w?E>M?[]:M===E?o?[]:[S]:T>=M?[S,x]:[S,_]:w>T?[]:w===T?o?[]:[b]:T>=M?[b,x]:[b,_]}function o(t,e,r,n){var i=1e-10,o=e.x-t.x,a=e.y-t.y,s=r.x-t.x,h=r.y-t.y,c=n.x-t.x,u=n.y-t.y,l=o*h-a*s,f=o*u-a*c;if(Math.abs(l)>i){var p=c*h-u*s;return l>0?f>=0&&p>=0:f>=0||p>=0}return f>0}function a(t,e){function r(t,e){var r=y.length-1,n=t-1;0>n&&(n=r);var i=t+1;i>r&&(i=0);var a=o(y[t],y[n],y[i],s[e]);if(!a)return!1;var h=s.length-1,c=e-1;0>c&&(c=h);var u=e+1;return u>h&&(u=0),a=o(s[e],s[c],s[u],y[t]),a?!0:!1}function n(t,e){var r,n,o;for(r=0;r<y.length;r++)if(n=r+1,n%=y.length,o=i(t,e,y[r],y[n],!0),o.length>0)return!0;return!1}function a(t,r){var n,o,a,s,h;for(n=0;n<b.length;n++)for(o=e[b[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,h=i(t,r,o[a],o[s],!0),h.length>0)return!0;return!1}for(var s,h,c,u,l,f,p,d,m,g,v,y=t.concat(),b=[],x=[],w=0,M=e.length;M>w;w++)b.push(w);for(var S=0,_=2*b.length;b.length>0;){if(_--,0>_){console.log("Infinite Loop! Holes left:"+b.length+", Probably Hole outside Shape!");break}for(c=S;c<y.length;c++){u=y[c],h=-1;for(var w=0;w<b.length;w++)if(f=b[w],p=u.x+":"+u.y+":"+f,void 0===x[p]){s=e[f];for(var E=0;E<s.length;E++)if(l=s[E],r(c,E)&&!n(u,l)&&!a(u,l)){h=E,b.splice(w,1),d=y.slice(0,c+1),m=y.slice(c),g=s.slice(h),v=s.slice(0,h+1),y=d.concat(g).concat(v).concat(m),S=c;break}if(h>=0)break;x[p]=!0}if(h>=0)break}}return y}for(var s,h,c,u,l,f,p={},d=t.concat(),m=0,g=e.length;g>m;m++)Array.prototype.push.apply(d,e[m]);for(s=0,h=d.length;h>s;s++)l=d[s].x+":"+d[s].y,void 0!==p[l]&&console.warn("THREE.Shape: Duplicate point",l),p[l]=s;var v=a(t,e),y=n.FontUtils.Triangulate(v,!1);for(s=0,h=y.length;h>s;s++)for(u=y[s],c=0;3>c;c++)l=u[c].x+":"+u[c].y,f=p[l],void 0!==f&&(u[c]=f);return y.concat()},isClockWise:function(t){return n.FontUtils.Triangulate.area(t)<0},b2p0:function(t,e){var r=1-t;return r*r*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,r,n){return this.b2p0(t,e)+this.b2p1(t,r)+this.b2p2(t,n)},b3p0:function(t,e){var r=1-t;return r*r*r*e},b3p1:function(t,e){var r=1-t;return 3*r*r*t*e},b3p2:function(t,e){var r=1-t;return 3*r*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,r,n,i){return this.b3p0(t,e)+this.b3p1(t,r)+this.b3p2(t,n)+this.b3p3(t,i)}},n.LineCurve=function(t,e){this.v1=t,this.v2=e},n.LineCurve.prototype=Object.create(n.Curve.prototype),n.LineCurve.prototype.constructor=n.LineCurve,n.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},n.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)},n.LineCurve.prototype.getTangent=function(t){var e=this.v2.clone().sub(this.v1);return e.normalize()},n.QuadraticBezierCurve=function(t,e,r){this.v0=t,this.v1=e,this.v2=r},n.QuadraticBezierCurve.prototype=Object.create(n.Curve.prototype),n.QuadraticBezierCurve.prototype.constructor=n.QuadraticBezierCurve,n.QuadraticBezierCurve.prototype.getPoint=function(t){var e=new n.Vector2;return e.x=n.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),e.y=n.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),e},n.QuadraticBezierCurve.prototype.getTangent=function(t){var e=new n.Vector2;return e.x=n.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),e.y=n.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),e.normalize()},n.CubicBezierCurve=function(t,e,r,n){this.v0=t,this.v1=e,this.v2=r,this.v3=n},n.CubicBezierCurve.prototype=Object.create(n.Curve.prototype),n.CubicBezierCurve.prototype.constructor=n.CubicBezierCurve,n.CubicBezierCurve.prototype.getPoint=function(t){var e,r;return e=n.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new n.Vector2(e,r)},n.CubicBezierCurve.prototype.getTangent=function(t){var e,r;e=n.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new n.Vector2(e,r);return i.normalize(),i},n.SplineCurve=function(t){this.points=void 0==t?[]:t},n.SplineCurve.prototype=Object.create(n.Curve.prototype),n.SplineCurve.prototype.constructor=n.SplineCurve,n.SplineCurve.prototype.getPoint=function(t){var e=this.points,r=(e.length-1)*t,i=Math.floor(r),o=r-i,a=e[0===i?i:i-1],s=e[i],h=e[i>e.length-2?e.length-1:i+1],c=e[i>e.length-3?e.length-1:i+2],u=new n.Vector2;return u.x=n.Curve.Utils.interpolate(a.x,s.x,h.x,c.x,o),u.y=n.Curve.Utils.interpolate(a.y,s.y,h.y,c.y,o),u},n.EllipseCurve=function(t,e,r,n,i,o,a,s){this.aX=t,this.aY=e,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0},n.EllipseCurve.prototype=Object.create(n.Curve.prototype),n.EllipseCurve.prototype.constructor=n.EllipseCurve,n.EllipseCurve.prototype.getPoint=function(t){var e=this.aEndAngle-this.aStartAngle;0>e&&(e+=2*Math.PI),e>2*Math.PI&&(e-=2*Math.PI);var r;r=this.aClockwise===!0?this.aEndAngle+(1-t)*(2*Math.PI-e):this.aStartAngle+t*e;var i=this.aX+this.xRadius*Math.cos(r),o=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){var a=Math.cos(this.aRotation),s=Math.sin(this.aRotation),h=i,c=o;i=(h-this.aX)*a-(c-this.aY)*s+this.aX,o=(h-this.aX)*s+(c-this.aY)*a+this.aY}return new n.Vector2(i,o)},n.ArcCurve=function(t,e,r,i,o,a){n.EllipseCurve.call(this,t,e,r,r,i,o,a)},n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype),n.ArcCurve.prototype.constructor=n.ArcCurve,n.LineCurve3=n.Curve.create(function(t,e){this.v1=t,this.v2=e},function(t){var e=new n.Vector3;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e}),n.QuadraticBezierCurve3=n.Curve.create(function(t,e,r){this.v0=t,this.v1=e,this.v2=r},function(t){var e=new n.Vector3;return e.x=n.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),e.y=n.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),e.z=n.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),e}),n.CubicBezierCurve3=n.Curve.create(function(t,e,r,n){this.v0=t,this.v1=e,this.v2=r,this.v3=n},function(t){var e=new n.Vector3;return e.x=n.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e.y=n.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e.z=n.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),e}),n.SplineCurve3=n.Curve.create(function(t){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==t?[]:t},function(t){var e=this.points,r=(e.length-1)*t,i=Math.floor(r),o=r-i,a=e[0==i?i:i-1],s=e[i],h=e[i>e.length-2?e.length-1:i+1],c=e[i>e.length-3?e.length-1:i+2],u=new n.Vector3;return u.x=n.Curve.Utils.interpolate(a.x,s.x,h.x,c.x,o),u.y=n.Curve.Utils.interpolate(a.y,s.y,h.y,c.y,o),u.z=n.Curve.Utils.interpolate(a.z,s.z,h.z,c.z,o),u}),n.CatmullRomCurve3=function(){function t(){}var e=new n.Vector3,r=new t,i=new t,o=new t;return t.prototype.init=function(t,e,r,n){this.c0=t,this.c1=r,this.c2=-3*t+3*e-2*r-n,this.c3=2*t-2*e+r+n},t.prototype.initNonuniformCatmullRom=function(t,e,r,n,i,o,a){var s=(e-t)/i-(r-t)/(i+o)+(r-e)/o,h=(r-e)/o-(n-e)/(o+a)+(n-r)/a;s*=o,h*=o,this.init(e,r,s,h)},t.prototype.initCatmullRom=function(t,e,r,n,i){this.init(e,r,i*(r-t),i*(n-e))},t.prototype.calc=function(t){var e=t*t,r=e*t;return this.c0+this.c1*t+this.c2*e+this.c3*r},n.Curve.create(function(t){this.points=t||[]},function(t){var a,s,h,c,u=this.points;c=u.length,2>c&&console.log("duh, you need at least 2 points"),a=(c-1)*t,s=Math.floor(a),h=a-s,0===h&&s===c-1&&(s=c-2,h=1);var l,f,p,d;if(0===s?(e.subVectors(u[0],u[1]).add(u[0]),l=e):l=u[s-1],f=u[s],p=u[s+1],c>s+2?d=u[s+2]:(e.subVectors(u[c-1],u[c-2]).add(u[c-2]),d=e),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var m="chordal"===this.type?.5:.25,g=Math.pow(l.distanceToSquared(f),m),v=Math.pow(f.distanceToSquared(p),m),y=Math.pow(p.distanceToSquared(d),m);1e-4>v&&(v=1),1e-4>g&&(g=v),1e-4>y&&(y=v),r.initNonuniformCatmullRom(l.x,f.x,p.x,d.x,g,v,y),i.initNonuniformCatmullRom(l.y,f.y,p.y,d.y,g,v,y),o.initNonuniformCatmullRom(l.z,f.z,p.z,d.z,g,v,y)}else if("catmullrom"===this.type){var b=void 0!==this.tension?this.tension:.5;r.initCatmullRom(l.x,f.x,p.x,d.x,b),i.initCatmullRom(l.y,f.y,p.y,d.y,b),o.initCatmullRom(l.z,f.z,p.z,d.z,b)}var x=new n.Vector3(r.calc(h),i.calc(h),o.calc(h));return x})}(),n.ClosedSplineCurve3=n.Curve.create(function(t){this.points=void 0==t?[]:t},function(t){var e=this.points,r=(e.length-0)*t,i=Math.floor(r),o=r-i;i+=i>0?0:(Math.floor(Math.abs(i)/e.length)+1)*e.length;var a=e[(i-1)%e.length],s=e[i%e.length],h=e[(i+1)%e.length],c=e[(i+2)%e.length],u=new n.Vector3;return u.x=n.Curve.Utils.interpolate(a.x,s.x,h.x,c.x,o),u.y=n.Curve.Utils.interpolate(a.y,s.y,h.y,c.y,o),u.z=n.Curve.Utils.interpolate(a.z,s.z,h.z,c.z,o),u}),n.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(t){if(t.initialized===!0)return t;for(var e=0;e<t.hierarchy.length;e++){for(var r=0;r<t.hierarchy[e].keys.length;r++)if(t.hierarchy[e].keys[r].time<0&&(t.hierarchy[e].keys[r].time=0),void 0!==t.hierarchy[e].keys[r].rot&&!(t.hierarchy[e].keys[r].rot instanceof n.Quaternion)){var i=t.hierarchy[e].keys[r].rot;t.hierarchy[e].keys[r].rot=(new n.Quaternion).fromArray(i)}if(t.hierarchy[e].keys.length&&void 0!==t.hierarchy[e].keys[0].morphTargets){for(var o={},r=0;r<t.hierarchy[e].keys.length;r++)for(var a=0;a<t.hierarchy[e].keys[r].morphTargets.length;a++){var s=t.hierarchy[e].keys[r].morphTargets[a];o[s]=-1}t.hierarchy[e].usedMorphTargets=o;for(var r=0;r<t.hierarchy[e].keys.length;r++){var h={};for(var s in o){for(var a=0;a<t.hierarchy[e].keys[r].morphTargets.length;a++)if(t.hierarchy[e].keys[r].morphTargets[a]===s){h[s]=t.hierarchy[e].keys[r].morphTargetsInfluences[a];break}a===t.hierarchy[e].keys[r].morphTargets.length&&(h[s]=0)}t.hierarchy[e].keys[r].morphTargetsInfluences=h}}for(var r=1;r<t.hierarchy[e].keys.length;r++)t.hierarchy[e].keys[r].time===t.hierarchy[e].keys[r-1].time&&(t.hierarchy[e].keys.splice(r,1),r--);for(var r=0;r<t.hierarchy[e].keys.length;r++)t.hierarchy[e].keys[r].index=r}return t.initialized=!0,t},parse:function(t){var e=function(t,r){r.push(t);for(var n=0;n<t.children.length;n++)e(t.children[n],r)},r=[];if(t instanceof n.SkinnedMesh)for(var i=0;i<t.skeleton.bones.length;i++)r.push(t.skeleton.bones[i]);else e(t,r);return r},play:function(t){-1===this.animations.indexOf(t)&&this.animations.push(t)},stop:function(t){var e=this.animations.indexOf(t);-1!==e&&this.animations.splice(e,1)},update:function(t){for(var e=0;e<this.animations.length;e++)this.animations[e].resetBlendWeights();for(var e=0;e<this.animations.length;e++)this.animations[e].update(t)}},n.Animation=function(t,e){this.root=t,this.data=n.AnimationHandler.init(e),this.hierarchy=n.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=n.AnimationHandler.LINEAR},n.Animation.prototype={constructor:n.Animation,keyTypes:["pos","rot","scl"],play:function(t,e){this.currentTime=void 0!==t?t:0,this.weight=void 0!==e?e:1,this.isPlaying=!0,this.reset(),n.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,n.AnimationHandler.stop(this)},reset:function(){for(var t=0,e=this.hierarchy.length;e>t;t++){var r=this.hierarchy[t];void 0===r.animationCache&&(r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var n=this.data.name,i=r.animationCache.animations,o=i[n];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:r.matrix},i[n]=o);for(var a=0;3>a;a++){for(var s=this.keyTypes[a],h=this.data.hierarchy[t].keys[0],c=this.getNextKeyWith(s,t,1);c.time<this.currentTime&&c.index>h.index;)h=c,c=this.getNextKeyWith(s,t,c.index+1);o.prevKey[s]=h,o.nextKey[s]=c}}},resetBlendWeights:function(){for(var t=0,e=this.hierarchy.length;e>t;t++){var r=this.hierarchy[t],n=r.animationCache;if(void 0!==n){var i=n.blending;i.positionWeight=0,i.quaternionWeight=0,i.scaleWeight=0}}},update:function(){var t=[],e=new n.Vector3,r=new n.Vector3,i=new n.Quaternion,o=function(t,e){var r,n,i,o,s,h,c,u,l,f=[],p=[];return r=(t.length-1)*e,n=Math.floor(r),i=r-n,f[0]=0===n?n:n-1,f[1]=n,f[2]=n>t.length-2?n:n+1,f[3]=n>t.length-3?n:n+2,h=t[f[0]],c=t[f[1]],u=t[f[2]],l=t[f[3]],o=i*i,s=i*o,p[0]=a(h[0],c[0],u[0],l[0],i,o,s),p[1]=a(h[1],c[1],u[1],l[1],i,o,s),p[2]=a(h[2],c[2],u[2],l[2],i,o,s),p},a=function(t,e,r,n,i,o,a){var s=.5*(r-t),h=.5*(n-e);return(2*(e-r)+s+h)*a+(-3*(e-r)-2*s-h)*o+s*i+e};return function(a){if(this.isPlaying!==!1&&(this.currentTime+=a*this.timeScale,0!==this.weight)){var s=this.data.length;(this.currentTime>s||this.currentTime<0)&&(this.loop?(this.currentTime%=s,this.currentTime<0&&(this.currentTime+=s),this.reset()):this.stop());for(var h=0,c=this.hierarchy.length;c>h;h++)for(var u=this.hierarchy[h],l=u.animationCache.animations[this.data.name],f=u.animationCache.blending,p=0;3>p;p++){var d=this.keyTypes[p],m=l.prevKey[d],g=l.nextKey[d];if(this.timeScale>0&&g.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){for(m=this.data.hierarchy[h].keys[0],g=this.getNextKeyWith(d,h,1);g.time<this.currentTime&&g.index>m.index;)m=g,g=this.getNextKeyWith(d,h,g.index+1);l.prevKey[d]=m,l.nextKey[d]=g}var v=(this.currentTime-m.time)/(g.time-m.time),y=m[d],b=g[d];if(0>v&&(v=0),v>1&&(v=1),"pos"===d){if(this.interpolationType===n.AnimationHandler.LINEAR){r.x=y[0]+(b[0]-y[0])*v,r.y=y[1]+(b[1]-y[1])*v,r.z=y[2]+(b[2]-y[2])*v;var x=this.weight/(this.weight+f.positionWeight);u.position.lerp(r,x),f.positionWeight+=this.weight}else if(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){t[0]=this.getPrevKeyWith("pos",h,m.index-1).pos,t[1]=y,t[2]=b,t[3]=this.getNextKeyWith("pos",h,g.index+1).pos,v=.33*v+.33;var w=o(t,v),x=this.weight/(this.weight+f.positionWeight);f.positionWeight+=this.weight;var M=u.position;if(M.x=M.x+(w[0]-M.x)*x,M.y=M.y+(w[1]-M.y)*x,M.z=M.z+(w[2]-M.z)*x,this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD){var S=o(t,1.01*v);e.set(S[0],S[1],S[2]),e.sub(M),e.y=0,e.normalize();var _=Math.atan2(e.x,e.z);u.rotation.set(0,_,0)}}}else if("rot"===d)if(n.Quaternion.slerp(y,b,i,v),0===f.quaternionWeight)u.quaternion.copy(i),f.quaternionWeight=this.weight;else{var x=this.weight/(this.weight+f.quaternionWeight);n.Quaternion.slerp(u.quaternion,i,u.quaternion,x),f.quaternionWeight+=this.weight}else if("scl"===d){r.x=y[0]+(b[0]-y[0])*v,r.y=y[1]+(b[1]-y[1])*v,r.z=y[2]+(b[2]-y[2])*v;var x=this.weight/(this.weight+f.scaleWeight);u.scale.lerp(r,x),f.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(t,e,r){var i=this.data.hierarchy[e].keys;for(this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD?r=r<i.length-1?r:i.length-1:r%=i.length;r<i.length;r++)if(void 0!==i[r][t])return i[r];return this.data.hierarchy[e].keys[0]},getPrevKeyWith:function(t,e,r){var i=this.data.hierarchy[e].keys;for(r=this.interpolationType===n.AnimationHandler.CATMULLROM||this.interpolationType===n.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][t])return i[r];return this.data.hierarchy[e].keys[i.length-1]}},n.KeyFrameAnimation=function(t){this.root=t.node,this.data=n.AnimationHandler.init(t),this.hierarchy=n.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var e=0,r=this.hierarchy.length;r>e;e++){var i=this.data.hierarchy[e].keys,o=this.data.hierarchy[e].sids,a=this.hierarchy[e];if(i.length&&o){for(var s=0;s<o.length;s++){var h=o[s],c=this.getNextKeyWith(h,e,0);c&&c.apply(h)}a.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),a.matrixWorldNeedsUpdate=!0}}},n.KeyFrameAnimation.prototype={constructor:n.KeyFrameAnimation,play:function(t){if(this.currentTime=void 0!==t?t:0,this.isPlaying===!1){this.isPlaying=!0;var e,r,i,o=this.hierarchy.length;for(e=0;o>e;e++){r=this.hierarchy[e],i=this.data.hierarchy[e],void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey=null,i.animationCache.nextKey=null,i.animationCache.originalMatrix=r.matrix);var a=this.data.hierarchy[e].keys;a.length&&(i.animationCache.prevKey=a[0],i.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,n.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,n.AnimationHandler.stop(this);for(var t=0;t<this.data.hierarchy.length;t++){var e=this.hierarchy[t],r=this.data.hierarchy[t];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;i.copy(e.matrix),e.matrix=i,delete r.animationCache}}},update:function(t){if(this.isPlaying!==!1){this.currentTime+=t*this.timeScale;var e=this.data.length;this.loop===!0&&this.currentTime>e&&(this.currentTime%=e),this.currentTime=Math.min(this.currentTime,e);for(var r=0,n=this.hierarchy.length;n>r;r++){var i=this.hierarchy[r],o=this.data.hierarchy[r],a=o.keys,s=o.animationCache;if(a.length){var h=s.prevKey,c=s.nextKey;if(c.time<=this.currentTime){for(;c.time<this.currentTime&&c.index>h.index;)h=c,c=a[h.index+1];s.prevKey=h,s.nextKey=c}c.time>=this.currentTime?h.interpolate(c,this.currentTime):h.interpolate(c,c.time),this.data.hierarchy[r].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(t,e,r){var n=this.data.hierarchy[e].keys;for(r%=n.length;r<n.length;r++)if(n[r].hasTarget(t))return n[r];return n[0]},getPrevKeyWith:function(t,e,r){var n=this.data.hierarchy[e].keys;for(r=r>=0?r:r+n.length;r>=0;r--)if(n[r].hasTarget(t))return n[r];return n[n.length-1]}},n.MorphAnimation=function(t){this.mesh=t,this.frames=t.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},n.MorphAnimation.prototype={constructor:n.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(t){if(this.isPlaying!==!1){this.currentTime+=t,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var e=this.duration/this.frames,r=Math.floor(this.currentTime/e),n=this.mesh.morphTargetInfluences;r!==this.currentFrame&&(n[this.lastFrame]=0,n[this.currentFrame]=1,n[r]=0,this.lastFrame=this.currentFrame,this.currentFrame=r);var i=this.currentTime%e/e;n[r]=i,n[this.lastFrame]=1-i}}},n.BoxGeometry=function(t,e,r,i,o,a){function s(t,e,r,i,o,a,s,c){var u,l,f,p=h.widthSegments,d=h.heightSegments,m=o/2,g=a/2,v=h.vertices.length;"x"===t&&"y"===e||"y"===t&&"x"===e?u="z":"x"===t&&"z"===e||"z"===t&&"x"===e?(u="y",d=h.depthSegments):("z"===t&&"y"===e||"y"===t&&"z"===e)&&(u="x",p=h.depthSegments);var y=p+1,b=d+1,x=o/p,w=a/d,M=new n.Vector3;for(M[u]=s>0?1:-1,f=0;b>f;f++)for(l=0;y>l;l++){var S=new n.Vector3;S[t]=(l*x-m)*r,S[e]=(f*w-g)*i,S[u]=s,h.vertices.push(S)}for(f=0;d>f;f++)for(l=0;p>l;l++){var _=l+y*f,E=l+y*(f+1),T=l+1+y*(f+1),C=l+1+y*f,A=new n.Vector2(l/p,1-f/d),L=new n.Vector2(l/p,1-(f+1)/d),P=new n.Vector2((l+1)/p,1-(f+1)/d),F=new n.Vector2((l+1)/p,1-f/d),R=new n.Face3(_+v,E+v,C+v);R.normal.copy(M),R.vertexNormals.push(M.clone(),M.clone(),M.clone()),R.materialIndex=c,h.faces.push(R),h.faceVertexUvs[0].push([A,L,F]),R=new n.Face3(E+v,T+v,C+v),R.normal.copy(M),R.vertexNormals.push(M.clone(),M.clone(),M.clone()),R.materialIndex=c,h.faces.push(R),h.faceVertexUvs[0].push([L.clone(),P,F.clone()])}}n.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:o,depthSegments:a},this.widthSegments=i||1,this.heightSegments=o||1,this.depthSegments=a||1;var h=this,c=t/2,u=e/2,l=r/2;s("z","y",-1,-1,r,e,c,0),s("z","y",1,-1,r,e,-c,1),s("x","z",1,1,t,r,u,2),s("x","z",1,-1,t,r,-u,3),s("x","y",1,-1,t,e,l,4),s("x","y",-1,-1,t,e,-l,5),this.mergeVertices()},n.BoxGeometry.prototype=Object.create(n.Geometry.prototype),n.BoxGeometry.prototype.constructor=n.BoxGeometry,n.BoxGeometry.prototype.clone=function(){var t=new n.BoxGeometry(this.parameters.width,this.parameters.height,this.parameters.depth,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.depthSegments);return t},n.CubeGeometry=n.BoxGeometry,n.CircleGeometry=function(t,e,r,i){n.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},t=t||50,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var o,a=[],s=new n.Vector3,h=new n.Vector2(.5,.5);for(this.vertices.push(s),a.push(h),o=0;e>=o;o++){var c=new n.Vector3,u=r+o/e*i;c.x=t*Math.cos(u),c.y=t*Math.sin(u),this.vertices.push(c),a.push(new n.Vector2((c.x/t+1)/2,(c.y/t+1)/2))}var l=new n.Vector3(0,0,1);for(o=1;e>=o;o++)this.faces.push(new n.Face3(o,o+1,0,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[o+1].clone(),h.clone()]);this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,t)},n.CircleGeometry.prototype=Object.create(n.Geometry.prototype),n.CircleGeometry.prototype.constructor=n.CircleGeometry,n.CircleGeometry.prototype.clone=function(){var t=new n.CircleGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);return t},n.CircleBufferGeometry=function(t,e,r,i){n.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},t=t||50,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var o=e+2,a=new Float32Array(3*o),s=new Float32Array(3*o),h=new Float32Array(2*o);s[3]=1,h[0]=.5,h[1]=.5;for(var c=0,u=3,l=2;e>=c;c++,u+=3,l+=2){var f=r+c/e*i;a[u]=t*Math.cos(f),a[u+1]=t*Math.sin(f),s[u+2]=1,h[l]=(a[u]/t+1)/2,h[l+1]=(a[u+1]/t+1)/2}for(var p=[],u=1;e>=u;u++)p.push(u),p.push(u+1),p.push(0);this.setIndex(new n.BufferAttribute(new Uint16Array(p),1)),this.addAttribute("position",new n.BufferAttribute(a,3)),this.addAttribute("normal",new n.BufferAttribute(s,3)),this.addAttribute("uv",new n.BufferAttribute(h,2)),this.boundingSphere=new n.Sphere(new n.Vector3,t)},n.CircleBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.CircleBufferGeometry.prototype.constructor=n.CircleBufferGeometry,n.CircleBufferGeometry.prototype.clone=function(){var t=new n.CircleBufferGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);return t.copy(this),t},n.CylinderGeometry=function(t,e,r,i,o,a,s,h){n.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:h},t=void 0!==t?t:20,e=void 0!==e?e:20,r=void 0!==r?r:100,i=i||8,o=o||1,a=void 0!==a?a:!1,s=void 0!==s?s:0,h=void 0!==h?h:2*Math.PI;var c,u,l=r/2,f=[],p=[];for(u=0;o>=u;u++){var d=[],m=[],g=u/o,v=g*(e-t)+t;for(c=0;i>=c;c++){var y=c/i,b=new n.Vector3;b.x=v*Math.sin(y*h+s),b.y=-g*r+l,b.z=v*Math.cos(y*h+s),this.vertices.push(b),d.push(this.vertices.length-1),m.push(new n.Vector2(y,1-g))}f.push(d),p.push(m)}var x,w,M=(e-t)/r;for(c=0;i>c;c++)for(0!==t?(x=this.vertices[f[0][c]].clone(),w=this.vertices[f[0][c+1]].clone()):(x=this.vertices[f[1][c]].clone(),w=this.vertices[f[1][c+1]].clone()),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*M).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*M).normalize(),u=0;o>u;u++){var S=f[u][c],_=f[u+1][c],E=f[u+1][c+1],T=f[u][c+1],C=x.clone(),A=x.clone(),L=w.clone(),P=w.clone(),F=p[u][c].clone(),R=p[u+1][c].clone(),k=p[u+1][c+1].clone(),O=p[u][c+1].clone();this.faces.push(new n.Face3(S,_,T,[C,A,P])),this.faceVertexUvs[0].push([F,R,O]),this.faces.push(new n.Face3(_,E,T,[A.clone(),L,P.clone()])),this.faceVertexUvs[0].push([R.clone(),k,O.clone()])}if(a===!1&&t>0)for(this.vertices.push(new n.Vector3(0,l,0)),c=0;i>c;c++){var S=f[0][c],_=f[0][c+1],E=this.vertices.length-1,C=new n.Vector3(0,1,0),A=new n.Vector3(0,1,0),L=new n.Vector3(0,1,0),F=p[0][c].clone(),R=p[0][c+1].clone(),k=new n.Vector2(R.x,0);this.faces.push(new n.Face3(S,_,E,[C,A,L],void 0,1)),this.faceVertexUvs[0].push([F,R,k])}if(a===!1&&e>0)for(this.vertices.push(new n.Vector3(0,-l,0)),c=0;i>c;c++){var S=f[o][c+1],_=f[o][c],E=this.vertices.length-1,C=new n.Vector3(0,-1,0),A=new n.Vector3(0,-1,0),L=new n.Vector3(0,-1,0),F=p[o][c+1].clone(),R=p[o][c].clone(),k=new n.Vector2(R.x,1);this.faces.push(new n.Face3(S,_,E,[C,A,L],void 0,2)),this.faceVertexUvs[0].push([F,R,k])}this.computeFaceNormals()},n.CylinderGeometry.prototype=Object.create(n.Geometry.prototype),n.CylinderGeometry.prototype.constructor=n.CylinderGeometry,n.CylinderGeometry.prototype.clone=function(){var t=new n.CylinderGeometry(this.parameters.radiusTop,this.parameters.radiusBottom,this.parameters.height,this.parameters.radialSegments,this.parameters.heightSegments,this.parameters.openEnded,this.parameters.thetaStart,this.parameters.thetaLength);return t},n.EdgesGeometry=function(t,e){n.BufferGeometry.call(this),e=void 0!==e?e:1;var r,i=Math.cos(n.Math.degToRad(e)),o=[0,0],a={},s=function(t,e){return t-e},h=["a","b","c"];t instanceof n.BufferGeometry?(r=new n.Geometry,r.fromBufferGeometry(t)):r=t.clone(),r.mergeVertices(),r.computeFaceNormals();for(var c=r.vertices,u=r.faces,l=0,f=u.length;f>l;l++)for(var p=u[l],d=0;3>d;d++){o[0]=p[h[d]],o[1]=p[h[(d+1)%3]],o.sort(s);var m=o.toString();void 0===a[m]?a[m]={vert1:o[0],vert2:o[1],face1:l,face2:void 0}:a[m].face2=l}var g=[];for(var m in a){var v=a[m];if(void 0===v.face2||u[v.face1].normal.dot(u[v.face2].normal)<=i){var y=c[v.vert1];g.push(y.x),g.push(y.y),g.push(y.z),y=c[v.vert2],g.push(y.x),g.push(y.y),g.push(y.z)}}this.addAttribute("position",new n.BufferAttribute(new Float32Array(g),3))},n.EdgesGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.EdgesGeometry.prototype.constructor=n.EdgesGeometry,n.ExtrudeGeometry=function(t,e){return"undefined"==typeof t?void(t=[]):(n.Geometry.call(this),this.type="ExtrudeGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),void this.computeFaceNormals())},n.ExtrudeGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry.prototype.constructor=n.ExtrudeGeometry,n.ExtrudeGeometry.prototype.addShapeList=function(t,e){for(var r=t.length,n=0;r>n;n++){var i=t[n];this.addShape(i,e)}},n.ExtrudeGeometry.prototype.addShape=function(t,e){function r(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}function i(t,e,r){var i,o,a=1e-10,s=1,h=t.x-e.x,c=t.y-e.y,u=r.x-t.x,l=r.y-t.y,f=h*h+c*c,p=h*l-c*u;if(Math.abs(p)>a){var d=Math.sqrt(f),m=Math.sqrt(u*u+l*l),g=e.x-c/d,v=e.y+h/d,y=r.x-l/m,b=r.y+u/m,x=((y-g)*l-(b-v)*u)/(h*l-c*u);i=g+h*x-t.x,o=v+c*x-t.y;var w=i*i+o*o;if(2>=w)return new n.Vector2(i,o);s=Math.sqrt(w/2)}else{var M=!1;h>a?u>a&&(M=!0):-a>h?-a>u&&(M=!0):Math.sign(c)===Math.sign(l)&&(M=!0),M?(i=-c,o=h,s=Math.sqrt(f)):(i=h,o=c,s=Math.sqrt(f/2))}return new n.Vector2(i/s,o/s)}function o(){if(x){var t=0,e=j*t;for(X=0;H>X;X++)z=D[X],c(z[2]+e,z[1]+e,z[0]+e);for(t=M+2*b,e=j*t,X=0;H>X;X++)z=D[X],c(z[0]+e,z[1]+e,z[2]+e)}else{for(X=0;H>X;X++)z=D[X],c(z[2],z[1],z[0]);for(X=0;H>X;X++)z=D[X],c(z[0]+j*M,z[1]+j*M,z[2]+j*M)}}function a(){var t=0;for(s(U,t),t+=U.length,C=0,A=k.length;A>C;C++)T=k[C],s(T,t),t+=T.length}function s(t,e){var r,n;for(X=t.length;--X>=0;){r=X,n=X-1,0>n&&(n=t.length-1);var i=0,o=M+2*b;for(i=0;o>i;i++){var a=j*i,s=j*(i+1),h=e+r+a,c=e+n+a,l=e+n+s,f=e+r+s;u(h,c,l,f,t,i,o,r,n)}}}function h(t,e,r){L.vertices.push(new n.Vector3(t,e,r))}function c(t,e,r){t+=P,e+=P,r+=P,L.faces.push(new n.Face3(t,e,r));var i=E.generateTopUV(L,t,e,r);L.faceVertexUvs[0].push(i)}function u(t,e,r,i,o,a,s,h,c){t+=P,e+=P,r+=P,i+=P,L.faces.push(new n.Face3(t,e,i)),L.faces.push(new n.Face3(e,r,i));var u=E.generateSideWallUV(L,t,e,r,i);L.faceVertexUvs[0].push([u[0],u[1],u[3]]),
L.faceVertexUvs[0].push([u[1],u[2],u[3]])}var l,f,p,d,m,g=void 0!==e.amount?e.amount:100,v=void 0!==e.bevelThickness?e.bevelThickness:6,y=void 0!==e.bevelSize?e.bevelSize:v-2,b=void 0!==e.bevelSegments?e.bevelSegments:3,x=void 0!==e.bevelEnabled?e.bevelEnabled:!0,w=void 0!==e.curveSegments?e.curveSegments:12,M=void 0!==e.steps?e.steps:1,S=e.extrudePath,_=!1,E=void 0!==e.UVGenerator?e.UVGenerator:n.ExtrudeGeometry.WorldUVGenerator;S&&(l=S.getSpacedPoints(M),_=!0,x=!1,f=void 0!==e.frames?e.frames:new n.TubeGeometry.FrenetFrames(S,M,!1),p=new n.Vector3,d=new n.Vector3,m=new n.Vector3),x||(b=0,v=0,y=0);var T,C,A,L=this,P=this.vertices.length,F=t.extractPoints(w),R=F.shape,k=F.holes,O=!n.Shape.Utils.isClockWise(R);if(O){for(R=R.reverse(),C=0,A=k.length;A>C;C++)T=k[C],n.Shape.Utils.isClockWise(T)&&(k[C]=T.reverse());O=!1}var D=n.Shape.Utils.triangulateShape(R,k),U=R;for(C=0,A=k.length;A>C;C++)T=k[C],R=R.concat(T);for(var B,I,N,V,G,z,j=R.length,H=D.length,W=[],X=0,q=U.length,K=q-1,Y=X+1;q>X;X++,K++,Y++)K===q&&(K=0),Y===q&&(Y=0),W[X]=i(U[X],U[K],U[Y]);var Q,Z=[],J=W.concat();for(C=0,A=k.length;A>C;C++){for(T=k[C],Q=[],X=0,q=T.length,K=q-1,Y=X+1;q>X;X++,K++,Y++)K===q&&(K=0),Y===q&&(Y=0),Q[X]=i(T[X],T[K],T[Y]);Z.push(Q),J=J.concat(Q)}for(B=0;b>B;B++){for(N=B/b,V=v*(1-N),I=y*Math.sin(N*Math.PI/2),X=0,q=U.length;q>X;X++)G=r(U[X],W[X],I),h(G.x,G.y,-V);for(C=0,A=k.length;A>C;C++)for(T=k[C],Q=Z[C],X=0,q=T.length;q>X;X++)G=r(T[X],Q[X],I),h(G.x,G.y,-V)}for(I=y,X=0;j>X;X++)G=x?r(R[X],J[X],I):R[X],_?(d.copy(f.normals[0]).multiplyScalar(G.x),p.copy(f.binormals[0]).multiplyScalar(G.y),m.copy(l[0]).add(d).add(p),h(m.x,m.y,m.z)):h(G.x,G.y,0);var $;for($=1;M>=$;$++)for(X=0;j>X;X++)G=x?r(R[X],J[X],I):R[X],_?(d.copy(f.normals[$]).multiplyScalar(G.x),p.copy(f.binormals[$]).multiplyScalar(G.y),m.copy(l[$]).add(d).add(p),h(m.x,m.y,m.z)):h(G.x,G.y,g/M*$);for(B=b-1;B>=0;B--){for(N=B/b,V=v*(1-N),I=y*Math.sin(N*Math.PI/2),X=0,q=U.length;q>X;X++)G=r(U[X],W[X],I),h(G.x,G.y,g+V);for(C=0,A=k.length;A>C;C++)for(T=k[C],Q=Z[C],X=0,q=T.length;q>X;X++)G=r(T[X],Q[X],I),_?h(G.x,G.y+l[M-1].y,l[M-1].x+V):h(G.x,G.y,g+V)}o(),a()},n.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,e,r,i){var o=t.vertices,a=o[e],s=o[r],h=o[i];return[new n.Vector2(a.x,a.y),new n.Vector2(s.x,s.y),new n.Vector2(h.x,h.y)]},generateSideWallUV:function(t,e,r,i,o){var a=t.vertices,s=a[e],h=a[r],c=a[i],u=a[o];return Math.abs(s.y-h.y)<.01?[new n.Vector2(s.x,1-s.z),new n.Vector2(h.x,1-h.z),new n.Vector2(c.x,1-c.z),new n.Vector2(u.x,1-u.z)]:[new n.Vector2(s.y,1-s.z),new n.Vector2(h.y,1-h.z),new n.Vector2(c.y,1-c.z),new n.Vector2(u.y,1-u.z)]}},n.ShapeGeometry=function(t,e){n.Geometry.call(this),this.type="ShapeGeometry",Array.isArray(t)===!1&&(t=[t]),this.addShapeList(t,e),this.computeFaceNormals()},n.ShapeGeometry.prototype=Object.create(n.Geometry.prototype),n.ShapeGeometry.prototype.constructor=n.ShapeGeometry,n.ShapeGeometry.prototype.addShapeList=function(t,e){for(var r=0,n=t.length;n>r;r++)this.addShape(t[r],e);return this},n.ShapeGeometry.prototype.addShape=function(t,e){void 0===e&&(e={});var r,i,o,a=void 0!==e.curveSegments?e.curveSegments:12,s=e.material,h=void 0===e.UVGenerator?n.ExtrudeGeometry.WorldUVGenerator:e.UVGenerator,c=this.vertices.length,u=t.extractPoints(a),l=u.shape,f=u.holes,p=!n.Shape.Utils.isClockWise(l);if(p){for(l=l.reverse(),r=0,i=f.length;i>r;r++)o=f[r],n.Shape.Utils.isClockWise(o)&&(f[r]=o.reverse());p=!1}var d=n.Shape.Utils.triangulateShape(l,f);for(r=0,i=f.length;i>r;r++)o=f[r],l=l.concat(o);var m,g,v=l.length,y=d.length;for(r=0;v>r;r++)m=l[r],this.vertices.push(new n.Vector3(m.x,m.y,0));for(r=0;y>r;r++){g=d[r];var b=g[0]+c,x=g[1]+c,w=g[2]+c;this.faces.push(new n.Face3(b,x,w,null,null,s)),this.faceVertexUvs[0].push(h.generateTopUV(this,b,x,w))}},n.LatheGeometry=function(t,e,r,i){n.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=e||12,r=r||0,i=i||2*Math.PI;for(var o=1/(t.length-1),a=1/e,s=0,h=e;h>=s;s++)for(var c=r+s*a*i,u=Math.cos(c),l=Math.sin(c),f=0,p=t.length;p>f;f++){var d=t[f],m=new n.Vector3;m.x=u*d.x-l*d.y,m.y=l*d.x+u*d.y,m.z=d.z,this.vertices.push(m)}for(var g=t.length,s=0,h=e;h>s;s++)for(var f=0,p=t.length-1;p>f;f++){var v=f+g*s,y=v,b=v+g,u=v+1+g,x=v+1,w=s*a,M=f*o,S=w+a,_=M+o;this.faces.push(new n.Face3(y,b,x)),this.faceVertexUvs[0].push([new n.Vector2(w,M),new n.Vector2(S,M),new n.Vector2(w,_)]),this.faces.push(new n.Face3(b,u,x)),this.faceVertexUvs[0].push([new n.Vector2(S,M),new n.Vector2(S,_),new n.Vector2(w,_)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},n.LatheGeometry.prototype=Object.create(n.Geometry.prototype),n.LatheGeometry.prototype.constructor=n.LatheGeometry,n.PlaneGeometry=function(t,e,r,i){n.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new n.PlaneBufferGeometry(t,e,r,i))},n.PlaneGeometry.prototype=Object.create(n.Geometry.prototype),n.PlaneGeometry.prototype.constructor=n.PlaneGeometry,n.PlaneGeometry.prototype.clone=function(){var t=new n.PlaneGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);return t},n.PlaneBufferGeometry=function(t,e,r,i){n.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i};for(var o=t/2,a=e/2,s=Math.floor(r)||1,h=Math.floor(i)||1,c=s+1,u=h+1,l=t/s,f=e/h,p=new Float32Array(c*u*3),d=new Float32Array(c*u*3),m=new Float32Array(c*u*2),g=0,v=0,y=0;u>y;y++)for(var b=y*f-a,x=0;c>x;x++){var w=x*l-o;p[g]=w,p[g+1]=-b,d[g+2]=1,m[v]=x/s,m[v+1]=1-y/h,g+=3,v+=2}g=0;for(var M=new(p.length/3>65535?Uint32Array:Uint16Array)(s*h*6),y=0;h>y;y++)for(var x=0;s>x;x++){var S=x+c*y,_=x+c*(y+1),E=x+1+c*(y+1),T=x+1+c*y;M[g]=S,M[g+1]=_,M[g+2]=T,M[g+3]=_,M[g+4]=E,M[g+5]=T,g+=6}this.setIndex(new n.BufferAttribute(M,1)),this.addAttribute("position",new n.BufferAttribute(p,3)),this.addAttribute("normal",new n.BufferAttribute(d,3)),this.addAttribute("uv",new n.BufferAttribute(m,2))},n.PlaneBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.PlaneBufferGeometry.prototype.constructor=n.PlaneBufferGeometry,n.PlaneBufferGeometry.prototype.clone=function(){var t=new n.PlaneBufferGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);return t.copy(this),t},n.RingGeometry=function(t,e,r,i,o,a){n.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:a},t=t||0,e=e||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(1,i):8;var s,h,c=[],u=t,l=(e-t)/i;for(s=0;i+1>s;s++){for(h=0;r+1>h;h++){var f=new n.Vector3,p=o+h/r*a;f.x=u*Math.cos(p),f.y=u*Math.sin(p),this.vertices.push(f),c.push(new n.Vector2((f.x/e+1)/2,(f.y/e+1)/2))}u+=l}var d=new n.Vector3(0,0,1);for(s=0;i>s;s++){var m=s*(r+1);for(h=0;r>h;h++){var p=h+m,g=p,v=p+r+1,y=p+r+2;this.faces.push(new n.Face3(g,v,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([c[g].clone(),c[v].clone(),c[y].clone()]),g=p,v=p+r+2,y=p+1,this.faces.push(new n.Face3(g,v,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([c[g].clone(),c[v].clone(),c[y].clone()])}}this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,u)},n.RingGeometry.prototype=Object.create(n.Geometry.prototype),n.RingGeometry.prototype.constructor=n.RingGeometry,n.RingGeometry.prototype.clone=function(){var t=new n.RingGeometry(this.parameters.innerRadius,this.parameters.outerRadius,this.parameters.thetaSegments,this.parameters.phiSegments,this.parameters.thetaStart,this.parameters.thetaLength);return t},n.SphereGeometry=function(t,e,r,i,o,a,s){n.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new n.SphereBufferGeometry(t,e,r,i,o,a,s))},n.SphereGeometry.prototype=Object.create(n.Geometry.prototype),n.SphereGeometry.prototype.constructor=n.SphereGeometry,n.SphereGeometry.prototype.clone=function(){var t=new n.SphereGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);return t},n.SphereBufferGeometry=function(t,e,r,i,o,a,s){n.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:o,thetaStart:a,thetaLength:s},t=t||50,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;for(var h=a+s,c=(e+1)*(r+1),u=new n.BufferAttribute(new Float32Array(3*c),3),l=new n.BufferAttribute(new Float32Array(3*c),3),f=new n.BufferAttribute(new Float32Array(2*c),2),p=0,d=[],m=new n.Vector3,g=0;r>=g;g++){for(var v=[],y=g/r,b=0;e>=b;b++){var x=b/e,w=-t*Math.cos(i+x*o)*Math.sin(a+y*s),M=t*Math.cos(a+y*s),S=t*Math.sin(i+x*o)*Math.sin(a+y*s);m.set(w,M,S).normalize(),u.setXYZ(p,w,M,S),l.setXYZ(p,m.x,m.y,m.z),f.setXY(p,x,1-y),v.push(p),p++}d.push(v)}for(var _=[],g=0;r>g;g++)for(var b=0;e>b;b++){var E=d[g][b+1],T=d[g][b],C=d[g+1][b],A=d[g+1][b+1];(0!==g||a>0)&&_.push(E,T,A),(g!==r-1||h<Math.PI)&&_.push(T,C,A)}this.setIndex(new n.BufferAttribute(new Uint16Array(_),1)),this.addAttribute("position",u),this.addAttribute("normal",l),this.addAttribute("uv",f),this.boundingSphere=new n.Sphere(new n.Vector3,t)},n.SphereBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.SphereBufferGeometry.prototype.constructor=n.SphereBufferGeometry,n.SphereBufferGeometry.prototype.clone=function(){var t=new n.SphereBufferGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);return t.copy(this),t},n.TextGeometry=function(t,e){e=e||{};var r=n.FontUtils.generateShapes(t,e);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),n.ExtrudeGeometry.call(this,r,e),this.type="TextGeometry"},n.TextGeometry.prototype=Object.create(n.ExtrudeGeometry.prototype),n.TextGeometry.prototype.constructor=n.TextGeometry,n.TorusGeometry=function(t,e,r,i,o){n.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:o},t=t||100,e=e||40,r=r||8,i=i||6,o=o||2*Math.PI;for(var a=new n.Vector3,s=[],h=[],c=0;r>=c;c++)for(var u=0;i>=u;u++){var l=u/i*o,f=c/r*Math.PI*2;a.x=t*Math.cos(l),a.y=t*Math.sin(l);var p=new n.Vector3;p.x=(t+e*Math.cos(f))*Math.cos(l),p.y=(t+e*Math.cos(f))*Math.sin(l),p.z=e*Math.sin(f),this.vertices.push(p),s.push(new n.Vector2(u/i,c/r)),h.push(p.clone().sub(a).normalize())}for(var c=1;r>=c;c++)for(var u=1;i>=u;u++){var d=(i+1)*c+u-1,m=(i+1)*(c-1)+u-1,g=(i+1)*(c-1)+u,v=(i+1)*c+u,y=new n.Face3(d,m,v,[h[d].clone(),h[m].clone(),h[v].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([s[d].clone(),s[m].clone(),s[v].clone()]),y=new n.Face3(m,g,v,[h[m].clone(),h[g].clone(),h[v].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([s[m].clone(),s[g].clone(),s[v].clone()])}this.computeFaceNormals()},n.TorusGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusGeometry.prototype.constructor=n.TorusGeometry,n.TorusGeometry.prototype.clone=function(){var t=new n.TorusGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.arc);return t},n.TorusKnotGeometry=function(t,e,r,i,o,a,s){function h(t,e,r,i,o){var a=Math.cos(t),s=Math.sin(t),h=e/r*t,c=Math.cos(h),u=i*(2+c)*.5*a,l=i*(2+c)*s*.5,f=o*i*Math.sin(h)*.5;return new n.Vector3(u,l,f)}n.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,p:o,q:a,heightScale:s},t=t||100,e=e||40,r=r||64,i=i||8,o=o||2,a=a||3,s=s||1;for(var c=new Array(r),u=new n.Vector3,l=new n.Vector3,f=new n.Vector3,p=0;r>p;++p){c[p]=new Array(i);var d=p/r*2*o*Math.PI,m=h(d,a,o,t,s),g=h(d+.01,a,o,t,s);u.subVectors(g,m),l.addVectors(g,m),f.crossVectors(u,l),l.crossVectors(f,u),f.normalize(),l.normalize();for(var v=0;i>v;++v){var y=v/i*2*Math.PI,b=-e*Math.cos(y),x=e*Math.sin(y),w=new n.Vector3;w.x=m.x+b*l.x+x*f.x,w.y=m.y+b*l.y+x*f.y,w.z=m.z+b*l.z+x*f.z,c[p][v]=this.vertices.push(w)-1}}for(var p=0;r>p;++p)for(var v=0;i>v;++v){var M=(p+1)%r,S=(v+1)%i,_=c[p][v],E=c[M][v],T=c[M][S],C=c[p][S],A=new n.Vector2(p/r,v/i),L=new n.Vector2((p+1)/r,v/i),P=new n.Vector2((p+1)/r,(v+1)/i),F=new n.Vector2(p/r,(v+1)/i);this.faces.push(new n.Face3(_,E,C)),this.faceVertexUvs[0].push([A,L,F]),this.faces.push(new n.Face3(E,T,C)),this.faceVertexUvs[0].push([L.clone(),P,F.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},n.TorusKnotGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusKnotGeometry.prototype.constructor=n.TorusKnotGeometry,n.TorusKnotGeometry.prototype.clone=function(){var t=new n.TorusKnotGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.p,this.parameters.q,this.parameters.heightScale);return t},n.TubeGeometry=function(t,e,r,i,o,a){function s(t,e,r){return P.vertices.push(new n.Vector3(t,e,r))-1}n.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:t,segments:e,radius:r,radialSegments:i,closed:o},e=e||64,r=r||1,i=i||8,o=o||!1,a=a||n.TubeGeometry.NoTaper;var h,c,u,l,f,p,d,m,g,v,y,b,x,w,M,S,_,E,T,C,A,L=[],P=this,F=e+1,R=new n.Vector3,k=new n.TubeGeometry.FrenetFrames(t,e,o),O=k.tangents,D=k.normals,U=k.binormals;for(this.tangents=O,this.normals=D,this.binormals=U,v=0;F>v;v++)for(L[v]=[],l=v/(F-1),g=t.getPointAt(l),h=O[v],c=D[v],u=U[v],p=r*a(l),y=0;i>y;y++)f=y/i*2*Math.PI,d=-p*Math.cos(f),m=p*Math.sin(f),R.copy(g),R.x+=d*c.x+m*u.x,R.y+=d*c.y+m*u.y,R.z+=d*c.z+m*u.z,L[v][y]=s(R.x,R.y,R.z);for(v=0;e>v;v++)for(y=0;i>y;y++)b=o?(v+1)%e:v+1,x=(y+1)%i,w=L[v][y],M=L[b][y],S=L[b][x],_=L[v][x],E=new n.Vector2(v/e,y/i),T=new n.Vector2((v+1)/e,y/i),C=new n.Vector2((v+1)/e,(y+1)/i),A=new n.Vector2(v/e,(y+1)/i),this.faces.push(new n.Face3(w,M,_)),this.faceVertexUvs[0].push([E,T,A]),this.faces.push(new n.Face3(M,S,_)),this.faceVertexUvs[0].push([T.clone(),C,A.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},n.TubeGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry.prototype.constructor=n.TubeGeometry,n.TubeGeometry.NoTaper=function(t){return 1},n.TubeGeometry.SinusoidalTaper=function(t){return Math.sin(Math.PI*t)},n.TubeGeometry.FrenetFrames=function(t,e,r){function i(){d[0]=new n.Vector3,m[0]=new n.Vector3,a=Number.MAX_VALUE,s=Math.abs(p[0].x),h=Math.abs(p[0].y),c=Math.abs(p[0].z),a>=s&&(a=s,f.set(1,0,0)),a>=h&&(a=h,f.set(0,1,0)),a>=c&&f.set(0,0,1),g.crossVectors(p[0],f).normalize(),d[0].crossVectors(p[0],g),m[0].crossVectors(p[0],d[0])}var o,a,s,h,c,u,l,f=new n.Vector3,p=[],d=[],m=[],g=new n.Vector3,v=new n.Matrix4,y=e+1,b=1e-4;for(this.tangents=p,this.normals=d,this.binormals=m,u=0;y>u;u++)l=u/(y-1),p[u]=t.getTangentAt(l),p[u].normalize();for(i(),u=1;y>u;u++)d[u]=d[u-1].clone(),m[u]=m[u-1].clone(),g.crossVectors(p[u-1],p[u]),g.length()>b&&(g.normalize(),o=Math.acos(n.Math.clamp(p[u-1].dot(p[u]),-1,1)),d[u].applyMatrix4(v.makeRotationAxis(g,o))),m[u].crossVectors(p[u],d[u]);if(r)for(o=Math.acos(n.Math.clamp(d[0].dot(d[y-1]),-1,1)),o/=y-1,p[0].dot(g.crossVectors(d[0],d[y-1]))>0&&(o=-o),u=1;y>u;u++)d[u].applyMatrix4(v.makeRotationAxis(p[u],o*u)),m[u].crossVectors(p[u],d[u])},n.PolyhedronGeometry=function(t,e,r,i){function o(t){var e=t.normalize().clone();e.index=l.vertices.push(e)-1;var r=h(t)/2/Math.PI+.5,i=c(t)/Math.PI+.5;return e.uv=new n.Vector2(r,1-i),e}function a(t,e,r,i){var o=new n.Face3(t.index,e.index,r.index,[t.clone(),e.clone(),r.clone()],void 0,i);l.faces.push(o),x.copy(t).add(e).add(r).divideScalar(3);var a=h(x);l.faceVertexUvs[0].push([u(t.uv,t,a),u(e.uv,e,a),u(r.uv,r,a)])}function s(t,e){for(var r=Math.pow(2,e),n=o(l.vertices[t.a]),i=o(l.vertices[t.b]),s=o(l.vertices[t.c]),h=[],c=t.materialIndex,u=0;r>=u;u++){h[u]=[];for(var f=o(n.clone().lerp(s,u/r)),p=o(i.clone().lerp(s,u/r)),d=r-u,m=0;d>=m;m++)0===m&&u===r?h[u][m]=f:h[u][m]=o(f.clone().lerp(p,m/d))}for(var u=0;r>u;u++)for(var m=0;2*(r-u)-1>m;m++){var g=Math.floor(m/2);m%2===0?a(h[u][g+1],h[u+1][g],h[u][g],c):a(h[u][g+1],h[u+1][g+1],h[u+1][g],c)}}function h(t){return Math.atan2(t.z,-t.x)}function c(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}function u(t,e,r){return 0>r&&1===t.x&&(t=new n.Vector2(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new n.Vector2(r/2/Math.PI+.5,t.y)),t.clone()}n.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},r=r||1,i=i||0;for(var l=this,f=0,p=t.length;p>f;f+=3)o(new n.Vector3(t[f],t[f+1],t[f+2]));for(var d=this.vertices,m=[],f=0,g=0,p=e.length;p>f;f+=3,g++){var v=d[e[f]],y=d[e[f+1]],b=d[e[f+2]];m[g]=new n.Face3(v.index,y.index,b.index,[v.clone(),y.clone(),b.clone()],void 0,g)}for(var x=new n.Vector3,f=0,p=m.length;p>f;f++)s(m[f],i);for(var f=0,p=this.faceVertexUvs[0].length;p>f;f++){var w=this.faceVertexUvs[0][f],M=w[0].x,S=w[1].x,_=w[2].x,E=Math.max(M,Math.max(S,_)),T=Math.min(M,Math.min(S,_));E>.9&&.1>T&&(.2>M&&(w[0].x+=1),.2>S&&(w[1].x+=1),.2>_&&(w[2].x+=1))}for(var f=0,p=this.vertices.length;p>f;f++)this.vertices[f].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,r)},n.PolyhedronGeometry.prototype=Object.create(n.Geometry.prototype),n.PolyhedronGeometry.prototype.constructor=n.PolyhedronGeometry,n.PolyhedronGeometry.prototype.clone=function(){var t=new n.PolyhedronGeometry(this.parameters.vertices,this.parameters.indices,this.parameters.radius,this.parameters.detail);return t.copy(this)},n.PolyhedronGeometry.prototype.copy=function(t){return n.Geometry.prototype.copy.call(this,t),this},n.DodecahedronGeometry=function(t,e){var r=(1+Math.sqrt(5))/2,i=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];n.PolyhedronGeometry.call(this,o,a,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}},n.DodecahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.DodecahedronGeometry.prototype.constructor=n.DodecahedronGeometry,n.DodecahedronGeometry.prototype.clone=function(){var t=new n.DodecahedronGeometry(this.parameters.radius,this.parameters.detail);return t.copy(this),t},n.IcosahedronGeometry=function(t,e){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];n.PolyhedronGeometry.call(this,i,o,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}},n.IcosahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.IcosahedronGeometry.prototype.constructor=n.IcosahedronGeometry,n.IcosahedronGeometry.prototype.clone=function(){var t=new n.IcosahedronGeometry(this.parameters.radius,this.parameters.detail);return t.copy(this),t},n.OctahedronGeometry=function(t,e){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];n.PolyhedronGeometry.call(this,r,i,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}},n.OctahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.OctahedronGeometry.prototype.constructor=n.OctahedronGeometry,n.OctahedronGeometry.prototype.clone=function(){var t=new n.OctahedronGeometry(this.parameters.radius,this.parameters.detail);return t.copy(this),t},n.TetrahedronGeometry=function(t,e){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];n.PolyhedronGeometry.call(this,r,i,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}},n.TetrahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.TetrahedronGeometry.prototype.constructor=n.TetrahedronGeometry,n.TetrahedronGeometry.prototype.clone=function(){var t=new n.TetrahedronGeometry(this.parameters.radius,this.parameters.detail);return t.copy(this),t},n.ParametricGeometry=function(t,e,r){n.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r};var i,o,a,s,h,c=this.vertices,u=this.faces,l=this.faceVertexUvs[0],f=e+1;for(i=0;r>=i;i++)for(h=i/r,o=0;e>=o;o++)s=o/e,a=t(s,h),c.push(a);var p,d,m,g,v,y,b,x;for(i=0;r>i;i++)for(o=0;e>o;o++)p=i*f+o,d=i*f+o+1,m=(i+1)*f+o+1,g=(i+1)*f+o,v=new n.Vector2(o/e,i/r),y=new n.Vector2((o+1)/e,i/r),b=new n.Vector2((o+1)/e,(i+1)/r),x=new n.Vector2(o/e,(i+1)/r),u.push(new n.Face3(p,d,g)),l.push([v,y,x]),u.push(new n.Face3(d,m,g)),l.push([y.clone(),b,x.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},n.ParametricGeometry.prototype=Object.create(n.Geometry.prototype),n.ParametricGeometry.prototype.constructor=n.ParametricGeometry,n.WireframeGeometry=function(t){n.BufferGeometry.call(this);var e=[0,0],r={},i=function(t,e){return t-e},o=["a","b","c"];if(t instanceof n.Geometry){for(var a=t.vertices,s=t.faces,h=0,c=new Uint32Array(6*s.length),u=0,l=s.length;l>u;u++)for(var f=s[u],p=0;3>p;p++){e[0]=f[o[p]],e[1]=f[o[(p+1)%3]],e.sort(i);var d=e.toString();void 0===r[d]&&(c[2*h]=e[0],c[2*h+1]=e[1],r[d]=!0,h++)}for(var m=new Float32Array(2*h*3),u=0,l=h;l>u;u++)for(var p=0;2>p;p++){var g=a[c[2*u+p]],v=6*u+3*p;m[v+0]=g.x,m[v+1]=g.y,m[v+2]=g.z}this.addAttribute("position",new n.BufferAttribute(m,3))}else if(t instanceof n.BufferGeometry)if(null!==t.index){var y=t.index.array,a=t.attributes.position,b=t.drawcalls,h=0;0===b.length&&t.addDrawCall(0,y.length);for(var c=new Uint32Array(2*y.length),x=0,w=b.length;w>x;++x)for(var M=b[x],S=M.start,_=M.count,u=S,E=S+_;E>u;u+=3)for(var p=0;3>p;p++){e[0]=y[u+p],e[1]=y[u+(p+1)%3],e.sort(i);var d=e.toString();void 0===r[d]&&(c[2*h]=e[0],c[2*h+1]=e[1],r[d]=!0,h++)}for(var m=new Float32Array(2*h*3),u=0,l=h;l>u;u++)for(var p=0;2>p;p++){var v=6*u+3*p,T=c[2*u+p];m[v+0]=a.getX(T),m[v+1]=a.getY(T),m[v+2]=a.getZ(T)}this.addAttribute("position",new n.BufferAttribute(m,3))}else{for(var a=t.attributes.position.array,h=a.length/3,C=h/3,m=new Float32Array(2*h*3),u=0,l=C;l>u;u++)for(var p=0;3>p;p++){var v=18*u+6*p,A=9*u+3*p;m[v+0]=a[A],m[v+1]=a[A+1],m[v+2]=a[A+2];var T=9*u+3*((p+1)%3);m[v+3]=a[T],m[v+4]=a[T+1],m[v+5]=a[T+2]}this.addAttribute("position",new n.BufferAttribute(m,3))}},n.WireframeGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.WireframeGeometry.prototype.constructor=n.WireframeGeometry,n.AxisHelper=function(t){t=t||1;var e=new Float32Array([0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new n.BufferGeometry;i.addAttribute("position",new n.BufferAttribute(e,3)),i.addAttribute("color",new n.BufferAttribute(r,3));var o=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.LineSegments.call(this,i,o)},n.AxisHelper.prototype=Object.create(n.LineSegments.prototype),n.AxisHelper.prototype.constructor=n.AxisHelper,n.ArrowHelper=function(){var t=new n.Geometry;t.vertices.push(new n.Vector3(0,0,0),new n.Vector3(0,1,0));var e=new n.CylinderGeometry(0,.5,1,5,1);return e.translate(0,-.5,0),function(r,i,o,a,s,h){n.Object3D.call(this),void 0===a&&(a=16776960),void 0===o&&(o=1),void 0===s&&(s=.2*o),void 0===h&&(h=.2*s),this.position.copy(i),o>s&&(this.line=new n.Line(t,new n.LineBasicMaterial({color:a})),this.line.matrixAutoUpdate=!1,this.add(this.line)),this.cone=new n.Mesh(e,new n.MeshBasicMaterial({color:a})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(o,s,h)}}(),n.ArrowHelper.prototype=Object.create(n.Object3D.prototype),n.ArrowHelper.prototype.constructor=n.ArrowHelper,n.ArrowHelper.prototype.setDirection=function(){var t,e=new n.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),n.ArrowHelper.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),t>e&&(this.line.scale.set(1,t-e,1),this.line.updateMatrix()),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},n.ArrowHelper.prototype.setColor=function(t){void 0!==this.line&&this.line.material.color.set(t),this.cone.material.color.set(t)},n.BoxHelper=function(t){var e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new n.BufferGeometry;i.setIndex(new n.BufferAttribute(e,1)),i.addAttribute("position",new n.BufferAttribute(r,3)),n.LineSegments.call(this,i,new n.LineBasicMaterial({color:16776960})),void 0!==t&&this.update(t)},n.BoxHelper.prototype=Object.create(n.LineSegments.prototype),n.BoxHelper.prototype.constructor=n.BoxHelper,n.BoxHelper.prototype.update=function(){var t=new n.Box3;return function(e){if(t.setFromObject(e),!t.empty()){var r=t.min,n=t.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),n.BoundingBoxHelper=function(t,e){var r=void 0!==e?e:8947848;this.object=t,this.box=new n.Box3,n.Mesh.call(this,new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial({color:r,wireframe:!0}))},n.BoundingBoxHelper.prototype=Object.create(n.Mesh.prototype),n.BoundingBoxHelper.prototype.constructor=n.BoundingBoxHelper,n.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},n.CameraHelper=function(t){function e(t,e,n){r(t,n),r(e,n)}function r(t,e){i.vertices.push(new n.Vector3),i.colors.push(new n.Color(e)),void 0===a[t]&&(a[t]=[]),a[t].push(i.vertices.length-1)}var i=new n.Geometry,o=new n.LineBasicMaterial({color:16777215,vertexColors:n.FaceColors}),a={},s=16755200,h=16711680,c=43775,u=16777215,l=3355443;e("n1","n2",s),e("n2","n4",s),e("n4","n3",s),e("n3","n1",s),e("f1","f2",s),e("f2","f4",s),e("f4","f3",s),e("f3","f1",s),e("n1","f1",s),e("n2","f2",s),e("n3","f3",s),e("n4","f4",s),e("p","n1",h),e("p","n2",h),e("p","n3",h),e("p","n4",h),e("u1","u2",c),e("u2","u3",c),e("u3","u1",c),e("c","t",u),e("p","c",l),e("cn1","cn2",l),e("cn3","cn4",l),e("cf1","cf2",l),e("cf3","cf4",l),n.LineSegments.call(this,i,o),this.camera=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},n.CameraHelper.prototype=Object.create(n.LineSegments.prototype),n.CameraHelper.prototype.constructor=n.CameraHelper,n.CameraHelper.prototype.update=function(){var t,e,r=new n.Vector3,i=new n.Camera,o=function(n,o,a,s){r.set(o,a,s).unproject(i);var h=e[n];if(void 0!==h)for(var c=0,u=h.length;u>c;c++)t.vertices[h[c]].copy(r)};return function(){t=this.geometry,e=this.pointMap;var r=1,n=1;i.projectionMatrix.copy(this.camera.projectionMatrix),o("c",0,0,-1),o("t",0,0,1),o("n1",-r,-n,-1),o("n2",r,-n,-1),o("n3",-r,n,-1),o("n4",r,n,-1),o("f1",-r,-n,1),o("f2",r,-n,1),o("f3",-r,n,1),o("f4",r,n,1),o("u1",.7*r,1.1*n,-1),o("u2",.7*-r,1.1*n,-1),o("u3",0,2*n,-1),o("cf1",-r,0,1),o("cf2",r,0,1),o("cf3",0,-n,1),o("cf4",0,n,1),o("cn1",-r,0,-1),o("cn2",r,0,-1),o("cn3",0,-n,-1),o("cn4",0,n,-1),t.verticesNeedUpdate=!0}}(),n.DirectionalLightHelper=function(t,e){n.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,e=e||1;var r=new n.Geometry;r.vertices.push(new n.Vector3(-e,e,0),new n.Vector3(e,e,0),new n.Vector3(e,-e,0),new n.Vector3(-e,-e,0),new n.Vector3(-e,e,0));var i=new n.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new n.Line(r,i),this.add(this.lightPlane),r=new n.Geometry,r.vertices.push(new n.Vector3,new n.Vector3),i=new n.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new n.Line(r,i),this.add(this.targetLine),this.update()},n.DirectionalLightHelper.prototype=Object.create(n.Object3D.prototype),n.DirectionalLightHelper.prototype.constructor=n.DirectionalLightHelper,n.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},n.DirectionalLightHelper.prototype.update=function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Vector3;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),n.EdgesHelper=function(t,e,r){var i=void 0!==e?e:16777215;n.LineSegments.call(this,new n.EdgesGeometry(t.geometry,r),new n.LineBasicMaterial({color:i})),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1},n.EdgesHelper.prototype=Object.create(n.LineSegments.prototype),n.EdgesHelper.prototype.constructor=n.EdgesHelper,n.FaceNormalsHelper=function(t,e,r,i){this.object=t,this.size=void 0!==e?e:1;var o=void 0!==r?r:16776960,a=void 0!==i?i:1,s=0,h=this.object.geometry;h instanceof n.Geometry?s=h.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var c=new n.BufferGeometry,u=new n.Float32Attribute(2*s*3,3);c.addAttribute("position",u),n.LineSegments.call(this,c,new n.LineBasicMaterial({color:o,linewidth:a})),this.matrixAutoUpdate=!1,this.update()},n.FaceNormalsHelper.prototype=Object.create(n.LineSegments.prototype),n.FaceNormalsHelper.prototype.constructor=n.FaceNormalsHelper,n.FaceNormalsHelper.prototype.update=function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Matrix3;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,h=0,c=0,u=s.length;u>c;c++){var l=s[c],f=l.normal;t.copy(a[l.a]).add(a[l.b]).add(a[l.c]).divideScalar(3).applyMatrix4(n),e.copy(f).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),i.setXYZ(h,t.x,t.y,t.z),h+=1,i.setXYZ(h,e.x,e.y,e.z),h+=1}return i.needsUpdate=!0,this}}(),n.GridHelper=function(t,e){var r=new n.Geometry,i=new n.LineBasicMaterial({vertexColors:n.VertexColors});this.color1=new n.Color(4473924),this.color2=new n.Color(8947848);for(var o=-t;t>=o;o+=e){r.vertices.push(new n.Vector3(-t,0,o),new n.Vector3(t,0,o),new n.Vector3(o,0,-t),new n.Vector3(o,0,t));var a=0===o?this.color1:this.color2;r.colors.push(a,a,a,a)}n.LineSegments.call(this,r,i)},n.GridHelper.prototype=Object.create(n.LineSegments.prototype),n.GridHelper.prototype.constructor=n.GridHelper,n.GridHelper.prototype.setColors=function(t,e){this.color1.set(t),this.color2.set(e),this.geometry.colorsNeedUpdate=!0},n.HemisphereLightHelper=function(t,e){n.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new n.Color,new n.Color];var r=new n.SphereGeometry(e,4,2);
r.rotateX(-Math.PI/2);for(var i=0,o=8;o>i;i++)r.faces[i].color=this.colors[4>i?0:1];var a=new n.MeshBasicMaterial({vertexColors:n.FaceColors,wireframe:!0});this.lightSphere=new n.Mesh(r,a),this.add(this.lightSphere),this.update()},n.HemisphereLightHelper.prototype=Object.create(n.Object3D.prototype),n.HemisphereLightHelper.prototype.constructor=n.HemisphereLightHelper,n.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},n.HemisphereLightHelper.prototype.update=function(){var t=new n.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),n.PointLightHelper=function(t,e){this.light=t,this.light.updateMatrixWorld();var r=new n.SphereGeometry(e,4,2),i=new n.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.Mesh.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},n.PointLightHelper.prototype=Object.create(n.Mesh.prototype),n.PointLightHelper.prototype.constructor=n.PointLightHelper,n.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},n.SkeletonHelper=function(t){this.bones=this.getBoneList(t);for(var e=new n.Geometry,r=0;r<this.bones.length;r++){var i=this.bones[r];i.parent instanceof n.Bone&&(e.vertices.push(new n.Vector3),e.vertices.push(new n.Vector3),e.colors.push(new n.Color(0,0,1)),e.colors.push(new n.Color(0,1,0)))}e.dynamic=!0;var o=new n.LineBasicMaterial({vertexColors:n.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});n.LineSegments.call(this,e,o),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()},n.SkeletonHelper.prototype=Object.create(n.LineSegments.prototype),n.SkeletonHelper.prototype.constructor=n.SkeletonHelper,n.SkeletonHelper.prototype.getBoneList=function(t){var e=[];t instanceof n.Bone&&e.push(t);for(var r=0;r<t.children.length;r++)e.push.apply(e,this.getBoneList(t.children[r]));return e},n.SkeletonHelper.prototype.update=function(){for(var t=this.geometry,e=(new n.Matrix4).getInverse(this.root.matrixWorld),r=new n.Matrix4,i=0,o=0;o<this.bones.length;o++){var a=this.bones[o];a.parent instanceof n.Bone&&(r.multiplyMatrices(e,a.matrixWorld),t.vertices[i].setFromMatrixPosition(r),r.multiplyMatrices(e,a.parent.matrixWorld),t.vertices[i+1].setFromMatrixPosition(r),i+=2)}t.verticesNeedUpdate=!0,t.computeBoundingSphere()},n.SpotLightHelper=function(t){n.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;var e=new n.CylinderGeometry(0,1,1,8,1,!0);e.translate(0,-.5,0),e.rotateX(-Math.PI/2);var r=new n.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new n.Mesh(e,r),this.add(this.cone),this.update()},n.SpotLightHelper.prototype=Object.create(n.Object3D.prototype),n.SpotLightHelper.prototype.constructor=n.SpotLightHelper,n.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.SpotLightHelper.prototype.update=function(){var t=new n.Vector3,e=new n.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),n.VertexNormalsHelper=function(t,e,r,i){this.object=t,this.size=void 0!==e?e:1;var o=void 0!==r?r:16711680,a=void 0!==i?i:1,s=0,h=this.object.geometry;h instanceof n.Geometry?s=3*h.faces.length:h instanceof n.BufferGeometry&&(s=h.attributes.normal.count);var c=new n.BufferGeometry,u=new n.Float32Attribute(2*s*3,3);c.addAttribute("position",u),n.LineSegments.call(this,c,new n.LineBasicMaterial({color:o,linewidth:a})),this.matrixAutoUpdate=!1,this.update()},n.VertexNormalsHelper.prototype=Object.create(n.LineSegments.prototype),n.VertexNormalsHelper.prototype.constructor=n.VertexNormalsHelper,n.VertexNormalsHelper.prototype.update=function(){var t=new n.Vector3,e=new n.Vector3,r=new n.Matrix3;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var o=this.object.matrixWorld,a=this.geometry.attributes.position,s=this.object.geometry;if(s instanceof n.Geometry)for(var h=s.vertices,c=s.faces,u=0,l=0,f=c.length;f>l;l++)for(var p=c[l],d=0,m=p.vertexNormals.length;m>d;d++){var g=h[p[i[d]]],v=p.vertexNormals[d];t.copy(g).applyMatrix4(o),e.copy(v).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),a.setXYZ(u,t.x,t.y,t.z),u+=1,a.setXYZ(u,e.x,e.y,e.z),u+=1}else if(s instanceof n.BufferGeometry)for(var y=s.attributes.position,b=s.attributes.normal,u=0,d=0,m=y.count;m>d;d++)t.set(y.getX(d),y.getY(d),y.getZ(d)).applyMatrix4(o),e.set(b.getX(d),b.getY(d),b.getZ(d)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),a.setXYZ(u,t.x,t.y,t.z),u+=1,a.setXYZ(u,e.x,e.y,e.z),u+=1;return a.needsUpdate=!0,this}}(),n.WireframeHelper=function(t,e){var r=void 0!==e?e:16777215;n.LineSegments.call(this,new n.WireframeGeometry(t.geometry),new n.LineBasicMaterial({color:r})),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1},n.WireframeHelper.prototype=Object.create(n.LineSegments.prototype),n.WireframeHelper.prototype.constructor=n.WireframeHelper,n.ImmediateRenderObject=function(){n.Object3D.call(this),this.render=function(t){}},n.ImmediateRenderObject.prototype=Object.create(n.Object3D.prototype),n.ImmediateRenderObject.prototype.constructor=n.ImmediateRenderObject,n.MorphBlendMesh=function(t,e){n.Mesh.call(this,t,e),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",o=0,a=r-1,s=r/1;this.createAnimation(i,o,a,s),this.setAnimationWeight(i,1)},n.MorphBlendMesh.prototype=Object.create(n.Mesh.prototype),n.MorphBlendMesh.prototype.constructor=n.MorphBlendMesh,n.MorphBlendMesh.prototype.createAnimation=function(t,e,r,n){var i={start:e,end:r,length:r-e+1,fps:n,duration:(r-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=i,this.animationsList.push(i)},n.MorphBlendMesh.prototype.autoCreateAnimations=function(t){for(var e,r=/([a-z]+)_?(\d+)/,n={},i=this.geometry,o=0,a=i.morphTargets.length;a>o;o++){var s=i.morphTargets[o],h=s.name.match(r);if(h&&h.length>1){var c=h[1];n[c]||(n[c]={start:1/0,end:-(1/0)});var u=n[c];o<u.start&&(u.start=o),o>u.end&&(u.end=o),e||(e=c)}}for(var c in n){var u=n[c];this.createAnimation(c,u.start,u.end,t)}this.firstAnimation=e},n.MorphBlendMesh.prototype.setAnimationDirectionForward=function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},n.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},n.MorphBlendMesh.prototype.setAnimationFPS=function(t,e){var r=this.animationsMap[t];r&&(r.fps=e,r.duration=(r.end-r.start)/r.fps)},n.MorphBlendMesh.prototype.setAnimationDuration=function(t,e){var r=this.animationsMap[t];r&&(r.duration=e,r.fps=(r.end-r.start)/r.duration)},n.MorphBlendMesh.prototype.setAnimationWeight=function(t,e){var r=this.animationsMap[t];r&&(r.weight=e)},n.MorphBlendMesh.prototype.setAnimationTime=function(t,e){var r=this.animationsMap[t];r&&(r.time=e)},n.MorphBlendMesh.prototype.getAnimationTime=function(t){var e=0,r=this.animationsMap[t];return r&&(e=r.time),e},n.MorphBlendMesh.prototype.getAnimationDuration=function(t){var e=-1,r=this.animationsMap[t];return r&&(e=r.duration),e},n.MorphBlendMesh.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("THREE.MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},n.MorphBlendMesh.prototype.stopAnimation=function(t){var e=this.animationsMap[t];e&&(e.active=!1)},n.MorphBlendMesh.prototype.update=function(t){for(var e=0,r=this.animationsList.length;r>e;e++){var i=this.animationsList[e];if(i.active){var o=i.duration/i.length;i.time+=i.direction*t,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var a=i.start+n.Math.clamp(Math.floor(i.time/o),0,i.length-1),s=i.weight;a!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*s,this.morphTargetInfluences[a]=0,i.lastFrame=i.currentFrame,i.currentFrame=a);var h=i.time%o/o;i.directionBackwards&&(h=1-h),i.currentFrame!==i.lastFrame?(this.morphTargetInfluences[i.currentFrame]=h*s,this.morphTargetInfluences[i.lastFrame]=(1-h)*s):this.morphTargetInfluences[i.currentFrame]=s}}}},{}],15:[function(t,e,r){!function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var t=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-t}}}();var n=n||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)},update:function(e){if(0===t.length)return!1;var r=0;for(e=void 0!==e?e:window.performance.now();r<t.length;)t[r].update(e)?r++:t.splice(r,1);return!0}}}();n.Tween=function(t){var e=t,r={},i={},o={},a=1e3,s=0,h=!1,c=!1,u=!1,l=0,f=null,p=n.Easing.Linear.None,d=n.Interpolation.Linear,m=[],g=null,v=!1,y=null,b=null,x=null;for(var w in t)r[w]=parseFloat(t[w],10);this.to=function(t,e){return void 0!==e&&(a=e),i=t,this},this.start=function(t){n.add(this),c=!0,v=!1,f=void 0!==t?t:window.performance.now(),f+=l;for(var a in i){if(i[a]instanceof Array){if(0===i[a].length)continue;i[a]=[e[a]].concat(i[a])}r[a]=e[a],r[a]instanceof Array==!1&&(r[a]*=1),o[a]=r[a]||0}return this},this.stop=function(){return c?(n.remove(this),c=!1,null!==x&&x.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=m.length;e>t;t++)m[t].stop()},this.delay=function(t){return l=t,this},this.repeat=function(t){return s=t,this},this.yoyo=function(t){return h=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return m=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return b=t,this},this.onStop=function(t){return x=t,this},this.update=function(t){var n,c,x;if(f>t)return!0;v===!1&&(null!==g&&g.call(e),v=!0),c=(t-f)/a,c=c>1?1:c,x=p(c);for(n in i){var w=r[n]||0,M=i[n];M instanceof Array?e[n]=d(M,x):("string"==typeof M&&(M=w+parseFloat(M,10)),"number"==typeof M&&(e[n]=w+(M-w)*x))}if(null!==y&&y.call(e,x),1===c){if(s>0){isFinite(s)&&s--;for(n in o){if("string"==typeof i[n]&&(o[n]=o[n]+parseFloat(i[n],10)),h){var S=o[n];o[n]=i[n],i[n]=S}r[n]=o[n]}return h&&(u=!u),f=t+l,!0}null!==b&&b.call(e);for(var _=0,E=m.length;E>_;_++)m[_].start(f+a);return!1}return!0}},n.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,r=.1,n=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=n/4):e=n*Math.asin(1/r)/(2*Math.PI),-(r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)))},Out:function(t){var e,r=.1,n=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=n/4):e=n*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/n)+1)},InOut:function(t){var e,r=.1,n=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=n/4):e=n*Math.asin(1/r)/(2*Math.PI),(t*=2)<1?-.5*(r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)):r*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*n.Easing.Bounce.In(2*t):.5*n.Easing.Bounce.Out(2*t-1)+.5}}},n.Interpolation={Linear:function(t,e){var r=t.length-1,i=r*e,o=Math.floor(i),a=n.Interpolation.Utils.Linear;return 0>e?a(t[0],t[1],i):e>1?a(t[r],t[r-1],r-i):a(t[o],t[o+1>r?r:o+1],i-o)},Bezier:function(t,e){for(var r=0,i=t.length-1,o=Math.pow,a=n.Interpolation.Utils.Bernstein,s=0;i>=s;s++)r+=o(1-e,i-s)*o(e,s)*t[s]*a(i,s);return r},CatmullRom:function(t,e){var r=t.length-1,i=r*e,o=Math.floor(i),a=n.Interpolation.Utils.CatmullRom;return t[0]===t[r]?(0>e&&(o=Math.floor(i=r*(1+e))),a(t[(o-1+r)%r],t[o],t[(o+1)%r],t[(o+2)%r],i-o)):0>e?t[0]-(a(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[r]-(a(t[r],t[r],t[r-1],t[r-1],i-r)-t[r]):a(t[o?o-1:0],t[o],t[o+1>r?r:o+1],t[o+2>r?r:o+2],i-o)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(t,e){var r=n.Interpolation.Utils.Factorial;return r(t)/r(e)/r(t-e)},Factorial:function(){var t=[1];return function(e){var r=1;if(t[e])return t[e];for(var n=e;n>1;n--)r*=n;return t[e]=r,r}}(),CatmullRom:function(t,e,r,n,i){var o=.5*(r-t),a=.5*(n-e),s=i*i,h=i*s;return(2*e-2*r+o+a)*h+(-3*e+3*r-2*o-a)*s+o*i+e}}},function(t){"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof r?e.exports=n:t.TWEEN=n}(this)},{}]},{},[6]);